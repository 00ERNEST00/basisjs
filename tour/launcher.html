<!doctype html>

<html>
<head>
  <title>basis.js tour code launcher</title>

  <style>
    #basis-tour-console
    {
      border: 1px solid #E0E0E0;
    }
    .basis-tour-message
    {
      padding: 2px 4px;
    }
    .basis-tour-message_warn
    {
      color: red;
    }
    .basis-tour-message_info
    {
      color: orange;
    }
  </style>

  <script>
    var virtualConsole = document.createElement('div');
    virtualConsole.id = 'basis-tour-console';

    window.console = (function(console){
      var methods = ['log', 'warn', 'info'];

      var F = function(){};
      F.prototype = console;
      var res = new F;  // inherit all non-wrap methods of console

      function tourConsoleMessage(value, type){
        var el = document.createElement('div');
        el.className = 'basis-tour-message basis-tour-message_' + type;
        el.appendChild(document.createTextNode(String(value)));
        virtualConsole.appendChild(el);
      }

      function wrapMethod(methodName){
        return function(){
          tourConsoleMessage(Array.prototype.slice.call(arguments).join(' '), methodName);
          if (console)
            Function.prototype.apply.call(console[methodName], console, arguments);
        }        
      }

      for (var i = 0, method; method = methods[i++];) {
        res[method] = wrapMethod(method);
      }

      return res;
    })(window.console);
  </script>
  <script src="../src/basis.js" basis-config></script>
</head>
<body>
  <script>
    window.onerror = function(message){
      document.write(message);
    }

    document.write(+new Date);

    basis.ready(function(){
      document.body.appendChild(virtualConsole);

      if (top.launcherCallback)
      {
        try {
          Function(top.launcherCallback())();
        } catch(e) {
          document.write('<div style="font-weight: bold; color: #AA0000;">Syntax error: ' + e.message + '</div>');
        }
      }
      else
        document.write('<div style="font-weight: bold; color: #AA0000;">Sorry, but I have no required environment</div>')
    });
  </script>
</body>
</html>