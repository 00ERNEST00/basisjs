/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(j){function q(a,c){for(var d in c)a[d]=c[d];return a}function r(a,c){for(var d in c)!1==d in a&&(a[d]=c[d]);return a}function y(a){return null==a||void 0==a}function t(a){return a}function z(a){var c={};a.names=function(a){return Object.slice(c,"string"==typeof a?a.qw():a)};a.extend=function(a){r(c,a);q(this,a);return this};return a}function x(a,c){for(var d=a.split("."),b=j,f,e,g;d.length;)if(f=d.shift(),e=(e?e+".":"")+f,b[f]||(b[f]=z((!d.length?c:null)||function(){},e),g&&(g.namespaces_[e]=
b[f])),b=b[f],!g&&(g=b,!g.namespaces_))g.namespaces_={};return o[a]=b}q(Object,{extend:q,complete:r,keys:function(a){var c=[],d;for(d in a)c.push(d);return c},values:function(a){var c=[],d;for(d in a)c.push(a[d]);return c},slice:function(a,c){var d={};if(!c)return q(d,a);for(var b=0,f;f=c[b++];)f in a&&(d[f]=a[f]);return d},splice:function(a,c){var d={};if(!c)return q(d,a);for(var b=0,f;f=c[b++];)f in a&&(d[f]=a[f],delete a[f]);return d},iterate:function(a,c,d){var b=[],f;for(f in a)b.push(c.call(d,
f,a[f]));return b},coalesce:function(){for(var a=arguments,c=0;c<a.length;c++)if(null!=a[c])return a[c]}});var v=function(){},u=function(){var a=1,c={},d={};a++;return function(b,f){var e,g;if(!f){if(b.getter)return b.getter;if("function"==typeof b)return b}if("function"!=typeof b)d[b]?e=d[b]:(e=new Function("object","return object != null ? object."+b+" : object"),e.path=b,e.getterIdx_=a++,d[b]=e);else if(e=b,!e.getterIdx_)e.getterIdx_=a++;g=e.getterIdx_;var k=c[g];if(k)if("undefined"==typeof f){if(k.nmg)return k.nmg}else for(g=
0;g<k.length;g++){if(k[g].modificator===f)return k[g].getter}else k=c[g]=[];var i=!0;switch(f&&typeof f){case "string":g=function(a){return f.format(e(a))};break;case "function":g=function(a){return f(e(a))};break;case "object":i=!1;g=function(a){return f[e(a)]};break;default:g=e.path?e:function(a){return e(a)}}if(i&&(k.push({getter:g,modificator:f}),"undefined"==typeof f))k.nmg=g;return g.getter=g}}();q(Function,{$undefined:function(a){return void 0==a},$defined:function(a){return void 0!=a},$isNull:y,
$isNotNull:function(a){return null!=a&&void 0!=a},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:t,$const:function(a){return function(){return a}},$false:function(){return!1},$true:function(){return!0},$null:function(){return null},$undef:v,getter:u,def:function(a,c,d){d=d||y;return function(b){b=a(b);return d(b)?c:b}},wrapper:function(a){return function(c){var d={};d[a]=c;return d}},lazyInit:function(a,c){var d=0,b;return function(){d++||(b=a.apply(c||this,arguments));
return b}},lazyInitAndRun:function(a,c,d){var b=0,f;return function(){b++||(f=a.call(d||this));c.apply(f,arguments);return f}},runOnce:function(a,c){var d=0;return function(){if(!d++)return a.apply(c||this,arguments)}}});r(Function.prototype,{bind:function(a){var c=this,d=Array.from(arguments,1);return d.length?function(){return c.apply(a,d.concat.apply(d,arguments))}:function(){return c.apply(a,arguments)}}});r(Array,{isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)}});
q(Array,{from:function(a,c){if(null!=a){var d=a.length;if("undefined"==typeof d)return[a];c||(c=0);if(0<d-c){for(var b=[],f=0,e=c;e<d;)b[f++]=a[e++];return b}}return[]},create:function(a,c,d){for(var b=[],f="function"==typeof c,e=0;e<a;e++)b[e]=f?c.call(d,e,b):c;return b}});r(Array.prototype,{indexOf:function(a,c){c=parseInt(c)||0;if(0>c)return-1;for(;c<this.length;c++)if(this[c]===a)return c;return-1},lastIndexOf:function(a,c){for(var d=this.length,c=parseInt(c),c=isNaN(c)||c>=d?d-1:(c+d)%d;0<=c;c--)if(this[c]===
a)return c;return-1},forEach:function(a,c){for(var d=0,b=this.length;d<b;d++)d in this&&a.call(c,this[d],d,this)},every:function(a,c){for(var d=0,b=this.length;d<b;d++)if(d in this&&!a.call(c,this[d],d,this))return!1;return!0},some:function(a,c){for(var d=0,b=this.length;d<b;d++)if(d in this&&a.call(c,this[d],d,this))return!0;return!1},filter:function(a,c){for(var d=[],b=0,f=this.length;b<f;b++)b in this&&a.call(c,this[b],b,this)&&d.push(this[b]);return d},map:function(a,c){for(var d=[],b=0,f=this.length;b<
f;b++)b in this&&(d[b]=a.call(c,this[b],b,this));return d},reduce:function(a,c){var d=this.length,b=arguments.length;if(0==d&&1==b)throw new TypeError;var f,e=0;1<b&&(f=c,e=1);for(b=0;b<d;b++)b in this&&(f=e++?a.call(null,f,this[b],b,this):this[b]);return f}});q(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[0<=a?a:this.length+a]},search:function(a,c,d){Array.lastSearchIndex=
-1;for(var c=Function.getter(c||t),d=parseInt(d)||0,b=this.length;d<b;d++)if(c(this[d])===a)return this[Array.lastSearchIndex=d]},lastSearch:function(a,c,d){Array.lastSearchIndex=-1;for(var c=Function.getter(c||t),b=this.length,d=isNaN(d)||null==d?b:parseInt(d),b=d>b?b:d;0<b--;)if(c(this[b])===a)return this[Array.lastSearchIndex=b]},binarySearchPos:function(a,c,d,b,f,e){if(!this.length)return b?-1:0;var c=Function.getter(c||t),d=!!d,g,f=isNaN(f)?0:f,k=isNaN(e)?this.length-1:e;do if(e=f+k>>1,g=c(this[e]),
d?a>g:a<g)k=e-1;else if(d?a<g:a>g)f=e+1;else return a==g?e:b?-1:0;while(f<=k);return b?-1:e+(g<a^d)},binarySearch:function(a,c){return this.binarySearchPos(a,c,!1,!0)},add:function(a){return-1==this.indexOf(a)&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return-1!=a&&!!this.splice(a,1)},has:function(a){return-1!=this.indexOf(a)},merge:function(a){return this.reduce(q,a||{})},sortAsObject:function(a,c,d){a=Function.getter(a);d=d?-1:1;return this.map(function(d,c){return{i:c,v:a(d)}}).sort(c||
function(a,c){return d*(a.v>c.v||-(a.v<c.v)||(a.i>c.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){if(this!==a)this.length=0,this.push.apply(this,a);return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var w=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);if(2>a.length)a[1]=this.length;return w.apply(this,a)}}var p={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",
nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};r(String,{toLowerCase:function(a){return(""+a).toLowerCase()},toUpperCase:function(a){return(""+a).toUpperCase()},trim:function(a){return(""+a).trim()},trimLeft:function(a){return(""+a).trimLeft()},trimRight:function(a){return(""+a).trimRight()},isEmpty:function(a){return null==a||""==""+a},isNotEmpty:function(a){return null!=a&&""!=""+a}});r(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,
"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});q(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(c){if(a)throw c;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],c=this.length,d=0;d<c;d++)a[d]=this.charAt(d);return a},repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,
"\\$&")},format:function(a){for(var c={},d=0;d<arguments.length;d++)c[d]=arguments[d];"object"==typeof a&&q(c,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(a,d,e,g,k){a=d in c?c[d]:k?"":a;return e&&!isNaN(a)?(a=Number(a),"."==e?a.toFixed(g):a.lead(g)):a})},quote:function(a,c){var a=a||'"',c=c||p[a]||a,d=(1==a.length?a:"")+(1==c.length?c:"");return a+(d?this.replace(RegExp("["+d.forRegExp()+"]","g"),"\\$&"):this)+c},capitalize:function(){return this.charAt(0).toUpperCase()+
this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,c){return c.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});String.format=String.prototype.format;if(11!="|||".split(/\|/).length+"|||".split(/(\|)/).length)String.prototype.split=function(a){if(""==a||a&&""==a.source)return this.toArray();var c=[],d=0,b;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));b=a.exec(this);)b[0]=
this.substring(d,b.index),c.push.apply(c,b),d=a.lastIndex;else for(;-1!=(b=this.indexOf(a,d));)c.push(this.substring(d,b)),d=b+a.length;c.push(this.substr(d));return c};if("2"!="12".substr(-1)){var l=String.prototype.substr;String.prototype.substr=function(a,c){return l.call(this,0>a?Math.max(0,this.length+a):a,c)}}q(Number.prototype,{fit:function(a,c){return!isNaN(a)&&this<a?Number(a):!isNaN(c)&&this>c?Number(c):this},between:function(a,c){return!isNaN(this)&&this>=a&&this<=c},quote:function(a,c){return(this+
"").quote(a,c)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return 0>this?-1:+(0<this)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},lead:function(a,c){return(this+"").replace(/\d+/,function(d){return 1<(a-=d.length-1)?Array(a).join(c||0)+d:d})},group:function(a,c){return(this+"").replace(/\d+/,function(d){return d.replace(/\d/g,function(b,f){return!f+(d.length-f)%(a||3)?b:(c||" ")+b})})},format:function(a,c,d,b,f){a=this.toFixed(a);if(c||f)a=
a.replace(/(\d+)(\.?)/,function(a,d,b){return(c?Number(d).group(3,c):d)+(b?f||b:"")});d&&(a=a.replace(/^-?/,"$&"+(d||"")));return a+(b||"")}});r(Date,{now:function(){return+new Date}});1900>(new Date).getYear()&&q(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&100>a?Number(a)+1900:a)}});var o={},s=function(){function a(a,d){for(var b=o[a],c=d?d.split(/\./):[];b&&c.length;)b=b[c.shift()];return b}var c=j.document?j.document.getElementsByTagName("SCRIPT"):
null,d=(c?c[c.length-1].src:module.filename).replace(/[^\/]+$/,""),b={},f;"function"==typeof require?f=function(a){return require(requirePath+a.replace(/\./g,"/"))}:(f=function(c,g){var k=c.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],i=c.substr(k.length?k.length+1:0),A=a(k,i),F=/^basis\./.test(k)?d:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!o[k]||!A)if(/^https?:/.test(F)){if(b[c])throw"Attempt to load namespace, probably cycle require";b[c]=1;var F=F+
(g||"")+c.replace(/\./g,"/")+".js",D=new XMLHttpRequest;D.open("POST",F,!1);D.send(null);if(200==D.status){try{(new Function(D.responseText)).call(j)}catch(n){throw n;}f.sequence.push(c.replace(/\./g,"/")+".js")}else if(404==D.status&&i)s(k);else throw"unable to load module "+c+" by basis.require()";}else throw"Path `"+c+"` can't be resolved";return A||a(k,i)},f.sequence=[]);return f}(),h=function(){function a(a){return"function"==typeof a&&a.basisClass_}var c=Function(),d=1,b={},f=function(){for(var a in{toString:1})return;
return!0}();q(c,{className:"basis.Class",extendConstructor_:!1,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=v}},create:function(f){"function"!=typeof f&&(f=c);var i=Function();i.prototype=f.prototype;for(var i=new i,e={className:f.className+"._SubClass_",basisClass_:!0,superClass_:f,extendConstructor_:!!f.extendConstructor_,__extend__:function(d){return d&&("object"==
typeof d||"function"==typeof d&&!a(d))&&d!==b?c.create.call(null,h,d):d},extend:c.extend,subclass:function(){return c.create.apply(null,[h].concat(Array.from(arguments)))},prototype:i},g=arguments,D=1;D<g.length;D++)e.extend("function"==typeof g[D]&&!a(g[D])?g[D](f.prototype):g[D]);var n={},h=e.extendConstructor_?function(a,b){this.eventObjectId=d++;var C,c;for(c in a)C=this[c],this[c]=C&&C.__extend__?C.__extend__(a[c]):a[c];this.init(b||n)}:function(){this.eventObjectId=d++;this.init.apply(this,
arguments)};i.constructor=h;for(var C in i)i[C]===b&&(i[C]=h);q(h,e);return h},extend:function(a){var d=this.prototype;if(a.prototype)a=a.prototype;for(var b in a){var c=a[b],e=d[b];"className"==b||"extendConstructor_"==b?this[b]=c:d[b]=e&&e.__extend__?e.__extend__(c):c}if(f&&a[b="toString"]!==Object.prototype[b])d[b]=a[b];return this}});var e=function(a,d){return{__extend__:function(a){var b=Function();b.prototype=this;b=new b;d(b,a);return b}}.__extend__(a)},g=function(a){return e(a,q)};return x("basis.Class",
c.create).extend({SELF:b,BaseClass:c,create:c.create,isClass:a,CustomExtendProperty:e,ExtensibleProperty:g,NestedExtProperty:function(a){return e(a,function(a,d){for(var b in d){var c=a[b];a[b]=c&&c.__extend__?c.__extend__(d[b]):g(d[b])}})}})}(),n=function(){function a(a){var b=d[a];b||(b=d[a]=function(){var d=this.handlers_,b,f;if(d&&d.length)for(var d=c.call(d),g=d.length;0<g--;)b=d[g],f=b.handler[a],"function"==typeof f&&f.apply(b.thisObject,arguments)});return b}var c=Array.prototype.slice,d=
{},b,f=h(null,{handlers_:null,event_destroy:b=a("destroy","object"),listen:h.NestedExtProperty(),extendConstructor_:!0,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(a,d){var b=this.handlers_;if(!b)b=this.handlers_=[];d||(d=this);for(var c=b.length,f;0<c--;)if(f=b[c],f.handler===a&&f.thisObject===d)return!1;return!!b.push({handler:a,thisObject:d||this})},removeHandler:function(a,d){var b=
this.handlers_;if(b){d||(d=this);for(var c=b.length,f;0<c--;)if(f=b[c],f.handler===a&&f.thisObject===d)return!!b.splice(c,1);return!1}},destroy:function(){if(this.handlers_)b.call(this,this),this.handlers_=null}});f.createEvent=a;f.event=d;return f}(),B=function(){var a=[];return{add:function(c){null!=c&&a.push(c)},remove:function(c){a.remove(c)}}}();(function(){function a(a){if(c){if(a.source!=j||a.data!=d)return;basis.dom.event.kill(a)}b.length&&(a=b.shift(),delete f[a.key],a.fn())}var c="function"==
typeof addEventListener&&"function"==typeof postMessage,d="zeroTimeoutMessage",b=[],f={},e=1;c&&j.addEventListener("message",a,!0);var g=setTimeout;j.setTimeout=function(i,A){var k;A?k=g.call(j,i,A):(k={key:"z"+e++,fn:"function"==typeof i?i:new Function(i)},f[k.key]=k,b.push(k),c?postMessage(d,"*"):k.timer=g.call(j,a,0),k=k.key);return k};var k=clearTimeout;j.clearTimeout=function(a){if(/z\d+/.test(a)){var d=f[a];d&&(clearTimeout(d.timer),b.remove(d),delete f[a])}else return k.call(j,a)}})();var m=
function(){function a(){if(!A)if(e.length){var a=Date.now(),c=Math.max(e[0].eventTime,a);c<k&&(clearTimeout(i),i=setTimeout(d,(k=c)-a))}else i=clearTimeout(i),k=b}function c(d,b){var c=d.eventObjectId,f=g[b]&&g[b][c];f&&(e.remove(f),delete g[b][c],a())}function d(){var d=Date.now(),d=e.binarySearchPos(d+15,f);A=!0;e.splice(0,d).forEach(function(a){delete g[a.eventName][a.object.eventObjectId];a.callback.call(a.object)});A=!1;k=b;a()}var b=2E12,f=u("eventTime"),e=[],g={},k=b,i=null,A=!1;B.add({destroy:function(){A=
!0;clearTimeout(i);e.length=0;g=null}});return{add:function(d,b,i){var A=d.eventObjectId,C=g[b];C||(C=g[b]={});var E=C[A];if(E){if(isNaN(i))return c(d,b);if(E.eventTime==i)return;e.remove(E);E.eventTime=i}else{if(isNaN(i))return;E=C[A]={eventName:b,object:d,eventTime:i,callback:d[b]}}e.splice(e.binarySearchPos(i,f),0,E);a()},remove:c}}();x("basis").extend({namespace:x,platformFeature:{},EventObject:n,TimeEventManager:m,Cleaner:B,require:s});j.basis.locale={}})(this);
(function(j,q){function r(n){for(var h=1E6,n=(""+n).split("."),j=0,a=0;4>j&&j<n.length;j++,h/=100)a+=n[j]*h;return a}function y(){for(var h=0;h<arguments.length;h++){var j=arguments[h].toLowerCase();if(j in z){if(z[j])return!0}else{var m=j.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(m){z[j]=!1;var a=m[1].toLowerCase(),c=r(m[3]),m=m[4]||"=";if(a=x[a])return z[j]=!c||"="==m&&a==c||"+"==m&&a>=c||"-"==m&&a<c}}}return!1}var t="basis.ua",z={},x={},v=q.navigator&&q.navigator.userAgent,u="unknown",w={MSIE:["Internet Explorer",
"msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},p;for(p in w)if(!("MSIE"==p&&q.opera)&&!("Safari"==p&&v.match(/chrome/i))&&!("AppleWebKit"==p&&v.match(/iphone/i))&&v.match(RegExp(p+".(\\d+(\\.\\d+)*)","i")))for(var l=w[p],o=q.opera&&"function"==
typeof q.opera.version?q.opera.version():RegExp.$1,s=r(o),u=l[0]+" "+o,o=0;o<l.length;o++)x[l[o].toLowerCase()]=s;j.platformFeature.datauri=!1;v="undefined"!=typeof Image?new Image:{};v.onload=function(){j.platformFeature.datauri=!0};v.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";if(y("IE7-"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(h){}t=j.namespace(t);t.toString=function(){return u};return t.extend({testImage:v,prettyName:u,test:y,
is:function(h){return y(h)},Cookies:{set:function(h,j,m,a){document.cookie=h+"="+(null==j?"":escape(j))+";path="+(a||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)+(m?";expires="+(new Date(Date.now()+1E3*m)).toGMTString():"")},get:function(h){return(h=document.cookie.match(RegExp("(^|;)\\s*"+h+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(h[2])},remove:function(h,j){document.cookie=h+"=;expires="+(new Date(0)).toGMTString()+";path="+(j||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)}}})})(basis,
this);
(function(j,q){function r(a,b,c){if(null!=b)return a.insertBefore(d(b)?b:x(b),c||null)}function y(a){return u("",a.cloneNode(!0)).innerHTML}function t(a){return d(a)||a&&a.nodeType?a:"string"==typeof a?o.getElementById(a):null}function z(d,c,f){var e,g=[],f="string"==typeof f?getter(f):f||Function.$true;c&26&&f(d)&&g.push(d);switch(c){case 1:case 2:for(e=d;(e=e[n])&&e!==d.document;)f(e)&&g.push(e);break;case 64:for(e=d[B];e;)f(e)&&g.push(e),e=e[m];break;case 4:case 8:d[B]&&(c=new b(d),c.nodes(f,g));
break;case 128:c=new b(d,f);for(c.cursor_=d[m]||d[n];e=c.next();)g.push(e);break;case 256:for(e=d;e=e[m];)f(e)&&g.push(e);break;case 32:f(d[n])&&g.push(d[n]);break;case 512:c=new b(d,f,b.BACKWARD);for(c.cursor_=d[a]||d[n];e=c.next();)g.push(e);break;case 1024:for(e=d;e=e[a];)f(e)&&g.push(e)}return g}function x(a){return o.createTextNode(null!=a?a:"")}function v(){for(var a=o.createDocumentFragment(),d=arguments.length,b=v.array=[],c=0;c<d;c++)b.push(r(a,arguments[c]));return a}function u(a,d){var b=
void 0!=a&&"string"!=typeof a,c=(b?a.description:a)||"",f="div",h=c.match(/^([a-z0-9\_\-]+)(.*)$/i);h&&(f=h[1],c=h[2]);if(""!=c){for(var C=[],E={},L;h=k.exec(c);){if(h[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+c+"\n\nProblem place:\n> "+c.substr(0,h.index)+"--\>"+c.substr(h.index)+"<--");L=h[1]||h[2]||h[3];h[1]?E.id=L:h[2]?C.push(L):"class"!=L&&(E[L]=h[4]?l(h[5],h[6],h[7]):L)}e&&E.name&&/^(input|textarea|select)$/i.test(f)&&(f="<"+f+" name="+E.name+">")}c=
o.createElement(f);if(E){if(E.style&&g)c.style.cssText=E.style;for(var I in E)c.setAttribute(I,E[I],0)}if(C&&C.length)c.className=C.join(" ");1<arguments.length&&r(c,v.apply(0,Array.from(arguments,1).flatten()));if(b&&(a.css&&j.cssom&&j.cssom.setStyle(c,a.css),j.dom.event))for(var J in a)"function"==typeof a[J]?j.dom.event.addHandler(c,J,a[J],c):a[J]instanceof j.dom.event.Handler&&j.dom.event.addHandler(c,J,a[J].handler,a[J].thisObject);return c}function w(a,d){return a[n]?a[n].replaceChild(d,a):
a}function p(a){if(o.selection){var d=o.selection.createRange();0!=d.compareEndPoints("StartToEnd",d)&&d.collapse(a);return d.getBookmark().charCodeAt(2)-2}}var l=Object.coalesce,o=q.document,s=j.Class,h=o.createElement("div"),n="parentNode",B="firstChild",m="nextSibling",a="previousSibling",c;c="function"==typeof h.compareDocumentPosition?function(a,d){return a.compareDocumentPosition(d)}:function(a,d){return a==d?0:a.document!=d.document?33:a.sourceIndex>d.sourceIndex?2|8*d.contains(childA):4|16*
a.contains(childB)};var d;if("undefined"!=typeof Node){if(d=function(a){return a instanceof Node},!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else d=function(a){return a&&a.ownerDocument===o};var b=s(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,d,b){this.setRoot(a);this.setDirection(b);if("function"==typeof d)this.filter=d},setDirection:function(d){Object.extend(this,d?{a:"lastChild",b:a,c:m,d:B}:{a:B,b:m,c:a,d:"lastChild"})},
setRoot:function(a){this.root_=a||o;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,d){var b;d||(d=[]);for(this.reset();b=this.next(a);)d.push(b);return d},next:function(a){var a=a||this.filter,d=this.cursor_||this.root_;do for(var b=d[this.a];!b;){if(d===this.root_)return this.cursor_=null;(b=d[this.b])||(d=d[n])}while(!a(d=b));return this.cursor_=d},prev:function(a){var a=a||
this.filter,d=this.cursor_,b=this.c,c=this.d;do{var f=d?d[b]:this.root_[c];if(f){for(;f[c];)f=f[c];d=f}else d&&(d=d[n]);if(!d||d===this.root_){d=null;break}}while(!a(d));return this.cursor_=d},destroy:function(){this.cursor_=this.root_=null}});b.BACKWARD=!0;var f="textContent innerText nodeValue".qw(),e=function(){var a=o.createElement("input");a.name="a";return!/name/.test(y(a))}(),g;h.setAttribute("style","color: red");g="red"!==h.style.color;var k=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return j.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:b,outerHTML:y,textContent:function(a){for(var d=0,b;b=f[d++];)if(null!=a[b])return a[b];return z(a,4,function(a){return 3==a.nodeType}).map(getter("nodeValue")).join("")},get:t,tag:function(a,d){a=t(a)||o;return"*"==d&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(d||"*"))},axis:z,findAncestor:function(a,d,b){for(;a&&a!==b;){if(d(a))return a;a=a.parentNode}},createElement:u,createText:x,createFragment:v,insert:function(a,
b,c,f){a=t(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(c){case void 0:case "end":f=null;break;case "begin":f=a[B];break;case "before":break;case "after":f=f[m];break;default:f=Number(c).between(0,a.childNodes.length)?a.childNodes[c]:null}c=!d(a);if(!b||!Array.isArray(b))c=c?b&&a.insertBefore(b,f):r(a,b,f);else if(c)for(var c=[],e=0,g=b.length;e<g;e++)c[e]=a.insertBefore(b[e],f);else a.insertBefore(v.apply(0,b),f),c=v.array;return c},remove:function(a){return a[n]?
a[n].removeChild(a):a},replace:w,swap:function(a,d){if(a===d||c(a,d)&25)return!1;w(a,h);w(d,a);w(h,d);return!0},clone:function(a,d){var b=a.cloneNode(!d);b.attachEvent&&z(b,8).forEach(Event.clearHandlers);return b},clear:function(a){for(a=t(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,d,b){var c=[],b=Function.getter(b||Function.$self),f;for(f in d)for(var e=0;e<a.length;e++){var C=b(a[e]);c[e]=d[f](a[e],e,C)?u(f,C):a[e]}return c},setAttribute:function(a,d,b){null==b?a.removeAttribute(d):
a.setAttribute(d,b)},parentOf:function(a,d){return a.contains(d)},isInside:function(a,d){return a==d||d.contains(a)},focus:function(a,d){try{a=t(a),a.focus(),d&&a.select&&a.select()}catch(b){}},setSelectionRange:function(a,d,b){3>arguments.length&&(b=d);if(a.setSelectionRange)a.setSelectionRange(d,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0);c.moveStart("character",d);c.moveEnd("character",b-d);c.select()}},getSelectionStart:function(a){return"undefined"!=typeof a.selectionStart?
a.selectionStart:p(!0)},getSelectionEnd:function(a){return"undefined"!=typeof a.selectionEnd?a.selectionEnd:p(!1)}})})(basis,this);
(function(j,q){function r(a){return a||q.event}function y(a){return"string"==typeof a?l.get(a):a}function t(a){a=r(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function z(a){a=r(a);a.preventDefault?a.preventDefault():a.returnValue=!1}function x(a){var c=Array.from(n[a.type]);if(c)for(var d=c.length;0<d--;){var b=c[d];b.handler.call(b.thisObject,a)}}function v(a,c,d,b){a=y(a);if(!a)throw Error("Event.addHandler: can't attach event listener to undefined");if("function"!=typeof d)throw Error("Event.addHandler: handler must be a function");
a[s]||(a[s]={});var f={handler:d,thisObject:b},e=a[s],g=e[c];if(g){for(a=0;c=g[a];a++)if(c.handler===d&&c.thisObject===b)return;g.push(f)}else g=e[c]=[f],g.fireEvent=function(a){a=r(a);if(B&&a&&"undefined"==typeof a.returnValue){x(a);if(!0===a.cancelBubble)return;if("undefined"==typeof a.returnValue)a.returnValue=!0}for(var d=0,b;b=g[d++];)b.handler.call(b.thisObject,a)},a.addEventListener?a.addEventListener(c,g.fireEvent,!1):a.attachEvent("on"+c,g.fireEvent)}function u(a,c,d,b){var a=y(a),f=a[s];
if(f&&(f=f[c]))for(var e=0,g;g=f[e];e++)if(g.handler===d&&g.thisObject===b){f.splice(e,1);f.length||w(a,c);break}}function w(a,c){var a=y(a),d=a[s];if(d)if("string"!=typeof c)for(c in d)w(a,c);else{var b=d[c];b&&(a.removeEventListener?a.removeEventListener(c,b.fireEvent,!1):a.detachEvent("on"+c,b.fireEvent),delete d[c])}}var p=q.document,l=j.dom,o=Function.$null,s="__basisEvents",h={mousewheel:["mousewheel","DOMMouseScroll"]},n={},B=!p.addEventListener,m=function(){function a(){c++||setTimeout(function(){for(var a=
0;a<d.length;a++)d[a].callback.call(d[a].thisObject)},10)}var c=!1,d=[];if(j.ua.is("ie7-"))(function(){var d="_"+Date.now();p.write('<script id="'+d+'" defer src="//:"><\/script>');y(d).onreadystatechange=function(){"complete"==this.readyState&&(l.remove(this),a())}})();else if(j.ua.is("safari525-"))var b=setInterval(function(){/loaded|complete/.test(p.readyState)&&(clearInterval(b),a())},15);else v(p,"DOMContentLoaded",a,!1);v(p,"load",a,!1);v(q,"load",a,!1);return function(a,b){c||d.push({callback:a,
thisObject:b})}}();return j.namespace("basis.dom.event",r).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return h[a]||[a]},Handler:function(a,c){this.handler=a;this.thisObject=c},sender:function(a){a=r(a);return a.target||a.srcElement},cancelBubble:t,
cancelDefault:z,kill:function(a,c){(c=y(c))?v(c,a,Event.kill):(z(a),t(a))},key:function(a){a=r(a);return a.keyCode||a.which||0},charCode:function(a){a=r(a);return a.charCode||a.keyCode||0},mouseButton:function(a,c){a=r(a);return"number"==typeof a.which?a.which==c.VALUE:a.button&c.BIT},mouseX:function(a){a=r(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+(p.documentElement.scrollLeft||p.body.scrollLeft)},mouseY:function(a){a=r(a);return a.changedTouches?a.changedTouches[0].pageY:
"pageY"in a?a.pageY:a.clientY+(p.documentElement.scrollTop||p.body.scrollTop)},wheelDelta:function(a){a=r(a);return"wheelDelta"in a?a.wheelDelta/120:"DOMMouseScroll"==a.type?-a.detail/3:0},addGlobalHandler:function(a,c,d){var b=n[a];if(b)for(a=b.length;0<a--;){var f=b[a];if(f.handler===c&&f.thisObject===d)return}else p.addEventListener?p.addEventListener(a,x,!0):v(p,a,o),b=n[a]=[];b.push({handler:c,thisObject:d})},removeGlobalHandler:function(a,c,d){var b=n[a];if(b)for(var f=0,e;e=b[f];f++)if(e.handler===
c&&e.thisObject===d){b.splice(f,1);b.length||(delete n[a],p.removeEventListener?p.removeEventListener(a,x,!0):u(p,a,o));break}},addHandler:v,addHandlers:function(a,c,d){var a=y(a),b;for(b in c)v(a,b,c[b],d)},removeHandler:u,clearHandlers:w,fireEvent:function(a,c){var a=y(a),d=a[s];d&&d[c]&&d[c].fireEvent()},onLoad:m,onUnload:function(a,c){v(q,"unload",a,c)}})})(basis,this);
(function(){function j(a,c,d){for(var b=1,f;c;)c&1&&(f=o[b],d&b?(a.addHandler(f.handler,f.context),f.action(f.context.add,a)):(a.removeHandler(f.handler,f.context),f.action(f.context.remove,a))),c>>=1,b<<=1}function q(a){return Array.isArray(a)?a.map(q):{data:a}}var r=basis.Class,y=basis.EventObject,t=Object.values,z=Function.$self,x=y.createEvent,v=y.event,u={},w=[],p={},l={PRIORITY:[],values_:{},add:function(a,c){var d=a.toUpperCase(),b=a.toLowerCase();this[d]=b;p[b]=!0;c&&(c=this.indexOf(c),-1==
c?this.PRIORITY.push(b):this.PRIORITY.splice(c,0,b))}};l.add("READY");l.add("DEPRECATED");l.add("UNDEFINED");l.add("ERROR");l.add("PROCESSING");var o={},s=1,h={NONE:0,MASK:0,add:function(a,c,d){o[s]={handler:c,action:d,context:{add:function(d,c){if(c){var e=h[a]+"_"+d.eventObjectId;if(!c.subscribers_)c.subscribers_={};if(!c.subscribers_[e]){var g=c.subscriberCount;c.subscribers_[e]=d;c.subscriberCount+=1;c.event_subscribersChanged(c,g)}}},remove:function(d,c){if(c){var e=h[a]+"_"+d.eventObjectId;
if(c.subscribers_[e]){var g=c.subscriberCount;delete c.subscribers_[e];c.subscriberCount-=1;c.event_subscribersChanged(c,g)}}}}};h[a]=s;h.MASK|=s;s<<=1}};h.add("DELEGATE",{delegateChanged:function(a,c){this.remove(a,c);this.add(a,a.delegate)}},function(a,c){a(c,c.delegate)});h.add("TARGET",{targetChanged:function(a,c){this.remove(a,c);this.add(a,a.target)}},function(a,c){a(c,c.target)});var n=r(y,{state:l.READY,data:null,canHaveDelegate:!0,delegate:null,root:null,cascadeDestroy:!1,isTarget:!1,target:null,
active:!1,subscribeTo:h.DELEGATE+h.TARGET,subscriberCount:0,subscribers_:null,event_update:x("update","object","delta"),event_stateChanged:x("stateChanged","object","oldState"),event_delegateChanged:x("delegateChanged","object","oldDelegate"),event_rootChanged:x("rootChanged","object","oldRoot"),event_targetChanged:x("targetChanged","object","oldTarget")&&function(a,c){var d=this.listen.target;d&&(c&&c.removeHandler(d,this),this.target&&this.target.addHandler(d,this));v.targetChanged.call(this,a,
c)},event_subscribersChanged:x("subscribersChanged","object"),event_activeChanged:x("activeChanged","object"),listen:{delegate:{update:function(a,c){this.data=a.data;this.event_update(this,c)},stateChanged:function(a,c){this.state=a.state;this.event_stateChanged(this,c)},targetChanged:function(a,c){this.target=a.target;this.event_targetChanged(this,c)},rootChanged:function(a,c){this.data=a.data;this.event_rootChanged(this,c)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},
init:function(a){y.prototype.init.call(this,a);if(a=this.delegate)this.delegate=null,this.data=a.data,this.state=a.state,this.setDelegate(a);else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&j(this,this.subscribeTo,h.MASK)},isConnected:function(a){if(a instanceof n){for(;a&&a!==this&&a!==a.delegate;)a=a.delegate;return a===this}return!1},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&
a&&a instanceof n){if(a.delegate&&this.isConnected(a))return!1}else a=null;if(this.delegate!==a){var c=this.state,d=this.data,b=this.delegate,f=this.target,e=this.root,g={},k=this.listen.delegate;b&&k&&b.removeHandler(k,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;k&&a.addHandler(k,this);for(var i in a.data)!1===i in d&&(g[i]=void 0);for(i in d)d[i]!==a.data[i]&&(g[i]=d[i])}else for(i in this.target=this.delegate=null,this.root=this,this.data=
{},d)this.data[i]=d[i];this.event_delegateChanged(this,b);this.root!==e&&this.event_rootChanged(this,e);this.target!==f&&this.event_targetChanged(this,f);if(a){for(i in g){this.event_update(this,g);break}c!==this.state&&(""+c!=this.state||c.data!==this.state.data)&&this.event_stateChanged(this,c)}return!0}return!1},setState:function(a,c){var d=this.target||this.getRootDelegate();if(d!==this)return d.setState(a,c);d=""+a;if(!p[d])throw Error("Wrong state value");if(this.state!=d||this.state.data!=
c){var b=this.state;this.state=Object(d);this.state.data=c;this.event_stateChanged(this,b);return!0}return!1},deprecate:function(){this.state!=l.PROCESSING&&this.setState(l.DEPRECATED)},update:function(a){var c=this.target||this.getRootDelegate();if(c!==this)return c.update(a);if(a){var c={},d=0,b;for(b in a)this.data[b]!==a[b]&&(d++,c[b]=this.data[b],this.data[b]=a[b]);if(d)return this.event_update(this,c),c}return!1},setActive:function(a){a=!!a;return this.active!=a?(this.active=a,this.event_activeChanged(this),
j(this,this.subscribeTo,h.MASK*a),!0):!1},setSubscription:function(a){var a=a&h.MASK,c=this.subscribeTo^a;return c?(this.subscribeTo=a,this.active&&j(this,c,a),!0):!1},destroy:function(){this.active&&j(this,this.subscribeTo,0);this.delegate&&this.setDelegate();y.prototype.destroy.call(this);this.data=u;this.state=l.UNDEFINED;this.target=this.root=null}}),z=r(null,{itemClass:n,keyGetter:z,map_:null,extendConstructor_:!0,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),
a)},create:function(a){var c={};a instanceof n?c.delegate=a:c.data={id:a,title:a};return new this.itemClass(c)},get:function(a,c){var d=a instanceof n?a.eventObjectId:a,b=this.map_[d];!b&&c&&(b=this.map_[d]=this.create(a,c),b.addHandler({destroy:function(){delete this.map_[d]}},this));return b},destroy:function(){basis.Cleaner.remove(this);for(var a=t(this.map_),c=0,d;d=a[c++];)d.destroy()}}),B=r(n,{state:l.UNDEFINED,itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:x("datasetChanged",
"dataset","delta")&&function(a,c){var d,b=0,f=0,e;if(d=c.inserted)for(;e=d[b];)this.item_[e.eventObjectId]=e,b++;if(d=c.deleted)for(;e=d[f];)delete this.item_[e.eventObjectId],f++;this.itemCount+=b-f;this.cache_=null;v.datasetChanged.call(this,a,c)},init:function(a){n.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!(!a||!this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=t(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];
return null},top:function(a){var c=[];if(a)for(var d in this.item_)if(c.push(this.item_[d])>=a)break;return c},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();n.prototype.destroy.call(this);this.cache_=w;this.itemCount=0;this.item_=this.memberMap_=null}}),m=r(B,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&this.remove([a])}}},init:function(a){B.prototype.init.call(this,a);if(a=this.items)this.set(a),
this.items=null},add:function(a){for(var c,d=this.memberMap_,b=[],f=this.listen.item,e=0;e<a.length;e++){var g=a[e];if(g instanceof n){var k=g.eventObjectId;d[k]||(d[k]=g,f&&g.addHandler(f,this),b.push(g))}}b.length&&this.event_datasetChanged(this,c={inserted:b});return c},remove:function(a){for(var c,d=this.memberMap_,b=[],f=this.listen.item,e=0;e<a.length;e++){var g=a[e];if(g instanceof n){var k=g.eventObjectId;d[k]&&(f&&g.removeHandler(f,this),delete d[k],b.push(g))}}b.length&&this.event_datasetChanged(this,
c={deleted:b});return c},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var c=this.memberMap_,d={},b=[],f=[],e,g,k,i=this.listen.item,h=0;h<a.length;h++)if(e=a[h],e instanceof n)g=e.eventObjectId,d[g]=e,c[g]||(c[g]=e,i&&e.addHandler(i,this),f.push(e));for(g in c)d[g]||(e=c[g],i&&e.removeHandler(i,this),delete c[g],b.push(e));var j;var a={},m;if(f&&f.length)m=a.inserted=f;if(b&&b.length)m=a.deleted=b;m&&(j=a);(k=j)&&this.event_datasetChanged(this,k);return k},
sync:function(a,c){if(a){m.setAccumulateState(!0);for(var d=this.memberMap_,b,f,e={},g=[],k,i=0;i<a.length;i++)if(b=a[i],b instanceof n)f=b.eventObjectId,e[f]=b,d[f]||g.push(b);for(f in this.item_)e[f]||this.item_[f].destroy();c&&g.length&&(k=this.add(g));m.setAccumulateState(!1);return k}},clear:function(){var a,c=this.getItems(),d=this.listen.item;if(c.length){if(d)for(a=c.length;0<a--;)c[a].removeHandler(d,this);this.event_datasetChanged(this,a={deleted:c});this.memberMap_={}}return a}});m.setAccumulateState=
function(){function a(a){var d=a.dataset;f.call(d,d,a)}function c(d,b){var c=d.eventObjectId,e=b.inserted,g=b.deleted,h=k[c];if(e&&g)return h&&(delete k[c],a(h)),f.call(d,d,b);if(h){var C=h[e?"inserted":"deleted"];if(C)return C.push.apply(C,e||g);a(h)}k[c]=b;b.dataset=d}function d(){e=1;setAccumulateState(!1)}var b=B.prototype,f=b.event_datasetChanged,e=0,g,k={};return function(i){if(i){if(0==e)b.event_datasetChanged=c,g=setTimeout(d,0);e++}else if(e-=0<e,0==e)clearTimeout(g),b.event_datasetChanged=
f,i=k,k={},t(i).forEach(a)}}();basis.namespace("basis.data",q).extend({STATE:l,SUBSCRIPTION:h,Object:n,DataObject:n,KeyObjectMap:z,AbstractDataset:B,Dataset:m})})(basis,this);
(function(j,q){function r(a,d,b,f){for(var d=d.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i),e=n(),g,k=0;k<d.length;k++)k%2?(g=d[k].split(/\|/),a.getters[g[0]]=b+"childNodes["+f+"]",g=1<g.length?g[1]:g[0]):g=d[k].length?d[k]:null,null!=g&&(h&&(e.lastChild&&e.appendChild(v.createComment("")),f++),e.appendChild(B(g)),f++);return e}function y(a){return function(d){if(!d||!("click"==d.type&&3==d.which)){var b=j.dom.event.sender(d),f,e;do if(f=b.getAttributeNode&&b.getAttributeNode(a))break;while(b=b.parentNode);
if(b&&f){do if(e=b.basisObjectId)if((e=l[e])&&e.templateAction){b=f.nodeValue.qw();f=0;for(var g;g=b[f++];)e.templateAction(g,j.dom.event(d));break}while(b=b.parentNode)}}}}function t(a,d,b){d=d.trim();if(!d)return"";for(var f="",e;e=s.exec(d);){var g=e[2],k=e[4]||e[5]||g;e[3]&&(a.getters[e[3]]=b+'.getAttributeNode("'+g+'")');if(e=g.match(/^event-([a-z]+)/i)){var i=e[1];if(!p[i]){p[i]=!0;e=0;for(var i=j.dom.event.browserEvents(i),h;h=i[e++];)j.dom.event.addGlobalHandler(h,y(g))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(a,d){var a=j.dom.event(a),b=this,c;do if(c=b.basisObjectId)if((c=l[c])&&c.templateAction){for(var b=d.qw(),C=0,f;f=b[C++];)c.templateAction(f,j.dom.event(a));break}while(b=b.parentNode)}}f+="class"==g?k.trim().replace(/^(.)|\s+/g,".$1"):"["+g+(k?"="+k.quote('"'):"")+"]"}return f}function z(a,d){if(!a.stack)a.stack=[];if(!a.source)a.source=a.str;d||(d=".");for(var b=n(),f,e=0,g,k=a.stack;g=o.exec(a.str);){f=RegExp.leftContext;a.str=a.str.substr(f.length+g[0].length);if(f.length)b.appendChild(r(a,
f,d,e)),e=b.childNodes.length;if(g[5]){if(g[5]==k[k.length-1])return k.pop(),b;throw"Wrong end tag";}if(g[6])g[7]&&(a.getters[g[7]]=d+"childNodes["+e+"]"),b.appendChild(v.createComment(g[6]));else{f=g[1];var i=g[2],h=!!g[4],j=d+"childNodes["+e+"]";g=u.createElement(f+t(a,g[3],j));i&&(a.getters[i]=j);h||(k.push(f),g.appendChild(z(a,j+".")));b.appendChild(g)}e++}a.str.length&&b.appendChild(r(a,a.str,d,e));if(k.length)throw"No end tag for "+k.reverse();return b}function x(a){if(!this.proto){a=this.source;
if("function"==typeof a)this.source=a=a();for(var a=a.trim(),a={str:a,getters:{element:".childNodes[0]"}},d=z(a),a=Object.iterate(a.getters,function(a,b){for(var c=a.split(/\|/).map(String.format,"obj_.{0}"),f=b.split(/(\.?childNodes\[(\d+)\])/),e=d,g=0;g<f.length;g+=3){var h=f[g+2];if(!h)break;f[g+2]="";e=e.childNodes[h];e.previousSibling?e.nextSibling||(f[g+1]=".lastChild"):f[g+1]=".firstChild"}return{name:c[0],alias:c.join("="),path:"dom_"+f.join("")}}).sortAsObject("path"),b=0;b<a.length;b++)for(var f=
RegExp("^"+a[b].path.forRegExp()),e=b+1,g;g=a[e++];)g.path=g.path.replace(f,a[b].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(a,d){obj_=a||{};dom_=proto_.cloneNode(!0);_code_();if(d&&obj_.element){var b=obj_.element.basisObjectId=map_.seed++;map_[b]=d}return obj_}.toString().replace("_code_()",a.map(String.format,"{alias}={path};\n").join(""))))(d,l);this.clearInstance=(new Function("map_","var obj_; return "+function(a){obj_=a;(a=obj_.element&&obj_.element.basisObjectId)&&
delete map_[a];_code_()}.toString().replace("_code_()",a.map(String.format,"{alias}=null;\n").join(""))))(l)}}var v=q.document,u=j.dom,w=j.Class,p={},l={seed:1},o=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<\!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,s=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;u.createFragment();var h=1==u.createElement("","a","b").cloneNode(!0).childNodes.length,n=u.createFragment,B=
u.createText,m=w(null,{__extend__:function(a){return a instanceof m?a:new m(a)},init:function(a){this.source=a},createInstance:function(a,d){x.call(this);return this.createInstance(a,d)},clearInstance:function(){x.call(this)}}),a=v.createElement("DIV");return j.namespace("basis.html").extend({Template:m,escape:function(a){return u.createElement("DIV",u.createText(a)).innerHTML},unescape:function(c){a.innerHTML=c;return a.firstChild.nodeValue},string2Html:function(c){a.innerHTML=c;return u.createFragment.apply(null,
Array.from(a.childNodes))}})})(basis,this);
(function(j){function q(a){return a.sortingValue||0}function r(a,d){a=a.sortingValue||0;d=d.sortingValue||0;return+(a>d)||-(a<d)}function y(a,d){a=a.sortingValue||0;d=d.sortingValue||0;return-(a>d)||+(a<d)}function t(a){return a.childNodes.sort(a.localSortingDesc?y:r)}function z(a,d){var b=d.length-1;a.childNodes=d;a.firstChild=d[0]||null;a.lastChild=d[b]||null;for(var c=b;b=d[c];c--)b.nextSibling=d[c+1]||null,b.previousSibling=d[c-1]||null,a.insertBefore(b,b.nextSibling)}function x(a,d){var b=a.childFactory||
a.document&&a.document.childFactory,c,d=Object.extend({document:a.document,contextSelection:a.selection||a.contextSelection},d);if(b&&(c=b.call(a,d),c instanceof a.childClass))return c;if(!c)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(a.childClass&&a.childClass.className)+" but "+(c&&c.constructor&&c.constructor.className)+")";}function v(){return j.ui.apply(this,arguments)}var u=j.Class,w=j.dom,p=j.data,l=p.SUBSCRIPTION,o=p.DataObject,
s=p.AbstractDataset,h=p.Dataset,n=w.AXIS_DESCENDANT,B=w.AXIS_DESCENDANT_OR_SELF,m=Function.getter,a=Object.complete,c=w.axis,p=j.EventObject.createEvent,d=j.EventObject.event,b={NONE:"none",PARENT:"parent",OWNER:"owner"};l.add("DATASOURCE",{dataSourceChanged:function(a,d){this.remove(a,d);this.add(a,a.dataSource)}},function(a,d){a(d,d.dataSource)});var f=u.ExtensibleProperty(),e={ownerChanged:function(){},destroy:function(a){w.replace(a.element,this)}},g=function(){var a=this.key,d=this.config,b=
this.owner,c="function"!=typeof d.existsIf||d.existsIf(b),f=b.satellite[a];if(c){var c="delegate"in d,g="dataSource"in d,k="function"==typeof d.delegate?d.delegate(b):null,h="function"==typeof d.dataSource?d.dataSource(b):null;if(f)c&&f.setDelegate(k),g&&f.setDataSource(h);else{var i=b.tmpl[d.replace||a],f={owner:b};if(c)f.delegate=k;if(g)f.dataSource=h;d.config&&Object.complete(f,"function"==typeof d.config?d.config(b):d.config);f=new d.instanceOf(f);b.satellite[a]=f;i&&f instanceof j.ui.Node&&f.element&&
(w.replace(i,f.element),f.addHandler(e,i))}}else if(f)f.destroy(),f.owner=null,delete b.satellite[a]},k=u.CustomExtendProperty({update:!0},function(a,d){for(var b in d)a[b]=d[b]?g:null}),i=u(o,{event_update:function(a,d){o.prototype.event_update.call(this,a,d);var b=this.parentNode;b&&(b.matchFunction&&this.match(b.matchFunction),b.insertBefore(this,this.nextSibling))},event_childNodesModified:p("childNodesModified","node","delta"),event_dataSourceChanged:p("dataSourceChanged","node","oldDataSource"),
event_localGroupingChanged:p("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:p("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:p("ownerChanged","node","oldOwner"),event_satellitesChanged:p("satellitesChanged","node","delta"),subscribeTo:o.prototype.subscribeTo+l.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegate:b.NONE,nodeType:"DOMWrapperNode",canHaveChildren:!1,childNodes:null,dataSource:null,colMap_:null,
destroyDataSourceMember:!0,document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:!1,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:f,satellite:null,owner:null,init:function(a){var d=this.dataSource,b=this.childNodes,c=this.localGrouping;if(d)this.dataSource=null;o.prototype.init.call(this,a);if(c)this.localGrouping=null,this.setLocalGrouping(c);if(this.canHaveChildren)this.childNodes=[],d?(this.dataSource=
null,this.setDataSource(d)):b&&this.setChildNodes(b);else{if(b)this.childNodes=null;if(d)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==f)for(var e in this.satelliteConfig)if(a=this.satelliteConfig[e],u.isClass(a)&&(a={instanceOf:a}),"object"==typeof a){d={key:e,owner:this,config:a};a=a.hook?k.__extend__(a.hook):k;for(e in a)if(a[e]===g){this.addHandler(a,d);break}g.call(d)}if(e=this.owner)this.owner=null,this.setOwner(e)},appendChild:function(){},insertBefore:function(){},
removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return 0<this.childNodes.length},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||!1==a instanceof i)a=null;if(this.owner!==a){var d=this.owner,c=this.listen.owner;this.owner=a;c&&(d&&d.removeHandler(c,this),a&&a.addHandler(c,this));this.event_ownerChanged(this,d);this.autoDelegate==b.OWNER&&this.setDelagate(a)}},
destroy:function(){o.prototype.destroy.call(this);this.dataSource?this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping)this.localGrouping.destroy(),this.localGrouping=null;this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var d=this.satellite[a];d.destroy();d.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=this.document=
null}}),A=u(i,{autoDestroyIfEmpty:!1,nodes:null,first:null,last:null,init:function(a){this.nodes=[];i.prototype.init.call(this,a)},insert:function(a,d){var b=this.nodes,c=d?b.indexOf(d):-1;-1==c?(b.push(a),this.last=a):b.splice(c,0,a);this.first=b[0];a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var d=this.nodes;if(d.remove(a))this.first=d[0]||null,this.last=d[d.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]});!this.first&&
this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var a=this.nodes,d=a.length;0<d--;)a[d].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){i.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),F={canHaveChildren:!0,childClass:i,childFactory:null,listen:{dataSource:{datasetChanged:function(a,d){var b={},c=[];if(d.deleted)if(b.deleted=c,this.childNodes.length==
d.deleted.length){c.push.apply(c,this.childNodes);var f=this.dataSource;this.dataSource=null;this.clear(!0);this.dataSource=f;this.colMap_={}}else for(var f=0,e;e=d.deleted[f];f++){e=e.eventObjectId;var g=this.colMap_[e];delete this.colMap_[e];g.canHaveDelegate=!0;this.removeChild(g);c.push(g)}if(d.inserted){b.inserted=[];for(f=0;e=d.inserted[f];f++)g=x(this,{cascadeDestroy:!1,delegate:e}),g.canHaveDelegate=!1,this.colMap_[e.eventObjectId]=g,b.inserted.push(g),this.firstChild&&this.insertBefore(g)}this.firstChild?
this.event_childNodesModified(this,b):this.setChildNodes(b.inserted);if(this.destroyDataSourceMember&&c.length)for(f=0;e=c[f];f++)e.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},insertBefore:function(a,d){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(a.firstChild){var f=this;do if(f==a)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";
while(f=f.parentNode)}if(this.dataSource&&!this.dataSource.has(a.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";!1==a instanceof this.childClass&&(a=x(this,a instanceof o?{delegate:a}:a));var e=a.parentNode===this,g=a.groupNode,k=this.localGrouping,h=this.localSorting,i,j=this.childNodes,G,m,l=null,f=-1,p=!1,A;if(e)A=a.nextSibling,m=a.previousSibling;if(h&&(d=null,i=this.localSortingDesc,G=h(a)||0,e))if(G===a.sortingValue)p=!0;else if((!A||(i?
A.sortingValue<=G:A.sortingValue>=G))&&(!m||(i?m.sortingValue>=G:m.sortingValue<=G)))a.sortingValue=G,p=!0;if(k){l=k.getGroupNode(a);m=l.nodes;if(g===l&&(p||e&&A===d))return a;h?p?f=A&&A.groupNode===l?m.indexOf(A):m.length:(f=m.binarySearchPos(G,q,i),a.sortingValue=G):f=d&&d.groupNode===l?m.indexOf(d):m.length;if(f<m.length)d=m[f];else if(l.last)d=l.last.nextSibling;else{f=l;for(d=null;(f=f.nextSibling)&&!(d=f.first););}if(a===d||e&&a.nextSibling===d)return g!==l&&(g&&g.remove(a),l.insert(a)),a;f=
-1}else if(h){if(p)return a;f=j.binarySearchPos(G,q,i);d=j[f];a.sortingValue=G;if(a===d||e&&A===d)return a}else{if(d&&d.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(e){if(A===d)return a;if(a===d)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}e?(a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.previousSibling=
null,a.nextSibling=null,-1==f?j.remove(a):(i=j.indexOf(a),j.splice(i,1),i<f&&f--),g&&(g.remove(a),g=null)):a.parentNode&&a.parentNode.removeChild(a);g!=l&&l.insert(a,d);if(d){-1==f&&(f=j.indexOf(d));if(-1==f)throw"basis.dom.wrapper: Node was not found";a.nextSibling=d;j.splice(f,0,a)}else f=j.length,j.push(a),d={previousSibling:this.lastChild},this.lastChild=a;a.parentNode=this;a.previousSibling=d.previousSibling;0==f?this.firstChild=a:d.previousSibling.nextSibling=a;d.previousSibling=a;var s=!1,
r=!1,B=this.selection||this.contextSelection;if(!a.document&&a.document!==this.document)s=this.document,a.document=this.document;if(!a.contextSelection&&a.contextSelection!==B)a.contextSelection=B,r=!a.selection,a.selected&&B.add([a]);a.firstChild&&(s||r)&&c(a,n).forEach(function(a){if(s&&!a.document)a.document=s;if(r&&!a.contextSelection)a.selected&&a.unselect(),a.contextSelection=B});e||(a.match&&a.match(this.matchFunction),a.autoDelegate==b.PARENT&&a.setDelegate(this),this.dataSource||this.event_childNodesModified(this,
{inserted:[a]}));return a},removeChild:function(a){if(null==a||a.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(!1==a instanceof this.childClass)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(a))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(a),1);a.parentNode=null;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling;
a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling;a.nextSibling=null;a.previousSibling=null;a.document===this.document&&c(a,B).forEach(function(a){if(a.document==this.document)a.document=null},this);if(a.contextSelection){for(var d=a.contextSelection,f=a,e=[];f;){if(f.contextSelection===d)f.selected&&e.push(f),f.contextSelection=null;if(!f.selection&&f.firstChild)f=f.firstChild;else if(f.nextSibling)f=f.nextSibling;else for(;f=f.parentNode;)if(f.nextSibling){f=
f.nextSibling;break}}d.remove(e)}a.groupNode&&a.groupNode.remove(a);this.dataSource||this.event_childNodesModified(this,{deleted:[a]});a.autoDelegate==b.PARENT&&a.setDelegate();return a},replaceChild:function(a,d){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(null==d||d.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(a,d);return this.removeChild(d)},clear:function(a){if(this.dataSource)this.setDataSource();
else if(this.firstChild){var d=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:d});for(var f=d.length;0<f--;){var e=d[f];e.parentNode=null;e.groupNode=null;a?((e.selection||e.document)&&c(e,w.AXIS_DESCENDANT_OR_SELF).forEach(function(a){if(this.selection&&a.selection===this.selection)a.selected&&a.selection.remove([a]),a.selection=null;if(a.document===this.document)a.document=null},this),e.nextSibling=null,e.previousSibling=null,e.autoDelegate==
b.PARENT&&e.setDelegate()):e.destroy()}if(this.localGrouping){a=this.localGrouping.childNodes;for(f=a.length-1;d=a[f];f--)d.clear()}}},setChildNodes:function(a,d){this.dataSource||this.clear(!!d);if(a&&(!1=="length"in a&&(a=[a]),a.length)){var b=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var c=0,f=a.length;c<f;c++)this.insertBefore(a[c]);this.event_childNodesModified=b;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||
!this.canHaveChildren||!1==a instanceof s)a=null;if(this.dataSource!==a){var d=this.dataSource,b=this.listen.dataSource;this.dataSource=a;if(d)this.colMap_=null,b&&d.removeHandler(b,this),d.itemCount&&this.clear();if(a)this.colMap_={},b&&(a.addHandler(b,this),a.itemCount&&b.datasetChanged&&b.datasetChanged.call(this,a,{inserted:a.getItems()}));this.event_dataSourceChanged(this,d)}},setLocalGrouping:function(a){if("function"==typeof a||"string"==typeof a)a={groupGetter:m(a)};!1==a instanceof H&&(a=
null!=a&&"object"==typeof a?new this.localGroupingClass(Object.complete({},a)):null);if(this.localGrouping!==a){var d=this.localGrouping,b;if(this.localGrouping){if(!a&&(this.localGrouping=null,this.firstChild)){b=this.localSorting?t(this):this.childNodes;for(var c=b.length;0<c--;)b[c].groupNode=null;z(this,b)}d.setOwner()}if(a&&(this.localGrouping=a,a.setOwner(this),this.firstChild)){b=this.localSorting?t(this):this.childNodes;for(c=0;a=b[c];c++)a.groupNode=this.localGrouping.getGroupNode(a);for(c=
0;a=b[c];c++)a.groupNode.nodes.push(a);b.length=0;for(c=this.localGrouping.nullGroup;c;c=c.nextSibling)a=c.nodes,c.first=a[0]||null,c.last=a[a.length-1]||null,b.push.apply(b,a),c.event_childNodesModified(c,{inserted:a});z(this,b)}this.event_localGroupingChanged(this,d)}},setLocalSorting:function(a,d){a&&(a=m(a));if(this.localSorting!=a||this.localSortingDesc!=!!d){var b=this.localSorting,c=this.localSortingDesc;this.localSortingDesc=!!d;this.localSorting=a||null;if(a&&this.firstChild){var f=[],e;
for(e=this.firstChild;e;e=e.nextSibling)e.sortingValue=a(e)||0;if(this.localGrouping)for(var g=this.localGrouping.nullGroup;g;g=g.nextSibling)e=g.nodes=t({childNodes:g.nodes,localSortingDesc:this.localSortingDesc}),g.first=e[0]||null,g.last=e[e.length-1]||null,f.push.apply(f,e);else f=t(this);z(this,f)}this.event_localSortingChanged(this,b,c)}},setMatchFunction:function(a){if(this.matchFunction!=a){var d=this.matchFunction;this.matchFunction=a;for(var b=this.lastChild;b;b=b.previousSibling)b.match(a);
this.event_matchFunctionChanged(this,d)}}},l=u(i,{event_enable:p("enable","node"),event_disable:p("disable","node"),event_select:p("select","node"),event_unselect:p("unselect","node"),event_match:p("match","node"),event_unmatch:p("unmatch","node"),event_matchFunctionChanged:p("matchFunctionChanged","node","oldMatchFunction"),selectable:!0,selected:!1,selection:null,contextSelection:null,matchFunction:null,matched:!0,disabled:!1,init:function(a){if(this.selection&&!1==this.selection instanceof s)this.selection=
new K(this.selection);i.prototype.init.call(this,a);this.disabled&&this.event_disable(this);if(this.selected)this.selected=!1,this.select(!0)},setSelection:function(a){if(this.selection==a)return!1;var d=this.selection;c(this,n,function(b){if(b.contextSelection==d)b.selected&&d&&d.remove([b]),b.contextSelection=a});this.selection=a;return!0},hasOwnSelection:function(){return!!this.selection},select:function(a){var d=this.selected,b=this.contextSelection;if(b)a?d?b.remove([this]):b.add([this]):this.selectable&&
b.set([this]);else if(!d&&this.selectable&&!this.isDisabled())this.selected=!0,this.event_select(this);return this.selected!=d},unselect:function(){var a=this.selected;if(a){var d=this.contextSelection;d?d.remove([this]):(this.selected=!1,this.event_unselect(this))}return this.selected!=a},enable:function(){if(this.disabled)this.disabled=!1,this.event_enable(this)},disable:function(){if(!this.disabled)this.disabled=!0,this.event_disable(this)},isDisabled:function(){return this.disabled||this.document&&
this.document.disabled||!!w.findAncestor(this,m("disabled"))},match:function(a){"function"!=typeof a&&(a=null);this.underMatch_&&!a&&this.underMatch_(this,!0);this.underMatch_=a;a=!a||a(this);if(this.matched!=a)(this.matched=a)?this.event_match(this):this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),delete this.selection);this.unselect();i.prototype.destroy.call(this)}}),D=u(l,F,{}),H=u(i,F,{event_childNodesModified:function(a,
b){d.childNodesModified.call(this,a,b);this.nullGroup.nextSibling=this.firstChild;if(b.inserted&&this.dataSource&&this.nullGroup.first)for(var c=this.owner,f=Array.from(this.nullGroup.nodes),e=f.length;0<e--;)c.insertBefore(f[e],f[e].nextSibling)},event_ownerChanged:function(a,b){b&&b.localGrouping===this&&b.setLocalGrouping(null,!0);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);d.ownerChanged.call(this,a,b);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},
map_:null,autoDestroyWithNoOwner:!0,autoDestroyEmptyGroups:!0,titleGetter:m("data.title"),groupGetter:Function.$undef,childClass:A,childFactory:function(d){return new this.childClass(a(d,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?!1:this.autoDestroyEmptyGroups}))},init:function(a){this.map_={};this.nullGroup=new A({autoDestroyIfEmpty:!1});i.prototype.init.call(this,a)},getGroupNode:function(a){var a=this.groupGetter(a),d=a instanceof o,b=this.map_[d?a.eventObjectId:a];!b&&!this.dataSource&&
(b=this.appendChild(d?{delegate:a}:{data:{id:a,title:a}}));return b||this.nullGroup},insertBefore:function(a,d){a=F.insertBefore.call(this,a,d);if(!1=="groupId_"in a)a.groupId_=a.delegate?a.delegate.eventObjectId:a.data.id,this.map_[a.groupId_]=a;if(a.first){var b=this.owner,c=b.childNodes,f=a.first,e=a.last,g,k,i;for(g=a;(g=g.previousSibling)&&!(i=g.last););if(!i)i=this.nullGroup.last;for(g=a;(g=g.nextSibling)&&!(k=g.first););if(f.previousSibling!==i||e.nextSibling!==k){if(f.previousSibling)f.previousSibling.nextSibling=
e.nextSibling;if(e.nextSibling)e.nextSibling.previousSibling=f.previousSibling;g=c.splice(c.indexOf(f),a.nodes.length);var h=c.indexOf(k);g.unshift(-1!=h?h:c.length,0);c.splice.apply(c,g);f.previousSibling=i;e.nextSibling=k;if(i)i.nextSibling=f;if(k)k.previousSibling=e;b.firstChild=c[0];b.lastChild=c[c.length-1]}}return a},removeChild:function(a){F.removeChild.call(this,a);delete this.map_[a.groupId_];return a},clear:function(){F.clear.call(this);this.map_={}},destroy:function(){this.setOwner();i.prototype.destroy.call(this);
this.map_=null}});i.prototype.localGroupingClass=H;var p=u(s,{autoDestroy:!0,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,d){var b=this.memberMap_,c={},f=0,e=0,g=d.inserted,k=d.deleted;if(g&&g.length)for(c.inserted=g;a=g[f];)b[a.eventObjectId]=a,f++;if(k&&k.length)for(c.deleted=k;a=k[e];)delete b[a.eventObjectId],e++;(f||e)&&this.event_datasetChanged(this,c)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:p("sourceNodeChanged")&&
function(a,b){d.sourceNodeChanged.call(this,a,b);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:!1,init:function(a,d){s.prototype.init.call(this,d);a&&this.setSourceNode(a)},setSourceNode:function(a){!1==a instanceof i&&(a=null);if(a!==this.sourceNode){var d=this.sourceNode,b=this.listen.sourceNode;this.sourceNode=a;if(b){var c=b.childNodesModified;d&&(d.removeHandler(b,this),c&&c.call(this,d,{deleted:d.childNodes}));a&&(a.addHandler(b,this),c&&c.call(this,a,{inserted:a.childNodes}))}this.event_sourceNodeChanged(this,
d)}},destroy:function(){this.setSourceNode();s.prototype.destroy.call(this)}}),K=u(h,{multiple:!1,event_datasetChanged:function(a,d){h.prototype.event_datasetChanged.call(this,a,d);if(d.inserted)for(var b=0,c;c=d.inserted[b];b++)if(!c.selected)c.selected=!0,c.event_select();if(d.deleted)for(b=0;c=d.deleted[b];b++)if(c.selected)c.selected=!1,c.event_unselect()},add:function(a){if(!this.multiple){if(this.itemCount)return this.set(a);a.splice(1)}for(var d=[],b=0,c;c=a[b];b++)c.contextSelection==this&&
c.selectable&&d.push(c);return h.prototype.add.call(this,d)},set:function(a){for(var d=[],b=0,c;c=a[b];b++)c.contextSelection==this&&c.selectable&&d.push(c);this.multiple||a.splice(1);return h.prototype.set.call(this,d)}});j.namespace("basis.dom.wrapper",v).extend({DELEGATE:b,AbstractNode:i,InteractiveNode:l,Node:D,GroupingNode:H,PartitionNode:A,simpleTemplate:v,ChildNodesDataset:p,Selection:K})})(basis);
(function(j,q){function r(a,d){return z(d,!0).getRule(a,!0)}function y(a,d){var b=a.match(/^([^{]+)\{(.*)\}\s*$/);if(b){for(var c=b[1].trim().split(/\s*,\s*/),f=0;f<c.length;f++)this.addRule(c[f],b[2]||null,d++);return d-1}}function t(a,d){var b=n.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:d?"alternate ":"",url:a.quote('"')}));n.tag(null,"HEAD")[0].appendChild(b);b=b.sheet||b.styleSheet;try{if(!b.cssRules)b.cssRules=b.rules}catch(c){}if(!b.insertRule)b.insertRule=
y;if(!b.deleteRule)b.deleteRule=b.removeRule;return b}function z(a,b){a||(a="DefaultGenericStyleSheet");d[a]||b&&(d[a]=new e(t()));return d[a]}function x(a,d,c,e){for(var e=e||{},d=d.qw(),g=0,k;k=d[g];g++)if("undefined"!=typeof f.style[k]){c&&(j.platformFeature["css-"+a]=k);b[a]={key:k,getter:e[k]};break}}function v(a,d){var c=b[a];if(a=c?c.key:a.replace(/^-ms-/,"ms-").camelize())return{key:a,value:c&&c.getter?c.getter(d):d}}function u(a,d,b){if("function"==typeof a.setProperty)return a.setProperty(d,
b);if(d=v(d,b))return a.style[d.key]=d.value}function w(a,d){for(var b in d)u(a,b,d[b]);return a}function p(a,d){return u(a,"display","string"==typeof d?d:d?"":"none")}function l(a,d){return u(a,"visibility",d?"":"hidden")}function o(a){return F[a]||(F[a]=RegExp("\\s*\\b"+a+"\\b"))}function s(a,d){var b=(d?"g":"s")+a;return H[b]||(H[b]=RegExp((d?"":"\\s*")+"\\b"+a+"\\S*\\b"))}var h=q.document,n=j.dom,B=j.dom.event,m=j.Class,a=/\s*!important/i,c=1,d={},b={},f=n.createElement("DIV");x("opacity","opacity MozOpacity KhtmlOpacity filter",
!0,{fitler:function(a){return"alpha(opacity:"+parseInt(100*a)+")"}});x("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",!0);x("float","cssFloat styleFloat");var e=m(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[];this.map_={}},getRule:function(a,d){if(!this.map_[a]&&d){for(var b=this.styleSheet,c=this.rules.length,f=b.insertRule(a+"{}",c),e=c;e<=f;e++)this.rules.push(new g(b.cssRules[e]));this.map_[a]=c!=f?new k(this.rules.splice(c)):this.rules[c]}return this.map_[a]},
deleteRule:function(a){var d=this.map_[a];if(d){for(var d=d.rules||[d],b=0;b<d.length;b++){var c=this.rules.indexOf(d[b]);this.stylesheet.deleteRule(c);this.rules.splice(c,1)}delete this.map_[a]}},destroy:function(){delete this.rules}}),g=m(null,{rule:null,selector:"",init:function(a){if(a)this.rule=a,this.selector=a.selectorText},setProperty:function(d,b){var c,f=!!a.test(b),e=this.rule.style;if(f||e.getPropertyPriority&&"important"==e.getPropertyPriority(d)){if(b=b.replace(a,""),c=v(d,b)){var g=
c.key;e.setProperty?(f||e.removeProperty(g),e.setProperty(g,c.value,f?"important":"")):e.cssText=e.cssText.replace(RegExp(e[g]?g+"\\s*:\\s*"+e[g]+"(\\s*!important)?\\s*;?":"^","i"),g+": "+c.value+(f?" !important":"")+";")}}else u(this.rule,d,b)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),k=m(null,{rules:null,init:function(a){this.rules=a},destroy:function(){delete this.rules}});["setProperty","setStyle",
"clear"].forEach(function(a){k.prototype[a]=function(){for(var d,b=0;d=this.rules[b];b++)d[a].apply(d,arguments)}});var i={};["em","ex","px","%"].forEach(function(a){i["%"==a?"percent":a]=function(d){return 0==d||isNaN(d)?"0":d+a}});var A,F={},D=m(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,d,b){b=b||"";"undefined"!=typeof a&&this.remove(b+a);"undefined"!=typeof d&&this.add(b+
d)},bool:function(a,d){d?this.add(a):this.remove(a)},clear:function(){this.element.className=""},contains:function(a){return!!this.element.className.match(o(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(o(a))||(this.element.className+=" "+a)},remove:function(a){var d=this.element.className,a=d.replace(o(a),"");if(a!=d)this.element.className=a},toggle:function(a){var d=this.contains(a);d?this.remove(a):this.add(a);return!d}}),H={},K=m(null,
{delim:"-",init:function(a,d){this.classList=d;this.prefix=a+this.delim},add:function(a){this.classList.add(this.prefix+a)},remove:function(a){this.classList.remove(this.prefix+a)},items:function(){var a=this.classList.toString();if(a)return a.toString().match(s(this.prefix,!0))},set:function(a){var d=this.items(),a="undefined"!=typeof a?this.prefix+a:"",b=this.classList;if(d)if(1==d.length){if(d[0]===a)return;b.remove(d[0])}else this.clear();a&&b.add(a)},clear:function(){this.items().forEach(this.classList.remove,
this.classList)}});q.DOMTokenList&&h.documentElement.classList?(m=D.prototype,Object.extend(q.DOMTokenList.prototype,{set:m.set,replace:m.replace,bool:m.bool,clear:function(){for(var a=this.length;0<a--;)this.remove(this[a])},setPrefixToken:m.setPrefixToken}),A=function(a){return("string"==typeof a?n.get(a):a).classList}):A=function(a){return new D("string"==typeof a?n.get(a):a)};B.onLoad(function(){A(h.body).bool("opacity-not-support",!j.platformFeature["css-opacity"])});n.extend({setStyleProperty:u,
setStyle:w,display:p,show:function(a){return p(a,1)},hide:function(a){return p(a)},visibility:l,visible:function(a){return l(a,1)},invisible:function(a){return l(a)}});return j.namespace("basis.cssom").extend({setStyleProperty:u,setStyle:w,classList:function(a,d){return d?new K(d,A(a)):A(a)},uniqueRule:function(a){var d="genericRule-"+c++;a&&A(a).add(d);a=r("."+d);a.token=d;return a},cssRule:r,getStyleSheet:z,addStyleSheet:t,CssStyleSheetWrapper:e,CssRuleWrapper:g,CssRuleWrapperSet:k}).extend(i)})(basis,
this);
(function(){function j(a,b){var c={},e;if(a&&a.length)e=c.inserted=a;if(b&&b.length)e=c.deleted=b;if(e)return c}function q(a,b){if(!a.length)return 0;var c,e,g,k=0,i=a.length-1;do if(c=k+i>>1,g=a[c].value||0,g===e?(g=a[c].object.eventObjectId,e=b.object.eventObjectId):e=b.value||0,e<g)i=c-1;else if(e>g)k=c+1;else return e==g?c:0;while(k<=i);return c+(g<e)}var r=basis.Class,y=Object.extend,t=Object.values,z=Function.$self,x=Function.$true,v=Function.$false,u=basis.EventObject.createEvent,w=basis.data.SUBSCRIPTION,p=
basis.data.DataObject,l=basis.data.KeyObjectMap,o=basis.data.AbstractDataset,s=basis.data.Dataset;w.add("SOURCE",{sourceChanged:function(a,b){this.remove(a,b);this.add(a,a.source)},sourcesChanged:function(a,b){var c;if(c=b.inserted)for(var e=c.length;0<e--;)this.add(a,c[e]);if(c=b.deleted)for(e=c.length;0<e--;)this.remove(a,c[e])}},function(a,b){for(var c=b.sources||[b.source],e=0,g;g=c[e++];)a(b,g)});w.add("MINUEND",{operandsChanged:function(a,b){this.minuend!==b&&(this.remove(a,b),this.add(a,a.minuend))}},
function(a,b){a(b,b.minuend)});w.add("SUBTRAHEND",{operandsChanged:function(a,b,c){this.subtrahend!==c&&(this.remove(a,c),this.add(a,a.subtrahend))}},function(a,b){a(b,b.subtrahend)});var h=r(o,{subscribeTo:w.SOURCE,event_sourcesChanged:u("sourcesChanged","dataset","delta"),sources:null,rule:function(a){return 0<a},listen:{source:{datasetChanged:function(a,b){var c=this.memberMap_,e={},g,k;if(b.inserted)for(var i=0;g=b.inserted[i];i++)k=g.eventObjectId,c[k]?c[k].count++:c[k]={count:1,object:g},e[k]=
c[k];if(b.deleted)for(i=0;g=b.deleted[i];i++)k=g.eventObjectId,e[k]=c[k],c[k].count--;this.applyRule(e)},destroy:function(a){this.removeSource(a)}}},init:function(a){o.prototype.init.call(this,a);a=this.sources;this.sources=[];a&&a.forEach(this.addSource,this)},setRule:function(a){if("function"!=typeof a)a=h.UNION;if(this.rule!==a)this.rule=a,this.applyRule()},applyRule:function(a){var b=this.memberMap_,c=this.rule,e=this.sources.length,g=[],k=[],i,h,m;a||(a=b);for(var n in a)i=b[n],h=e&&i.count&&
c(i.count,e),h!=!!this.item_[n]&&(h?g:k).push(i.object),0==i.count&&delete b[n];(m=j(g,k))&&this.event_datasetChanged(this,m)},addSource:function(a){if(a instanceof o&&this.sources.add(a)){this.listen.source&&a.addHandler(this.listen.source,this);var b=this.memberMap_,c;for(c in a.item_)b[c]?b[c].count++:b[c]={count:1,object:a.item_[c]};this.applyRule();this.event_sourcesChanged(this,{inserted:[a]});return!0}},removeSource:function(a){if(this.sources.remove(a)){this.listen.source&&a.removeHandler(this.listen.source,
this);var b=this.memberMap_,c;for(c in a.item_)b[c].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[a]});return!0}},setSources:function(a){for(var b=Array.from(this.sources),c=0,e;e=a[c];c++)e instanceof o&&(b.remove(e)||this.addSource(e));b.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){o.prototype.destroy.call(this);this.sources=null}});h.UNION=h.prototype.rule;h.INTERSECTION=function(a,b){return a==
b};h.DIFFERENCE=function(a){return 1==a};h.MORE_THAN_ONE_INCLUDE=function(a,b){return 1==b||1<a};h.AT_LEAST_ONE_EXCLUDE=function(a,b){return 1==b||a<b};var n=function(a){return!this.has(a)},B=r(o,{subscribeTo:w.MINUEND+w.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:u("operandsChanged","dataset","oldMinuend","oldSubtrahend"),listen:{minuend:{datasetChanged:function(a,b){if(this.subtrahend){var c=j(b.inserted&&b.inserted.filter(n,this.subtrahend),b.deleted&&b.deleted.filter(this.has,
this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(a,b){if(this.minuend){var c=j(b.deleted&&b.deleted.filter(n,this),b.inserted&&b.inserted.filter(this.has,this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(a){o.prototype.init.call(this,a);var a=this.minuend,b=this.subtrahend;this.subtrahend=this.minuend=null;(a||b)&&this.setOperands(a,b)},setOperands:function(a,
b){var c,e=!1;!1==a instanceof o&&(a=null);!1==b instanceof o&&(b=null);var g=this.minuend,k=this.subtrahend;if(g!==a){e=!0;this.minuend=a;var i=this.listen.minuend;i&&(g&&g.removeHandler(i,this),a&&a.addHandler(i,this))}if(k!==b&&(e=!0,this.subtrahend=b,i=this.listen.subtrahend))k&&k.removeHandler(i,this),b&&b.addHandler(i,this);if(!e)return!1;this.event_operandsChanged(this,g,k);if(!a||!b)this.itemCount&&this.event_datasetChanged(this,c={deleted:this.getItems()});else{var e=[],g=[],h;for(h in this.item_)(!a.item_[h]||
b.item_[h])&&e.push(this.item_[h]);for(h in a.item_)!this.item_[h]&&!b.item_[h]&&g.push(a.item_[h]);(c=j(g,e))&&this.event_datasetChanged(this,c)}return c},clear:function(){this.setOperands()}}),m={subscribeTo:w.SOURCE,source:null,sourceMap_:null,event_sourceChanged:u("sourceChanged","dataset","oldSource"),init:function(a){this.sourceMap_={};o.prototype.init.call(this,a);if(a=this.source)this.source=null,this.setSource(a)},setSource:function(a){!1==a instanceof o&&(a=null);if(this.source!==a){var b=
this.source,c=this.listen.source;this.source=a;if(c){var e=c.datasetChanged;b&&(b.removeHandler(c,this),e&&e.call(this,b,{deleted:b.getItems()}));a&&(a.addHandler(c,this),e&&e.call(this,a,{inserted:a.getItems()}))}this.event_sourceChanged(this,b)}},clear:function(){this.setSource()}},a=r(o,m,{map:z,reduce:v,rule:x,addMemberRef:null,removeMemberRef:null,listen:{sourceObject:{update:function(a){var b=this.map?this.map(a):a;if(!1==b instanceof p||this.reduce(b))b=null;var c=this.sourceMap_[a.eventObjectId],
e=c.member;if(e!=b){var g=this.memberMap_,k,h,m;c.member=b;if(e)c=e.eventObjectId,this.removeMemberRef&&this.removeMemberRef(e,a),0==--g[c]&&(delete g[c],m=[e]);if(b)e=b.eventObjectId,this.addMemberRef&&this.addMemberRef(b,a),g[e]?g[e]++:(g[e]=1,h=[b]);(k=j(h,m))&&this.event_datasetChanged(this,k)}}},source:{datasetChanged:function(a,b){var c=this.sourceMap_,e=this.memberMap_,g=[],k=[],h,m,n,l=this.listen.sourceObject;s.setAccumulateState(!0);if(b.inserted)for(var o=0;h=b.inserted[o];o++){n=this.map?
this.map(h):h;if(!1==n instanceof p||this.reduce(n))n=null;l&&h.addHandler(l,this);c[h.eventObjectId]={sourceObject:h,member:n};if(n)m=n.eventObjectId,e[m]?e[m]++:(e[m]=1,g.push(n)),this.addMemberRef&&this.addMemberRef(n,h)}if(b.deleted)for(o=0;h=b.deleted[o];o++)if(m=h.eventObjectId,n=c[m].member,l&&h.removeHandler(l,this),delete c[m],n)m=n.eventObjectId,0==--e[m]&&(delete e[m],k.push(n)),this.removeMemberRef&&this.removeMemberRef(n,h);s.setAccumulateState(!1);(b=j(g,k))&&this.event_datasetChanged(this,
b)},destroy:function(){this.setSource()}}},init:function(a){m.init.call(this,a)},setRule:function(a){"function"!=typeof a&&(a=x);if(this.rule!==a)return this.rule=a,this.applyRule()},setMap:function(a){"function"!=typeof a&&(a=z);if(this.map!==a)return this.map=a,this.applyRule()},setReduce:function(a){"function"!=typeof a&&(a=v);if(this.reduce!==a)return this.reduce=a,this.applyRule()},applyRule:function(){var a=this.sourceMap_,b=this.memberMap_,c,e,g,h,i,m=[],n=[],l,o;for(o in a){i=a[o];h=i.sourceObject;
c=i.member;e=this.map?this.map(h):h;if(!1==e instanceof p||this.reduce(e))e=null;if(c!=e){i.member=e;if(c)g=c.eventObjectId,this.removeMemberRef&&this.removeMemberRef(c,h),b[g]--;if(e)c=e.eventObjectId,this.addMemberRef&&this.addMemberRef(e,h),c in b?b[c]++:(b[c]=1,m.push(e))}}for(g in this.item_)0==b[g]&&(delete b[g],n.push(this.item_[g]));(l=j(m,n))&&this.event_datasetChanged(this,l);return l},destroy:function(){o.prototype.destroy.call(this);this.sourceMap_=null}}),u=r(a,{reduce:function(a){return!this.rule(a)}}),
w=r(a,{map:function(a){return this.keyMap.resolve(a)},subsetClass:o,keyMap:null,addMemberRef:function(a,b){a.event_datasetChanged(a,{inserted:[b]})},removeMemberRef:function(a,b){a.event_datasetChanged(a,{deleted:[b]})},init:function(d){if(!this.keyMap||!1==this.keyMap instanceof l)this.keyMap=new l(y({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));a.prototype.init.call(this,d)},getSubset:function(a,b){return this.keyMap.get(a,b)},destroy:function(){a.prototype.destroy.call(this);this.keyMap.destroy();
this.keyMap=null}}),c=r(o,m,{rule:x,index_:null,offset:0,limit:10,listen:{sourceObject:{update:function(a){var b=this.sourceMap_[a.eventObjectId],a=this.rule(a),c=this.index_;if(a!==b.value)c.splice(q(c,b),1),b.value=a,c.splice(q(c,b),0,b),this.applyRule()}},source:{datasetChanged:function(a,b){var c=this.sourceMap_,e=this.index_,g=this.listen.sourceObject,h,i;if(i=b.inserted)for(var j=0,m;m=i[j];j++)h={object:m,value:this.rule(m)},c[m.eventObjectId]=h,e.splice(q(e,h),0,h),g&&m.addHandler(g,this);
if(i=b.deleted)for(j=0;m=i[j];j++)h=c[m.eventObjectId],e.splice(q(e,h),1),g&&m.removeHandler(g,this);this.applyRule()}}},init:function(a){this.index_=[];m.init.call(this,a)},setRange:function(a,b){this.offset=a;this.limit=b;this.applyRule()},applyRule:function(){for(var a=Object.slice(this.item_),b=this.index_.slice(this.offset,this.offset+this.limit),c=[],e,g=0,h;h=b[g];g++){var i=h.object.eventObjectId;a[i]?delete a[i]:c.push(h.object)}(e=j(c,t(a)))&&this.event_datasetChanged(this,e)}}),r=r(o,m,
{rule:x,map:z,subsetClass:o,listen:{sourceObject:{update:function(a,b){var c=this.sourceMap_,e=this.memberMap_,g=a.eventObjectId,h=c[g].list,c=c[g].list={},g=this.rule(a),i=[],m=[],n;if(Array.isArray(g))for(var l=0;l<g.length;l++)if(n=this.keyMap.resolve(g[l]))o=n.eventObjectId,c[o]=n,h[o]||(n.event_datasetChanged(n,{inserted:[a]}),e[o]?e[o]++:(i.push(n),e[o]=1));for(var o in h)n=h[o],n.event_datasetChanged(n,{deleted:[a]}),--e[o]||(delete e[o],m.push(n));(b=j(i,m))&&this.event_datasetChanged(this,
b)}},source:{datasetChanged:function(a,b){var c=this.sourceMap_,e=this.memberMap_,g=this.listen.sourceObject,h,i,m,n=[],l=[];if(h=b.inserted)for(var o=0,p;p=h[o];o++){var s=this.rule(p),r={object:p,list:{}};c[p.eventObjectId]=r;if(Array.isArray(s))for(var q=0;q<s.length;q++)if(i=this.keyMap.resolve(s[q]))i.event_datasetChanged(i,{inserted:[p]}),m=i.eventObjectId,r.list[m]=i,e[m]?e[m]++:(n.push(i),e[m]=1);g&&p.addHandler(g,this)}if(h=b.deleted)for(o=0;p=h[o];o++){i=p.eventObjectId;s=c[i].list;delete c[i];
for(m in s)i=s[m],i.event_datasetChanged(i,{deleted:[p]}),--e[m]||(delete e[m],l.push(i));g&&p.removeHandler(g,this)}(b=j(n,l))&&this.event_datasetChanged(this,b)}}},init:function(a){if(!this.keyMap||!1==this.keyMap instanceof l)this.keyMap=new l(y({keyGetter:this.map,itemClass:this.subsetClass},this.keyMap));m.init.call(this,a)}});basis.namespace("basis.data.dataset").extend({Merge:h,Subtract:B,MapReduce:a,Subset:u,Split:w,Slice:c,Cloud:r})})(basis,this);
(function(){function j(a){if(a instanceof n)return a.set;a=a.nodeType;if(!1==isNaN(a))return 1==a?h:"nodeValue"}var q=basis.Class,r=basis.dom,y=basis.Cleaner,t=Function.getter,z=basis.cssom.classList,x=basis.EventObject,v=basis.TimeEventManager,u=x.createEvent,w=basis.data,p=w.DataObject,l=w.STATE,o=q(p,{event_change:u("change"),locked:!1,lockValue_:null,extendConstructor_:!1,updateCount:0,init:function(a,c,d){p.prototype.init.call(this,{});c&&this.addHandler(c);this.proxy="function"==typeof d?d:
Function.$self;this.initValue=this.value=this.proxy(a)},set:function(a,c){var d=this.value,b=this.proxy?this.proxy(a):b,f=!1;if(b!==d)this.value=b,f=!0,this.updateCount+=1;!this.locked&&(f||c)&&this.event_change(b,d);return f},lock:function(){if(!this.locked)this.lockValue_=this.value,this.locked=!0},unlock:function(){if(this.locked)this.locked=!1,this.value!==this.lockValue_&&this.event_change(this.value,this.lockValue_)},update:function(a,c){return this.set(a,c)},reset:function(){this.set(this.initValue)},
destroy:function(){p.prototype.destroy.call(this);delete this.initValue;delete this.proxy;delete this.lockValue_;delete this.value}}),s={destroy:function(a){this.removeLink(a)}},h=function(a){r.insert(r.clear(this),a)},n=q(o,{links_:null,event_change:function(a,c){o.prototype.event_change.call(this,a,c);if(this.links_.length&&!y.globalDestroy)for(var d=0,b;b=this.links_[d++];)this.power_(b,c)},init:function(a,c,d){o.prototype.init.call(this,a,c,d);this.links_=[];y.add(this)},addLink:function(a,c,
d){if("object"!=typeof a&&!1==a instanceof Object)throw Error("basis.data.property: Link to undefined object ignored");null==c&&(c=j(a));"function"!=typeof d&&(d=t(Function.$self,d));c={object:a,format:d,field:c,isEventObject:a instanceof x};this.links_.push(c);c.isEventObject&&a.addHandler(s,this);this.power_(c);return a},addLinkShortcut:function(a,c,d){return this.addLink(a,n.shortcut[c],d)},removeLink:function(a,c){if(null!=this.links_){var d=2>arguments.length;!d&&null==c&&(c=j(a));for(var b=
0,f=0,e;e=this.links_[f];f++)e.object===a&&(d||c==e.field)?e.isEventObject&&e.object.removeHandler(s,this):this.links_[b++]=e;this.links_.length=b}},clear:function(){for(var a=0,c;c=this.links_[a];a++)c.isEventObject&&c.object.removeHandler(s,this);this.links_.clear()},power_:function(a,c){var d=a.field;if(null!=d){var b=a.format(this.value),f=a.object;"function"==typeof d?d.call(f,b,2>arguments.length?b:a.format(c)):f[d]=b}},destroy:function(){this.clear();o.prototype.destroy.call(this);this.links_=
null;y.remove(this)}});n.shortcut={className:function(a,c){z(this).replace(c,a)},show:function(a){r.display(this,!!a)},hide:function(a){r.display(this,!a)},disable:function(a){this.disabled=!!a},enable:function(a){this.disabled=!a}};var B=l.PRIORITY,m={stateChanged:function(){this.fire(!1,!0)},update:function(){this.fire(!0)},change:function(){this.fire(!0)},destroy:function(a){this.remove(a)}},q=q(n,{calculateValue:function(){return this.value+1},objects:[],timer_:null,valueChanged_:!1,stateChanged_:!0,
state:l.UNDEFINED,extendConstructor_:!0,init:function(){var a=this.handler;delete this.handler;n.prototype.init.call(this,this.value||0,a,this.proxy);this.objects.length?(a=this.objects,this.objects=[],this.lock(),this.add.apply(this,a),this.unlock()):this.objects=[];this.valueChanged_=this.stateChanged_=!!this.calculateOnInit;this.update();y.add(this)},add:function(){for(var a=0,c=arguments.length;a<c;a++){var d=arguments[a];if(d instanceof p)this.objects.add(d)&&d.addHandler(m,this);else throw Error("basis.data.property: Instance of DataObject required");
}this.fire(!0,!0)},remove:function(a){this.objects.remove(a)&&a.removeHandler(m,this);this.fire(!0,!0)},clear:function(){for(var a=0,c;c=this.objects[a];a++)c.removeHandler(m,this);this.objects.clear();this.fire(!0,!0)},fire:function(a,c){if(!this.locked&&(this.valueChanged_=this.valueChanged_||!!a,this.stateChanged_=this.stateChanged_||!!c,!this.timer_&&(this.valueChanged_||this.stateChanged_)))this.timer_=!0,v.add(this,"update",Date.now())},lock:function(){this.locked=!0},unlock:function(){this.locked=
!1},update:function(){delete this.timer_;v.remove(this,"update");if(!y.globalDestroy&&(this.valueChanged_&&this.set(this.calculateValue()),this.stateChanged_)){var a=this.objects.length;if(a){for(var c=-2,d,b=0;b<a;b++){var f=this.objects[b],e=B.indexOf(""+f.state);e>c&&(d=f,c=e)}d&&this.setState(d.state,d.state.data)}else this.setState(l.UNDEFINED)}this.stateChanged_=this.valueChanged_=!1},destroy:function(){this.lock();this.clear();v.remove(this,"update");n.prototype.destroy.call(this)}});basis.namespace("basis.data.property").extend({DataObjectSet:q,
AbstractProperty:o,Property:n,PropertySet:q})})();
(function(j){function q(a,b){if(!a.length)return 0;var c,e,g=0,h=a.length-1;do if(c=g+h>>1,e=a[c]||0,b<e)h=c-1;else if(b>e)g=c+1;else return b==e?c:0;while(g<=h);return c+(e<b)}function r(a,b){var a=Function.getter(a),f=b+"_"+a.getterIdx_,e=o[f];if(!e)e=o[f]=this,this.indexType=b,this.indexClass=l[b],this.getter=a,this.key=f,this.createInstance=function(a){if(a instanceof w){var d=a.indexes&&a.indexes[this.key];if(!d)d=new this.indexClass(this.getter),d.addHandler(c,a),d.key=this.key;return d}};return e}
function y(a,b,c){var e=a.indexCache_;a.lock();if(b)for(var g=0,h;h=b[g++];){var i=a.valueGetter(h);e[h.eventObjectId]=i;a.add(h,i)}if(c)for(g=0;h=c[g++];)a.remove(h,e[h.eventObjectId]),delete e[h.eventObjectId];a.unlock()}var t=j.Class,z=j.TimeEventManager,x=j.data,v=x.KeyObjectMap,u=x.property.Property,w=x.AbstractDataset,p=x.dataset.MapReduce,l=t(u,{autoDestroy:!0,valueGetter:Function.$null,dataSource:null,init:function(a){u.prototype.init.call(this,this.value||0);this.indexCache_={};this.valueGetter=
a},add:function(){},remove:function(){},upd:function(){}});l.Sum=t(l,{add:function(a,b){this.value+=b},remove:function(a,b){this.value-=b},upd:function(a,b,c){this.set(this.value+b-c)}});l.Avg=t(l,{sum_:0,count_:0,add:function(a,b){this.sum_+=b;this.count_+=1;this.value=this.sum_/this.count_},remove:function(a,b){this.sum_-=b;this.value=(this.count_-=1)?this.sum_/this.count_:0},upd:function(a,b,c){this.sum_+=b-c;this.set(this.sum_/this.count_)}});l.Count=t(l,{valueGetter:Function.$true,add:function(a,
b){b&&(this.value+=1)},remove:function(a,b){b&&(this.value-=1)},upd:function(a,b){this.set(this.value+(b?1:-1))}});l.Max=t(l,{init:function(a,b){this.stack=[];l.prototype.init.call(this,a,b)},add:function(a,b){this.stack.splice(q(this.stack,b),0,b);this.value=this.stack[this.stack.length-1]},remove:function(a,b){this.stack.remove(b);this.value=this.stack[this.stack.length-1]},upd:function(a,b,c){this.stack.splice(q(this.stack,c),1);this.stack.splice(q(this.stack,b),0,b);this.set(this.stack[this.stack.length-
1])}});l.Min=t(l,{init:function(a,b){this.stack=[];l.prototype.init.call(this,a,b)},add:function(a,b){this.stack.splice(q(this.stack,b),0,b);this.value=this.stack[0]},remove:function(a,b){this.stack.remove(b);this.value=this.stack[0]},upd:function(a,b,c){this.stack.splice(q(this.stack,c),1);this.stack.splice(q(this.stack,b),0,b);this.set(this.stack[0])}});var o={},s=function(a){return function(b){return new r(b,a)}},x=s("Sum"),h=s("Avg"),n=s("Count"),B=s("Min"),s=s("Max"),m={update:function(a){var b,
c,e,g=a.eventObjectId,h;for(h in this.indexes)e=this.indexes[h],b=e.indexCache_[g],c=e.valueGetter(a),c!==b&&(e.upd(a,c,b),e.indexCache_[g]=c)}},a={datasetChanged:function(a,b){if(b.inserted)for(var c=0;a=b.inserted[c++];)a.addHandler(m,this);if(b.deleted)for(c=0;a=b.deleted[c++];)a.removeHandler(m,this);for(var e in this.indexes)y(this.indexes[e],b.inserted,b.deleted)},destroy:function(){for(var a in this.indexes)this.indexes[a].destroy()}},c={destroy:function(a){this.removeIndex(a)}};w.prototype.createIndex=
function(d){if(!1!=d instanceof r){if(!this.indexes)this.indexes={},this.addHandler(a),a.datasetChanged.call(this,this,{inserted:this.getItems()});var b=d.key;this.indexes[b]||(d=d.createInstance(this),this.indexes[b]=d,y(d,this.getItems()));return this.indexes[b]}};w.prototype.removeIndex=function(d){if(this.indexes&&this.indexes[d.key]){delete this.indexes[d.key];d.destroy();for(var b in this.indexes)return;this.removeHandler(a);delete this.indexes}};t=t(p,{calcs:null,indexes:null,indexes_:null,
timer_:null,indexUpdated:null,memberSourceMap:null,keyMap:null,event_sourceChanged:function(a,b){p.prototype.event_sourceChanged.call(this,a,b);var c,e;for(e in this.indexes_)c=this.indexes_[e],b&&(this.removeIndex(e),b.removeIndex(this.indexes[e])),this.source&&this.addIndex(e,this.source.createIndex(c))},listen:{sourceObject:{update:function(a,b){p.prototype.listen.sourceObject.update.call(this,a,b);this.sourceMap_[a.eventObjectId].updated=!0;this.fireUpdate()}},index:{change:function(a){var b=
this.indexMap;b.indexValues[this.key]=a;b.indexUpdated=!0;b.fireUpdate()}},member:{subscribersChanged:function(a,b){0<a.subscriberCount&&0==b&&this.calcMember(a)}}},map:function(a){return this.keyMap.get(a,!0)},addMemberRef:function(a,b){this.memberSourceMap[a.eventObjectId]=b.eventObjectId;this.listen.member&&a.addHandler(this.listen.member,this);this.sourceMap_[b.eventObjectId].updated=!0;0<a.subscriberCount&&this.calcMember(a)},removeMemberRef:function(a){delete this.memberSourceMap[a.eventObjectId];
this.listen.member&&a.removeHandler(this.listen.member,this)},init:function(a){this.indexUpdated=!1;this.indexesBind_={};this.memberSourceMap={};var b=this.indexes;this.indexes={};this.indexes_={};this.calcs=this.calcs||{};this.indexValues={};if(!this.keyMap||!1==this.keyMap instanceof v)this.keyMap=new v(Object.complete({create:function(a,d){return new this.itemClass(d)}},this.keyMap));p.prototype.init.call(this,a);Object.iterate(b,this.addIndex,this)},addIndex:function(a,b){if(!this.indexes[a]){if(b instanceof
r){if(this.indexes_[a])return;this.indexes_[a]=b;b=this.source&&this.source.createIndex(b)}if(b instanceof l){this.indexValues[a]=b.value;this.indexes[a]=b;this.indexesBind_[a]={key:a,indexMap:this};var c=this.listen.index;c&&(b.addHandler(c,this.indexesBind_[a]),c.change&&c.change.call(this.indexesBind_[a],b.value))}}},removeIndex:function(a){if(this.indexes_[a]||this.indexes[a])this.indexes[a]&&this.listen.index&&this.indexes[a].removeHandler(this.listen.index,this.indexesBind_[a]),delete this.indexValues[a],
delete this.indexesBind_[a],delete this.indexes[a],delete this.indexes_[a]},addCalc:function(a,b){this.calcs[a]=b;this.fireUpdate()},removeCalc:function(){delete this.calcs[name]},lock:function(){Object.values(this.indexes).forEach(function(a){a.lock()})},unlock:function(){Object.values(this.indexes).forEach(function(a){a.unlock()})},fireUpdate:function(){if(!this.timer_)this.timer_=!0,z.add(this,"apply",Date.now())},apply:function(){for(var a in this.item_)this.calcMember(this.item_[a]);this.timer_=
this.indexUpdated=!1},calcMember:function(a){var b=this.sourceMap_[this.memberSourceMap[a.eventObjectId]];if(a.subscriberCount&&(b.updated||this.indexUpdated)){b.updated=!1;var c={},e,g,h;for(h in this.calcs)if(e=this.calcs[h](b.sourceObject.data,this.indexValues),a.data[h]!==e&&(!isNaN(e)||!isNaN(a.data[h])))c[h]=e,g=!0;g&&a.update(c)}},getMember:function(a){return this.keyMap.get(a,!0)},destroy:function(){this.indexesBind_=this.memberSourceMap=this.indexUpdated=this.calcs=this.timer_=null;this.keyMap.destroy();
this.keyMap=null;for(var a in this.indexes)this.removeIndexConstructor(a);p.prototype.destroy.call(this)}});j.namespace("basis.data.index").extend({IndexConstructor:r,Index:l,Sum:x,Avg:h,Count:n,Max:s,Min:B,IndexMap:t})})(basis);
(function(j){function q(a){e[a]=e[a]||0;return a+e[a]++}function r(){var a=Array.from(arguments),b=a.pop();"function"!=typeof b&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=
!0;return b}function y(){return r.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;0<b--;){if(null==arguments[b])return null;a.push(arguments[b])}return a.join("-")}))}var t=j.Class,z=j.Cleaner,x=Object.extend,v=Function.$self,u=Function.getter,w=j.data,p=j.EventObject,l=w.Dataset,o=w.dataset.Subset,s=w.dataset.Split,h=w.DataObject,n=w.STATE,B={},m={string:1,number:1},a=[],c=function(a){return isNaN(a)?null:Number(a)},d=function(a){return isNaN(a)?null:Number(a)},
b=function(a){return isNaN(a)?null:parseInt(a)},f=function(a){return null==a?null:""+a},e={},g=j.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+c;return e};z.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=
b,!0},remove:function(a,b){if(this.index[a]===b)return delete this.index[a],!0},destroy:function(){this.index=null}}),w=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},k=function(a,b){return function(c){if(!this.name)this.name=q(b);a.prototype.init.call(this,c)}},i=function(a){return function(b,c){l.setAccumulateState(!0);b=(b||[]).map(this.wrapper);l.setAccumulateState(!1);return a.prototype.sync.call(this,b,c)}},A=t(l,{wrapper:Function.$self,init:k(l,"EntitySet"),
sync:i(l),set:w(l,"set"),add:w(l,"add"),remove:w(l,"remove"),destroy:function(){l.prototype.destroy.call(this);delete this.wrapper}}),F=t(A,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),D=t(o,{init:k(o,"EntityCollection"),sync:i(o)});D.sourceHandler=o.sourceHandler;var H=t(s,{subsetClass:F,init:k(s,"EntityGrouping"),sync:i(s),getSubset:function(a,b){var c=s.prototype.getSubset.call(this,a,b);if(c)c.wrapper=this.wrapper;return c}}),K=function(a){if(this instanceof
K){var b=new C(a||v);return function(a,c){return null!=a?(c instanceof A||(c=b.createEntitySet()),c.set(a instanceof l?a.getItems():Array.from(a)),c):null}}};K.className="basis.entity.EntitySetWrapper";var C=t(null,{init:function(a){this.wrapper=a},createEntitySet:function(){return new A({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),E=function(a){if(this instanceof E){var b=function(a,b){if(null!=a){if(a===b||a.entityType===c)return a;var g,
h=c.idField;if(m[typeof a]){if(!h)return;g=a;a={};a[h]=g}else if(c.compositeKey)g=c.compositeKey(a,a);else if(h)g=a[h];else if(f&&(b=c.singleton,!b))return c.singleton=new e(a);null!=g&&d&&(b=d.get(g,c.entityClass));b&&b.entityType===c?b.update(a):b=new e(a);return b}return c.singleton},c=new J(a||{},b),d=c.index__,e=c.entityClass,f=c.isSingleton;x(b,{toString:function(){return this.typeName+"()"},entityType:c,type:b,typeName:c.name,index:d,reader:function(a){return c.reader(a)},get:function(a){return c.get(a)},
addField:function(a,b){c.addField(a,b)},all:c.all,createCollection:function(a,d,e){var f=c.collection_[a];return!f&&d?c.collection_[a]=new D({wrapper:b,source:e||c.all,rule:d}):f},getCollection:function(a){return c.collection_[a]},createGrouping:function(a,d,e){var f=c.grouping_[a];return!f&&d?c.grouping_[a]=new H({wrapper:b,source:e||c.all,rule:d}):f},getGrouping:function(a){return c.grouping_[a]},getSlot:function(a,b){return c.getSlot(a,b)}});return b}};E.className="basis.entity.EntityTypeWrapper";
var L=u("singleton"),I={};t(h,{});var J=t(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:!1,index__:null,slot_:null,init:function(b,c){this.name=b.name||q(this.name);this.index__=b.index;this.idFields={};a.push(this);this.isSingleton=b.isSingleton;this.wrapper=c;this.all=new F(Object.extend(b.all||{},{wrapper:c}));this.slot_={};if(b.extensible)this.extensible=!0;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(b.fields,this.addField,this);b.constrains&&
b.constrains.forEach(function(a){this.addCalcField(null,a)},this);if(this.isSingleton)this.get=L;b.aliases&&Object.iterate(b.aliases,this.addAlias,this);this.collection_={};if(b.collections)for(var d in b.collections)this.collection_[d]=new D({name:d,wrapper:c,source:this.all,rule:b.collections[d]||Function.$true});this.grouping_={};if(b.groupings)for(d in b.groupings)this.grouping_[d]=new H({name:d,wrapper:c,source:this.all,rule:b.groupings[d]||Function.$true});this.entityClass=N(this,this.all,this.index__,
this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:c,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(m[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||null==a)return null;for(var c in a){var d=c in this.aliases?this.aliases[c]:"";d&&d in this.fields&&(b[d]=this.fields[d].reader?this.fields[d].reader(a[c]):a[c])}return b},addAlias:function(a,b){b in this.fields&&!1==a in this.aliases&&(this.aliases[a]=b)},addField:function(a,
e){if(!this.all.itemCount){this.aliases[a]=a;"function"==typeof e&&(e={type:e});if("type"in e&&"function"!=typeof e.type)e.type=v;var h=e.type||v;if([c,d,b,f].has(h))e.id=!0;if(e.id){if(!this.index__)this.index__=new g(String);this.idFields[a]=!0;this.idField||this.compositeKey?(this.idField=null,this.compositeKey=y.apply(null,Object.keys(this.idFields))):this.idField=a}e.calc?this.addCalcField(a,e.calc,void 0):this.fields[a]=h;this.defaults[a]="defValue"in e?e.defValue:h();this.getters["get_"+a]=
function(){return this.data[a]};I[a]||(I[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){if(!this.calcs)this.calcs=[];for(var d={args:b.args,wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=g;break}if(f>e)return;if(this.idField&&a==this.idField)this.compositeKey=b;this.fields[a]=function(a,
b){"undefined"!=typeof console&&console.log("Calculate fields are readonly");return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(null!=a)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&null!=a){if(m[typeof a])return a;if(a&&a.entityType===this)return a.__id__;if(a instanceof h)a=a.data;return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);if(null!=b){var c=
this.slot_[b];c||(m[typeof a]&&(c={},this.idField&&!this.compositeKey&&(c[this.idField]=a),a=c),c=this.slot_[b]=new h({delegate:this.get(b),data:a}));return c}}}),M=t(h,{init:p.prototype.init,event_rollbackUpdate:p.createEvent("rollbackUpdate")}),N=function(a,b,c,d,e,f,g){function i(b,c,d){var e=!1,f=a.calcs,g=b.__id__,h=b.data;try{if(f)for(var j=0,n;n=f[j++];){var l=n.key;if(l){var o=h[l];h[l]=n.wrapper(c,h,h[l]);h[l]!==o&&(c[l]=o,e=!0)}else n.wrapper(c,h)}if(a.compositeKey)b.__id__=a.compositeKey(c,
h,b.__id__);else if(m&&m in c)b.__id__=h[m];b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(p){b.__id__=g;for(var s in c)b.data[s]=c[s];if(d)for(s in d)if(!b.modified)b.modified=d;e=!1}b.__id__!==g&&k(b,g,b.__id__);return e}function k(a,b,e){null!=b&&(c.remove(b,a),d[b]&&d[b].setDelegate());null!=e&&(c.add(e,a),d[e]&&d[e].setDelegate(a))}var m=a.idField;return t(M,g,{canHaveDelegate:!1,modified:null,isTarget:!0,extendConstructor_:!1,init:function(a){M.prototype.init.call(this);this.fieldHandlers_=
{};this.data={};this.root=this;this.target=this;var c,d={},g;for(g in e)g in a?(d[g]=f[g],c=e[g](a[g])):c=f[g],c&&c!==this&&c instanceof p&&c.addHandler(I[g],this)&&(this.fieldHandlers_[g]=!0),this.data[g]=c;i(this,d);b.event_datasetChanged(b,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,f){var g=e[b];if(!g){if(!a.extensible)return;g=v}var h,k=this.modified,c=g(c,this.data[b]),
g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{h={};if(b!=m)if(d){if(!k)this.modified=k={};if(!1===b in k)h.rollback={key:b,value:void 0},k[b]=g;else if(k[b]===c&&(h.rollback={key:b,value:c},delete k[b],!Object.keys(k).length))this.modified=null}else if(k&&b in k)if(k[b]!==c){h.rollback={key:b,value:k[b]};k[b]=c;break a}else return!1;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(I[b],this),this.fieldHandlers_[b]=!1);c&&c!==this&&c instanceof p&&
c.addHandler(I[b],this)&&(this.fieldHandlers_[b]=!0);h.key=b;h.value=g;h.delta={};h.delta[b]=g}else if(!d&&k&&b in k&&(h={rollback:{key:b,value:k[b]}},delete k[b],!Object.keys(k).length))this.modified=null;if(!f&&h){var d=h.key,b=h.delta||{},n;if(h.rollback)n={},n[h.rollback.key]=h.rollback.value;i(this,b,n)&&(d=!0);if(d)this.event_update(this,b),h.delta=b;n&&this.event_rollbackUpdate(this,n)}return h||!1},update:function(a,b){if(a){var c,d={},e,f={},g,h;for(h in a)if(g=this.set(h,a[h],b,!0)){if(g.key)c=
!0,d[g.key]=g.value;if(g.rollback)e=!0,f[g.rollback.key]=g.rollback.value}i(this,d,f)&&(c=!0);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:!1},reset:function(){this.update(f)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=n.PROCESSING){if(this.modified){var a=this.modified;
this.modified=null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(n.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.data[a].removeHandler(I[a],this);this.fieldHandlers_=B;this.__id__&&k(this,this.__id__,null);h.prototype.destroy.call(this);b.event_datasetChanged(b,{deleted:[this]});this.data=B;this.modified=null}})};j.namespace("basis.entity").extend({isEntity:function(a){return a&&a instanceof N},NumericId:c,NumberId:d,IntId:b,StringId:f,Index:g,CalculateField:r,
EntityType:E,Entity:N,BaseEntity:M,EntitySetType:K,EntitySet:A,ReadOnlyEntitySet:F,Collection:D,Grouping:H})})(basis);
(function(j){var q=j.Class,r=j.dom,y=j.html.Template,t=j.cssom.classList,z=Function.getter,x=j.Cleaner,v=j.dom.wrapper.Node,u=j.dom.wrapper.PartitionNode,w=j.dom.wrapper.GroupingNode,p=q.ExtensibleProperty(),l=function(j){return{template:new y("<div/>"),action:p,cssClassName:null,event_update:function(h,n){this.templateUpdate(this.tmpl,"update",n);j.event_update.call(this,h,n)},event_select:function(h){j.event_select.call(this,h);t(this.tmpl.selected||this.tmpl.content||this.element).add("selected")},
event_unselect:function(h){j.event_unselect.call(this,h);t(this.tmpl.selected||this.tmpl.content||this.element).remove("selected")},event_disable:function(h){j.event_disable.call(this,h);t(this.tmpl.disabled||this.element).add("disabled")},event_enable:function(h){j.event_enable.call(this,h);t(this.tmpl.disabled||this.element).remove("disabled")},event_match:function(h){j.event_match.call(this,h);r.display(this.element,!0)},event_unmatch:function(h){j.event_unmatch.call(this,h);r.display(this.element,
!1)},init:function(h){this.tmpl={};if(this.template){this.template.createInstance(this.tmpl,this);this.element=this.tmpl.element;if(this.tmpl.childNodesHere)this.tmpl.childNodesElement=this.tmpl.childNodesHere.parentNode,this.tmpl.childNodesElement.insertPoint=this.tmpl.childNodesHere;this.content&&r.insert(this.tmpl.content||this.element,this.content)}else this.element=this.tmpl.element=r.createElement();this.childNodesElement=this.tmpl.childNodesElement||this.element;j.init.call(this,h);if(this.id)this.element.id=
this.id;if(h=this.cssClassName){"string"==typeof h&&(h={element:h});for(var n in h){var l=this.tmpl[n];if(l)for(var l=t(l),m=(""+h[n]).qw(),a=0,c;c=m[a++];)l.add(c)}}this.tmpl&&this.templateUpdate(this.tmpl);this.container&&r.insert(this.container,this.element)},templateAction:function(h,j){var l=this.action[h];l&&l.call(this,j)},templateUpdate:function(){},destroy:function(){var h=this.element;j.destroy.call(this);h&&h.parentNode&&h.parentNode.removeChild(h);this.template&&this.template.clearInstance(this.tmpl,
this);this.childNodesElement=this.tmpl=this.element=null}}},v=q(v,l,{}),z=q(u,l,{titleGetter:z("data.title"),templateUpdate:function(j){if(j.titleText)j.titleText.nodeValue=""+this.titleGetter(this)}}),l=function(j){return{insertBefore:function(h,n){var h=j.insertBefore.call(this,h,n),l=h.groupNode||this,m=h.nextSibling,l=l.childNodesElement||l.element||this.childNodesElement||this.element,a=h.element,m=(m&&m.element.parentNode==l?m.element:null)||l.insertPoint||null;(a.parentNode!==l||a.nextSibling!==
m)&&l.insertBefore(a,m);return h},removeChild:function(h){j.removeChild.call(this,h);var n=h.element,l=n.parentNode;l&&l.removeChild(n);return h},clear:function(h){if(h)for(var n=this.firstChild;n;){var l=n.element;l.parentNode&&l.parentNode.removeChild(l);n=n.nextSibling}j.clear.call(this,h)},setChildNodes:function(h,n){var l=r.createFragment(),m=this.localGrouping||this,a=m.childNodesElement||m.element;m.childNodesElement=l;j.setChildNodes.call(this,h,n);a.insertBefore(l,a.insertPoint||null);m.childNodesElement=
a}}},u=q(w,l,{childClass:z,localGroupingClass:q.SELF,event_ownerChanged:function(j,h){var n=this,l=this.owner,m=null;l&&(m=l.tmpl&&l.tmpl.groupsElement||l.childNodesElement||l.element,m.appendChild(this.nullElement));do n.element=n.childNodesElement=m;while(n=n.localGrouping);w.prototype.event_ownerChanged.call(this,j,h)},init:function(j){this.element=this.childNodesElement=this.nullElement=r.createFragment();w.prototype.init.call(this,j)}}),o=q(v,l,{childClass:v,childFactory:function(j){return new this.childClass(j)},
localGroupingClass:u}),q=q(o,{selection:{},init:function(j){this.document=this;o.prototype.init.call(this,j);x.add(this)},destroy:function(){if(this.selection)this.selection.destroy(),this.selection=null;o.prototype.destroy.call(this);x.remove(this)}}),l=function(j,h){for(var l=j.match(/\{(this_[^\}]+)\}/g)||[],o=[],m=0;m<l.length;m++){var a=l[m].match(/\{(this_[^\|\}]+)\}/)[1];o.push("this.tmpl."+a+".nodeValue = "+a.replace(/_/g,"."))}return Function("tmpl_","config_","return "+function(a){return Object.extend({template:tmpl_,
templateUpdate:function(d,b,f){a.templateUpdate.call(this,d,b,f);_code_()}},config_)}.toString().replace("_code_()",o.join(";\n")))(new y(j),h)};j.namespace("basis.ui",l).extend({simpleTemplate:l,Node:v,Container:o,PartitionNode:z,GroupingNode:u,Control:q})})(basis);
