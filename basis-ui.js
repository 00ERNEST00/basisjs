/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(x){function F(a,d){for(var b in d)a[b]=d[b];return a}function G(a,d){for(var b in d)if(b in a==false)a[b]=d[b];return a}function R(a){return a==null||a==undefined}function J(a){return a}function T(a){var d={};a.names=function(b){return Object.slice(d,typeof b=="string"?b.qw():b)};a.extend=function(b){G(d,b);F(this,b);return this};return a}function P(a,d){for(var b=a.split("."),c=x,f,i,k;b.length;){f=b.shift();i=(i?i+".":"")+f;if(!c[f]){c[f]=T((!b.length?d:null)||function(){},i);if(k)k.namespaces_[i]=
c[f]}c=c[f];if(!k){k=c;if(!k.namespaces_)k.namespaces_={}}}return D[a]=c}F(Object,{extend:F,complete:G,keys:function(a){var d=[];for(var b in a)d.push(b);return d},values:function(a){var d=[];for(var b in a)d.push(a[b]);return d},slice:function(a,d){var b={};if(!d)return F(b,a);for(var c=0,f;f=d[c++];)if(f in a)b[f]=a[f];return b},splice:function(a,d){var b={};if(!d)return F(b,a);for(var c=0,f;f=d[c++];)if(f in a){b[f]=a[f];delete a[f]}return b},iterate:function(a,d,b){var c=[];for(var f in a)c.push(d.call(b,
f,a[f]));return c},coalesce:function(){for(var a=arguments,d=0;d<a.length;d++)if(a[d]!=null)return a[d]}});var N=function(){},K=function(){var a=1,d={},b={},c=function(f){return f.modificator};c.getter=c;c.getterIdx_=a++;return function(f,i){var k,l;if(!i){if(f.getter)return f.getter;if(typeof f=="function")return f}if(typeof f!="function")if(b[f])k=b[f];else{k=new Function("object","return object != null ? object."+f+" : object");k.path=f;k.getterIdx_=a++;b[f]=k}else{k=f;if(!k.getterIdx_)k.getterIdx_=
a++}l=k.getterIdx_;var g=d[l];if(g)if(typeof i=="undefined"){if(g.nmg)return g.nmg}else for(l=0;l<g.length;l++){if(g[l].modificator===i)return g[l].getter}else g=d[l]=[];var m=true;switch(i&&typeof i){case "string":l=function(n){return i.format(k(n))};break;case "function":l=function(n){return i(k(n))};break;case "object":m=false;l=function(n){return i[k(n)]};break;default:l=k.path?k:function(n){return k(n)}}if(m){g.push({getter:l,modificator:i});if(typeof i=="undefined")g.nmg=l}return l.getter=l}}();
F(Function,{$undefined:function(a){return a==undefined},$defined:function(a){return a!=undefined},$isNull:R,$isNotNull:function(a){return a!=null&&a!=undefined},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:J,$const:function(a){return function(){return a}},$false:function(){return false},$true:function(){return true},$null:function(){return null},$undef:N,getter:K,def:function(a,d,b){b=b||R;return function(c){c=a(c);return b(c)?d:c}},wrapper:function(a){return function(d){var b=
{};b[a]=d;return b}},lazyInit:function(a,d){var b=0,c,f;return c=function(){if(!b++){c.inited=true;c.data=f=a.apply(d||this,arguments)}return f}},lazyInitAndRun:function(a,d,b){var c=0,f,i;return f=function(){if(!c++){f.inited=true;f.data=i=a.call(b||this)}d.apply(i,arguments);return i}},runOnce:function(a,d){var b=0;return function(){if(!b++)return a.apply(d||this,arguments)}}});G(Function.prototype,{bind:function(a){var d=this,b=Array.from(arguments,1);return b.length?function(){return d.apply(a,
b.concat.apply(b,arguments))}:function(){return d.apply(a,arguments)}}});G(Array,{isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"}});F(Array,{from:function(a,d){if(a!=null){var b=a.length;if(typeof b=="undefined")return[a];d||(d=0);if(b-d>0){for(var c=[],f=0,i=d;i<b;)c[f++]=a[i++];return c}}return[]},create:function(a,d,b){for(var c=[],f=0;f<a;f++)c[f]=typeof d=="function"?d.call(b,f,c):d;return c}});G(Array.prototype,{indexOf:function(a,d){d=parseInt(d)||0;if(d<0)return-1;
for(;d<this.length;d++)if(this[d]===a)return d;return-1},lastIndexOf:function(a,d){var b=this.length;d=parseInt(d);for(d=isNaN(d)||d>=b?b-1:(d+b)%b;d>=0;d--)if(this[d]===a)return d;return-1},forEach:function(a,d){for(var b=0,c=this.length;b<c;b++)b in this&&a.call(d,this[b],b,this)},every:function(a,d){for(var b=0,c=this.length;b<c;b++)if(b in this&&!a.call(d,this[b],b,this))return false;return true},some:function(a,d){for(var b=0,c=this.length;b<c;b++)if(b in this&&a.call(d,this[b],b,this))return true;
return false},filter:function(a,d){for(var b=[],c=0,f=this.length;c<f;c++)c in this&&a.call(d,this[c],c,this)&&b.push(this[c]);return b},map:function(a,d){for(var b=[],c=0,f=this.length;c<f;c++)if(c in this)b[c]=a.call(d,this[c],c,this);return b},reduce:function(a,d){var b=this.length,c=arguments.length;if(b==0&&c==1)throw new TypeError;var f,i=0;if(c>1){f=d;i=1}for(c=0;c<b;c++)if(c in this)f=i++?a.call(null,f,this[c],c,this):this[c];return f}});F(Array.prototype,{flatten:function(){return this.concat.apply([],
this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[a>=0?a:this.length+a]},search:function(a,d,b){Array.lastSearchIndex=-1;d=Function.getter(d||J);b=parseInt(b)||0;for(var c=this.length;b<c;b++)if(d(this[b])===a)return this[Array.lastSearchIndex=b]},lastSearch:function(a,d,b){Array.lastSearchIndex=-1;d=Function.getter(d||J);var c=this.length;b=isNaN(b)||b==null?c:parseInt(b);for(c=b>c?c:b;c-- >0;)if(d(this[c])===a)return this[Array.lastSearchIndex=
c]},binarySearchPos:function(a,d,b,c,f,i){if(!this.length)return c?-1:0;d=Function.getter(d||J);b=!!b;var k;f=isNaN(f)?0:f;var l=isNaN(i)?this.length-1:i;do{i=f+l>>1;k=d(this[i]);if(b?a>k:a<k)l=i-1;else if(b?a<k:a>k)f=i+1;else return a==k?i:c?-1:0}while(f<=l);return c?-1:i+(k<a^b)},binarySearch:function(a,d){return this.binarySearchPos(a,d,false,true)},add:function(a){return this.indexOf(a)==-1&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return a!=-1&&!!this.splice(a,1)},has:function(a){return this.indexOf(a)!=
-1},merge:function(a){return this.reduce(F,a||{})},sortAsObject:function(a,d,b){a=Function.getter(a);b=b?-1:1;return this.map(function(c,f){return{i:f,v:a(c)}}).sort(d||function(c,f){return b*(c.v>f.v||-(c.v<f.v)||(c.i>f.i?1:-1))}).map(function(c){return this[c.i]},this)},set:function(a){if(this!==a){this.length=0;this.push.apply(this,a)}return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var M=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);
if(a.length<2)a[1]=this.length;return M.apply(this,a)}}var B={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};G(String,{toLowerCase:function(a){return String(a).toLowerCase()},toUpperCase:function(a){return String(a).toUpperCase()},trim:function(a){return String(a).trim()},trimLeft:function(a){return String(a).trimLeft()},
trimRight:function(a){return String(a).trimRight()},isEmpty:function(a){return a==null||String(a)==""},isNotEmpty:function(a){return a!=null&&String(a)!=""}});G(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});F(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(d){if(a)throw d;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:
function(){for(var a=[],d=this.length,b=0;b<d;b++)a[b]=this.charAt(b);return a},repeat:function(a){return(new Array(parseInt(a)+1||0)).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(a){for(var d={},b=0;b<arguments.length;b++)d[b]=arguments[b];typeof a=="object"&&F(d,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(c,f,i,k,l){c=f in d?d[f]:l?"":
c;if(i&&!isNaN(c)){c=Number(c);return i=="."?c.toFixed(k):c.lead(k)}return c})},quote:function(a,d){a=a||'"';d=d||B[a]||a;var b=(a.length==1?a:"")+(d.length==1?d:"");return a+(b?this.replace(new RegExp("["+b.forRegExp()+"]","g"),"\\$&"):this)+d},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,d){return d.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});
String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=11)String.prototype.split=function(a){if(a==""||a&&a.source=="")return this.toArray();var d=[],b=0,c;if(a instanceof RegExp)for(a.global||(a=new RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));c=a.exec(this);){c[0]=this.substring(b,c.index);d.push.apply(d,c);b=a.lastIndex}else for(;(c=this.indexOf(a,b))!=-1;){d.push(this.substring(b,c));b=c+a.length}d.push(this.substr(b));return d};if("12".substr(-1)!="2"){var A=
String.prototype.substr;String.prototype.substr=function(a,d){return A.call(this,a<0?Math.max(0,this.length+a):a,d)}}F(Number.prototype,{fit:function(a,d){if(!isNaN(a)&&this<a)return Number(a);if(!isNaN(d)&&this>d)return Number(d);return this},between:function(a,d){return!isNaN(this)&&this>=a&&this<=d},quote:function(a,d){return(this+"").quote(a,d)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(a){return!a||isNaN(a)?0:
Math.floor(this/a)*a},lead:function(a,d){return(this+"").replace(/\d+/,function(b){return(a-=b.length-1)>1?Array(a).join(d||0)+b:b})},group:function(a,d){return(this+"").replace(/\d+/,function(b){return b.replace(/\d/g,function(c,f){return!f+(b.length-f)%(a||3)?c:(d||" ")+c})})},format:function(a,d,b,c,f){a=this.toFixed(a);if(d||f)a=a.replace(/(\d+)(\.?)/,function(i,k,l){return(d?Number(k).group(3,d):k)+(l?f||l:"")});if(b)a=a.replace(/^-?/,"$&"+(b||""));return a+(c||"")}});G(Date,{now:function(){return+new Date}});
(new Date).getYear()<1900&&F(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&a<100?Number(a)+1900:a)}});var D={},C=function(){function a(i,k){for(var l=D[i],g=k?k.split(/\./):[];l&&g.length;)l=l[g.shift()];return l}var d=x.document?x.document.getElementsByTagName("SCRIPT"):null,b=(d?d[d.length-1].src:module.filename).replace(/[^\/]+$/,""),c={},f;if(typeof require=="function")f=function(i){return require(requirePath+i.replace(/\./g,
"/"))};else{f=function(i,k){var l=i.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],g=i.substr(l.length?l.length+1:0),m=a(l,g),n=/^basis\./.test(l)?b:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!D[l]||!m)if(/^https?:/.test(n))if(c[i])throw"Attempt to load namespace, probably cycle require";else{c[i]=1;n=n+(k||"")+i.replace(/\./g,"/")+".js";var q=new XMLHttpRequest;q.open("POST",n,false);q.send(null);if(q.status==200){try{(new Function(q.responseText)).call(x)}catch(t){throw t;
}f.sequence.push(i.replace(/\./g,"/")+".js")}else if(q.status==404&&g)C(l);else throw"unable to load module "+i+" by basis.require()";}else throw"Path `"+i+"` can't be resolved";return m||a(l,g)};f.sequence=[]}return f}(),v=function(){function a(l){return typeof l=="function"&&l.basisClass_}var d=Function(),b={id:1},c={},f=function(){for(var l in{toString:1})return;return true}();F(d,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+
(this.constructor||this).className+"]"},destroy:function(){for(var l in this)this[l]=null;this.destroy=N}},create:function(l){if(typeof l!="function")l=d;var g=Function();g.prototype=l.prototype;g=new g;for(var m={className:l.className+"._SubClass_",basisClass_:true,superClass_:l,extendConstructor_:!!l.extendConstructor_,__extend__:function(h){return h&&(typeof h=="object"||typeof h=="function"&&!a(h))&&h!==c?d.create.call(null,H,h):h},extend:d.extend,subclass:function(){return d.create.apply(null,
[H].concat(Array.from(arguments)))},prototype:g},n=arguments,q=1;q<n.length;q++)m.extend(typeof n[q]=="function"&&!a(n[q])?n[q](l.prototype):n[q]);var t={},H=m.extendConstructor_?function(h,j){this.eventObjectId=b.id++;var o;for(var r in h){o=this[r];this[r]=o&&o.__extend__?o.__extend__(h[r]):h[r]}this.init(j||t)}:function(){this.eventObjectId=b.id++;this.init.apply(this,arguments)};g.constructor=H;for(var e in g)if(g[e]===c)g[e]=H;F(H,m);return H},extend:function(l){var g=this.prototype;if(l.prototype)l=
l.prototype;for(var m in l){var n=l[m],q=g[m];if(m=="className"||m=="extendConstructor_")this[m]=n;else g[m]=q&&q.__extend__?q.__extend__(n):n}if(f&&l[m="toString"]!==Object.prototype[m])g[m]=l[m];return this}});var i=function(l,g){return{__extend__:function(m){var n=Function();n.prototype=this;n=new n;g(n,m);return n}}.__extend__(l)},k=function(l){return i(l,F)};return P("basis.Class",d.create).extend({SELF:c,BaseClass:d,create:d.create,isClass:a,CustomExtendProperty:i,ExtensibleProperty:k,NestedExtProperty:function(l){return i(l,
function(g,m){for(var n in m){var q=g[n];g[n]=q&&q.__extend__?q.__extend__(m[n]):k(m[n])}})}})}(),w=function(){function a(i){var k=b[i];k||(k=b[i]=function(){var l=this.handlers_,g,m;if(l&&l.length){l=d.call(l);for(var n=l.length;n-- >0;){g=l[n];m=g.handler[i];typeof m=="function"&&m.apply(g.thisObject,arguments)}}});return k}var d=Array.prototype.slice,b={},c,f=v(null,{handlers_:null,event_destroy:c=a("destroy","object"),listen:v.NestedExtProperty(),extendConstructor_:true,init:function(){if(this.handler)(this.handlers_||
(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(i,k){var l=this.handlers_;if(!l)l=this.handlers_=[];k||(k=this);for(var g=l.length,m;g-- >0;){m=l[g];if(m.handler===i&&m.thisObject===k)return false}return!!l.push({handler:i,thisObject:k||this})},removeHandler:function(i,k){var l=this.handlers_;if(l){k||(k=this);for(var g=l.length,m;g-- >0;){m=l[g];if(m.handler===i&&m.thisObject===k)return!!l.splice(g,1)}return false}},destroy:function(){if(this.handlers_){c.call(this,
this);this.handlers_=null}}});f.createEvent=a;f.event=b;return f}(),z=function(){var a=[];return{add:function(d){d!=null&&a.push(d)},remove:function(d){a.remove(d)}}}();(function(){function a(g){if(d){if(g.source!=x||g.data!=b)return;basis.dom.event.kill(g)}if(c.length){g=c.shift();delete f[g.key];g.fn()}}var d=typeof addEventListener=="function"&&typeof postMessage=="function",b="zeroTimeoutMessage",c=[],f={},i=1;d&&x.addEventListener("message",a,true);var k=setTimeout;x.setTimeout=function(g,m){var n;
if(m)n=k.call(x,g,m);else{n={key:"z"+i++,fn:typeof g=="function"?g:new Function(g)};f[n.key]=n;c.push(n);if(d)postMessage(b,"*");else n.timer=k.call(x,a,0);n=n.key}return n};var l=clearTimeout;x.clearTimeout=function(g){if(/z\d+/.test(g)){var m=f[g];if(m){clearTimeout(m.timer);c.remove(m);delete f[g]}}else return l.call(x,g)}})();var y=function(){function a(){if(!m)if(i.length){var n=Date.now(),q=Math.max(i[0].eventTime,n);if(q<l){clearTimeout(g);g=setTimeout(b,(l=q)-n)}}else{g=clearTimeout(g);l=
c}}function d(n,q){var t=n.eventObjectId,H=k[q]&&k[q][t];if(H){i.remove(H);delete k[q][t];a()}}function b(){var n=Date.now();n=i.binarySearchPos(n+15,f);m=true;i.splice(0,n).forEach(function(q){delete k[q.eventName][q.object.eventObjectId];q.callback.call(q.object)});m=false;l=c;a()}var c=2E12,f=K("eventTime"),i=[],k={},l=c,g=null,m=false;z.add({destroy:function(){m=true;clearTimeout(g);i.length=0;k=null}});return{add:function(n,q,t){var H=n.eventObjectId,e=k[q];e||(e=k[q]={});var h=e[H];if(h){if(isNaN(t))return d(n,
q);if(h.eventTime==t)return;i.remove(h);h.eventTime=t}else{if(isNaN(t))return;h=e[H]={eventName:q,object:n,eventTime:t,callback:n[q]}}i.splice(i.binarySearchPos(t,f),0,h);a()},remove:d}}();P("basis").extend({namespace:P,platformFeature:{},EventObject:w,TimeEventManager:y,Cleaner:z,require:C});x.basis.locale={}})(this);
(function(x,F){function G(z){var y=1E6;z=String(z).split(".");for(var a=0,d=0;a<4&&a<z.length;a++,y/=100)d+=z[a]*y;return d}function R(){for(var z=0;z<arguments.length;z++){var y=arguments[z].toLowerCase();if(y in T){if(T[y])return true}else{var a=y.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(a){T[y]=false;var d=a[1].toLowerCase(),b=G(a[3]);a=a[4]||"=";if(d=P[d])return T[y]=!b||a=="="&&d==b||a=="+"&&d>=b||a=="-"&&d<b}}}return false}var J="basis.ua",T={},P={},N=F.navigator&&F.navigator.userAgent,K=
"unknown",M="unknown",B={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]};for(var A in B)if(!(A=="MSIE"&&F.opera))if(!(A=="Safari"&&N.match(/chrome/i)))if(!(A=="AppleWebKit"&&N.match(/iphone/i)))if(N.match(new RegExp(A+
".(\\d+(\\.\\d+)*)","i"))){var D=B[A],C=F.opera&&typeof F.opera.version=="function"?F.opera.version():RegExp.$1,v=G(C);K=D[0]+v;M=D[0]+" "+C;for(K=0;K<D.length;K++)P[D[K].toLowerCase()]=v}x.platformFeature.datauri=false;N=typeof Image!="undefined"?new Image:{};N.onload=function(){x.platformFeature.datauri=true};N.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";B={set:function(z,y,a,d){document.cookie=z+"="+(y==null?"":escape(y))+";path="+(d||(location.pathname.indexOf("/")==
0?"":"/")+location.pathname)+(a?";expires="+(new Date(Date.now()+a*1E3)).toGMTString():"")},get:function(z){return(z=document.cookie.match(new RegExp("(^|;)\\s*"+z+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(z[2])},remove:function(z,y){document.cookie=z+"=;expires="+(new Date(0)).toGMTString()+";path="+(y||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)}};if(R("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(w){}J=x.namespace(J);J.toString=function(){return M};return J.extend({testImage:N,
prettyName:M,test:R,is:function(z){return R(z)},Cookies:B})})(basis,this);
(function(x,F){function G(g,m,n){if(m!=null)return g.insertBefore(b(m)?m:P(m),n||null)}function R(g){return K("",g.cloneNode(true)).innerHTML}function J(g){return b(g)||g&&g.nodeType?g:typeof g=="string"?D.getElementById(g):null}function T(g,m,n){var q,t=[];n=typeof n=="string"?getter(n):n||Function.$true;m&26&&n(g)&&t.push(g);switch(m){case 1:case 2:for(q=g;(q=q[w])&&q!==g.document;)n(q)&&t.push(q);break;case 64:for(q=g[z];q;){n(q)&&t.push(q);q=q[y]}break;case 4:case 8:if(g[z]){m=new c(g);m.nodes(n,
t)}break;case 128:m=new c(g,n);for(m.cursor_=g[y]||g[w];q=m.next();)t.push(q);break;case 256:for(q=g;q=q[y];)n(q)&&t.push(q);break;case 32:n(g[w])&&t.push(g[w]);break;case 512:m=new c(g,n,c.BACKWARD);for(m.cursor_=g[a]||g[w];q=m.next();)t.push(q);break;case 1024:for(q=g;q=q[a];)n(q)&&t.push(q);break}return t}function P(g){return D.createTextNode(g!=null?g:"")}function N(){for(var g=D.createDocumentFragment(),m=arguments.length,n=N.array=[],q=0;q<m;q++)n.push(G(g,arguments[q]));return g}function K(g){var m=
g!=undefined&&typeof g!="string",n=(m?g.description:g)||"",q="div",t=n.match(/^([a-z0-9\_\-]+)(.*)$/i);if(t){q=t[1];n=t[2]}if(n!=""){for(var H=[],e={},h;t=l.exec(n);){if(t[8])throw new Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+n+"\n\nProblem place:\n> "+n.substr(0,t.index)+"--\>"+n.substr(t.index)+"<--");h=t[1]||t[2]||t[3];if(t[1])e.id=h;else if(t[2])H.push(h);else if(h!="class")e[h]=t[4]?A(t[5],t[6],t[7]):h}if(i&&e.name&&/^(input|textarea|select)$/i.test(q))q=
"<"+q+" name="+e.name+">"}n=D.createElement(q);if(e){if(e.style&&k)n.style.cssText=e.style;for(var j in e)n.setAttribute(j,e[j],0)}if(H&&H.length)n.className=H.join(" ");arguments.length>1&&G(n,N.apply(0,Array.from(arguments,1).flatten()));if(m){g.css&&x.cssom&&x.cssom.setStyle(n,g.css);if(x.dom.event)for(var o in g)if(typeof g[o]=="function")x.dom.event.addHandler(n,o,g[o],n);else g[o]instanceof x.dom.event.Handler&&x.dom.event.addHandler(n,o,g[o].handler,g[o].thisObject)}return n}function M(g,m){return g[w]?
g[w].replaceChild(m,g):g}function B(g){if(D.selection){var m=D.selection.createRange();m.compareEndPoints("StartToEnd",m)!=0&&m.collapse(g);return m.getBookmark().charCodeAt(2)-2}}var A=Object.coalesce,D=F.document,C=x.Class,v=D.createElement("div"),w="parentNode",z="firstChild",y="nextSibling",a="previousSibling",d;d=typeof v.compareDocumentPosition=="function"?function(g,m){return g.compareDocumentPosition(m)}:function(g,m){if(g==m)return 0;if(g.document!=m.document)return 33;return g.sourceIndex>
m.sourceIndex?2|8*m.contains(childA):4|16*g.contains(childB)};var b;if(typeof Node!="undefined"){b=function(g){return g instanceof Node};if(!Node.prototype.contains)Node.prototype.contains=function(g){return!!(this.compareDocumentPosition(g)&16)}}else b=function(g){return g&&g.ownerDocument===D};var c=C(null,{root_:null,cursor_:null,filter:Function.$true,init:function(g,m,n){this.setRoot(g);this.setDirection(n);if(typeof m=="function")this.filter=m},setDirection:function(g){Object.extend(this,g?{a:"lastChild",
b:a,c:y,d:z}:{a:z,b:y,c:a,d:"lastChild"})},setRoot:function(g){this.root_=g||D;this.reset()},reset:function(){this.cursor_=null},first:function(g){this.reset();return this.next(g)},last:function(g){this.reset();return this.prev(g)},nodes:function(g,m){var n;m||(m=[]);for(this.reset();n=this.next(g);)m.push(n);return m},next:function(g){g=g||this.filter;var m=this.cursor_||this.root_;do for(var n=m[this.a];!n;){if(m===this.root_)return this.cursor_=null;(n=m[this.b])||(m=m[w])}while(!g(m=n));return this.cursor_=
m},prev:function(g){g=g||this.filter;var m=this.cursor_,n=this.c,q=this.d;do{var t=m?m[n]:this.root_[q];if(t){for(;t[q];)t=t[q];m=t}else if(m)m=m[w];if(!m||m===this.root_){m=null;break}}while(!g(m));return this.cursor_=m},destroy:function(){this.cursor_=this.root_=null}});c.BACKWARD=true;var f="textContent innerText nodeValue".qw(),i=function(){var g=D.createElement("input");g.name="a";return!/name/.test(R(g))}(),k;v.setAttribute("style","color: red");k=v.style.color!=="red";var l=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return x.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:c,outerHTML:R,textContent:function(g){for(var m=0,n;n=f[m++];)if(g[n]!=null)return g[n];return T(g,4,function(q){return q.nodeType==3}).map(getter("nodeValue")).join("")},get:J,tag:function(g,m){g=J(g)||D;return m=="*"&&g.all?Array.from(g.all):Array.from(g.getElementsByTagName(m||"*"))},axis:T,findAncestor:function(g,m,n){for(;g&&g!==n;){if(m(g))return g;g=g.parentNode}},createElement:K,createText:P,createFragment:N,insert:function(g,
m,n,q){g=J(g);if(!g)throw new Error("basis.dom.insert: destination node can't be null");switch(n){case undefined:case "end":q=null;break;case "begin":q=g[z];break;case "before":break;case "after":q=q[y];break;default:q=Number(n).between(0,g.childNodes.length)?g.childNodes[n]:null}n=!b(g);if(!m||!Array.isArray(m))n=n?m&&g.insertBefore(m,q):G(g,m,q);else if(n){n=[];for(var t=0,H=m.length;t<H;t++)n[t]=g.insertBefore(m[t],q)}else{g.insertBefore(N.apply(0,m),q);n=N.array}return n},remove:function(g){return g[w]?
g[w].removeChild(g):g},replace:M,swap:function(g,m){if(g===m||d(g,m)&25)return false;M(g,v);M(m,g);M(v,m);return true},clone:function(g,m){var n=g.cloneNode(!m);n.attachEvent&&T(n,8).forEach(Event.clearHandlers);return n},clear:function(g){for(g=J(g);g.lastChild;)g.removeChild(g.lastChild);return g},wrap:function(g,m,n){var q=[];n=Function.getter(n||Function.$self);for(var t in m)for(var H=0;H<g.length;H++){var e=n(g[H]);q[H]=m[t](g[H],H,e)?K(t,e):g[H]}return q},setAttribute:function(g,m,n){n==null?
g.removeAttribute(m):g.setAttribute(m,n)},parentOf:function(g,m){return g.contains(m)},isInside:function(g,m){return g==m||m.contains(g)},focus:function(g,m){try{g=J(g);g.focus();m&&g.select&&g.select()}catch(n){}},setSelectionRange:function(g,m,n){if(arguments.length<3)n=m;if(g.setSelectionRange)g.setSelectionRange(m,n);else if(g.createTextRange){var q=g.createTextRange();q.collapse(true);q.moveStart("character",m);q.moveEnd("character",n-m);q.select()}},getSelectionStart:function(g){return typeof g.selectionStart!=
"undefined"?g.selectionStart:B(true)},getSelectionEnd:function(g){return typeof g.selectionEnd!="undefined"?g.selectionEnd:B(false)}})})(basis,this);
(function(x,F){function G(a){return a||F.event}function R(a){return typeof a=="string"?A.get(a):a}function J(a){a=G(a);if(a.stopPropagation)a.stopPropagation();else a.cancelBubble=true}function T(a){a=G(a);if(a.preventDefault)a.preventDefault();else a.returnValue=false}function P(a){var d=Array.from(w[a.type]);if(d)for(var b=d.length;b-- >0;){var c=d[b];c.handler.call(c.thisObject,a)}}function N(a,d,b,c){a=R(a);if(!a)throw new Error("Event.addHandler: can't attach event listener to undefined");if(typeof b!=
"function")throw new Error("Event.addHandler: handler must be a function");a[C]||(a[C]={});var f={handler:b,thisObject:c},i=a[C],k=i[d];if(k){for(a=0;d=k[a];a++)if(d.handler===b&&d.thisObject===c)return;k.push(f)}else{k=i[d]=[f];k.fireEvent=function(l){l=G(l);if(z&&l)if(typeof l.returnValue=="undefined"){P(l);if(l.cancelBubble===true)return;if(typeof l.returnValue=="undefined")l.returnValue=true}for(var g=0,m;m=k[g++];)m.handler.call(m.thisObject,l)};a.addEventListener?a.addEventListener(d,k.fireEvent,
false):a.attachEvent("on"+d,k.fireEvent)}}function K(a,d,b,c){a=R(a);var f=a[C];if(f)if(f=f[d])for(var i=0,k;k=f[i];i++)if(k.handler===b&&k.thisObject===c){f.splice(i,1);f.length||M(a,d);return}}function M(a,d){a=R(a);var b=a[C];if(b)if(typeof d!="string")for(d in b)M(a,d);else{var c=b[d];if(c){a.removeEventListener?a.removeEventListener(d,c.fireEvent,false):a.detachEvent("on"+d,c.fireEvent);delete b[d]}}}var B=F.document,A=x.dom,D=Function.$null,C="__basisEvents",v={mousewheel:["mousewheel","DOMMouseScroll"]},
w={},z=!B.addEventListener,y=function(){function a(){d++||setTimeout(function(){for(var f=0;f<b.length;f++)b[f].callback.call(b[f].thisObject)},10)}var d=false,b=[];if(x.ua.is("ie7-"))(function(){var f="_"+Date.now();B.write('<script id="'+f+'" defer src="//:"><\/script>');R(f).onreadystatechange=function(){if(this.readyState=="complete"){A.remove(this);a()}}})();else if(x.ua.is("safari525-"))var c=setInterval(function(){if(/loaded|complete/.test(B.readyState)){clearInterval(c);a()}},15);else N(B,
"DOMContentLoaded",a,false);N(B,"load",a,false);N(F,"load",a,false);return function(f,i){d||b.push({callback:f,thisObject:i})}}();return x.namespace("basis.dom.event",G).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return v[a]||[a]},Handler:function(a,
d){this.handler=a;this.thisObject=d},sender:function(a){a=G(a);return a.target||a.srcElement},cancelBubble:J,cancelDefault:T,kill:function(a,d){if(d=R(d))N(d,a,Event.kill);else{T(a);J(a)}},key:function(a){a=G(a);return a.keyCode||a.which||0},charCode:function(a){a=G(a);return a.charCode||a.keyCode||0},mouseButton:function(a,d){a=G(a);return typeof a.which=="number"?a.which==d.VALUE:a.button&d.BIT},mouseX:function(a){a=G(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+
(B.documentElement.scrollLeft||B.body.scrollLeft)},mouseY:function(a){a=G(a);return a.changedTouches?a.changedTouches[0].pageY:"pageY"in a?a.pageY:a.clientY+(B.documentElement.scrollTop||B.body.scrollTop)},wheelDelta:function(a){a=G(a);return"wheelDelta"in a?a.wheelDelta/120:a.type=="DOMMouseScroll"?-a.detail/3:0},addGlobalHandler:function(a,d,b){var c=w[a];if(c)for(a=c.length;a-- >0;){var f=c[a];if(f.handler===d&&f.thisObject===b)return}else{B.addEventListener?B.addEventListener(a,P,true):N(B,a,
D);c=w[a]=[]}c.push({handler:d,thisObject:b})},removeGlobalHandler:function(a,d,b){var c=w[a];if(c)for(var f=0,i;i=c[f];f++)if(i.handler===d&&i.thisObject===b){c.splice(f,1);if(!c.length){delete w[a];B.removeEventListener?B.removeEventListener(a,P,true):K(B,a,D)}return}},addHandler:N,addHandlers:function(a,d,b){a=R(a);for(var c in d)N(a,c,d[c],b)},removeHandler:K,clearHandlers:M,fireEvent:function(a,d){a=R(a);var b=a[C];b&&b[d]&&b[d].fireEvent()},onLoad:y,onUnload:function(a,d){N(F,"unload",a,d)}})})(basis,
this);
(function(){function x(a,d,b){for(var c=1,f;d;){if(d&1){f=D[c];if(b&c){a.addHandler(f.handler,f.context);f.action(f.context.add,a)}else{a.removeHandler(f.handler,f.context);f.action(f.context.remove,a)}}d>>=1;c<<=1}}function F(a){return Array.isArray(a)?a.map(F):{data:a}}var G=basis.Class,R=basis.EventObject,J=Object.values,T=Function.$self,P=R.createEvent,N=R.event,K={},M=[],B={},A={PRIORITY:[],values_:{},add:function(a,d){var b=a.toUpperCase(),c=a.toLowerCase();this[b]=c;B[c]=true;if(d){d=this.indexOf(d);
d==-1?this.PRIORITY.push(c):this.PRIORITY.splice(d,0,c)}}};A.add("READY");A.add("DEPRECATED");A.add("UNDEFINED");A.add("ERROR");A.add("PROCESSING");var D={},C=1,v={NONE:0,MASK:0,add:function(a,d,b){D[C]={handler:d,action:b,context:{add:function(c,f){if(f){var i=v[a]+"_"+c.eventObjectId;if(!f.subscribers_)f.subscribers_={};if(!f.subscribers_[i]){var k=f.subscriberCount;f.subscribers_[i]=c;f.subscriberCount+=1;f.event_subscribersChanged(f,k)}}},remove:function(c,f){if(f){var i=v[a]+"_"+c.eventObjectId;
if(f.subscribers_[i]){var k=f.subscriberCount;delete f.subscribers_[i];f.subscriberCount-=1;f.event_subscribersChanged(f,k)}}}}};v[a]=C;v.MASK|=C;C<<=1}};v.add("DELEGATE",{delegateChanged:function(a,d){this.remove(a,d);this.add(a,a.delegate)}},function(a,d){a(d,d.delegate)});v.add("TARGET",{targetChanged:function(a,d){this.remove(a,d);this.add(a,a.target)}},function(a,d){a(d,d.target)});var w=G(R,{state:A.READY,data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,
target:null,active:false,subscribeTo:v.DELEGATE+v.TARGET,subscriberCount:0,subscribers_:null,event_update:P("update","object","delta"),event_stateChanged:P("stateChanged","object","oldState"),event_delegateChanged:P("delegateChanged","object","oldDelegate"),event_rootChanged:P("rootChanged","object","oldRoot"),event_targetChanged:P("targetChanged","object","oldTarget")&&function(a,d){var b=this.listen.target;if(b){d&&d.removeHandler(b,this);this.target&&this.target.addHandler(b,this)}N.targetChanged.call(this,
a,d)},event_subscribersChanged:P("subscribersChanged","object"),event_activeChanged:P("activeChanged","object"),listen:{delegate:{update:function(a,d){this.data=a.data;this.event_update(this,d)},stateChanged:function(a,d){this.state=a.state;this.event_stateChanged(this,d)},targetChanged:function(a,d){this.target=a.target;this.event_targetChanged(this,d)},rootChanged:function(a,d){this.data=a.data;this.event_rootChanged(this,d)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},
init:function(a){R.prototype.init.call(this,a);if(a=this.delegate){this.delegate=null;this.data=a.data;this.state=a.state;this.setDelegate(a)}else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&x(this,this.subscribeTo,v.MASK)},isConnected:function(a){if(a instanceof w){for(;a&&a!==this&&a!==a.delegate;)a=a.delegate;return a===this}return false},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&
a&&a instanceof w){if(a.delegate&&this.isConnected(a))return false}else a=null;if(this.delegate!==a){var d=this.state,b=this.data,c=this.delegate,f=this.target,i=this.root,k={},l=this.listen.delegate;c&&l&&c.removeHandler(l,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;l&&a.addHandler(l,this);for(var g in a.data)if(g in b===false)k[g]=undefined;for(g in b)if(b[g]!==a.data[g])k[g]=b[g]}else{this.target=this.delegate=null;this.root=this;this.data=
{};for(g in b)this.data[g]=b[g]}this.event_delegateChanged(this,c);this.root!==i&&this.event_rootChanged(this,i);this.target!==f&&this.event_targetChanged(this,f);if(a){for(g in k){this.event_update(this,k);break}if(d!==this.state&&(String(d)!=this.state||d.data!==this.state.data))this.event_stateChanged(this,d)}return true}return false},setState:function(a,d){var b=this.target||this.getRootDelegate();if(b!==this)return b.setState(a,d);b=String(a);if(!B[b])throw new Error("Wrong state value");if(this.state!=
b||this.state.data!=d){var c=this.state;this.state=Object(b);this.state.data=d;this.event_stateChanged(this,c);return true}return false},deprecate:function(){this.state!=A.PROCESSING&&this.setState(A.DEPRECATED)},update:function(a){var d=this.target||this.getRootDelegate();if(d!==this)return d.update(a);if(a){d={};var b=0;for(var c in a)if(this.data[c]!==a[c]){b++;d[c]=this.data[c];this.data[c]=a[c]}if(b){this.event_update(this,d);return d}}return false},setActive:function(a){a=!!a;if(this.active!=
a){this.active=a;this.event_activeChanged(this);x(this,this.subscribeTo,v.MASK*a);return true}return false},setSubscription:function(a){a=a&v.MASK;var d=this.subscribeTo^a;if(d){this.subscribeTo=a;this.active&&x(this,d,a);return true}return false},destroy:function(){this.active&&x(this,this.subscribeTo,0);this.delegate&&this.setDelegate();R.prototype.destroy.call(this);this.data=K;this.state=A.UNDEFINED;this.target=this.root=null}});T=G(null,{itemClass:w,keyGetter:T,map_:null,extendConstructor_:true,
init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var d={};if(a instanceof w)d.delegate=a;else d.data={id:a,title:a};return new this.itemClass(d)},get:function(a,d){var b=a instanceof w?a.eventObjectId:a,c=this.map_[b];if(!c&&d){c=this.map_[b]=this.create(a,d);c.addHandler({destroy:function(){delete this.map_[b]}},this)}return c},destroy:function(){basis.Cleaner.remove(this);for(var a=J(this.map_),d=0,b;b=a[d++];)b.destroy()}});
var z=G(w,{state:A.UNDEFINED,itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:P("datasetChanged","dataset","delta")&&function(a,d){var b,c=0,f=0,i;if(b=d.inserted)for(;i=b[c];){this.item_[i.eventObjectId]=i;c++}if(b=d.deleted)for(;i=b[f];){delete this.item_[i.eventObjectId];f++}this.itemCount+=c-f;this.cache_=null;N.datasetChanged.call(this,a,d)},init:function(a){w.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!!(a&&this.item_[a.eventObjectId])},
getItems:function(){if(!this.cache_)this.cache_=J(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var d=[];if(a)for(var b in this.item_)if(d.push(this.item_[b])>=a)break;return d},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();w.prototype.destroy.call(this);this.cache_=M;this.itemCount=0;this.item_=this.memberMap_=null}}),y=G(z,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&
this.remove([a])}}},init:function(a){z.prototype.init.call(this,a);if(a=this.items){this.set(a);this.items=null}},add:function(a){for(var d,b=this.memberMap_,c=[],f=this.listen.item,i=0;i<a.length;i++){var k=a[i];if(k instanceof w){var l=k.eventObjectId;if(!b[l]){b[l]=k;f&&k.addHandler(f,this);c.push(k)}}}if(c.length)this.event_datasetChanged(this,d={inserted:c});return d},remove:function(a){for(var d,b=this.memberMap_,c=[],f=this.listen.item,i=0;i<a.length;i++){var k=a[i];if(k instanceof w){var l=
k.eventObjectId;if(b[l]){f&&k.removeHandler(f,this);delete b[l];c.push(k)}}}if(c.length)this.event_datasetChanged(this,d={deleted:c});return d},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var d=this.memberMap_,b={},c=[],f=[],i,k,l=this.listen.item,g=0;g<a.length;g++){i=a[g];if(i instanceof w){k=i.eventObjectId;b[k]=i;if(!d[k]){d[k]=i;l&&i.addHandler(l,this);f.push(i)}}}for(k in d)if(!b[k]){i=d[k];l&&i.removeHandler(l,this);delete d[k];c.push(i)}var m;
a={};var n;if(f&&f.length)n=a.inserted=f;if(c&&c.length)n=a.deleted=c;if(n)m=a;if(c=m)this.event_datasetChanged(this,c);return c},sync:function(a,d){if(a){y.setAccumulateState(true);for(var b=this.memberMap_,c,f,i={},k=[],l,g=0;g<a.length;g++){c=a[g];if(c instanceof w){f=c.eventObjectId;i[f]=c;b[f]||k.push(c)}}for(f in this.item_)i[f]||this.item_[f].destroy();if(d&&k.length)l=this.add(k);y.setAccumulateState(false);return l}},clear:function(){var a,d=this.getItems(),b=this.listen.item;if(d.length){if(b)for(a=
d.length;a-- >0;)d[a].removeHandler(b,this);this.event_datasetChanged(this,a={deleted:d});this.memberMap_={}}return a}});y.setAccumulateState=function(){function a(g){var m=g.dataset;f.call(m,m,g)}function d(g,m){var n=g.eventObjectId,q=m.inserted,t=m.deleted,H=l[n];if(q&&t){if(H){delete l[n];a(H)}return f.call(g,g,m)}if(H){var e=H[q?"inserted":"deleted"];if(e)return e.push.apply(e,q||t);else a(H)}l[n]=m;m.dataset=g}function b(){i=1;setAccumulateState(false)}var c=z.prototype,f=c.event_datasetChanged,
i=0,k,l={};return function(g){if(g){if(i==0){c.event_datasetChanged=d;k=setTimeout(b,0)}i++}else{i-=i>0;if(i==0){clearTimeout(k);c.event_datasetChanged=f;g=l;l={};J(g).forEach(a)}}}}();basis.namespace("basis.data",F).extend({STATE:A,SUBSCRIPTION:v,Object:w,DataObject:w,KeyObjectMap:T,AbstractDataset:z,Dataset:y})})(basis,this);
(function(x,F){function G(d,b,c,f){b=b.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i);for(var i=w(),k,l=0;l<b.length;l++){if(l%2){k=b[l].split(/\|/);d.getters[k[0]]=c+"childNodes["+f+"]";k=k.length>1?k[1]:k[0]}else k=b[l].length?b[l]:null;if(k!=null){if(v){i.lastChild&&i.appendChild(N.createComment(""));f++}i.appendChild(z(k));f++}}return i}function R(d){return function(b){if(!(b&&b.type=="click"&&b.which==3)){var c=x.dom.event.sender(b),f,i;do if(f=c.getAttributeNode&&c.getAttributeNode(d))break;while(c=
c.parentNode);if(c&&f){do if(i=c.basisObjectId)if((i=A[i])&&i.templateAction){c=f.nodeValue.qw();f=0;for(var k;k=c[f++];)i.templateAction(k,x.dom.event(b));break}while(c=c.parentNode)}}}}function J(d,b,c){b=b.trim();if(!b)return"";for(var f="",i;i=C.exec(b);){var k=i[2],l=i[4]||i[5]||k;if(i[3])d.getters[i[3]]=c+'.getAttributeNode("'+k+'")';if(i=k.match(/^event-([a-z]+)/i)){var g=i[1];if(!B[g]){B[g]=true;i=0;g=x.dom.event.browserEvents(g);for(var m;m=g[i++];)x.dom.event.addGlobalHandler(m,R(k))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(n,q){n=x.dom.event(n);var t=this,H;do if(H=t.basisObjectId)if((H=A[H])&&H.templateAction){t=q.qw();for(var e=0,h;h=t[e++];)H.templateAction(h,x.dom.event(n));break}while(t=t.parentNode)}}f+=k=="class"?l.trim().replace(/^(.)|\s+/g,".$1"):"["+k+(l?"="+l.quote('"'):"")+"]"}return f}function T(d,b){if(!d.stack)d.stack=[];if(!d.source)d.source=d.str;b||(b=".");for(var c=w(),f,i=0,k,l=d.stack;k=D.exec(d.str);){f=RegExp.leftContext;d.str=d.str.substr(f.length+k[0].length);if(f.length){c.appendChild(G(d,
f,b,i));i=c.childNodes.length}if(k[5])if(k[5]==l[l.length-1]){l.pop();return c}else throw"Wrong end tag";if(k[6]){if(k[7])d.getters[k[7]]=b+"childNodes["+i+"]";c.appendChild(N.createComment(k[6]))}else{f=k[1];var g=k[2],m=!!k[4],n=b+"childNodes["+i+"]";k=K.createElement(f+J(d,k[3],n));if(g)d.getters[g]=n;if(!m){l.push(f);k.appendChild(T(d,n+"."))}c.appendChild(k)}i++}d.str.length&&c.appendChild(G(d,d.str,b,i));if(l.length)throw"No end tag for "+l.reverse();return c}function P(d){if(!this.proto){d=
this.source;if(typeof d=="function")this.source=d=d();d=d.trim();d={str:d,getters:{element:".childNodes[0]"}};var b=T(d);d=Object.iterate(d.getters,function(l,g){for(var m=l.split(/\|/).map(String.format,"obj_.{0}"),n=g.split(/(\.?childNodes\[(\d+)\])/),q=b,t=0;t<n.length;t+=3){var H=n[t+2];if(!H)break;n[t+2]="";q=q.childNodes[H];if(q.previousSibling)q.nextSibling||(n[t+1]=".lastChild");else n[t+1]=".firstChild"}return{name:m[0],alias:m.join("="),path:"dom_"+n.join("")}}).sortAsObject("path");for(var c=
0;c<d.length;c++)for(var f=new RegExp("^"+d[c].path.forRegExp()),i=c+1,k;k=d[i++];)k.path=k.path.replace(f,d[c].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(l,g){obj_=l||{};dom_=proto_.cloneNode(true);_code_();if(g&&obj_.element){var m=obj_.element.basisObjectId=map_.seed++;map_[m]=g}return obj_}.toString().replace("_code_()",d.map(String.format,"{alias}={path};\n").join(""))))(b,A);this.clearInstance=(new Function("map_","var obj_; return "+function(l){obj_=
l;(l=obj_.element&&obj_.element.basisObjectId)&&delete map_[l];_code_()}.toString().replace("_code_()",d.map(String.format,"{alias}=null;\n").join(""))))(A)}}var N=F.document,K=x.dom,M=x.Class,B={},A={seed:1},D=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,C=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;K.createFragment();var v=K.createElement("","a","b").cloneNode(true).childNodes.length==
1,w=K.createFragment,z=K.createText,y=M(null,{__extend__:function(d){return d instanceof y?d:new y(d)},init:function(d){this.source=d},createInstance:function(d,b){P.call(this);return this.createInstance(d,b)},clearInstance:function(){P.call(this)}}),a=N.createElement("DIV");return x.namespace("basis.html").extend({Template:y,escape:function(d){return K.createElement("DIV",K.createText(d)).innerHTML},unescape:function(d){a.innerHTML=d;return a.firstChild.nodeValue},string2Html:function(d){a.innerHTML=
d;return K.createFragment.apply(null,Array.from(a.childNodes))}})})(basis,this);
(function(x){function F(e){return e.sortingValue||0}function G(e,h){e=e.sortingValue||0;h=h.sortingValue||0;return+(e>h)||-(e<h)}function R(e,h){e=e.sortingValue||0;h=h.sortingValue||0;return-(e>h)||+(e<h)}function J(e){return e.childNodes.sort(e.localSortingDesc?R:G)}function T(e,h){var j=h.length-1;e.childNodes=h;e.firstChild=h[0]||null;e.lastChild=h[j]||null;for(var o=j;j=h[o];o--){j.nextSibling=h[o+1]||null;j.previousSibling=h[o-1]||null;e.insertBefore(j,j.nextSibling)}}function P(e,h){var j=
e.childFactory||e.document&&e.document.childFactory,o;h=Object.extend({document:e.document,contextSelection:e.selection||e.contextSelection},h);if(j){o=j.call(e,h);if(o instanceof e.childClass)return o}if(!o)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(e.childClass&&e.childClass.className)+" but "+(o&&o.constructor&&o.constructor.className)+")";}function N(){return x.ui.apply(this,arguments)}var K=x.Class,M=x.dom,B=x.data,A=B.SUBSCRIPTION,
D=B.DataObject,C=B.AbstractDataset,v=B.Dataset,w=M.AXIS_DESCENDANT,z=M.AXIS_DESCENDANT_OR_SELF,y=Function.getter,a=Object.complete,d=M.axis;B=x.EventObject.createEvent;var b=x.EventObject.event,c={NONE:"none",PARENT:"parent",OWNER:"owner"};A.add("DATASOURCE",{dataSourceChanged:function(e,h){this.remove(e,h);this.add(e,e.dataSource)}},function(e,h){e(h,h.dataSource)});var f=K.ExtensibleProperty(),i={ownerChanged:function(){},destroy:function(e){M.replace(e.element,this)}},k=function(){var e=this.key,
h=this.config,j=this.owner,o=typeof h.existsIf!="function"||h.existsIf(j),r=j.satellite[e];if(o){o="delegate"in h;var I="dataSource"in h,L=typeof h.delegate=="function"?h.delegate(j):null,p=typeof h.dataSource=="function"?h.dataSource(j):null;if(r){o&&r.setDelegate(L);I&&r.setDataSource(p)}else{var s=j.tmpl[h.replace||e];r={owner:j};if(o)r.delegate=L;if(I)r.dataSource=p;if(h.config)Object.complete(r,typeof h.config=="function"?h.config(j):h.config);r=new h.instanceOf(r);j.satellite[e]=r;if(s&&r instanceof
x.ui.Node&&r.element){M.replace(s,r.element);r.addHandler(i,s)}}}else if(r){r.destroy();r.owner=null;delete j.satellite[e]}},l=K.CustomExtendProperty({update:true},function(e,h){for(var j in h)e[j]=h[j]?k:null}),g=K(D,{event_update:function(e,h){D.prototype.event_update.call(this,e,h);var j=this.parentNode;if(j){j.matchFunction&&this.match(j.matchFunction);j.insertBefore(this,this.nextSibling)}},event_childNodesModified:B("childNodesModified","node","delta"),event_dataSourceChanged:B("dataSourceChanged",
"node","oldDataSource"),event_localGroupingChanged:B("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:B("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:B("ownerChanged","node","oldOwner"),event_satellitesChanged:B("satellitesChanged","node","delta"),subscribeTo:D.prototype.subscribeTo+A.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegate:c.NONE,nodeType:"DOMWrapperNode",canHaveChildren:false,childNodes:null,
dataSource:null,colMap_:null,destroyDataSourceMember:true,document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:false,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:f,satellite:null,owner:null,init:function(e){var h=this.dataSource,j=this.childNodes,o=this.localGrouping;if(h)this.dataSource=null;D.prototype.init.call(this,e);if(o){this.localGrouping=null;this.setLocalGrouping(o)}if(this.canHaveChildren){this.childNodes=
[];if(h){this.dataSource=null;this.setDataSource(h)}else j&&this.setChildNodes(j)}else{if(j)this.childNodes=null;if(h)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==f)for(var r in this.satelliteConfig){e=this.satelliteConfig[r];if(K.isClass(e))e={instanceOf:e};if(typeof e=="object"){h={key:r,owner:this,config:e};e=e.hook?l.__extend__(e.hook):l;for(r in e)if(e[r]===k){this.addHandler(e,h);break}k.call(h)}}if(r=this.owner){this.owner=null;this.setOwner(r)}},appendChild:function(){},
insertBefore:function(){},removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(e){if(!e||e instanceof g==false)e=null;if(this.owner!==e){var h=this.owner,j=this.listen.owner;this.owner=e;if(j){h&&h.removeHandler(j,this);e&&e.addHandler(j,this)}this.event_ownerChanged(this,h);this.autoDelegate==
c.OWNER&&this.setDelagate(e)}},destroy:function(){D.prototype.destroy.call(this);if(this.dataSource)this.setDataSource();else this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping){this.localGrouping.destroy();this.localGrouping=null}this.owner&&this.setOwner();if(this.satellite){for(var e in this.satellite){var h=this.satellite[e];h.destroy();h.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=
this.childNodes=this.document=null}}),m=K(g,{autoDestroyIfEmpty:false,nodes:null,first:null,last:null,init:function(e){this.nodes=[];g.prototype.init.call(this,e)},insert:function(e,h){var j=this.nodes,o=h?j.indexOf(h):-1;if(o==-1){j.push(e);this.last=e}else j.splice(o,0,e);this.first=j[0];e.groupNode=this;this.event_childNodesModified(this,{inserted:[e]})},remove:function(e){var h=this.nodes;if(h.remove(e)){this.first=h[0]||null;this.last=h[h.length-1]||null;e.groupNode=null;this.event_childNodesModified(this,
{deleted:[e]})}!this.first&&this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var e=this.nodes,h=e.length;h-- >0;)e[h].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:e});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){g.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),n={canHaveChildren:true,childClass:g,childFactory:null,listen:{dataSource:{datasetChanged:function(e,h){var j={},o=[];if(h.deleted){j.deleted=
o;if(this.childNodes.length==h.deleted.length){o.push.apply(o,this.childNodes);var r=this.dataSource;this.dataSource=null;this.clear(true);this.dataSource=r;this.colMap_={}}else{r=0;for(var I;I=h.deleted[r];r++){I=I.eventObjectId;var L=this.colMap_[I];delete this.colMap_[I];L.canHaveDelegate=true;this.removeChild(L);o.push(L)}}}if(h.inserted){j.inserted=[];for(r=0;I=h.inserted[r];r++){L=P(this,{cascadeDestroy:false,delegate:I});L.canHaveDelegate=false;this.colMap_[I.eventObjectId]=L;j.inserted.push(L);
this.firstChild&&this.insertBefore(L)}}this.firstChild?this.event_childNodesModified(this,j):this.setChildNodes(j.inserted);if(this.destroyDataSourceMember&&o.length)for(r=0;I=o[r];r++)I.destroy()},destroy:function(e){this.dataSource===e&&this.setDataSource()}}},appendChild:function(e){return this.insertBefore(e)},insertBefore:function(e,h){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(e.firstChild){var j=this;do if(j==e)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";
while(j=j.parentNode)}if(this.dataSource&&!this.dataSource.has(e.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(e instanceof this.childClass==false)e=P(this,e instanceof D?{delegate:e}:e);var o=e.parentNode===this,r=e.groupNode,I=this.localGrouping,L=this.localSorting,p,s=this.childNodes,u,Q,U=null;j=-1;var aa=false,O;if(o){O=e.nextSibling;Q=e.previousSibling}if(L){h=null;p=this.localSortingDesc;u=L(e)||0;if(o)if(u===e.sortingValue)aa=true;
else if((!O||(p?O.sortingValue<=u:O.sortingValue>=u))&&(!Q||(p?Q.sortingValue>=u:Q.sortingValue<=u))){e.sortingValue=u;aa=true}}if(I){U=I.getGroupNode(e);Q=U.nodes;if(r===U)if(aa||o&&O===h)return e;if(L)if(aa)j=O&&O.groupNode===U?Q.indexOf(O):Q.length;else{j=Q.binarySearchPos(u,F,p);e.sortingValue=u}else j=h&&h.groupNode===U?Q.indexOf(h):Q.length;if(j<Q.length)h=Q[j];else if(U.last)h=U.last.nextSibling;else{j=U;for(h=null;j=j.nextSibling;)if(h=j.first)break}if(e===h||o&&e.nextSibling===h){if(r!==
U){r&&r.remove(e);U.insert(e)}return e}j=-1}else if(L){if(aa)return e;j=s.binarySearchPos(u,F,p);h=s[j];e.sortingValue=u;if(e===h||o&&O===h)return e}else{if(h&&h.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(o){if(O===h)return e;if(e===h)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}if(o){if(e.nextSibling)e.nextSibling.previousSibling=e.previousSibling;else this.lastChild=e.previousSibling;if(e.previousSibling)e.previousSibling.nextSibling=
e.nextSibling;else this.firstChild=e.nextSibling;e.previousSibling=null;e.nextSibling=null;if(j==-1)s.remove(e);else{p=s.indexOf(e);s.splice(p,1);p<j&&j--}if(r){r.remove(e);r=null}}else e.parentNode&&e.parentNode.removeChild(e);r!=U&&U.insert(e,h);if(h){if(j==-1)j=s.indexOf(h);if(j==-1)throw"basis.dom.wrapper: Node was not found";e.nextSibling=h;s.splice(j,0,e)}else{j=s.length;s.push(e);h={previousSibling:this.lastChild};this.lastChild=e}e.parentNode=this;e.previousSibling=h.previousSibling;if(j==
0)this.firstChild=e;else h.previousSibling.nextSibling=e;h.previousSibling=e;var W=false,$=false,Y=this.selection||this.contextSelection;if(!e.document&&e.document!==this.document){W=this.document;e.document=this.document}if(!e.contextSelection&&e.contextSelection!==Y){e.contextSelection=Y;$=!e.selection;e.selected&&Y.add([e])}if(e.firstChild&&(W||$))d(e,w).forEach(function(E){if(W&&!E.document)E.document=W;if($&&!E.contextSelection){E.selected&&E.unselect();E.contextSelection=Y}});if(!o){e.match&&
e.match(this.matchFunction);e.autoDelegate==c.PARENT&&e.setDelegate(this);this.dataSource||this.event_childNodesModified(this,{inserted:[e]})}return e},removeChild:function(e){if(e==null||e.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(e instanceof this.childClass==false)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(e))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(e),
1);e.parentNode=null;if(e.nextSibling)e.nextSibling.previousSibling=e.previousSibling;else this.lastChild=e.previousSibling;if(e.previousSibling)e.previousSibling.nextSibling=e.nextSibling;else this.firstChild=e.nextSibling;e.nextSibling=null;e.previousSibling=null;e.document===this.document&&d(e,z).forEach(function(r){if(r.document==this.document)r.document=null},this);if(e.contextSelection){for(var h=e.contextSelection,j=e,o=[];j;){if(j.contextSelection===h){j.selected&&o.push(j);j.contextSelection=
null}if(!j.selection&&j.firstChild)j=j.firstChild;else if(j.nextSibling)j=j.nextSibling;else for(;j=j.parentNode;)if(j.nextSibling){j=j.nextSibling;break}}h.remove(o)}e.groupNode&&e.groupNode.remove(e);this.dataSource||this.event_childNodesModified(this,{deleted:[e]});e.autoDelegate==c.PARENT&&e.setDelegate();return e},replaceChild:function(e,h){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(h==null||h.parentNode!==this)throw"basis.dom.wrapper: Node was not found";
this.insertBefore(e,h);return this.removeChild(h)},clear:function(e){if(this.dataSource)this.setDataSource();else if(this.firstChild){var h=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:h});for(var j=h.length;j-- >0;){var o=h[j];o.parentNode=null;o.groupNode=null;if(e){if(o.selection||o.document)d(o,M.AXIS_DESCENDANT_OR_SELF).forEach(function(r){if(this.selection&&r.selection===this.selection){r.selected&&r.selection.remove([r]);
r.selection=null}if(r.document===this.document)r.document=null},this);o.nextSibling=null;o.previousSibling=null;o.autoDelegate==c.PARENT&&o.setDelegate()}else o.destroy()}if(this.localGrouping){e=this.localGrouping.childNodes;for(j=e.length-1;h=e[j];j--)h.clear()}}},setChildNodes:function(e,h){this.dataSource||this.clear(!!h);if(e){if("length"in e==false)e=[e];if(e.length){var j=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var o=0,r=e.length;o<r;o++)this.insertBefore(e[o]);
this.event_childNodesModified=j;this.event_childNodesModified(this,{inserted:this.childNodes})}}},setDataSource:function(e){if(!e||!this.canHaveChildren||e instanceof C==false)e=null;if(this.dataSource!==e){var h=this.dataSource,j=this.listen.dataSource;this.dataSource=e;if(h){this.colMap_=null;j&&h.removeHandler(j,this);h.itemCount&&this.clear()}if(e){this.colMap_={};if(j){e.addHandler(j,this);e.itemCount&&j.datasetChanged&&j.datasetChanged.call(this,e,{inserted:e.getItems()})}}this.event_dataSourceChanged(this,
h)}},setLocalGrouping:function(e){if(typeof e=="function"||typeof e=="string")e={groupGetter:y(e)};if(e instanceof t==false)e=e!=null&&typeof e=="object"?new this.localGroupingClass(Object.complete({},e)):null;if(this.localGrouping!==e){var h=this.localGrouping,j;if(this.localGrouping){if(!e){this.localGrouping=null;if(this.firstChild){j=this.localSorting?J(this):this.childNodes;for(var o=j.length;o-- >0;)j[o].groupNode=null;T(this,j)}}h.setOwner()}if(e){this.localGrouping=e;e.setOwner(this);if(this.firstChild){j=
this.localSorting?J(this):this.childNodes;for(o=0;e=j[o];o++)e.groupNode=this.localGrouping.getGroupNode(e);j=j;for(o=0;e=j[o];o++)e.groupNode.nodes.push(e);j.length=0;for(o=this.localGrouping.nullGroup;o;o=o.nextSibling){e=o.nodes;o.first=e[0]||null;o.last=e[e.length-1]||null;j.push.apply(j,e);o.event_childNodesModified(o,{inserted:e})}T(this,j)}}this.event_localGroupingChanged(this,h)}},setLocalSorting:function(e,h){if(e)e=y(e);if(this.localSorting!=e||this.localSortingDesc!=!!h){var j=this.localSorting,
o=this.localSortingDesc;this.localSortingDesc=!!h;this.localSorting=e||null;if(e&&this.firstChild){var r=[],I;for(I=this.firstChild;I;I=I.nextSibling)I.sortingValue=e(I)||0;if(this.localGrouping)for(var L=this.localGrouping.nullGroup;L;L=L.nextSibling){I=L.nodes=J({childNodes:L.nodes,localSortingDesc:this.localSortingDesc});L.first=I[0]||null;L.last=I[I.length-1]||null;r.push.apply(r,I)}else r=J(this);T(this,r)}this.event_localSortingChanged(this,j,o)}},setMatchFunction:function(e){if(this.matchFunction!=
e){var h=this.matchFunction;this.matchFunction=e;for(var j=this.lastChild;j;j=j.previousSibling)j.match(e);this.event_matchFunctionChanged(this,h)}}};A=K(g,{event_enable:B("enable","node"),event_disable:B("disable","node"),event_select:B("select","node"),event_unselect:B("unselect","node"),event_match:B("match","node"),event_unmatch:B("unmatch","node"),event_matchFunctionChanged:B("matchFunctionChanged","node","oldMatchFunction"),selectable:true,selected:false,selection:null,contextSelection:null,
matchFunction:null,matched:true,disabled:false,init:function(e){if(this.selection&&this.selection instanceof C==false)this.selection=new H(this.selection);g.prototype.init.call(this,e);this.disabled&&this.event_disable(this);if(this.selected){this.selected=false;this.select(true)}},setSelection:function(e){if(this.selection==e)return false;var h=this.selection;d(this,w,function(j){if(j.contextSelection==h){j.selected&&h&&h.remove([j]);j.contextSelection=e}});this.selection=e;return true},hasOwnSelection:function(){return!!this.selection},
select:function(e){var h=this.selected,j=this.contextSelection;if(j)if(e)h?j.remove([this]):j.add([this]);else this.selectable&&j.set([this]);else if(!h&&this.selectable&&!this.isDisabled()){this.selected=true;this.event_select(this)}return this.selected!=h},unselect:function(){var e=this.selected;if(e){var h=this.contextSelection;if(h)h.remove([this]);else{this.selected=false;this.event_unselect(this)}}return this.selected!=e},enable:function(){if(this.disabled){this.disabled=false;this.event_enable(this)}},
disable:function(){if(!this.disabled){this.disabled=true;this.event_disable(this)}},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!M.findAncestor(this,y("disabled"))},match:function(e){if(typeof e!="function")e=null;this.underMatch_&&!e&&this.underMatch_(this,true);this.underMatch_=e;e=!e||e(this);if(this.matched!=e)(this.matched=e)?this.event_match(this):this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){if(this.hasOwnSelection()){this.selection.destroy();
delete this.selection}this.unselect();g.prototype.destroy.call(this)}});var q=K(A,n,{}),t=K(g,n,{event_childNodesModified:function(e,h){b.childNodesModified.call(this,e,h);this.nullGroup.nextSibling=this.firstChild;if(h.inserted&&this.dataSource&&this.nullGroup.first)for(var j=this.owner,o=Array.from(this.nullGroup.nodes),r=o.length;r-- >0;)j.insertBefore(o[r],o[r].nextSibling)},event_ownerChanged:function(e,h){h&&h.localGrouping===this&&h.setLocalGrouping(null,true);this.owner&&this.owner.localGrouping!==
this&&this.owner.setLocalGrouping(this);b.ownerChanged.call(this,e,h);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:true,autoDestroyEmptyGroups:true,titleGetter:y("data.title"),groupGetter:Function.$undef,childClass:m,childFactory:function(e){return new this.childClass(a(e,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups}))},init:function(e){this.map_={};this.nullGroup=new m({autoDestroyIfEmpty:false});
g.prototype.init.call(this,e)},getGroupNode:function(e){e=this.groupGetter(e);var h=e instanceof D,j=this.map_[h?e.eventObjectId:e];if(!j&&!this.dataSource)j=this.appendChild(h?{delegate:e}:{data:{id:e,title:e}});return j||this.nullGroup},insertBefore:function(e,h){e=n.insertBefore.call(this,e,h);if("groupId_"in e==false){e.groupId_=e.delegate?e.delegate.eventObjectId:e.data.id;this.map_[e.groupId_]=e}if(e.first){var j=this.owner,o=j.childNodes,r=e.first,I=e.last,L,p,s;for(L=e;L=L.previousSibling;)if(s=
L.last)break;if(!s)s=this.nullGroup.last;for(L=e;L=L.nextSibling;)if(p=L.first)break;if(r.previousSibling!==s||I.nextSibling!==p){if(r.previousSibling)r.previousSibling.nextSibling=I.nextSibling;if(I.nextSibling)I.nextSibling.previousSibling=r.previousSibling;L=o.splice(o.indexOf(r),e.nodes.length);var u=o.indexOf(p);L.unshift(u!=-1?u:o.length,0);o.splice.apply(o,L);r.previousSibling=s;I.nextSibling=p;if(s)s.nextSibling=r;if(p)p.previousSibling=I;j.firstChild=o[0];j.lastChild=o[o.length-1]}}return e},
removeChild:function(e){n.removeChild.call(this,e);delete this.map_[e.groupId_];return e},clear:function(){n.clear.call(this);this.map_={}},destroy:function(){this.setOwner();g.prototype.destroy.call(this);this.map_=null}});g.prototype.localGroupingClass=t;B=K(C,{autoDestroy:true,sourceNode:null,listen:{sourceNode:{childNodesModified:function(e,h){var j=this.memberMap_,o={},r=0,I=0,L=h.inserted,p=h.deleted;if(L&&L.length)for(o.inserted=L;e=L[r];){j[e.eventObjectId]=e;r++}if(p&&p.length)for(o.deleted=
p;e=p[I];){delete j[e.eventObjectId];I++}if(r||I)this.event_datasetChanged(this,o)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:B("sourceNodeChanged")&&function(e,h){b.sourceNodeChanged.call(this,e,h);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:false,init:function(e,h){C.prototype.init.call(this,h);e&&this.setSourceNode(e)},setSourceNode:function(e){if(e instanceof g==false)e=null;if(e!==this.sourceNode){var h=this.sourceNode,
j=this.listen.sourceNode;this.sourceNode=e;if(j){var o=j.childNodesModified;if(h){h.removeHandler(j,this);o&&o.call(this,h,{deleted:h.childNodes})}if(e){e.addHandler(j,this);o&&o.call(this,e,{inserted:e.childNodes})}}this.event_sourceNodeChanged(this,h)}},destroy:function(){this.setSourceNode();C.prototype.destroy.call(this)}});var H=K(v,{multiple:false,event_datasetChanged:function(e,h){v.prototype.event_datasetChanged.call(this,e,h);if(h.inserted)for(var j=0,o;o=h.inserted[j];j++)if(!o.selected){o.selected=
true;o.event_select()}if(h.deleted)for(j=0;o=h.deleted[j];j++)if(o.selected){o.selected=false;o.event_unselect()}},add:function(e){if(!this.multiple)if(this.itemCount)return this.set(e);else e.splice(1);for(var h=[],j=0,o;o=e[j];j++)o.contextSelection==this&&o.selectable&&h.push(o);return v.prototype.add.call(this,h)},set:function(e){for(var h=[],j=0,o;o=e[j];j++)o.contextSelection==this&&o.selectable&&h.push(o);this.multiple||e.splice(1);return v.prototype.set.call(this,h)}});x.namespace("basis.dom.wrapper",
N).extend({DELEGATE:c,AbstractNode:g,InteractiveNode:A,Node:q,GroupingNode:t,PartitionNode:m,simpleTemplate:N,ChildNodesDataset:B,Selection:H})})(basis);
(function(x,F){function G(h,j){return T(j,true).getRule(h,true)}function R(h,j){var o=h.match(/^([^{]+)\{(.*)\}\s*$/);if(o){for(var r=o[1].trim().split(/\s*,\s*/),I=0;I<r.length;I++)this.addRule(r[I],o[2]||null,j++);return j-1}}function J(h,j){var o=w.createElement(!h?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:j?"alternate ":"",url:h.quote('"')}));w.tag(null,"HEAD")[0].appendChild(o);o=o.sheet||o.styleSheet;try{if(!o.cssRules)o.cssRules=o.rules}catch(r){}if(!o.insertRule)o.insertRule=
R;if(!o.deleteRule)o.deleteRule=o.removeRule;return o}function T(h,j){h||(h="DefaultGenericStyleSheet");if(!c[h])if(j)c[h]=new k(J());return c[h]}function P(h,j,o,r){r=r||{};j=j.qw();for(var I=0,L;L=j[I];I++)if(typeof i.style[L]!="undefined"){if(o)x.platformFeature["css-"+h]=L;f[h]={key:L,getter:r[L]};return}}function N(h,j){var o=f[h];if(h=o?o.key:h.replace(/^-ms-/,"ms-").camelize())return{key:h,value:o&&o.getter?o.getter(j):j}}function K(h,j,o){if(typeof h.setProperty=="function")return h.setProperty(j,
o);if(j=N(j,o))return h.style[j.key]=j.value}function M(h,j){for(var o in j)K(h,o,j[o]);return h}function B(h,j){return K(h,"display",typeof j=="string"?j:j?"":"none")}function A(h,j){return K(h,"visibility",j?"":"hidden")}function D(h){return q[h]||(q[h]=new RegExp("\\s*\\b"+h+"\\b"))}function C(h,j){var o=(j?"g":"s")+h;return H[o]||(H[o]=new RegExp((j?"":"\\s*")+"\\b"+h+"\\S*\\b"))}var v=F.document,w=x.dom,z=x.dom.event,y=x.Class,a=/\s*!important/i,d=String("important"),b=1,c={},f={},i=w.createElement("DIV");
P("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(h){return"alpha(opacity:"+parseInt(h*100)+")"}});P("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);P("float","cssFloat styleFloat");var k=y(null,{styleSheet:null,rules:null,init:function(h){this.styleSheet=h;this.rules=[];this.map_={}},getRule:function(h,j){if(!this.map_[h])if(j){for(var o=this.styleSheet,r=this.rules.length,I=o.insertRule(h+"{}",r),L=r;L<=I;L++)this.rules.push(new l(o.cssRules[L]));
this.map_[h]=r!=I?new g(this.rules.splice(r)):this.rules[r]}return this.map_[h]},deleteRule:function(h){var j=this.map_[h];if(j){j=j.rules||[j];for(var o=0;o<j.length;o++){var r=this.rules.indexOf(j[o]);this.stylesheet.deleteRule(r);this.rules.splice(r,1)}delete this.map_[h]}},destroy:function(){delete this.rules}}),l=y(null,{rule:null,selector:"",init:function(h){if(h){this.rule=h;this.selector=h.selectorText}},setProperty:function(h,j){var o,r=!!a.test(j),I=this.rule.style;if(r||(I.getPropertyPriority?
I.getPropertyPriority(h)==d:false)){j=j.replace(a,"");if(o=N(h,j)){var L=o.key;if(I.setProperty){r||I.removeProperty(L);I.setProperty(L,o.value,r?d:"")}else{o=L+": "+o.value+(r?" !"+d:"")+";";I.cssText=I.cssText.replace(new RegExp(I[L]?L+"\\s*:\\s*"+I[L]+"(\\s*!"+d+")?\\s*;?":"^","i"),o)}}}else K(this.rule,h,j)},setStyle:function(h){Object.iterate(h,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),g=y(null,{rules:null,init:function(h){this.rules=
h},destroy:function(){delete this.rules}});["setProperty","setStyle","clear"].forEach(function(h){g.prototype[h]=function(){for(var j,o=0;j=this.rules[o];o++)j[h].apply(j,arguments)}});var m={};["em","ex","px","%"].forEach(function(h){m[h=="%"?"percent":h]=function(j){return j==0||isNaN(j)?"0":j+h}});var n,q={},t=y(null,{init:function(h){this.element=h},toString:function(){return this.element.className},set:function(h){this.clear();h.qw().forEach(this.add,this)},replace:function(h,j,o){o=o||"";typeof h!=
"undefined"&&this.remove(o+h);typeof j!="undefined"&&this.add(o+j)},bool:function(h,j){j?this.add(h):this.remove(h)},clear:function(){this.element.className=""},contains:function(h){return!!this.element.className.match(D(h))},item:function(h){return this.element.className.qw()[h]},add:function(h){this.element.className.match(D(h))||(this.element.className+=" "+h)},remove:function(h){var j=this.element.className;h=j.replace(D(h),"");if(h!=j)this.element.className=h},toggle:function(h){var j=this.contains(h);
j?this.remove(h):this.add(h);return!j}}),H={},e=y(null,{delim:"-",init:function(h,j){this.classList=j;this.prefix=h+this.delim},add:function(h){this.classList.add(this.prefix+h)},remove:function(h){this.classList.remove(this.prefix+h)},items:function(){var h=this.classList.toString();if(h)return h.toString().match(C(this.prefix,true))},set:function(h){var j=this.items();h=typeof h!="undefined"?this.prefix+h:"";var o=this.classList;if(j)if(j.length==1){if(j[0]===h)return;o.remove(j[0])}else this.clear();
h&&o.add(h)},clear:function(){this.items().forEach(this.classList.remove,this.classList)}});if(F.DOMTokenList&&v.documentElement.classList){y=t.prototype;Object.extend(F.DOMTokenList.prototype,{set:y.set,replace:y.replace,bool:y.bool,clear:function(){for(var h=this.length;h-- >0;)this.remove(this[h])},setPrefixToken:y.setPrefixToken});n=function(h){return(typeof h=="string"?w.get(h):h).classList}}else n=function(h){return new t(typeof h=="string"?w.get(h):h)};z.onLoad(function(){n(v.body).bool("opacity-not-support",
!x.platformFeature["css-opacity"])});w.extend({setStyleProperty:K,setStyle:M,display:B,show:function(h){return B(h,1)},hide:function(h){return B(h)},visibility:A,visible:function(h){return A(h,1)},invisible:function(h){return A(h)}});return x.namespace("basis.cssom").extend({setStyleProperty:K,setStyle:M,classList:function(h,j){return j?new e(j,n(h)):n(h)},uniqueRule:function(h){var j="genericRule-"+b++;h&&n(h).add(j);h=G("."+j);h.token=j;return h},cssRule:G,getStyleSheet:T,addStyleSheet:J,CssStyleSheetWrapper:k,
CssRuleWrapper:l,CssRuleWrapperSet:g}).extend(m)})(basis,this);
(function(){function x(b,c){var f={},i;if(b&&b.length)i=f.inserted=b;if(c&&c.length)i=f.deleted=c;if(i)return f}function F(b,c){if(!b.length)return 0;var f,i,k,l=0,g=b.length-1;do{f=l+g>>1;k=b[f].value||0;if(k===i){k=b[f].object.eventObjectId;i=c.object.eventObjectId}else i=c.value||0;if(i<k)g=f-1;else if(i>k)l=f+1;else return i==k?f:0}while(l<=g);return f+(k<i)}var G=basis.Class,R=Object.extend,J=Object.values,T=Function.$self,P=Function.$true,N=Function.$false,K=basis.EventObject.createEvent,M=
basis.data.SUBSCRIPTION,B=basis.data.DataObject,A=basis.data.KeyObjectMap,D=basis.data.AbstractDataset,C=basis.data.Dataset;M.add("SOURCE",{sourceChanged:function(b,c){this.remove(b,c);this.add(b,b.source)},sourcesChanged:function(b,c){var f;if(f=c.inserted)for(var i=f.length;i-- >0;)this.add(b,f[i]);if(f=c.deleted)for(i=f.length;i-- >0;)this.remove(b,f[i])}},function(b,c){for(var f=c.sources||[c.source],i=0,k;k=f[i++];)b(c,k)});M.add("MINUEND",{operandsChanged:function(b,c){if(this.minuend!==c){this.remove(b,
c);this.add(b,b.minuend)}}},function(b,c){b(c,c.minuend)});M.add("SUBTRAHEND",{operandsChanged:function(b,c,f){if(this.subtrahend!==f){this.remove(b,f);this.add(b,b.subtrahend)}}},function(b,c){b(c,c.subtrahend)});var v={datasetChanged:function(b,c){var f=this.memberMap_,i={},k,l;if(c.inserted)for(var g=0;k=c.inserted[g];g++){l=k.eventObjectId;if(f[l])f[l].count++;else f[l]={count:1,object:k};i[l]=f[l]}if(c.deleted)for(g=0;k=c.deleted[g];g++){l=k.eventObjectId;i[l]=f[l];f[l].count--}this.applyRule(i)},
destroy:function(b){this.removeSource(b)}},w=G(D,{subscribeTo:M.SOURCE,event_sourcesChanged:K("sourcesChanged","dataset","delta"),sources:null,rule:function(b){return b>0},listen:{source:v},init:function(b){D.prototype.init.call(this,b);b=this.sources;this.sources=[];b&&b.forEach(this.addSource,this)},setRule:function(b){if(typeof b!="function")b=w.UNION;if(this.rule!==b){this.rule=b;this.applyRule()}},applyRule:function(b){var c=this.memberMap_,f=this.rule,i=this.sources.length,k=[],l=[],g,m;b||
(b=c);for(var n in b){g=c[n];m=i&&g.count&&f(g.count,i);if(m!=!!this.item_[n])(m?k:l).push(g.object);g.count==0&&delete c[n]}if(b=x(k,l))this.event_datasetChanged(this,b)},addSource:function(b){if(b instanceof D)if(this.sources.add(b)){this.listen.source&&b.addHandler(this.listen.source,this);var c=this.memberMap_;for(var f in b.item_)if(c[f])c[f].count++;else c[f]={count:1,object:b.item_[f]};this.applyRule();this.event_sourcesChanged(this,{inserted:[b]});return true}},removeSource:function(b){if(this.sources.remove(b)){this.listen.source&&
b.removeHandler(this.listen.source,this);var c=this.memberMap_;for(var f in b.item_)c[f].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[b]});return true}},setSources:function(b){for(var c=Array.from(this.sources),f=0,i;i=b[f];f++)if(i instanceof D)c.remove(i)||this.addSource(i);c.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){D.prototype.destroy.call(this);this.sources=null}});w.UNION=w.prototype.rule;
w.INTERSECTION=function(b,c){return b==c};w.DIFFERENCE=function(b){return b==1};w.MORE_THAN_ONE_INCLUDE=function(b,c){return c==1||b>1};w.AT_LEAST_ONE_EXCLUDE=function(b,c){return c==1||b<c};var z=function(b){return!this.has(b)};v={datasetChanged:function(b,c){if(this.subtrahend){var f=x(c.inserted&&c.inserted.filter(z,this.subtrahend),c.deleted&&c.deleted.filter(this.has,this));f&&this.event_datasetChanged(this,f)}},destroy:function(){this.setOperands(null,this.subtrahend)}};var y={datasetChanged:function(b,
c){if(this.minuend){var f=x(c.deleted&&c.deleted.filter(z,this),c.inserted&&c.inserted.filter(this.has,this));f&&this.event_datasetChanged(this,f)}},destroy:function(){this.setOperands(this.minuend,null)}};v=G(D,{subscribeTo:M.MINUEND+M.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:K("operandsChanged","dataset","oldMinuend","oldSubtrahend"),listen:{minuend:v,subtrahend:y},init:function(b){D.prototype.init.call(this,b);b=this.minuend;var c=this.subtrahend;this.subtrahend=this.minuend=
null;if(b||c)this.setOperands(b,c)},setOperands:function(b,c){var f,i=false;if(b instanceof D==false)b=null;if(c instanceof D==false)c=null;var k=this.minuend,l=this.subtrahend;if(k!==b){i=true;this.minuend=b;var g=this.listen.minuend;if(g){k&&k.removeHandler(g,this);b&&b.addHandler(g,this)}}if(l!==c){i=true;this.subtrahend=c;if(g=this.listen.subtrahend){l&&l.removeHandler(g,this);c&&c.addHandler(g,this)}}if(!i)return false;this.event_operandsChanged(this,k,l);if(!b||!c){if(this.itemCount)this.event_datasetChanged(this,
f={deleted:this.getItems()})}else{f=[];i=[];for(var m in this.item_)if(!b.item_[m]||c.item_[m])f.push(this.item_[m]);for(m in b.item_)!this.item_[m]&&!c.item_[m]&&i.push(b.item_[m]);if(f=x(i,f))this.event_datasetChanged(this,f)}return f},clear:function(){this.setOperands()}});var a={subscribeTo:M.SOURCE,source:null,sourceMap_:null,event_sourceChanged:K("sourceChanged","dataset","oldSource"),init:function(b){this.sourceMap_={};D.prototype.init.call(this,b);if(b=this.source){this.source=null;this.setSource(b)}},
setSource:function(b){if(b instanceof D==false)b=null;if(this.source!==b){var c=this.source,f=this.listen.source;this.source=b;if(f){var i=f.datasetChanged;if(c){c.removeHandler(f,this);i&&i.call(this,c,{deleted:c.getItems()})}if(b){b.addHandler(f,this);i&&i.call(this,b,{inserted:b.getItems()})}}this.event_sourceChanged(this,c)}},clear:function(){this.setSource()}},d=G(D,a,{map:T,reduce:N,rule:P,addMemberRef:null,removeMemberRef:null,listen:{sourceObject:{update:function(b){var c=this.map?this.map(b):
b;if(c instanceof B==false||this.reduce(c))c=null;var f=this.sourceMap_[b.eventObjectId],i=f.member;if(i!=c){var k=this.memberMap_,l,g;f.member=c;if(i){f=i.eventObjectId;this.removeMemberRef&&this.removeMemberRef(i,b);if(--k[f]==0){delete k[f];g=[i]}}if(c){i=c.eventObjectId;this.addMemberRef&&this.addMemberRef(c,b);if(k[i])k[i]++;else{k[i]=1;l=[c]}}if(b=x(l,g))this.event_datasetChanged(this,b)}}},source:{datasetChanged:function(b,c){var f=this.sourceMap_,i=this.memberMap_,k=[],l=[],g,m,n,q=this.listen.sourceObject;
C.setAccumulateState(true);if(c.inserted)for(var t=0;g=c.inserted[t];t++){n=this.map?this.map(g):g;if(n instanceof B==false||this.reduce(n))n=null;q&&g.addHandler(q,this);f[g.eventObjectId]={sourceObject:g,member:n};if(n){m=n.eventObjectId;if(i[m])i[m]++;else{i[m]=1;k.push(n)}this.addMemberRef&&this.addMemberRef(n,g)}}if(c.deleted)for(t=0;g=c.deleted[t];t++){m=g.eventObjectId;n=f[m].member;q&&g.removeHandler(q,this);delete f[m];if(n){m=n.eventObjectId;if(--i[m]==0){delete i[m];l.push(n)}this.removeMemberRef&&
this.removeMemberRef(n,g)}}C.setAccumulateState(false);if(c=x(k,l))this.event_datasetChanged(this,c)},destroy:function(){this.setSource()}}},init:function(b){a.init.call(this,b)},setRule:function(b){if(typeof b!="function")b=P;if(this.rule!==b){this.rule=b;return this.applyRule()}},setMap:function(b){if(typeof b!="function")b=T;if(this.map!==b){this.map=b;return this.applyRule()}},setReduce:function(b){if(typeof b!="function")b=N;if(this.reduce!==b){this.reduce=b;return this.applyRule()}},applyRule:function(){var b=
this.sourceMap_,c=this.memberMap_,f,i,k,l,g,m=[],n=[];for(var q in b){g=b[q];l=g.sourceObject;f=g.member;i=this.map?this.map(l):l;if(i instanceof B==false||this.reduce(i))i=null;if(f!=i){g.member=i;if(f){k=f.eventObjectId;this.removeMemberRef&&this.removeMemberRef(f,l);c[k]--}if(i){f=i.eventObjectId;this.addMemberRef&&this.addMemberRef(i,l);if(f in c)c[f]++;else{c[f]=1;m.push(i)}}}}for(k in this.item_)if(c[k]==0){delete c[k];n.push(this.item_[k])}if(b=x(m,n))this.event_datasetChanged(this,b);return b},
destroy:function(){D.prototype.destroy.call(this);this.sourceMap_=null}});K=G(d,{reduce:function(b){return!this.rule(b)}});M=G(d,{map:function(b){return this.keyMap.resolve(b)},subsetClass:D,keyMap:null,addMemberRef:function(b,c){b.event_datasetChanged(b,{inserted:[c]})},removeMemberRef:function(b,c){b.event_datasetChanged(b,{deleted:[c]})},init:function(b){if(!this.keyMap||this.keyMap instanceof A==false)this.keyMap=new A(R({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));d.prototype.init.call(this,
b)},getSubset:function(b,c){return this.keyMap.get(b,c)},destroy:function(){d.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});y=G(D,a,{rule:P,index_:null,offset:0,limit:10,listen:{sourceObject:{update:function(b){var c=this.sourceMap_[b.eventObjectId];b=this.rule(b);var f=this.index_;if(b!==c.value){f.splice(F(f,c),1);c.value=b;f.splice(F(f,c),0,c);this.applyRule()}}},source:{datasetChanged:function(b,c){var f=this.sourceMap_,i=this.index_,k=this.listen.sourceObject,l,g;if(g=
c.inserted)for(var m=0,n;n=g[m];m++){l={object:n,value:this.rule(n)};f[n.eventObjectId]=l;i.splice(F(i,l),0,l);k&&n.addHandler(k,this)}if(g=c.deleted)for(m=0;n=g[m];m++){l=f[n.eventObjectId];i.splice(F(i,l),1);k&&n.removeHandler(k,this)}this.applyRule()}}},init:function(b){this.index_=[];a.init.call(this,b)},setRange:function(b,c){this.offset=b;this.limit=c;this.applyRule()},applyRule:function(){for(var b=Object.slice(this.item_),c=this.index_.slice(this.offset,this.offset+this.limit),f=[],i=0,k;k=
c[i];i++){var l=k.object.eventObjectId;if(b[l])delete b[l];else f.push(k.object)}if(b=x(f,J(b)))this.event_datasetChanged(this,b)}});G=G(D,a,{rule:P,map:T,subsetClass:D,listen:{sourceObject:{update:function(b,c){var f=this.sourceMap_,i=this.memberMap_,k=b.eventObjectId,l=f[k].list;f=f[k].list={};k=this.rule(b);var g=[],m=[],n;if(Array.isArray(k))for(var q=0;q<k.length;q++)if(n=this.keyMap.resolve(k[q])){t=n.eventObjectId;f[t]=n;if(!l[t]){n.event_datasetChanged(n,{inserted:[b]});if(i[t])i[t]++;else{g.push(n);
i[t]=1}}}for(var t in l)if(!f[t]){n=l[t];n.event_datasetChanged(n,{deleted:[b]});if(!--i[t]){delete i[t];m.push(n)}}if(c=x(g,m))this.event_datasetChanged(this,c)}},source:{datasetChanged:function(b,c){var f=this.sourceMap_,i=this.memberMap_,k=this.listen.sourceObject,l,g,m,n=[],q=[];if(l=c.inserted)for(var t=0,H;H=l[t];t++){var e=this.rule(H),h={object:H,list:{}};f[H.eventObjectId]=h;if(Array.isArray(e))for(var j=0;j<e.length;j++)if(g=this.keyMap.resolve(e[j])){g.event_datasetChanged(g,{inserted:[H]});
m=g.eventObjectId;h.list[m]=g;if(i[m])i[m]++;else{n.push(g);i[m]=1}}k&&H.addHandler(k,this)}if(l=c.deleted)for(t=0;H=l[t];t++){g=H.eventObjectId;e=f[g].list;delete f[g];for(m in e){g=e[m];g.event_datasetChanged(g,{deleted:[H]});if(!--i[m]){delete i[m];q.push(g)}}k&&H.removeHandler(k,this)}if(c=x(n,q))this.event_datasetChanged(this,c)}}},init:function(b){if(!this.keyMap||this.keyMap instanceof A==false)this.keyMap=new A(R({keyGetter:this.map,itemClass:this.subsetClass},this.keyMap));a.init.call(this,
b)}});basis.namespace("basis.data.dataset").extend({Merge:w,Subtract:v,MapReduce:d,Subset:K,Split:M,Slice:y,Cloud:G})})(basis,this);
(function(){function x(a){if(a instanceof w)return a.set;a=a.nodeType;if(isNaN(a)==false)return a==1?v:"nodeValue"}var F=basis.Class,G=basis.dom,R=basis.Cleaner,J=Function.getter,T=basis.cssom.classList,P=basis.EventObject,N=basis.TimeEventManager,K=P.createEvent,M=basis.data,B=M.DataObject,A=M.STATE,D=F(B,{event_change:K("change"),locked:false,lockValue_:null,extendConstructor_:false,updateCount:0,init:function(a,d,b){B.prototype.init.call(this,{});d&&this.addHandler(d);this.proxy=typeof b=="function"?
b:Function.$self;this.initValue=this.value=this.proxy(a)},set:function(a,d){var b=this.value,c=this.proxy?this.proxy(a):c,f=false;if(c!==b){this.value=c;f=true;this.updateCount+=1}if(!this.locked&&(f||d))this.event_change(c,b);return f},lock:function(){if(!this.locked){this.lockValue_=this.value;this.locked=true}},unlock:function(){if(this.locked){this.locked=false;this.value!==this.lockValue_&&this.event_change(this.value,this.lockValue_)}},update:function(a,d){return this.set(a,d)},reset:function(){this.set(this.initValue)},
destroy:function(){B.prototype.destroy.call(this);delete this.initValue;delete this.proxy;delete this.lockValue_;delete this.value}}),C={destroy:function(a){this.removeLink(a)}},v=function(a){G.insert(G.clear(this),a)},w=F(D,{links_:null,event_change:function(a,d){D.prototype.event_change.call(this,a,d);if(!(!this.links_.length||R.globalDestroy))for(var b=0,c;c=this.links_[b++];)this.power_(c,d)},init:function(a,d,b){D.prototype.init.call(this,a,d,b);this.links_=[];R.add(this)},addLink:function(a,
d,b){if(typeof a!="object"&&a instanceof Object==false)throw new Error("basis.data.property: Link to undefined object ignored");if(d==null)d=x(a);if(typeof b!="function")b=J(Function.$self,b);d={object:a,format:b,field:d,isEventObject:a instanceof P};this.links_.push(d);d.isEventObject&&a.addHandler(C,this);this.power_(d);return a},addLinkShortcut:function(a,d,b){return this.addLink(a,w.shortcut[d],b)},removeLink:function(a,d){if(this.links_!=null){var b=arguments.length<2;if(!b&&d==null)d=x(a);for(var c=
0,f=0,i;i=this.links_[f];f++)if(i.object===a&&(b||d==i.field))i.isEventObject&&i.object.removeHandler(C,this);else this.links_[c++]=i;this.links_.length=c}},clear:function(){for(var a=0,d;d=this.links_[a];a++)d.isEventObject&&d.object.removeHandler(C,this);this.links_.clear()},power_:function(a,d){var b=a.field;if(b!=null){var c=a.format(this.value),f=a.object;if(typeof b=="function")b.call(f,c,arguments.length<2?c:a.format(d));else f[b]=c}},destroy:function(){this.clear();D.prototype.destroy.call(this);
this.links_=null;R.remove(this)}});w.shortcut={className:function(a,d){T(this).replace(d,a)},show:function(a){G.display(this,!!a)},hide:function(a){G.display(this,!a)},disable:function(a){this.disabled=!!a},enable:function(a){this.disabled=!a}};var z=A.PRIORITY,y={stateChanged:function(){this.fire(false,true)},update:function(){this.fire(true)},change:function(){this.fire(true)},destroy:function(a){this.remove(a)}};F=F(w,{calculateValue:function(){return this.value+1},objects:[],timer_:null,valueChanged_:false,
stateChanged_:true,state:A.UNDEFINED,extendConstructor_:true,init:function(){var a=this.handler;delete this.handler;w.prototype.init.call(this,this.value||0,a,this.proxy);if(this.objects.length){a=this.objects;this.objects=[];this.lock();this.add.apply(this,a);this.unlock()}else this.objects=[];this.valueChanged_=this.stateChanged_=!!this.calculateOnInit;this.update();R.add(this)},add:function(){for(var a=0,d=arguments.length;a<d;a++){var b=arguments[a];if(b instanceof B)this.objects.add(b)&&b.addHandler(y,
this);else throw new Error("basis.data.property: Instance of DataObject required");}this.fire(true,true)},remove:function(a){this.objects.remove(a)&&a.removeHandler(y,this);this.fire(true,true)},clear:function(){for(var a=0,d;d=this.objects[a];a++)d.removeHandler(y,this);this.objects.clear();this.fire(true,true)},fire:function(a,d){if(!this.locked){this.valueChanged_=this.valueChanged_||!!a;this.stateChanged_=this.stateChanged_||!!d;if(!this.timer_&&(this.valueChanged_||this.stateChanged_)){this.timer_=
true;N.add(this,"update",Date.now())}}},lock:function(){this.locked=true},unlock:function(){this.locked=false},update:function(){delete this.timer_;N.remove(this,"update");if(!R.globalDestroy){this.valueChanged_&&this.set(this.calculateValue());if(this.stateChanged_){var a=this.objects.length;if(a){for(var d=-2,b,c=0;c<a;c++){var f=this.objects[c],i=z.indexOf(String(f.state));if(i>d){b=f;d=i}}b&&this.setState(b.state,b.state.data)}else this.setState(A.UNDEFINED)}}this.stateChanged_=this.valueChanged_=
false},destroy:function(){this.lock();this.clear();N.remove(this,"update");w.prototype.destroy.call(this)}});basis.namespace("basis.data.property").extend({DataObjectSet:F,AbstractProperty:D,Property:w,PropertySet:F})})();
(function(x){function F(b,c){if(!b.length)return 0;var f,i,k=0,l=b.length-1;do{f=k+l>>1;i=b[f]||0;if(c<i)l=f-1;else if(c>i)k=f+1;else return c==i?f:0}while(k<=l);return f+(i<c)}function G(b,c){b=Function.getter(b);var f=c+"_"+b.getterIdx_,i=D[f];if(!i){i=D[f]=this;this.indexType=c;this.indexClass=A[c];this.getter=b;this.key=f;this.createInstance=function(k){if(k instanceof M){var l=k.indexes&&k.indexes[this.key];if(!l){l=new this.indexClass(this.getter);l.addHandler(d,k);l.key=this.key}return l}}}return i}
function R(b,c,f){var i=b.indexCache_;b.lock();if(c)for(var k=0,l;l=c[k++];){var g=b.valueGetter(l);i[l.eventObjectId]=g;b.add(l,g)}if(f)for(k=0;l=f[k++];){b.remove(l,i[l.eventObjectId]);delete i[l.eventObjectId]}b.unlock()}var J=x.Class,T=x.TimeEventManager,P=x.data,N=P.KeyObjectMap,K=P.property.Property,M=P.AbstractDataset,B=P.dataset.MapReduce,A=J(K,{autoDestroy:true,valueGetter:Function.$null,dataSource:null,init:function(b){K.prototype.init.call(this,this.value||0);this.indexCache_={};this.valueGetter=
b},add:function(){},remove:function(){},upd:function(){}});A.Sum=J(A,{add:function(b,c){this.value+=c},remove:function(b,c){this.value-=c},upd:function(b,c,f){this.set(this.value+c-f)}});A.Avg=J(A,{sum_:0,count_:0,add:function(b,c){this.sum_+=c;this.count_+=1;this.value=this.sum_/this.count_},remove:function(b,c){this.sum_-=c;this.count_-=1;this.value=this.count_?this.sum_/this.count_:0},upd:function(b,c,f){this.sum_+=c-f;this.set(this.sum_/this.count_)}});A.Count=J(A,{valueGetter:Function.$true,
add:function(b,c){if(c)this.value+=1},remove:function(b,c){if(c)this.value-=1},upd:function(b,c){this.set(this.value+(c?1:-1))}});A.Max=J(A,{init:function(b,c){this.stack=[];A.prototype.init.call(this,b,c)},add:function(b,c){this.stack.splice(F(this.stack,c),0,c);this.value=this.stack[this.stack.length-1]},remove:function(b,c){this.stack.remove(c);this.value=this.stack[this.stack.length-1]},upd:function(b,c,f){this.stack.splice(F(this.stack,f),1);this.stack.splice(F(this.stack,c),0,c);this.set(this.stack[this.stack.length-
1])}});A.Min=J(A,{init:function(b,c){this.stack=[];A.prototype.init.call(this,b,c)},add:function(b,c){this.stack.splice(F(this.stack,c),0,c);this.value=this.stack[0]},remove:function(b,c){this.stack.remove(c);this.value=this.stack[0]},upd:function(b,c,f){this.stack.splice(F(this.stack,f),1);this.stack.splice(F(this.stack,c),0,c);this.set(this.stack[0])}});var D={},C=function(b){return function(c){return new G(c,b)}};P=C("Sum");var v=C("Avg"),w=C("Count"),z=C("Min");C=C("Max");var y={update:function(b){var c,
f,i,k=b.eventObjectId;for(var l in this.indexes){i=this.indexes[l];c=i.indexCache_[k];f=i.valueGetter(b);if(f!==c){i.upd(b,f,c);i.indexCache_[k]=f}}}},a={datasetChanged:function(b,c){if(c.inserted)for(var f=0;b=c.inserted[f++];)b.addHandler(y,this);if(c.deleted)for(f=0;b=c.deleted[f++];)b.removeHandler(y,this);for(var i in this.indexes)R(this.indexes[i],c.inserted,c.deleted)},destroy:function(){for(var b in this.indexes)this.indexes[b].destroy()}},d={destroy:function(b){this.removeIndex(b)}};M.prototype.createIndex=
function(b){if(b instanceof G!=false){if(!this.indexes){this.indexes={};this.addHandler(a);a.datasetChanged.call(this,this,{inserted:this.getItems()})}var c=b.key;if(!this.indexes[c]){b=b.createInstance(this);this.indexes[c]=b;R(b,this.getItems())}return this.indexes[c]}};M.prototype.removeIndex=function(b){if(this.indexes&&this.indexes[b.key]){delete this.indexes[b.key];b.destroy();for(var c in this.indexes)return;this.removeHandler(a);delete this.indexes}};J=J(B,{calcs:null,indexes:null,indexes_:null,
timer_:null,indexUpdated:null,memberSourceMap:null,keyMap:null,event_sourceChanged:function(b,c){B.prototype.event_sourceChanged.call(this,b,c);var f;for(var i in this.indexes_){f=this.indexes_[i];if(c){this.removeIndex(i);c.removeIndex(this.indexes[i])}this.source&&this.addIndex(i,this.source.createIndex(f))}},listen:{sourceObject:{update:function(b,c){B.prototype.listen.sourceObject.update.call(this,b,c);this.sourceMap_[b.eventObjectId].updated=true;this.fireUpdate()}},index:{change:function(b){var c=
this.indexMap;c.indexValues[this.key]=b;c.indexUpdated=true;c.fireUpdate()}},member:{subscribersChanged:function(b,c){b.subscriberCount>0&&c==0&&this.calcMember(b)}}},map:function(b){return this.keyMap.get(b,true)},addMemberRef:function(b,c){this.memberSourceMap[b.eventObjectId]=c.eventObjectId;this.listen.member&&b.addHandler(this.listen.member,this);this.sourceMap_[c.eventObjectId].updated=true;b.subscriberCount>0&&this.calcMember(b)},removeMemberRef:function(b){delete this.memberSourceMap[b.eventObjectId];
this.listen.member&&b.removeHandler(this.listen.member,this)},init:function(b){this.indexUpdated=false;this.indexesBind_={};this.memberSourceMap={};var c=this.indexes;this.indexes={};this.indexes_={};this.calcs=this.calcs||{};this.indexValues={};if(!this.keyMap||this.keyMap instanceof N==false)this.keyMap=new N(Object.complete({create:function(f,i){return new this.itemClass(i)}},this.keyMap));B.prototype.init.call(this,b);Object.iterate(c,this.addIndex,this)},addIndex:function(b,c){if(!this.indexes[b]){if(c instanceof
G)if(this.indexes_[b])return;else{this.indexes_[b]=c;c=this.source&&this.source.createIndex(c)}if(c instanceof A){this.indexValues[b]=c.value;this.indexes[b]=c;this.indexesBind_[b]={key:b,indexMap:this};var f=this.listen.index;if(f){c.addHandler(f,this.indexesBind_[b]);f.change&&f.change.call(this.indexesBind_[b],c.value)}}}},removeIndex:function(b){if(this.indexes_[b]||this.indexes[b]){this.indexes[b]&&this.listen.index&&this.indexes[b].removeHandler(this.listen.index,this.indexesBind_[b]);delete this.indexValues[b];
delete this.indexesBind_[b];delete this.indexes[b];delete this.indexes_[b]}},addCalc:function(b,c){this.calcs[b]=c;this.fireUpdate()},removeCalc:function(b){delete this.calcs[b]},lock:function(){Object.values(this.indexes).forEach(function(b){b.lock()})},unlock:function(){Object.values(this.indexes).forEach(function(b){b.unlock()})},fireUpdate:function(){if(!this.timer_){this.timer_=true;T.add(this,"apply",Date.now())}},apply:function(){for(var b in this.item_)this.calcMember(this.item_[b]);this.timer_=
this.indexUpdated=false},calcMember:function(b){var c=this.sourceMap_[this.memberSourceMap[b.eventObjectId]];if(b.subscriberCount&&(c.updated||this.indexUpdated)){c.updated=false;var f={},i,k;for(var l in this.calcs){i=this.calcs[l](c.sourceObject.data,this.indexValues,c.sourceObject);if(b.data[l]!==i&&(!isNaN(i)||!isNaN(b.data[l]))){f[l]=i;k=true}}k&&b.update(f)}},getMember:function(b){return this.keyMap.get(b,true)},destroy:function(){this.indexesBind_=this.memberSourceMap=this.indexUpdated=this.calcs=
this.timer_=null;this.keyMap.destroy();this.keyMap=null;for(var b in this.indexes)this.removeIndexConstructor(b);B.prototype.destroy.call(this)}});x.namespace("basis.data.index").extend({IndexConstructor:G,Index:A,Sum:P,Avg:v,Count:w,Max:C,Min:z,IndexMap:J})})(basis);
(function(x){function F(p){i[p]=i[p]||0;return p+i[p]++}function G(){var p=Array.from(arguments),s=p.pop();typeof s!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var u=[],Q=[],U=0,aa;U<p.length;U++){aa=p[U].quote('"');u.push(aa+" in delta");Q.push("data["+aa+"]")}s=(new Function("calc","return function(delta, data, oldValue){"+(u.length?"if ("+u.join(" || ")+")":"")+"return calc("+Q.join(", ")+");"+(u.length?"return oldValue;":"")+"}"))(s);s.args=
p;s.isCalcField=true;return s}function R(){return G.apply(null,Array.from(arguments).concat(function(){for(var p=[],s=arguments.length;s-- >0;){if(arguments[s]==null)return null;p.push(arguments[s])}return p.join("-")}))}var J=x.Class,T=x.Cleaner,P=Object.extend,N=Function.$self,K=Function.getter,M=x.data,B=x.EventObject,A=M.Dataset,D=M.dataset.Subset,C=M.dataset.Split,v=M.DataObject,w=M.STATE,z={},y={string:1,number:1},a=[],d=function(p){return isNaN(p)?null:Number(p)},b=function(p){return isNaN(p)?
null:Number(p)},c=function(p){return isNaN(p)?null:parseInt(p)},f=function(p){return p==null?null:String(p)},i={},k=x.Class(null,{init:function(p){var s=this.index={};this.normalize=p;this.valueWrapper=function(u,Q){var U=p(u,Q);if(U!==Q&&s[U])return Q;return U};this.calcWrapper=function(u,Q){var U=p(u,Q);if(U!==Q&&s[U])throw"Duplicate value for index "+Q+" => "+u;return U};T.add(this)},get:function(p,s){var u=this.index[p];if(u&&(!s||u instanceof s))return u},add:function(p,s){var u=this.index[p];
if(s&&(!u||u===s)){this.index[p]=s;return true}},remove:function(p,s){if(this.index[p]===s){delete this.index[p];return true}},destroy:function(){this.index=null}});M=function(p,s){return function(u){return p.prototype[s].call(this,u&&u.map(this.wrapper))}};var l=function(p,s){return function(u){if(!this.name)this.name=F(s);p.prototype.init.call(this,u)}},g=function(p){return function(s,u){A.setAccumulateState(true);s=(s||[]).map(this.wrapper);A.setAccumulateState(false);return p.prototype.sync.call(this,
s,u)}},m=J(A,{wrapper:Function.$self,init:l(A,"EntitySet"),sync:g(A),set:M(A,"set"),add:M(A,"add"),remove:M(A,"remove"),destroy:function(){A.prototype.destroy.call(this);delete this.wrapper}}),n=J(m,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),q=J(D,{init:l(D,"EntityCollection"),sync:g(D)});q.sourceHandler=D.sourceHandler;var t=J(C,{subsetClass:n,init:l(C,"EntityGrouping"),sync:g(C),getSubset:function(p,s){var u=C.prototype.getSubset.call(this,p,s);if(u)u.wrapper=
this.wrapper;return u}}),H=function(p){if(this instanceof H){var s=new e(p||N);return function(u,Q){if(u!=null){Q instanceof m||(Q=s.createEntitySet());Q.set(u instanceof A?u.getItems():Array.from(u));return Q}else return null}}};H.className="basis.entity.EntitySetWrapper";var e=J(null,{init:function(p){this.wrapper=p},createEntitySet:function(){return new m({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),h=function(p){if(this instanceof h){var s=
function(O,W){if(O!=null){if(O===W||O.entityType===u)return O;var $,Y=u.idField;if(y[typeof O]){if(!Y)return;$=O;O={};O[Y]=$}else if(u.compositeKey)$=u.compositeKey(O,O);else if(Y)$=O[Y];else if(aa){W=u.singleton;if(!W)return u.singleton=new U(O)}if($!=null&&Q)W=Q.get($,u.entityClass);if(W&&W.entityType===u)W.update(O);else W=new U(O);return W}else return u.singleton},u=new r(p||{},s),Q=u.index__,U=u.entityClass,aa=u.isSingleton;P(s,{toString:function(){return this.typeName+"()"},entityType:u,type:s,
typeName:u.name,index:Q,reader:function(O){return u.reader(O)},get:function(O){return u.get(O)},addField:function(O,W){u.addField(O,W)},all:u.all,createCollection:function(O,W,$){var Y=u.collection_[O];if(!Y&&W)return u.collection_[O]=new q({wrapper:s,source:$||u.all,rule:W});return Y},getCollection:function(O){return u.collection_[O]},createGrouping:function(O,W,$){var Y=u.grouping_[O];if(!Y&&W)return u.grouping_[O]=new t({wrapper:s,source:$||u.all,rule:W});return Y},getGrouping:function(O){return u.grouping_[O]},
getSlot:function(O,W){return u.getSlot(O,W)}});return s}};h.className="basis.entity.EntityTypeWrapper";var j=K("singleton"),o={};J(v,{});var r=J(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(p,s){this.name=p.name||F(this.name);this.index__=p.index;this.idFields={};a.push(this);this.isSingleton=p.isSingleton;this.wrapper=s;this.all=new n(Object.extend(p.all||{},{wrapper:s}));this.slot_={};if(p.extensible)this.extensible=true;this.fields=
{};this.defaults={};this.aliases={};this.getters={};Object.iterate(p.fields,this.addField,this);p.constrains&&p.constrains.forEach(function(Q){this.addCalcField(null,Q)},this);if(this.isSingleton)this.get=j;p.aliases&&Object.iterate(p.aliases,this.addAlias,this);this.collection_={};if(p.collections)for(var u in p.collections)this.collection_[u]=new q({name:u,wrapper:s,source:this.all,rule:p.collections[u]||Function.$true});this.grouping_={};if(p.groupings)for(u in p.groupings)this.grouping_[u]=new t({name:u,
wrapper:s,source:this.all,rule:p.groupings[u]||Function.$true});this.entityClass=L(this,this.all,this.index__,this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:s,typeName:this.name,getId:function(){return this.__id__}})},reader:function(p){var s={};if(y[typeof p]){if(this.idField){s[this.idField]=p;return s}return null}if(!p||p==null)return null;for(var u in p){var Q=u in this.aliases?this.aliases[u]:"";if(Q&&Q in this.fields)s[Q]=this.fields[Q].reader?this.fields[Q].reader(p[u]):
p[u]}return s},addAlias:function(p,s){if(s in this.fields)if(p in this.aliases==false)this.aliases[p]=s},addField:function(p,s){if(!this.all.itemCount){this.aliases[p]=p;if(typeof s=="function")s={type:s};if("type"in s&&typeof s.type!="function")s.type=N;var u=s.type||N;if([d,b,c,f].has(u))s.id=true;if(s.id){if(!this.index__)this.index__=new k(String);this.idFields[p]=true;if(this.idField||this.compositeKey){this.idField=null;this.compositeKey=R.apply(null,Object.keys(this.idFields))}else this.idField=
p}if(s.calc)this.addCalcField(p,s.calc,void 0);else this.fields[p]=u;this.defaults[p]="defValue"in s?s.defValue:u();this.getters["get_"+p]=function(){return this.data[p]};o[p]||(o[p]={destroy:function(){this.set(p,null)}})}},addCalcField:function(p,s,u){if(!(p&&this.fields[p])){if(!this.calcs)this.calcs=[];for(var Q={args:s.args,wrapper:!u?s:function(W,$,Y){return u(s(W,$,Y))}},U=this.calcs.length,aa=0,O=0;O<this.calcs.length;O++)if(s.args.has(this.calcs[O].key))aa=O+1;if(p){Q.key=p;for(O=0;O<this.calcs.length;O++)if(this.calcs[O].args.has(p)){U=
O;break}if(aa>U)return;if(this.idField&&p==this.idField)this.compositeKey=s;this.fields[p]=function(W,$){typeof console!="undefined"&&console.log("Calculate fields are readonly");return $}}else U=aa;this.calcs.splice(Math.min(U,aa),0,Q)}},get:function(p){p=this.getId(p);if(p!=null)return this.index__.get(p,this.entityClass)},getId:function(p){if((this.idField||this.compositeKey)&&p!=null){if(y[typeof p])return p;if(p&&p.entityType===this)return p.__id__;if(p instanceof v)p=p.data;return this.compositeKey?
this.compositeKey(p,p):p[this.idField]}},getSlot:function(p){var s=this.getId(p);if(s!=null){var u=this.slot_[s];if(!u){if(y[typeof p]){u={};if(this.idField&&!this.compositeKey)u[this.idField]=p;p=u}u=this.slot_[s]=new v({delegate:this.get(s),data:p})}return u}}}),I=J(v,{init:B.prototype.init,event_rollbackUpdate:B.createEvent("rollbackUpdate")}),L=function(p,s,u,Q,U,aa,O){function W(E,S,Z){var ba=false,ca=p.calcs,X=E.__id__,V=E.data;try{if(ca)for(var da=0,fa;fa=ca[da++];){var ea=fa.key;if(ea){var ha=
V[ea];V[ea]=fa.wrapper(S,V,V[ea]);if(V[ea]!==ha){S[ea]=ha;ba=true}}else fa.wrapper(S,V)}if(p.compositeKey)E.__id__=p.compositeKey(S,V,E.__id__);else if(Y&&Y in S)E.__id__=V[Y];E.__id__!==X&&p.index__.calcWrapper(E.__id__)}catch(ia){E.__id__=X;for(var ga in S)E.data[ga]=S[ga];if(Z)for(ga in Z)if(!E.modified)E.modified=Z;ba=false}E.__id__!==X&&$(E,X,E.__id__);return ba}function $(E,S,Z){if(S!=null){u.remove(S,E);Q[S]&&Q[S].setDelegate()}if(Z!=null){u.add(Z,E);Q[Z]&&Q[Z].setDelegate(E)}}var Y=p.idField;
return J(I,O,{canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(E){I.prototype.init.call(this);this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var S,Z={};for(var ba in U){if(ba in E){Z[ba]=aa[ba];S=U[ba](E[ba])}else S=aa[ba];if(S&&S!==this&&S instanceof B)if(S.addHandler(o[ba],this))this.fieldHandlers_[ba]=true;this.data[ba]=S}W(this,Z);s.event_datasetChanged(s,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+
"("+this.entityType.name+")]"},get:function(E){return this.data[E]},set:function(E,S,Z,ba){var ca=U[E];if(!ca){if(!p.extensible)return;ca=N}var X,V=this.modified;S=ca(S,this.data[E]);ca=this.data[E];if(S!==ca&&(!S||!ca||S.constructor!==Date||ca.constructor!==Date||+S!==+ca))a:{X={};if(E!=Y)if(Z){if(!V)this.modified=V={};if(E in V===false){X.rollback={key:E,value:undefined};V[E]=ca}else if(V[E]===S){X.rollback={key:E,value:S};delete V[E];if(!Object.keys(V).length)this.modified=null}}else if(V&&E in
V)if(V[E]!==S){X.rollback={key:E,value:V[E]};V[E]=S;break a}else return false;this.data[E]=S;if(this.fieldHandlers_[E]){ca.removeHandler(o[E],this);this.fieldHandlers_[E]=false}if(S&&S!==this&&S instanceof B)if(S.addHandler(o[E],this))this.fieldHandlers_[E]=true;X.key=E;X.value=ca;X.delta={};X.delta[E]=ca}else if(!Z&&V&&E in V){X={rollback:{key:E,value:V[E]}};delete V[E];if(!Object.keys(V).length)this.modified=null}if(!ba&&X){Z=X.key;E=X.delta||{};var da;if(X.rollback){da={};da[X.rollback.key]=X.rollback.value}if(W(this,
E,da))Z=true;if(Z){this.event_update(this,E);X.delta=E}da&&this.event_rollbackUpdate(this,da)}return X||false},update:function(E,S){if(E){var Z,ba={},ca,X={},V;for(var da in E)if(V=this.set(da,E[da],S,true)){if(V.key){Z=true;ba[V.key]=V.value}if(V.rollback){ca=true;X[V.rollback.key]=V.rollback.value}}if(W(this,ba,X))Z=true;Z&&this.event_update(this,ba);ca&&this.event_rollbackUpdate(this,X)}return Z?ba:false},reset:function(){this.update(aa)},clear:function(){var E={};for(var S in this.data)E[S]=undefined;
return this.update(E)},commit:function(E){if(this.modified){var S=this.modified;this.modified=null}this.update(E);S&&this.event_rollbackUpdate(this,S)},rollback:function(){if(this.state!=w.PROCESSING){if(this.modified){var E=this.modified;this.modified=null;this.update(E);this.event_rollbackUpdate(this,E)}this.setState(w.READY)}},destroy:function(){for(var E in this.fieldHandlers_)this.data[E].removeHandler(o[E],this);this.fieldHandlers_=z;this.__id__&&$(this,this.__id__,null);v.prototype.destroy.call(this);
s.event_datasetChanged(s,{deleted:[this]});this.data=z;this.modified=null}})};x.namespace("basis.entity").extend({isEntity:function(p){return p&&p instanceof L},NumericId:d,NumberId:b,IntId:c,StringId:f,Index:k,CalculateField:G,EntityType:h,Entity:L,BaseEntity:I,EntitySetType:H,EntitySet:m,ReadOnlyEntitySet:n,Collection:q,Grouping:t})})(basis);
(function(x){var F=x.Class,G=x.dom,R=x.html.Template,J=x.cssom.classList,T=Function.getter,P=x.Cleaner,N=x.dom.wrapper.Node,K=x.dom.wrapper.PartitionNode,M=x.dom.wrapper.GroupingNode,B=F.ExtensibleProperty(),A=function(C){return{template:new R("<div/>"),action:B,cssClassName:null,event_update:function(v,w){this.templateUpdate(this.tmpl,"update",w);C.event_update.call(this,v,w)},event_select:function(v){C.event_select.call(this,v);J(this.tmpl.selected||this.tmpl.content||this.element).add("selected")},
event_unselect:function(v){C.event_unselect.call(this,v);J(this.tmpl.selected||this.tmpl.content||this.element).remove("selected")},event_disable:function(v){C.event_disable.call(this,v);J(this.tmpl.disabled||this.element).add("disabled")},event_enable:function(v){C.event_enable.call(this,v);J(this.tmpl.disabled||this.element).remove("disabled")},event_match:function(v){C.event_match.call(this,v);G.display(this.element,true)},event_unmatch:function(v){C.event_unmatch.call(this,v);G.display(this.element,
false)},init:function(v){this.tmpl={};if(this.template){this.template.createInstance(this.tmpl,this);this.element=this.tmpl.element;if(this.tmpl.childNodesHere){this.tmpl.childNodesElement=this.tmpl.childNodesHere.parentNode;this.tmpl.childNodesElement.insertPoint=this.tmpl.childNodesHere}if(this.content)G.insert(this.tmpl.content||this.element,this.content)}else this.element=this.tmpl.element=G.createElement();this.childNodesElement=this.tmpl.childNodesElement||this.element;C.init.call(this,v);if(this.id)this.element.id=
this.id;if(v=this.cssClassName){if(typeof v=="string")v={element:v};for(var w in v){var z=this.tmpl[w];if(z){z=J(z);for(var y=String(v[w]).qw(),a=0,d;d=y[a++];)z.add(d)}}}this.tmpl&&this.templateUpdate(this.tmpl);this.container&&G.insert(this.container,this.element)},templateAction:function(v,w){var z=this.action[v];z&&z.call(this,w)},templateUpdate:function(){},destroy:function(){var v=this.element;C.destroy.call(this);v&&v.parentNode&&v.parentNode.removeChild(v);this.template&&this.template.clearInstance(this.tmpl,
this);this.childNodesElement=this.tmpl=this.element=null}}};N=F(N,A,{});T=F(K,A,{titleGetter:T("data.title"),templateUpdate:function(C){if(C.titleText)C.titleText.nodeValue=String(this.titleGetter(this))}});A=function(C){return{insertBefore:function(v,w){v=C.insertBefore.call(this,v,w);var z=v.groupNode||this,y=v.nextSibling;z=z.childNodesElement||z.element||this.childNodesElement||this.element;var a=v.element;y=(y&&y.element.parentNode==z?y.element:null)||z.insertPoint||null;if(a.parentNode!==z||
a.nextSibling!==y)z.insertBefore(a,y);return v},removeChild:function(v){C.removeChild.call(this,v);var w=v.element,z=w.parentNode;z&&z.removeChild(w);return v},clear:function(v){if(v)for(var w=this.firstChild;w;){var z=w.element;z.parentNode&&z.parentNode.removeChild(z);w=w.nextSibling}C.clear.call(this,v)},setChildNodes:function(v,w){var z=G.createFragment(),y=this.localGrouping||this,a=y.childNodesElement||y.element;y.childNodesElement=z;C.setChildNodes.call(this,v,w);a.insertBefore(z,a.insertPoint||
null);y.childNodesElement=a}}};K=F(M,A,{childClass:T,localGroupingClass:F.SELF,event_ownerChanged:function(C,v){var w=this,z=this.owner,y=null;if(z){y=z.tmpl&&z.tmpl.groupsElement||z.childNodesElement||z.element;y.appendChild(this.nullElement)}do w.element=w.childNodesElement=y;while(w=w.localGrouping);M.prototype.event_ownerChanged.call(this,C,v)},init:function(C){this.element=this.childNodesElement=this.nullElement=G.createFragment();M.prototype.init.call(this,C)}});var D=F(N,A,{childClass:N,childFactory:function(C){return new this.childClass(C)},
localGroupingClass:K});F=F(D,{selection:{},init:function(C){this.document=this;D.prototype.init.call(this,C);P.add(this)},destroy:function(){if(this.selection){this.selection.destroy();this.selection=null}D.prototype.destroy.call(this);P.remove(this)}});A=function(C,v){for(var w=C.match(/\{(this_[^\}]+)\}/g)||[],z=[],y=0;y<w.length;y++){var a=w[y].match(/\{(this_[^\|\}]+)\}/)[1];z.push("this.tmpl."+a+".nodeValue = "+a.replace(/_/g,"."))}return Function("tmpl_","config_","return "+function(d){return Object.extend({template:tmpl_,
templateUpdate:function(b,c,f){d.templateUpdate.call(this,b,c,f);_code_()}},config_)}.toString().replace("_code_()",z.join(";\n")))(new R(C),v)};x.namespace("basis.ui",A).extend({simpleTemplate:A,Node:N,Container:D,PartitionNode:T,GroupingNode:K,Control:F})})(basis);
