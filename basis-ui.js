/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(y){function A(c,e){for(var i in e)c[i]=e[i];return c}function J(c,e){for(var i in e)if(i in c==false)c[i]=e[i];return c}function L(c){return c==null||c==undefined}function H(c){return c}function R(c){var e={};c.names=function(i){return Object.slice(e,typeof i=="string"?i.qw():i)};c.extend=function(i){J(e,i);A(this,i);return this};return c}function M(c,e){for(var i=c.split("."),l=y,q,h,k;i.length;){q=i.shift();h=(h?h+".":"")+q;if(!l[q]){l[q]=R((!i.length?e:null)||function(){},h);if(k)k.namespaces_[h]=
l[q]}l=l[q];if(!k){k=l;if(!k.namespaces_)k.namespaces_={}}}return G[c]=l}A(Object,{extend:A,complete:J,keys:function(c){var e=[];for(var i in c)e.push(i);return e},values:function(c){var e=[];for(var i in c)e.push(c[i]);return e},slice:function(c,e){var i={};if(!e)return A(i,c);for(var l=0,q;q=e[l++];)if(q in c)i[q]=c[q];return i},splice:function(c,e){var i={};if(!e)return A(i,c);for(var l=0,q;q=e[l++];)if(q in c){i[q]=c[q];delete c[q]}return i},iterate:function(c,e,i){var l=[];for(var q in c)l.push(e.call(i,
q,c[q]));return l},coalesce:function(){for(var c=arguments,e=0;e<c.length;e++)if(c[e]!=null)return c[e]}});var K=function(){},E=function(){var c=1,e={},i={},l=function(q){return q.modificator};l.getter=l;l.getterIdx_=c++;return function(q,h){var k,o;if(!h){if(q.getter)return q.getter;if(typeof q=="function")return q}if(typeof q!="function")if(i[q])k=i[q];else{k=new Function("object","return object != null ? object."+q+" : object");k.path=q;k.getterIdx_=c++;i[q]=k}else{k=q;if(!k.getterIdx_)k.getterIdx_=
c++}o=k.getterIdx_;var a=e[o];if(a)if(typeof h=="undefined"){if(a.nmg)return a.nmg}else for(o=0;o<a.length;o++){if(a[o].modificator===h)return a[o].getter}else a=e[o]=[];var d=true;switch(h&&typeof h){case "string":o=function(g){return h.format(k(g))};break;case "function":o=function(g){return h(k(g))};break;case "object":d=false;o=function(g){return h[k(g)]};break;default:o=k.path?k:function(g){return k(g)}}if(d){a.push({getter:o,modificator:h});if(typeof h=="undefined")a.nmg=o}return o.getter=o}}();
A(Function,{$undefined:function(c){return c==undefined},$defined:function(c){return c!=undefined},$isNull:L,$isNotNull:function(c){return c!=null&&c!=undefined},$isSame:function(c){return c===this},$isNotSame:function(c){return c!==this},$self:H,$const:function(c){return function(){return c}},$false:function(){return false},$true:function(){return true},$null:function(){return null},$undef:K,getter:E,def:function(c,e,i){i=i||L;return function(l){l=c(l);return i(l)?e:l}},wrapper:function(c){return function(e){var i=
{};i[c]=e;return i}},lazyInit:function(c,e){var i=0,l,q;return l=function(){if(!i++){l.inited=true;l.data=q=c.apply(e||this,arguments)}return q}},lazyInitAndRun:function(c,e,i){var l=0,q,h;return q=function(){if(!l++){q.inited=true;q.data=h=c.call(i||this)}e.apply(h,arguments);return h}},runOnce:function(c,e){var i=0;return function(){if(!i++)return c.apply(e||this,arguments)}}});J(Function.prototype,{bind:function(c){var e=this,i=Array.from(arguments,1);return i.length?function(){return e.apply(c,
i.concat.apply(i,arguments))}:function(){return e.apply(c,arguments)}}});J(Array,{isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"}});A(Array,{from:function(c,e){if(c!=null){var i=c.length;if(typeof i=="undefined")return[c];e||(e=0);if(i-e>0){for(var l=[],q=0,h=e;h<i;)l[q++]=c[h++];return l}}return[]},create:function(c,e,i){for(var l=[],q=0;q<c;q++)l[q]=typeof e=="function"?e.call(i,q,l):e;return l}});J(Array.prototype,{indexOf:function(c,e){e=parseInt(e)||0;if(e<0)return-1;
for(;e<this.length;e++)if(this[e]===c)return e;return-1},lastIndexOf:function(c,e){var i=this.length;e=parseInt(e);for(e=isNaN(e)||e>=i?i-1:(e+i)%i;e>=0;e--)if(this[e]===c)return e;return-1},forEach:function(c,e){for(var i=0,l=this.length;i<l;i++)i in this&&c.call(e,this[i],i,this)},every:function(c,e){for(var i=0,l=this.length;i<l;i++)if(i in this&&!c.call(e,this[i],i,this))return false;return true},some:function(c,e){for(var i=0,l=this.length;i<l;i++)if(i in this&&c.call(e,this[i],i,this))return true;
return false},filter:function(c,e){for(var i=[],l=0,q=this.length;l<q;l++)l in this&&c.call(e,this[l],l,this)&&i.push(this[l]);return i},map:function(c,e){for(var i=[],l=0,q=this.length;l<q;l++)if(l in this)i[l]=c.call(e,this[l],l,this);return i},reduce:function(c,e){var i=this.length,l=arguments.length;if(i==0&&l==1)throw new TypeError;var q,h=0;if(l>1){q=e;h=1}for(l=0;l<i;l++)if(l in this)q=h++?c.call(null,q,this[l],l,this):this[l];return q}});A(Array.prototype,{flatten:function(){return this.concat.apply([],
this)},repeat:function(c){return Array.create(parseInt(c)||0,this).flatten()},item:function(c){c=parseInt(c||0);return this[c>=0?c:this.length+c]},search:function(c,e,i){Array.lastSearchIndex=-1;e=Function.getter(e||H);i=parseInt(i)||0;for(var l=this.length;i<l;i++)if(e(this[i])===c)return this[Array.lastSearchIndex=i]},lastSearch:function(c,e,i){Array.lastSearchIndex=-1;e=Function.getter(e||H);var l=this.length;i=isNaN(i)||i==null?l:parseInt(i);for(l=i>l?l:i;l-- >0;)if(e(this[l])===c)return this[Array.lastSearchIndex=
l]},binarySearchPos:function(c,e,i,l,q,h){if(!this.length)return l?-1:0;e=Function.getter(e||H);i=!!i;var k;q=isNaN(q)?0:q;var o=isNaN(h)?this.length-1:h;do{h=q+o>>1;k=e(this[h]);if(i?c>k:c<k)o=h-1;else if(i?c<k:c>k)q=h+1;else return c==k?h:l?-1:0}while(q<=o);return l?-1:h+(k<c^i)},binarySearch:function(c,e){return this.binarySearchPos(c,e,false,true)},add:function(c){return this.indexOf(c)==-1&&!!this.push(c)},remove:function(c){c=this.indexOf(c);return c!=-1&&!!this.splice(c,1)},has:function(c){return this.indexOf(c)!=
-1},merge:function(c){return this.reduce(A,c||{})},sortAsObject:function(c,e,i){c=Function.getter(c);i=i?-1:1;return this.map(function(l,q){return{i:q,v:c(l)}}).sort(e||function(l,q){return i*(l.v>q.v||-(l.v<q.v)||(l.i>q.i?1:-1))}).map(function(l){return this[l.i]},this)},set:function(c){if(this!==c){this.length=0;this.push.apply(this,c)}return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var I=Array.prototype.splice;Array.prototype.splice=function(){var c=Array.from(arguments);
if(c.length<2)c[1]=this.length;return I.apply(this,c)}}var C={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};J(String,{toLowerCase:function(c){return String(c).toLowerCase()},toUpperCase:function(c){return String(c).toUpperCase()},trim:function(c){return String(c).trim()},trimLeft:function(c){return String(c).trimLeft()},
trimRight:function(c){return String(c).trimRight()},isEmpty:function(c){return c==null||String(c)==""},isNotEmpty:function(c){return c!=null&&String(c)!=""}});J(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});A(String.prototype,{toObject:function(c){try{return Function("return 0,"+this)()}catch(e){if(c)throw e;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:
function(){for(var c=[],e=this.length,i=0;i<e;i++)c[i]=this.charAt(i);return c},repeat:function(c){return(new Array(parseInt(c)+1||0)).join(this)},qw:function(){var c=this.trim();return c?c.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(c){for(var e={},i=0;i<arguments.length;i++)e[i]=arguments[i];typeof c=="object"&&A(e,c);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(l,q,h,k,o){l=q in e?e[q]:o?"":
l;if(h&&!isNaN(l)){l=Number(l);return h=="."?l.toFixed(k):l.lead(k)}return l})},quote:function(c,e){c=c||'"';e=e||C[c]||c;var i=(c.length==1?c:"")+(e.length==1?e:"");return c+(i?this.replace(new RegExp("["+i.forRegExp()+"]","g"),"\\$&"):this)+e},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(c,e){return e.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(c){return"-"+c.toLowerCase()})}});
String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=11)String.prototype.split=function(c){if(c==""||c&&c.source=="")return this.toArray();var e=[],i=0,l;if(c instanceof RegExp)for(c.global||(c=new RegExp(c.source,/\/([mi]*)$/.exec(c)[1]+"g"));l=c.exec(this);){l[0]=this.substring(i,l.index);e.push.apply(e,l);i=c.lastIndex}else for(;(l=this.indexOf(c,i))!=-1;){e.push(this.substring(i,l));i=l+c.length}e.push(this.substr(i));return e};if("12".substr(-1)!="2"){var F=
String.prototype.substr;String.prototype.substr=function(c,e){return F.call(this,c<0?Math.max(0,this.length+c):c,e)}}A(Number.prototype,{fit:function(c,e){if(!isNaN(c)&&this<c)return Number(c);if(!isNaN(e)&&this>e)return Number(e);return this},between:function(c,e){return!isNaN(this)&&this>=c&&this<=e},quote:function(c,e){return(this+"").quote(c,e)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(c){return!c||isNaN(c)?0:
Math.floor(this/c)*c},lead:function(c,e){return(this+"").replace(/\d+/,function(i){return(c-=i.length-1)>1?Array(c).join(e||0)+i:i})},group:function(c,e){return(this+"").replace(/\d+/,function(i){return i.replace(/\d/g,function(l,q){return!q+(i.length-q)%(c||3)?l:(e||" ")+l})})},format:function(c,e,i,l,q){c=this.toFixed(c);if(e||q)c=c.replace(/(\d+)(\.?)/,function(h,k,o){return(e?Number(k).group(3,e):k)+(o?q||o:"")});if(i)c=c.replace(/^-?/,"$&"+(i||""));return c+(l||"")}});J(Date,{now:function(){return+new Date}});
(new Date).getYear()<1900&&A(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(c){return this.setFullYear(!isNaN(c)&&c<100?Number(c)+1900:c)}});var G={},z=function(){function c(h,k){for(var o=G[h],a=k?k.split(/\./):[];o&&a.length;)o=o[a.shift()];return o}var e=y.document?y.document.getElementsByTagName("SCRIPT"):null,i=(e?e[e.length-1].src:module.filename).replace(/[^\/]+$/,""),l={},q;if(typeof require=="function")q=function(h){return require(requirePath+h.replace(/\./g,
"/"))};else{q=function(h,k){var o=h.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],a=h.substr(o.length?o.length+1:0),d=c(o,a),g=/^basis\./.test(o)?i:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!G[o]||!d)if(/^https?:/.test(g))if(l[h])throw"Attempt to load namespace, probably cycle require";else{l[h]=1;g=g+(k||"")+h.replace(/\./g,"/")+".js";var n=new XMLHttpRequest;n.open("POST",g,false);n.send(null);if(n.status==200){try{(new Function(n.responseText)).call(y)}catch(j){throw j;
}q.sequence.push(h.replace(/\./g,"/")+".js")}else if(n.status==404&&a)z(o);else throw"!";}else throw"Path `"+h+"` can't be resolved";return d||c(o,a)};q.sequence=[]}return q}(),w=function(){function c(h){return typeof h=="function"&&h.basisClass_}var e=Function(),i={id:1};A(e,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var h in this)this[h]=null;this.destroy=
K}},create:function(h){if(typeof h!="function")h=e;var k=Function();k.prototype=h.prototype;k={className:h.className+"._SubClass_",basisClass_:true,superClass_:h,extendConstructor_:!!h.extendConstructor_,__extend__:function(n){return n&&(typeof n=="object"||typeof n=="function"&&!c(n))?e.create.call(null,g,n):n},extend:e.extend,subclass:function(){return e.create.apply(null,[g].concat(Array.from(arguments)))},prototype:new k};for(var o=arguments,a=1;a<o.length;a++)k.extend(typeof o[a]=="function"&&
!c(o[a])?o[a](h.prototype):o[a]);var d={},g=k.extendConstructor_?function(n,j){this.eventObjectId=i.id++;var b;for(var f in n){b=this[f];this[f]=b&&b.__extend__?b.__extend__(n[f]):n[f]}this.init(j||d)}:function(){this.eventObjectId=i.id++;this.init.apply(this,arguments)};k.prototype.constructor=g;A(g,k);return g},extend:function(h){var k=this.prototype;if(h.prototype)h=h.prototype;var o=Object.keys(h);h.toString!==Object.prototype.toString&&o.add("toString");for(var a=o.length;a-- >0;){var d=o[a],
g=h[d],n=k[d];if(d=="className"||d=="extendConstructor_")this[d]=g;else k[d]=n&&n.__extend__?n.__extend__(g):g}return this}});var l=function(h,k){return{__extend__:function(o){var a=Function();a.prototype=this;a=new a;k(a,o);return a}}.__extend__(h)},q=function(h){return l(h,A)};return M("basis.Class",e.create).extend({BaseClass:e,create:e.create,isClass:c,CustomExtendProperty:l,ExtensibleProperty:q,NestedExtProperty:function(h){return l(h,function(k,o){for(var a in o){var d=k[a];k[a]=d&&d.__extend__?
d.__extend__(o[a]):q(o[a])}})}})}(),x=function(){function c(h){var k=i[h];k||(k=i[h]=function(){var o=this.handlers_,a,d;if(o&&o.length){o=e.call(o);for(var g=o.length;g-- >0;){a=o[g];d=a.handler[h];typeof d=="function"&&d.apply(a.thisObject,arguments)}}});return k}var e=Array.prototype.slice,i={},l,q=w(null,{handlers_:null,event_destroy:l=c("destroy","object"),listen:w.NestedExtProperty(),extendConstructor_:true,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,
thisObject:this.handlerContext||this})},addHandler:function(h,k){var o=this.handlers_;if(!o)o=this.handlers_=[];k||(k=this);for(var a=o.length,d;a-- >0;){d=o[a];if(d.handler===h&&d.thisObject===k)return false}return!!o.push({handler:h,thisObject:k||this})},removeHandler:function(h,k){var o=this.handlers_;if(o){k||(k=this);for(var a=o.length,d;a-- >0;){d=o[a];if(d.handler===h&&d.thisObject===k)return!!o.splice(a,1)}return false}},destroy:function(){if(this.handlers_){l.call(this,this);this.handlers_=
null}}});q.createEvent=c;q.event=i;return q}(),t=function(){var c=[];return{add:function(e){e!=null&&c.push(e)},remove:function(e){c.remove(e)}}}();(function(){function c(a){if(e){if(a.source!=y||a.data!=i)return;basis.dom.event.kill(a)}if(l.length){a=l.shift();delete q[a.key];a.fn()}}var e=typeof addEventListener=="function"&&typeof postMessage=="function",i="zeroTimeoutMessage",l=[],q={},h=1;e&&y.addEventListener("message",c,true);var k=setTimeout;y.setTimeout=function(a,d){var g;if(d)g=k.call(y,
a,d);else{g={key:"z"+h++,fn:typeof a=="function"?a:new Function(a)};q[g.key]=g;l.push(g);if(e)postMessage(i,"*");else g.timer=k.call(y,c,0);g=g.key}return g};var o=clearTimeout;y.clearTimeout=function(a){if(/z\d+/.test(a)){var d=q[a];if(d){clearTimeout(d.timer);l.remove(d);delete q[a]}}else return o.call(y,a)}})();var B=function(){function c(){if(!d)if(h.length){var g=Date.now(),n=Math.max(h[0].eventTime,g);if(n<o){clearTimeout(a);a=setTimeout(i,(o=n)-g)}}else{a=clearTimeout(a);o=l}}function e(g,
n){var j=g.eventObjectId,b=k[n]&&k[n][j];if(b){h.remove(b);delete k[n][j];c()}}function i(){var g=Date.now();g=h.binarySearchPos(g+15,q);d=true;h.splice(0,g).forEach(function(n){delete k[n.eventName][n.object.eventObjectId];n.callback.call(n.object)});d=false;o=l;c()}var l=2E12,q=E("eventTime"),h=[],k={},o=l,a=null,d=false;t.add({destroy:function(){d=true;clearTimeout(a);h.length=0;k=null}});return{add:function(g,n,j){var b=g.eventObjectId,f=k[n];f||(f=k[n]={});var m=f[b];if(m){if(isNaN(j))return e(g,
n);if(m.eventTime==j)return;h.remove(m);m.eventTime=j}else{if(isNaN(j))return;m=f[b]={eventName:n,object:g,eventTime:j,callback:g[n]}}h.splice(h.binarySearchPos(j,q),0,m);c()},remove:e}}();M("basis").extend({namespace:M,platformFeature:{},EventObject:x,TimeEventManager:B,Cleaner:t,require:z});y.basis.locale={}})(this);
(function(y,A){function J(t){var B=1E6;t=String(t).split(".");for(var c=0,e=0;c<4&&c<t.length;c++,B/=100)e+=t[c]*B;return e}function L(){for(var t=0;t<arguments.length;t++){var B=arguments[t].toLowerCase();if(B in R){if(R[B])return true}else{var c=B.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(c){R[B]=false;var e=c[1].toLowerCase(),i=J(c[3]);c=c[4]||"=";if(e=M[e])return R[B]=!i||c=="="&&e==i||c=="+"&&e>=i||c=="-"&&e<i}}}return false}var H="basis.ua",R={},M={},K=A.navigator&&A.navigator.userAgent,E=
"unknown",I="unknown",C={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]};for(var F in C)if(!(F=="MSIE"&&A.opera))if(!(F=="Safari"&&K.match(/chrome/i)))if(!(F=="AppleWebKit"&&K.match(/iphone/i)))if(K.match(new RegExp(F+
".(\\d+(\\.\\d+)*)","i"))){var G=C[F],z=A.opera&&typeof A.opera.version=="function"?A.opera.version():RegExp.$1,w=J(z);E=G[0]+w;I=G[0]+" "+z;for(E=0;E<G.length;E++)M[G[E].toLowerCase()]=w}y.platformFeature.datauri=false;K=typeof Image!="undefined"?new Image:{};K.onload=function(){y.platformFeature.datauri=true};K.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";C={set:function(t,B,c,e){document.cookie=t+"="+(B==null?"":escape(B))+";path="+(e||(location.pathname.indexOf("/")==
0?"":"/")+location.pathname)+(c?";expires="+(new Date(Date.now()+c*1E3)).toGMTString():"")},get:function(t){return(t=document.cookie.match(new RegExp("(^|;)\\s*"+t+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(t[2])},remove:function(t,B){document.cookie=t+"=;expires="+(new Date(0)).toGMTString()+";path="+(B||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)}};if(L("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(x){}H=y.namespace(H);H.toString=function(){return I};return H.extend({testImage:K,
prettyName:I,test:L,is:function(t){return L(t)},Cookies:C})})(basis,this);
(function(y,A){function J(a,d,g){if(d!=null)return a.insertBefore(i(d)?d:M(d),g||null)}function L(a){return E("",a.cloneNode(true)).innerHTML}function H(a){return i(a)||a&&a.nodeType?a:typeof a=="string"?G.getElementById(a):null}function R(a,d,g){var n,j=[];g=typeof g=="string"?getter(g):g||Function.$true;d&26&&g(a)&&j.push(a);switch(d){case 1:case 2:for(n=a;(n=n[x])&&n!==a.document;)g(n)&&j.push(n);break;case 64:for(n=a[t];n;){g(n)&&j.push(n);n=n[B]}break;case 4:case 8:if(a[t]){d=new l(a);d.nodes(g,
j)}break;case 128:d=new l(a,g);for(d.cursor_=a[B]||a[x];n=d.next();)j.push(n);break;case 256:for(n=a;n=n[B];)g(n)&&j.push(n);break;case 32:g(a[x])&&j.push(a[x]);break;case 512:d=new l(a,g,l.BACKWARD);for(d.cursor_=a[c]||a[x];n=d.next();)j.push(n);break;case 1024:for(n=a;n=n[c];)g(n)&&j.push(n);break}return j}function M(a){return G.createTextNode(a!=null?a:"")}function K(){for(var a=G.createDocumentFragment(),d=arguments.length,g=K.array=[],n=0;n<d;n++)g.push(J(a,arguments[n]));return a}function E(a){var d=
a!=undefined&&typeof a!="string",g=(d?a.description:a)||"",n="div",j=g.match(/^([a-z0-9\_\-]+)(.*)$/i);if(j){n=j[1];g=j[2]}if(g!=""){for(var b=[],f={},m;j=o.exec(g);){if(j[8])throw new Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+g+"\n\nProblem place:\n> "+g.substr(0,j.index)+"--\>"+g.substr(j.index)+"<--");m=j[1]||j[2]||j[3];if(j[1])f.id=m;else if(j[2])b.push(m);else if(m!="class")f[m]=j[4]?F(j[5],j[6],j[7]):m}if(h&&f.name&&/^(input|textarea|select)$/i.test(n))n=
"<"+n+" name="+f.name+">"}g=G.createElement(n);if(f){if(f.style&&k)g.style.cssText=f.style;for(var p in f)g.setAttribute(p,f[p],0)}if(b&&b.length)g.className=b.join(" ");arguments.length>1&&J(g,K.apply(0,Array.from(arguments,1).flatten()));if(d){a.css&&y.cssom&&y.cssom.setStyle(g,a.css);if(y.dom.event)for(var s in a)if(typeof a[s]=="function")y.dom.event.addHandler(g,s,a[s],g);else a[s]instanceof y.dom.event.Handler&&y.dom.event.addHandler(g,s,a[s].handler,a[s].thisObject)}return g}function I(a,d){return a[x]?
a[x].replaceChild(d,a):a}function C(a){if(G.selection){var d=G.selection.createRange();d.compareEndPoints("StartToEnd",d)!=0&&d.collapse(a);return d.getBookmark().charCodeAt(2)-2}}var F=Object.coalesce,G=A.document,z=y.Class,w=G.createElement("div"),x="parentNode",t="firstChild",B="nextSibling",c="previousSibling",e;e=typeof w.compareDocumentPosition=="function"?function(a,d){return a.compareDocumentPosition(d)}:function(a,d){if(a==d)return 0;if(a.document!=d.document)return 33;return a.sourceIndex>
d.sourceIndex?2|8*d.contains(childA):4|16*a.contains(childB)};var i;if(typeof Node!="undefined"){i=function(a){return a instanceof Node};if(!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else i=function(a){return a&&a.ownerDocument===G};var l=z(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,d,g){this.setRoot(a);this.setDirection(g);if(typeof d=="function")this.filter=d},setDirection:function(a){Object.extend(this,a?{a:"lastChild",
b:c,c:B,d:t}:{a:t,b:B,c:c,d:"lastChild"})},setRoot:function(a){this.root_=a||G;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,d){var g;d||(d=[]);for(this.reset();g=this.next(a);)d.push(g);return d},next:function(a){a=a||this.filter;var d=this.cursor_||this.root_;do for(var g=d[this.a];!g;){if(d===this.root_)return this.cursor_=null;(g=d[this.b])||(d=d[x])}while(!a(d=g));return this.cursor_=
d},prev:function(a){a=a||this.filter;var d=this.cursor_,g=this.c,n=this.d;do{var j=d?d[g]:this.root_[n];if(j){for(;j[n];)j=j[n];d=j}else if(d)d=d[x];if(!d||d===this.root_){d=null;break}}while(!a(d));return this.cursor_=d},destroy:function(){this.cursor_=this.root_=null}});l.BACKWARD=true;var q="textContent innerText nodeValue".qw(),h=function(){var a=G.createElement("input");a.name="a";return!/name/.test(L(a))}(),k;w.setAttribute("style","color: red");k=w.style.color!=="red";var o=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return y.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:l,outerHTML:L,textContent:function(a){for(var d=0,g;g=q[d++];)if(a[g]!=null)return a[g];return R(a,4,function(n){return n.nodeType==3}).map(getter("nodeValue")).join("")},get:H,tag:function(a,d){a=H(a)||G;return d=="*"&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(d||"*"))},axis:R,findAncestor:function(a,d,g){for(;a&&a!==g;){if(d(a))return a;a=a.parentNode}},createElement:E,createText:M,createFragment:K,insert:function(a,
d,g,n){a=H(a);if(!a)throw new Error("basis.dom.insert: destination node can't be null");switch(g){case undefined:case "end":n=null;break;case "begin":n=a[t];break;case "before":break;case "after":n=n[B];break;default:n=Number(g).between(0,a.childNodes.length)?a.childNodes[g]:null}g=!i(a);if(!d||!Array.isArray(d))g=g?d&&a.insertBefore(d,n):J(a,d,n);else if(g){g=[];for(var j=0,b=d.length;j<b;j++)g[j]=a.insertBefore(d[j],n)}else{a.insertBefore(K.apply(0,d),n);g=K.array}return g},remove:function(a){return a[x]?
a[x].removeChild(a):a},replace:I,swap:function(a,d){if(a===d||e(a,d)&25)return false;I(a,w);I(d,a);I(w,d);return true},clone:function(a,d){var g=a.cloneNode(!d);g.attachEvent&&R(g,8).forEach(Event.clearHandlers);return g},clear:function(a){for(a=H(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,d,g){var n=[];g=Function.getter(g||Function.$self);for(var j in d)for(var b=0;b<a.length;b++){var f=g(a[b]);n[b]=d[j](a[b],b,f)?E(j,f):a[b]}return n},setAttribute:function(a,d,g){g==null?
a.removeAttribute(d):a.setAttribute(d,g)},parentOf:function(a,d){return a.contains(d)},isInside:function(a,d){return a==d||d.contains(a)},focus:function(a,d){try{a=H(a);a.focus();d&&a.select&&a.select()}catch(g){}},setSelectionRange:function(a,d,g){if(arguments.length<3)g=d;if(a.setSelectionRange)a.setSelectionRange(d,g);else if(a.createTextRange){var n=a.createTextRange();n.collapse(true);n.moveStart("character",d);n.moveEnd("character",g-d);n.select()}},getSelectionStart:function(a){return typeof a.selectionStart!=
"undefined"?a.selectionStart:C(true)},getSelectionEnd:function(a){return typeof a.selectionEnd!="undefined"?a.selectionEnd:C(false)}})})(basis,this);
(function(y,A){function J(c){return c||A.event}function L(c){return typeof c=="string"?F.get(c):c}function H(c){c=J(c);if(c.stopPropagation)c.stopPropagation();else c.cancelBubble=true}function R(c){c=J(c);if(c.preventDefault)c.preventDefault();else c.returnValue=false}function M(c){var e=Array.from(x[c.type]);if(e)for(var i=e.length;i-- >0;){var l=e[i];l.handler.call(l.thisObject,c)}}function K(c,e,i,l){c=L(c);if(!c)throw new Error("Event.addHandler: can't attach event listener to undefined");if(typeof i!=
"function")throw new Error("Event.addHandler: handler must be a function");c[z]||(c[z]={});var q={handler:i,thisObject:l},h=c[z],k=h[e];if(k){for(c=0;e=k[c];c++)if(e.handler===i&&e.thisObject===l)return;k.push(q)}else{k=h[e]=[q];k.fireEvent=function(o){o=J(o);if(t&&o)if(typeof o.returnValue=="undefined"){M(o);if(o.cancelBubble===true)return;if(typeof o.returnValue=="undefined")o.returnValue=true}for(var a=0,d;d=k[a++];)d.handler.call(d.thisObject,o)};c.addEventListener?c.addEventListener(e,k.fireEvent,
false):c.attachEvent("on"+e,k.fireEvent)}}function E(c,e,i,l){c=L(c);var q=c[z];if(q)if(q=q[e])for(var h=0,k;k=q[h];h++)if(k.handler===i&&k.thisObject===l){q.splice(h,1);q.length||I(c,e);return}}function I(c,e){c=L(c);var i=c[z];if(i)if(typeof e!="string")for(e in i)I(c,e);else{var l=i[e];if(l){c.removeEventListener?c.removeEventListener(e,l.fireEvent,false):c.detachEvent("on"+e,l.fireEvent);delete i[e]}}}var C=A.document,F=y.dom,G=Function.$null,z="__basisEvents",w={mousewheel:["mousewheel","DOMMouseScroll"]},
x={},t=!C.addEventListener,B=function(){function c(){e++||setTimeout(function(){for(var q=0;q<i.length;q++)i[q].callback.call(i[q].thisObject)},10)}var e=false,i=[];if(y.ua.is("ie7-"))(function(){var q="_"+Date.now();C.write('<script id="'+q+'" defer src="//:"><\/script>');L(q).onreadystatechange=function(){if(this.readyState=="complete"){F.remove(this);c()}}})();else if(y.ua.is("safari525-"))var l=setInterval(function(){if(/loaded|complete/.test(C.readyState)){clearInterval(l);c()}},15);else K(C,
"DOMContentLoaded",c,false);K(C,"load",c,false);K(A,"load",c,false);return function(q,h){e||i.push({callback:q,thisObject:h})}}();return y.namespace("basis.dom.event",J).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(c){return w[c]||[c]},Handler:function(c,
e){this.handler=c;this.thisObject=e},sender:function(c){c=J(c);return c.target||c.srcElement},cancelBubble:H,cancelDefault:R,kill:function(c,e){if(e=L(e))K(e,c,Event.kill);else{R(c);H(c)}},key:function(c){c=J(c);return c.keyCode||c.which||0},charCode:function(c){c=J(c);return c.charCode||c.keyCode||0},mouseButton:function(c,e){c=J(c);return typeof c.which=="number"?c.which==e.VALUE:c.button&e.BIT},mouseX:function(c){c=J(c);return c.changedTouches?c.changedTouches[0].pageX:"pageX"in c?c.pageX:c.clientX+
(C.documentElement.scrollLeft||C.body.scrollLeft)},mouseY:function(c){c=J(c);return c.changedTouches?c.changedTouches[0].pageY:"pageY"in c?c.pageY:c.clientY+(C.documentElement.scrollTop||C.body.scrollTop)},wheelDelta:function(c){c=J(c);return"wheelDelta"in c?c.wheelDelta/120:c.type=="DOMMouseScroll"?-c.detail/3:0},addGlobalHandler:function(c,e,i){var l=x[c];if(l)for(c=l.length;c-- >0;){var q=l[c];if(q.handler===e&&q.thisObject===i)return}else{C.addEventListener?C.addEventListener(c,M,true):K(C,c,
G);l=x[c]=[]}l.push({handler:e,thisObject:i})},removeGlobalHandler:function(c,e,i){var l=x[c];if(l)for(var q=0,h;h=l[q];q++)if(h.handler===e&&h.thisObject===i){l.splice(q,1);if(!l.length){delete x[c];C.removeEventListener?C.removeEventListener(c,M,true):E(C,c,G)}return}},addHandler:K,addHandlers:function(c,e,i){c=L(c);for(var l in e)K(c,l,e[l],i)},removeHandler:E,clearHandlers:I,fireEvent:function(c,e){c=L(c);var i=c[z];i&&i[e]&&i[e].fireEvent()},onLoad:B,onUnload:function(c,e){K(A,"unload",c,e)}})})(basis,
this);
(function(){function y(a,d,g){for(var n=1,j;d;){if(d&1){j=z[n];if(g&n){a.addHandler(j.handler,j.context);j.action(j.context.add,a)}else{a.removeHandler(j.handler,j.context);j.action(j.context.remove,a)}}d>>=1;n<<=1}}function A(a,d){var g={},n;if(a&&a.length)n=g.inserted=a;if(d&&d.length)n=g.deleted=d;if(n)return g}function J(a){return Array.isArray(a)?a.map(J):{data:a}}var L=basis.Class,H=basis.EventObject,R=Object.values,M=Function.$self,K=Function.$true,E=Function.$false,I=H.createEvent,C=H.event,
F={},G=[],z={},w=1,x={NONE:0,MASK:0,regType:function(a,d,g){z[w]={handler:d,action:g,context:{add:function(n,j){if(j){var b=x[a]+"_"+n.eventObjectId;if(!j.subscribers_)j.subscribers_={};if(!j.subscribers_[b]){var f=j.subscriberCount;j.subscribers_[b]=n;j.subscriberCount+=1;j.event_subscribersChanged(j,f)}}},remove:function(n,j){if(j){var b=x[a]+"_"+n.eventObjectId;if(j.subscribers_[b]){var f=j.subscriberCount;delete j.subscribers_[b];j.subscriberCount-=1;j.event_subscribersChanged(j,f)}}}}};x[a]=
w;x.MASK|=w;w<<=1}};x.regType("DELEGATE",{delegateChanged:function(a,d){this.remove(a,d);this.add(a,a.delegate)}},function(a,d){a(d,d.delegate)});x.regType("TARGET",{targetChanged:function(a,d){this.remove(a,d);this.add(a,a.target)}},function(a,d){a(d,d.target)});x.regType("SOURCE",{sourceChanged:function(a,d){this.remove(a,d);this.add(a,a.source)},sourcesChanged:function(a,d){var g;if(g=d.inserted)for(var n=g.length;n-- >0;)this.add(a,g[n]);if(g=d.deleted)for(n=g.length;n-- >0;)this.remove(a,g[n])}},
function(a,d){for(var g=d.sources||[d.source],n=0,j;j=g[n++];)a(d,j)});var t=L(H,{state:"ready",data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,target:null,active:false,subscribeTo:x.DELEGATE+x.TARGET,subscriberCount:0,subscribers_:null,event_update:I("update","object","delta"),event_stateChanged:I("stateChanged","object","oldState"),event_delegateChanged:I("delegateChanged","object","oldDelegate"),event_rootChanged:I("rootChanged","object","oldRoot"),event_targetChanged:I("targetChanged",
"object","oldTarget")&&function(a,d){var g=this.listen.target;if(g){d&&d.removeHandler(g,this);this.target&&this.target.addHandler(g,this)}C.targetChanged.call(this,a,d)},event_subscribersChanged:I("subscribersChanged","object"),event_activeChanged:I("activeChanged","object"),listen:{delegate:{update:function(a,d){this.data=a.data;this.event_update(this,d)},stateChanged:function(a,d){this.state=a.state;this.event_stateChanged(this,d)},targetChanged:function(a,d){this.target=a.target;this.event_targetChanged(this,
d)},rootChanged:function(a,d){this.data=a.data;this.event_rootChanged(this,d)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},init:function(a){H.prototype.init.call(this,a);if(a=this.delegate){this.delegate=null;this.data=a.data;this.state=a.state;this.setDelegate(a)}else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&y(this,this.subscribeTo,x.MASK)},isConnected:function(a){if(a instanceof t){for(;a&&a!==this&&a!==a.delegate;)a=
a.delegate;return a===this}return false},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&a&&a instanceof t){if(a.delegate&&this.isConnected(a))return false}else a=null;if(this.delegate!==a){var d=this.state,g=this.data,n=this.delegate,j=this.target,b=this.root,f={};n&&n.removeHandler(this.listen.delegate,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;
a.addHandler(this.listen.delegate,this);for(var m in a.data)if(m in g===false)f[m]=undefined;for(m in g)if(g[m]!==a.data[m])f[m]=g[m]}else{this.target=this.delegate=null;this.root=this;this.data={};for(m in g)this.data[m]=g[m]}this.event_delegateChanged(this,n);this.root!==b&&this.event_rootChanged(this,b);this.target!==j&&this.event_targetChanged(this,j);if(a){for(m in f){this.event_update(this,f);break}if(d!==this.state&&(String(d)!=this.state||d.data!==this.state.data))this.event_stateChanged(this,
d)}return true}return false},setState:function(a,d){var g=this.target||this.getRootDelegate();if(g!==this)return g.setState(a,d);if(this.state!=String(a)||this.state.data!=d){g=this.state;this.state=Object(String(a));this.state.data=d;this.event_stateChanged(this,g);return true}return false},deprecate:function(){this.state!="processing"&&this.setState("deprecated")},update:function(a){var d=this.target||this.getRootDelegate();if(d!==this)return d.update(a);if(a){d={};var g=0;for(var n in a)if(this.data[n]!==
a[n]){g++;d[n]=this.data[n];this.data[n]=a[n]}if(g){this.event_update(this,d);return d}}return false},setActive:function(a){a=!!a;if(this.active!=a){this.active=a;this.event_activeChanged(this);y(this,this.subscribeTo,x.MASK*a);return true}return false},setSubscription:function(a){a=a&x.MASK;var d=this.subscribeTo^a;if(d){this.subscribeTo=a;this.active&&y(this,d,a);return true}return false},destroy:function(){this.active&&y(this,this.subscribeTo,0);this.delegate&&this.setDelegate();H.prototype.destroy.call(this);
this.data=F;this.state="undefined";this.target=this.root=null}}),B=L(null,{itemClass:t,keyGetter:M,map_:null,extendConstructor_:true,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var d={};if(a instanceof t)d.delegate=a;else d.data={id:a,title:a};return new this.itemClass(d)},get:function(a,d){var g=a instanceof t?a.eventObjectId:a,n=this.map_[g];if(!n&&d){n=this.map_[g]=this.create(a,d);n.addHandler({destroy:function(){delete this.map_[g]}},
this)}return n},destroy:function(){basis.Cleaner.remove(this);for(var a=R(this.map_),d=0,g;g=a[d++];)g.destroy()}}),c=L(t,{state:"undefined",itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:I("datasetChanged","dataset","delta")&&function(a,d){var g,n=0,j=0,b;if(g=d.inserted)for(;b=g[n];){this.item_[b.eventObjectId]=b;n++}if(g=d.deleted)for(;b=g[j];){delete this.item_[b.eventObjectId];j++}this.itemCount+=n-j;this.cache_=null;C.datasetChanged.call(this,a,d)},init:function(a){t.prototype.init.call(this,
a);this.memberMap_={};this.item_={}},has:function(a){return!!(a&&this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=R(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var d=[];if(a)for(var g in this.item_)if(d.push(this.item_[g])>=a)break;return d},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();t.prototype.destroy.call(this);
this.cache_=G;this.itemCount=0;this.item_=this.memberMap_=null}}),e=L(c,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&this.remove([a])}}},init:function(a){c.prototype.init.call(this,a);if(a=this.items){this.set(a);this.items=null}},add:function(a){for(var d,g=this.memberMap_,n=[],j=0;j<a.length;j++){var b=a[j];if(b instanceof t){var f=b.eventObjectId;if(!g[f]){g[f]=b;b.addHandler(this.listen.item,this);n.push(b)}}}if(n.length)this.event_datasetChanged(this,d={inserted:n});return d},
remove:function(a){for(var d,g=this.memberMap_,n=[],j=0;j<a.length;j++){var b=a[j];if(b instanceof t){var f=b.eventObjectId;if(g[f]){b.removeHandler(this.listen.item,this);delete g[f];n.push(b)}}}if(n.length)this.event_datasetChanged(this,d={deleted:n});return d},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var d=this.memberMap_,g={},n=[],j=[],b,f,m=0;m<a.length;m++){b=a[m];if(b instanceof t){f=b.eventObjectId;g[f]=b;if(!d[f]){d[f]=b;b.addHandler(this.listen.item,
this);j.push(b)}}}for(f in d)if(!g[f]){b=d[f];b.removeHandler(this.listen.item,this);delete d[f];n.push(b)}if(a=A(j,n))this.event_datasetChanged(this,a);return a},sync:function(a,d){if(a){e.setAccumulateState(true);for(var g=this.memberMap_,n,j,b={},f=[],m,p=0;p<a.length;p++){n=a[p];if(n instanceof t){j=n.eventObjectId;b[j]=n;g[j]||f.push(n)}}for(j in this.item_)b[j]||this.item_[j].destroy();if(d&&f.length)m=this.add(f);e.setAccumulateState(false);return m}},clear:function(){var a,d=this.getItems();
if(d.length){for(a=d.length;a-- >0;)d[a].removeHandler(this.listen.item,this);this.event_datasetChanged(this,a={deleted:d});this.memberMap_={}}return a}});e.setAccumulateState=function(){function a(p){var s=p.dataset;j.call(s,s,p)}function d(p,s){var O=p.eventObjectId,N=s.inserted,U=s.deleted,r=m[O];if(N&&U){if(r){delete m[O];a(r)}return j.call(p,p,s)}if(r){var u=r[N?"inserted":"deleted"];if(u)return u.push.apply(u,N||U);else a(r)}m[O]=s;s.dataset=p}function g(){b=1;setAccumulateState(false)}var n=
c.prototype,j=n.event_datasetChanged,b=0,f,m={};return function(p){if(p){if(b==0){n.event_datasetChanged=d;f=setTimeout(g,0)}b++}else{b-=b>0;if(b==0){clearTimeout(f);n.event_datasetChanged=j;p=m;m={};R(p).forEach(a)}}}}();var i={datasetChanged:function(a,d){var g=this.memberMap_,n={},j,b;if(d.inserted)for(var f=0;j=d.inserted[f];f++){b=j.eventObjectId;if(g[b])g[b].count++;else g[b]={count:1,object:j};n[b]=g[b]}if(d.deleted)for(f=0;j=d.deleted[f];f++){b=j.eventObjectId;n[b]=g[b];g[b].count--}this.applyRule(n)},
destroy:function(a){this.removeSource(a)}},l=L(c,{subscribeTo:x.SOURCE,event_sourcesChanged:I("sourcesChanged","dataset","delta"),sources:null,rule:function(a){return a>0},listen:{source:i},init:function(a){c.prototype.init.call(this,a);a=this.sources;this.sources=[];a&&a.forEach(this.addSource,this)},setRule:function(a){if(typeof a!="function")a=l.UNION;if(this.rule!==a){this.rule=a;this.applyRule()}},applyRule:function(a){var d=this.memberMap_,g=this.rule,n=this.sources.length,j=[],b=[],f,m;a||
(a=d);for(var p in a){f=d[p];m=n&&f.count&&g(f.count,n);if(m!=!!this.item_[p])(m?j:b).push(f.object);f.count==0&&delete d[p]}if(a=A(j,b))this.event_datasetChanged(this,a)},addSource:function(a){if(a instanceof c)if(this.sources.add(a)){a.addHandler(this.listen.source,this);var d=this.memberMap_;for(var g in a.item_)if(d[g])d[g].count++;else d[g]={count:1,object:a.item_[g]};this.applyRule();this.event_sourcesChanged(this,{inserted:[a]});return true}},removeSource:function(a){if(this.sources.remove(a)){a.removeHandler(this.listen.source,
this);var d=this.memberMap_;for(var g in a.item_)d[g].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[a]});return true}},setSources:function(a){for(var d=Array.from(this.sources),g=0,n;n=a[g];g++)if(n instanceof c)d.remove(n)||this.addSource(n);d.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){c.prototype.destroy.call(this);this.sources=null}});l.UNION=l.prototype.rule;l.INTERSECTION=function(a,d){return a==
d};l.DIFFERENCE=function(a){return a==1};l.MORE_THAN_ONE_INCLUDE=function(a,d){return d==1||a>1};l.AT_LEAST_ONE_EXCLUDE=function(a,d){return d==1||a<d};var q=function(a){return!this.has(a)};i=L(c,{minuend:null,subtrahend:null,listen:{minuend:{datasetChanged:function(a,d){if(this.subtrahend){var g=A(d.inserted&&d.inserted.filter(q,this.subtrahend),d.deleted&&d.deleted.filter(this.has,this));g&&this.event_datasetChanged(this,g)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(a,
d){if(this.minuend){var g=A(d.deleted&&d.deleted.filter(q,this),d.inserted&&d.inserted.filter(this.has,this));g&&this.event_datasetChanged(this,g)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(a){c.prototype.init.call(this,a);a=this.minuend;var d=this.subtrahend;this.subtrahend=this.minuend=null;if(a||d)this.setOperands(a,d)},setOperands:function(a,d){var g;if(a instanceof c==false)a=null;if(d instanceof c==false)d=null;var n=this.minuend,j=this.subtrahend;if(n!==a){n&&
n.removeHandler(this.listen.minuend,this);if(this.minuend=a)a.addHandler(this.listen.minuend,this)}if(j!==d){j&&j.removeHandler(this.listen.subtrahend,this);if(this.subtrahend=d)d.addHandler(this.listen.subtrahend,this)}if(!a||!d){if(this.itemCount)this.event_datasetChanged(this,g={deleted:this.getItems()})}else{g=[];n=[];for(var b in this.item_)if(!a.item_[b]||d.item_[b])g.push(this.item_[b]);for(b in a.item_)!this.item_[b]&&!d.item_[b]&&n.push(a.item_[b]);if(g=A(n,g))this.event_datasetChanged(this,
g)}return g},clear:function(){this.setOperands()}});var h={update:function(a){var d=this.map?this.map(a):a;if(d instanceof t==false||this.reduce(d))d=null;var g=this.sourceMap_[a.eventObjectId],n=g.member;if(n!=d){var j=this.memberMap_,b,f;g.member=d;if(n){g=n.eventObjectId;this.removeMemberRef&&this.removeMemberRef(n,a);if(--j[g]==0){delete j[g];f=[n]}}if(d){n=d.eventObjectId;this.addMemberRef&&this.addMemberRef(d,a);if(j[n])j[n]++;else{j[n]=1;b=[d]}}if(a=A(b,f))this.event_datasetChanged(this,a)}}},
k={datasetChanged:function(a,d){var g=this.sourceMap_,n=this.memberMap_,j=[],b=[],f,m,p;e.setAccumulateState(true);if(d.inserted)for(var s=0;f=d.inserted[s];s++){p=this.map?this.map(f):f;if(p instanceof t==false||this.reduce(p))p=null;f.addHandler(this.listen.sourceObject,this);g[f.eventObjectId]={sourceObject:f,member:p};if(p){m=p.eventObjectId;if(n[m])n[m]++;else{n[m]=1;j.push(p)}this.addMemberRef&&this.addMemberRef(p,f)}}if(d.deleted)for(s=0;f=d.deleted[s];s++){m=f.eventObjectId;p=g[m].member;
f.removeHandler(this.listen.sourceObject,this);delete g[m];if(p){m=p.eventObjectId;if(--n[m]==0){delete n[m];b.push(p)}this.removeMemberRef&&this.removeMemberRef(p,f)}}e.setAccumulateState(false);if(d=A(j,b))this.event_datasetChanged(this,d)},destroy:function(){this.setSource()}},o=L(c,{source:null,event_sourceChanged:I("sourceChanged","dataset","oldSource"),map:M,reduce:E,rule:E,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:h,source:k},init:function(a){c.prototype.init.call(this,
a);this.sourceMap_={};if(a=this.source){this.source=null;this.setSource(a)}},setRule:function(a){if(typeof a!="function")a=K;if(this.rule!==a){this.rule=a;return this.applyRule()}},setMap:function(a){if(typeof a!="function")a=M;if(this.map!==a){this.map=a;return this.applyRule()}},setSource:function(a){if(a instanceof c==false)a=null;if(this.source!==a){var d=this.source;if(d){d.removeHandler(this.listen.source,this);this.listen.source.datasetChanged.call(this,d,{deleted:d.getItems()})}if(this.source=
a){a.addHandler(this.listen.source,this);this.listen.source.datasetChanged.call(this,a,{inserted:a.getItems()})}this.event_sourceChanged(this,d)}},applyRule:function(){var a=this.sourceMap_,d=this.memberMap_,g,n,j,b,f,m=[],p=[];for(var s in a){f=a[s];b=f.sourceObject;g=f.member;n=this.map?this.map(b):b;if(n instanceof t==false||this.reduce(n))n=null;if(g!=n){f.member=n;if(g){j=g.eventObjectId;this.removeMemberRef&&this.removeMemberRef(g,b);d[j]--}if(n){g=n.eventObjectId;this.addMemberRef&&this.addMemberRef(n,
b);if(g in d)d[g]++;else{d[g]=1;m.push(n)}}}}for(j in this.item_)if(d[j]==0){delete d[j];p.push(this.item_[j])}if(a=A(m,p))this.event_datasetChanged(this,a);return a},clear:function(){this.setSource()},destroy:function(){c.prototype.destroy.call(this);this.sourceMap_=null}});E=L(o,{reduce:function(a){return!this.rule(a)},rule:K});L=L(o,{map:function(a){return this.keyMap.resolve(a)},rule:K,subsetClass:c,keyMap:null,addMemberRef:function(a,d){a.event_datasetChanged(a,{inserted:[d]})},removeMemberRef:function(a,
d){a.event_datasetChanged(a,{deleted:[d]})},init:function(a){if(!this.keyMap||this.keyMap instanceof B==false)this.keyMap=new B(Object.extend({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));o.prototype.init.call(this,a)},getSubset:function(a,d){return this.keyMap.get(a,d)},destroy:function(){o.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});Object.extend(e,{Merge:l,Subtract:i,MapReduce:o,Subset:E,Split:L});basis.namespace("basis.data",J).extend({STATE:{UNDEFINED:"undefined",
READY:"ready",PROCESSING:"processing",ERROR:"error",DEPRECATED:"deprecated"},Subscription:x,Object:t,DataObject:t,KeyObjectMap:B,AbstractDataset:c,Dataset:e,AggregateDataset:l,Collection:E,Grouping:L});basis.namespace("basis.data.dataset").extend({Merge:l,Subtract:i,MapReduce:o,Subset:E,Split:L})})();
(function(y,A){function J(e,i,l,q){i=i.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i);for(var h=x(),k,o=0;o<i.length;o++){if(o%2){k=i[o].split(/\|/);e.getters[k[0]]=l+"childNodes["+q+"]";k=k.length>1?k[1]:k[0]}else k=i[o].length?i[o]:null;if(k!=null){if(w){h.lastChild&&h.appendChild(K.createComment(""));q++}h.appendChild(t(k));q++}}return h}function L(e){return function(i){if(!(i&&i.type=="click"&&i.which==3)){var l=y.dom.event.sender(i),q,h;do if(q=l.getAttributeNode&&l.getAttributeNode(e))break;while(l=
l.parentNode);if(l&&q){do if(h=l.basisObjectId)if((h=F[h])&&h.templateAction){l=q.nodeValue.qw();q=0;for(var k;k=l[q++];)h.templateAction(k,y.dom.event(i));break}while(l=l.parentNode)}}}}function H(e,i,l){i=i.trim();if(!i)return"";for(var q="",h;h=z.exec(i);){var k=h[2],o=h[4]||h[5]||k;if(h[3])e.getters[h[3]]=l+'.getAttributeNode("'+k+'")';if(h=k.match(/^event-([a-z]+)/i)){var a=h[1];if(!C[a]){C[a]=true;h=0;a=y.dom.event.browserEvents(a);for(var d;d=a[h++];)y.dom.event.addGlobalHandler(d,L(k))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(g,n){g=y.dom.event(g);var j=this,b;do if(b=j.basisObjectId)if((b=F[b])&&b.templateAction){j=n.qw();for(var f=0,m;m=j[f++];)b.templateAction(m,y.dom.event(g));break}while(j=j.parentNode)}}q+=k=="class"?o.trim().replace(/^(.)|\s+/g,".$1"):"["+k+(o?"="+o.quote('"'):"")+"]"}return q}function R(e,i){if(!e.stack)e.stack=[];if(!e.source)e.source=e.str;i||(i=".");for(var l=x(),q,h=0,k,o=e.stack;k=G.exec(e.str);){q=RegExp.leftContext;e.str=e.str.substr(q.length+k[0].length);if(q.length){l.appendChild(J(e,
q,i,h));h=l.childNodes.length}if(k[5])if(k[5]==o[o.length-1]){o.pop();return l}else throw"Wrong end tag";if(k[6]){if(k[7])e.getters[k[7]]=i+"childNodes["+h+"]";l.appendChild(K.createComment(k[6]))}else{q=k[1];var a=k[2],d=!!k[4],g=i+"childNodes["+h+"]";k=E.createElement(q+H(e,k[3],g));if(a)e.getters[a]=g;if(!d){o.push(q);k.appendChild(R(e,g+"."))}l.appendChild(k)}h++}e.str.length&&l.appendChild(J(e,e.str,i,h));if(o.length)throw"No end tag for "+o.reverse();return l}function M(e){if(!this.proto){e=
this.source;if(typeof e=="function")this.source=e=e();e=e.trim();e={str:e,getters:{element:".childNodes[0]"}};var i=R(e);e=Object.iterate(e.getters,function(o,a){for(var d=o.split(/\|/).map(String.format,"obj_.{0}"),g=a.split(/(\.?childNodes\[(\d+)\])/),n=i,j=0;j<g.length;j+=3){var b=g[j+2];if(!b)break;g[j+2]="";n=n.childNodes[b];if(n.previousSibling)n.nextSibling||(g[j+1]=".lastChild");else g[j+1]=".firstChild"}return{name:d[0],alias:d.join("="),path:"dom_"+g.join("")}}).sortAsObject("path");for(var l=
0;l<e.length;l++)for(var q=new RegExp("^"+e[l].path.forRegExp()),h=l+1,k;k=e[h++];)k.path=k.path.replace(q,e[l].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(o,a){obj_=o||{};dom_=proto_.cloneNode(true);_code_();if(a&&obj_.element){var d=obj_.element.basisObjectId=map_.seed++;map_[d]=a}return obj_}.toString().replace("_code_()",e.map(String.format,"{alias}={path};\n").join(""))))(i,F);this.clearInstance=(new Function("map_","var obj_; return "+function(o){obj_=
o;(o=obj_.element&&obj_.element.basisObjectId)&&delete map_[o];_code_()}.toString().replace("_code_()",e.map(String.format,"{alias}=null;\n").join(""))))(F)}}var K=A.document,E=y.dom,I=y.Class,C={},F={seed:1},G=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,z=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;E.createFragment();var w=E.createElement("","a","b").cloneNode(true).childNodes.length==
1,x=E.createFragment,t=E.createText,B=I(null,{__extend__:function(e){return e instanceof B?e:new B(e)},init:function(e){this.source=e},createInstance:function(e,i){M.call(this);return this.createInstance(e,i)},clearInstance:function(){M.call(this)}}),c=K.createElement("DIV");return y.namespace("basis.html").extend({Template:B,escape:function(e){return E.createElement("DIV",E.createText(e)).innerHTML},unescape:function(e){c.innerHTML=e;return c.firstChild.nodeValue},string2Html:function(e){c.innerHTML=
e;return E.createFragment.apply(null,Array.from(c.childNodes))}})})(basis,this);
(function(y){function A(b){return b.sortingValue||0}function J(b,f){b=b.sortingValue||0;f=f.sortingValue||0;return+(b>f)||-(b<f)}function L(b,f){b=b.sortingValue||0;f=f.sortingValue||0;return-(b>f)||+(b<f)}function H(b){return b.childNodes.sort(b.localSortingDesc?L:J)}function R(b,f){b.childNodes=f;b.firstChild=f[0]||null;b.lastChild=f[f.length-1]||null;for(var m=f.length-1;m>=0;m--){f[m].nextSibling=f[m+1]||null;f[m].previousSibling=f[m-1]||null;b.insertBefore(f[m],f[m].nextSibling)}}function M(b,
f){var m=b.childFactory||b.document&&b.document.childFactory,p;f=Object.extend({document:b.document,contextSelection:b.selection||b.contextSelection},f);if(m){p=m.call(b,f);if(p instanceof b.childClass)return p}if(!p)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(b.childClass&&b.childClass.className)+" but "+(p&&p.constructor&&p.constructor.className)+")";}function K(){return y.ui.apply(this,arguments)}var E=y.Class,I=y.dom,C=y.data,F=
C.Subscription,G=C.DataObject,z=C.AbstractDataset,w=C.Dataset,x=I.AXIS_DESCENDANT,t=I.AXIS_DESCENDANT_OR_SELF,B=Function.getter,c=Object.complete,e=I.axis;C=y.EventObject.createEvent;var i=y.EventObject.event;F.regType("DATASOURCE",{dataSourceChanged:function(b,f){this.remove(b,f);this.add(b,b.dataSource)}},function(b,f){b(f,f.dataSource)});var l=E.ExtensibleProperty(),q={ownerChanged:function(){},destroy:function(b){I.replace(b.element,this)}},h=function(){var b=this.key,f=this.config,m=this.owner,
p=typeof f.existsIf!="function"||f.existsIf(m),s=m.satellite[b];if(p){p="delegate"in f;var O="dataSource"in f,N=typeof f.delegate=="function"?f.delegate(m):null,U=typeof f.dataSource=="function"?f.dataSource(m):null;if(s){p&&s.setDelegate(N);O&&s.setDataSource(U)}else{var r=m.tmpl[f.replace||b];s={owner:m};if(p)s.delegate=N;if(O)s.dataSource=U;if(f.config)Object.complete(s,typeof f.config=="function"?f.config(m):f.config);s=new f.instanceOf(s);m.satellite[b]=s;if(r&&s instanceof y.ui.Node&&s.element){I.replace(r,
s.element);s.addHandler(q,r)}}}else if(s){s.destroy();s.owner=null;delete m.satellite[b]}},k=E.CustomExtendProperty({update:true},function(b,f){for(var m in f)b[m]=f[m]?h:null}),o=E(G,{event_update:function(b,f){G.prototype.event_update.call(this,b,f);var m=this.parentNode;if(m){if(m.matchFunction){this.match();this.match(m.matchFunction)}m.insertBefore(this,this.nextSibling)}},event_childNodesModified:C("childNodesModified","node","delta"),event_dataSourceChanged:C("dataSourceChanged","node","oldDataSource"),
event_localGroupingChanged:C("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:C("localSortingChanged","node"),event_ownerChanged:C("ownerChanged","node","oldOwner"),event_satellitesChanged:C("satellitesChanged","node","delta"),subscribeTo:G.prototype.subscribeTo+F.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegateParent:false,nodeType:"DOMWrapperNode",canHaveChildren:false,childNodes:null,dataSource:null,colMap_:null,destroyDataSourceMember:true,
document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:false,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:l,satellite:null,owner:null,init:function(b){var f=this.dataSource,m=this.childNodes,p=this.localGrouping;if(f)this.dataSource=null;G.prototype.init.call(this,b);if(p){this.localGrouping=null;this.setLocalGrouping(p)}if(this.canHaveChildren){this.childNodes=[];if(f){this.dataSource=null;
this.setDataSource(f)}else m&&this.setChildNodes(m)}else{if(m)this.childNodes=null;if(f)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==l)for(var s in this.satelliteConfig){b=this.satelliteConfig[s];if(E.isClass(b))b={instanceOf:b};if(typeof b=="object"){f={key:s,owner:this,config:b};b=b.hook?k.__extend__(b.hook):k;for(s in b)if(b[s]===h){this.addHandler(b,f);break}h.call(f)}}if(s=this.owner){this.owner=null;this.setOwner(s)}},appendChild:function(){},insertBefore:function(){},
removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(b){if(!b||b instanceof o==false)b=null;if(this.owner!==b){var f=this.owner;f&&f.removeHandler(this.listen.owner,this);if(this.owner=b)b.addHandler(this.listen.owner,this);this.event_ownerChanged(this,f)}},destroy:function(){G.prototype.destroy.call(this);
if(this.dataSource)this.setDataSource();else this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping){this.localGrouping.destroy();this.localGrouping=null}this.owner&&this.setOwner();if(this.satellite){for(var b in this.satellite){var f=this.satellite[b];f.destroy();f.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=this.document=null}}),a=E(o,{autoDestroyIfEmpty:false,
nodes:null,first:null,last:null,init:function(b){this.nodes=[];o.prototype.init.call(this,b)},insert:function(b,f){var m=this.nodes,p=f?m.indexOf(f):m.length;if(p==-1)p=m.length;m.splice(p,0,b);this.first=m[0]||null;this.last=m[m.length-1]||null;b.groupNode=this;this.event_childNodesModified(this,{inserted:[b]})},remove:function(b){var f=this.nodes;if(f.remove(b)){this.first=f[0]||null;this.last=f[f.length-1]||null;b.groupNode=null;this.event_childNodesModified(this,{deleted:[b]})}!this.first&&this.autoDestroyIfEmpty&&
this.destroy()},clear:function(){if(this.first){for(var b=this.nodes,f=b.length;f-- >0;)b[f].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:b});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){o.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),d={canHaveChildren:true,childClass:o,childFactory:null,listen:{dataSource:{datasetChanged:function(b,f){var m={},p=[];if(f.deleted){m.deleted=p;if(this.childNodes.length==f.deleted.length){p.push.apply(p,
this.childNodes);var s=this.dataSource;this.dataSource=null;this.clear(true);this.dataSource=s;this.colMap_={}}else{s=0;for(var O;O=f.deleted[s];s++){O=O.eventObjectId;var N=this.colMap_[O];delete this.colMap_[O];N.canHaveDelegate=true;this.removeChild(N);p.push(N)}}}if(f.inserted){m.inserted=[];for(s=0;O=f.inserted[s];s++){N=M(this,{cascadeDestroy:false,delegate:O});N.canHaveDelegate=false;this.colMap_[O.eventObjectId]=N;m.inserted.push(N);this.firstChild&&this.insertBefore(N)}}this.firstChild?this.event_childNodesModified(this,
m):this.setChildNodes(m.inserted);if(this.destroyDataSourceMember&&p.length)for(s=0;O=p[s];s++)O.destroy()},destroy:function(b){this.dataSource===b&&this.setDataSource()}}},appendChild:function(b){return this.insertBefore(b)},insertBefore:function(b,f){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(b.firstChild){var m=this;do if(m==b)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";while(m=m.parentNode)}if(this.dataSource&&
!this.dataSource.has(b.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(b instanceof this.childClass==false)b=M(this,b instanceof G?{delegate:b}:b);var p=b.parentNode===this,s=b.groupNode,O=this.localGrouping;m=this.localSorting;var N=this.childNodes,U=null,r=-1;if(O){U=O.getGroupNode(b);O=U.nodes;if(p&&b.nextSibling===f&&s===U)return b;if(m){m=m(b)||0;r=O.binarySearchPos(m,A,this.localSortingDesc);b.sortingValue=m}else r=f&&f.groupNode===U?
O.indexOf(f):O.length;if(r<O.length)f=O[r];else if(U.last)f=U.last.nextSibling;else{m=U;for(f=null;m=m.nextSibling;)if(f=m.first)break}if(b===f||p&&b.nextSibling===f){if(s!==U){s&&s.remove(b);U.insert(b)}return b}r=-1}else if(m){r=this.localSortingDesc;O=b.nextSibling;var u=b.previousSibling;m=m(b)||0;if(p){if(m===b.localSorting)return b;if((!O||(r?O.sortingValue<=m:O.sortingValue>=m))&&(!u||(r?u.sortingValue>=m:u.sortingValue<=m))){b.sortingValue=m;return b}}r=N.binarySearchPos(m,A,r);f=N[r];b.sortingValue=
m;if(b===f||p&&O===f)return b}else{if(f&&f.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(p){if(b.nextSibling===f)return b;if(b===f)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}if(p){if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;b.previousSibling=null;b.nextSibling=null;if(r==-1)N.remove(b);
else{m=N.indexOf(b);N.splice(m,1);m<r&&r--}s&&s.remove(b)}else b.parentNode&&b.parentNode.removeChild(b);s!=U&&U.insert(b,f);if(f){if(r==-1)r=N.indexOf(f);if(r==-1)throw"basis.dom.wrapper: Node was not found";b.nextSibling=f;N.splice(r,0,b)}else{r=N.length;N.push(b);f={previousSibling:this.lastChild};this.lastChild=b}b.parentNode=this;b.previousSibling=f.previousSibling;if(r==0)this.firstChild=b;else f.previousSibling.nextSibling=b;f.previousSibling=b;var v=false,S=false,V=this.selection||this.contextSelection;
if(!b.document&&b.document!==this.document){v=this.document;b.document=this.document}if(!b.contextSelection&&b.contextSelection!==V){b.contextSelection=V;S=!b.selection;b.selected&&V.add([b])}if(b.firstChild&&(v||S))e(b,x).forEach(function(Z){if(v&&!Z.document)Z.document=v;if(S&&!Z.contextSelection){Z.selected&&Z.unselect();Z.contextSelection=V}});if(!p){b.match&&b.match(this.matchFunction);b.autoDelegateParent&&b.setDelegate(this);this.dataSource||this.event_childNodesModified(this,{inserted:[b]})}return b},
removeChild:function(b){if(b==null||b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(b instanceof this.childClass==false)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(b))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(b),1);b.parentNode=null;if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;
if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;b.nextSibling=null;b.previousSibling=null;b.document===this.document&&e(b,t).forEach(function(s){if(s.document==this.document)s.document=null},this);if(b.contextSelection){for(var f=b.contextSelection,m=b,p=[];m;){if(m.contextSelection===f){m.selected&&p.push(m);m.contextSelection=null}if(!m.selection&&m.firstChild)m=m.firstChild;else if(m.nextSibling)m=m.nextSibling;else for(;m=m.parentNode;)if(m.nextSibling){m=
m.nextSibling;break}}f.remove(p)}b.groupNode&&b.groupNode.remove(b);this.dataSource||this.event_childNodesModified(this,{deleted:[b]});b.autoDelegateParent&&b.setDelegate();return b},replaceChild:function(b,f){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(f==null||f.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(b,f);return this.removeChild(f)},clear:function(b){if(this.dataSource)this.setDataSource();
else if(this.firstChild){var f=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:f});for(var m=f.length;m-- >0;){var p=f[m];p.parentNode=null;p.groupNode=null;if(b){if(p.selection||p.document)e(p,I.AXIS_DESCENDANT_OR_SELF).forEach(function(s){if(this.selection&&s.selection===this.selection){s.selected&&s.selection.remove([s]);s.selection=null}if(s.document===this.document)s.document=null},this);p.nextSibling=null;p.previousSibling=null;
p.autoDelegateParent&&p.setDelegate()}else p.destroy()}this.localGrouping&&this.localGrouping.clear()}},setChildNodes:function(b,f){this.dataSource||this.clear(!!f);if(b){if("length"in b==false)b=[b];if(b.length){var m=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var p=0,s=b.length;p<s;p++)this.insertBefore(b[p]);this.event_childNodesModified=m;this.event_childNodesModified(this,{inserted:this.childNodes})}}},setDataSource:function(b){if(!b||!this.canHaveChildren||
b instanceof z==false)b=null;if(this.dataSource!==b){var f=this.dataSource;if(f){this.colMap_=this.dataSource=null;f.removeHandler(this.listen.dataSource,this);f.itemCount&&this.clear()}if(b){this.dataSource=b;this.colMap_={};b.addHandler(this.listen.dataSource,this);b.itemCount&&this.listen.dataSource.datasetChanged.call(this,b,{inserted:b.getItems()})}this.event_dataSourceChanged(this,f)}},setLocalGrouping:function(b){if(typeof b=="function"||typeof b=="string")b={groupGetter:B(b)};if(b instanceof
n==false)b=b!=null&&typeof b=="object"?new this.localGroupingClass(Object.complete({},b)):null;if(this.localGrouping!==b){var f=this.localGrouping,m;if(this.localGrouping){if(!b&&this.firstChild){this.localGrouping=null;m=this.localSorting?H(this):this.childNodes;for(var p=m.length;p-- >0;)m[p].groupNode=null;R(this,m)}f.setOwner()}if(b){this.localGrouping=b;b.setOwner(this);if(this.firstChild){m=this.localSorting?H(this):this.childNodes;for(p=0;b=m[p];p++)b.groupNode=this.localGrouping.getGroupNode(b);
m=m;for(p=0;b=m[p];p++)b.groupNode.nodes.push(b);m.length=0;for(p=this.localGrouping.nullGroup;p;p=p.nextSibling){b=p.nodes;p.first=b[0]||null;p.last=b[b.length-1]||null;m.push.apply(m,b);p.event_childNodesModified(p,{inserted:b})}R(this,m)}}this.event_localGroupingChanged(this,f)}},setLocalSorting:function(b,f){if(b)b=B(b);if(this.localSorting!=b||this.localSortingDesc!=!!f){this.localSortingDesc=!!f;this.localSorting=b||null;if(b&&this.firstChild){var m=[],p;for(p=this.firstChild;p;p=p.nextSibling)p.sortingValue=
b(p)||0;if(this.localGrouping)for(var s=this.localGrouping.nullGroup;s;s=s.nextSibling){p=s.nodes=H({childNodes:s.nodes,localSortingDesc:this.localSortingDesc});s.first=p[0]||null;s.last=p[p.length-1]||null;m.push.apply(m,p)}else m=H(this);R(this,m)}this.event_localSortingChanged(this)}},setMatchFunction:function(b){if(this.matchFunction!=b){this.matchFunction=b;for(var f=this.lastChild;f;f=f.previousSibling)f.match(b)}}};F=E(o,{event_enable:C("enable","node"),event_disable:C("disable","node"),event_select:C("select",
"node"),event_unselect:C("unselect","node"),event_match:C("match","node"),event_unmatch:C("unmatch","node"),selectable:true,selected:false,selection:null,contextSelection:null,matchFunction:null,matched:true,disabled:false,init:function(b){if(this.selection&&this.selection instanceof z==false)this.selection=new j(this.selection);o.prototype.init.call(this,b);this.disabled&&this.event_disable(this);if(this.selected){this.selected=false;this.select(true)}},setSelection:function(b){if(this.selection==
b)return false;var f=this.selection;e(this,x,function(m){if(m.contextSelection==f){m.selected&&f&&f.remove([m]);m.contextSelection=b}});this.selection=b;return true},hasOwnSelection:function(){return!!this.selection},select:function(b){var f=this.selected,m=this.contextSelection;if(m)if(b)f?m.remove([this]):m.add([this]);else this.selectable&&m.set([this]);else if(!f&&this.selectable&&!this.isDisabled()){this.selected=true;this.event_select(this)}return this.selected!=f},unselect:function(){var b=
this.selected;if(b){var f=this.contextSelection;if(f)f.remove([this]);else{this.selected=false;this.event_unselect(this)}}return this.selected!=b},enable:function(){if(this.disabled){this.disabled=false;this.event_enable(this)}},disable:function(){if(!this.disabled){this.disabled=true;this.event_disable(this)}},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!I.findAncestor(this,B("disabled"))},match:function(b){if(typeof b!="function")if(this.matched){if(this.underMatch_){this.underMatch_(this,
true);this.underMatch_=null}}else{this.matched=true;this.event_match(this)}else if(b(this)){this.underMatch_=b;if(!this.matched){this.matched=true;this.event_match(this)}}else{this.underMatch_=null;if(this.matched){this.matched=false;this.event_unmatch(this)}}},setMatchFunction:function(){},destroy:function(){if(this.hasOwnSelection()){this.selection.destroy();delete this.selection}this.unselect();o.prototype.destroy.call(this)}});var g=E(F,d,{}),n=E(o,d,{event_childNodesModified:function(b,f){i.childNodesModified.call(this,
b,f);this.nullGroup.nextSibling=this.firstChild;if(f.inserted&&this.dataSource&&this.nullGroup.first)for(var m=this.owner,p=Array.from(this.nullGroup.nodes),s=p.length;s-- >0;)m.insertBefore(p[s],p[s].nextSibling)},event_ownerChanged:function(b,f){f&&f.localGrouping===this&&f.setLocalGrouping(null,true);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);i.ownerChanged.call(this,b,f);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:true,
autoDestroyEmptyGroups:true,titleGetter:B("data.title"),groupGetter:Function.$undef,childClass:a,childFactory:function(b){return new this.childClass(c(b,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups}))},init:function(b){this.map_={};this.nullGroup=new a({autoDestroyIfEmpty:false});o.prototype.init.call(this,b)},getGroupNode:function(b){b=this.groupGetter(b);var f=b instanceof G,m=this.map_[f?b.eventObjectId:b];if(!m&&!this.dataSource)m=this.appendChild(f?
{delegate:b}:{data:{id:b,title:b}});return m||this.nullGroup},insertBefore:function(b,f){b=d.insertBefore.call(this,b,f);if("groupId_"in b==false){b.groupId_=b.delegate?b.delegate.eventObjectId:b.data.id;this.map_[b.groupId_]=b}if(b.first){var m=this.owner,p=m.childNodes,s=b.first,O=b.last,N,U,r;for(N=b;N=N.previousSibling;)if(r=N.last)break;if(!r)r=this.nullGroup.last;for(N=b;N=N.nextSibling;)if(U=N.first)break;if(s.previousSibling!==r||O.nextSibling!==U){if(s.previousSibling)s.previousSibling.nextSibling=
O.nextSibling;if(O.nextSibling)O.nextSibling.previousSibling=s.previousSibling;N=p.splice(p.indexOf(s),b.nodes.length);var u=p.indexOf(U);N.unshift(u!=-1?u:p.length,0);p.splice.apply(p,N);s.previousSibling=r;O.nextSibling=U;if(r)r.nextSibling=s;if(U)U.previousSibling=O;m.firstChild=p[0];m.lastChild=p[p.length-1]}}return b},removeChild:function(b){d.removeChild.call(this,b);delete this.map_[b.groupId_];return b},clear:function(){d.clear.call(this);this.map_={}},destroy:function(){this.setOwner();o.prototype.destroy.call(this);
this.map_=null}});o.prototype.localGroupingClass=n;C=E(z,{autoDestroy:true,sourceNode:null,listen:{sourceNode:{childNodesModified:function(b,f){var m=this.memberMap_,p={},s=0,O=0,N=f.inserted,U=f.deleted;if(N&&N.length)for(p.inserted=N;b=N[s];){m[b.eventObjectId]=b;s++}if(U&&U.length)for(p.deleted=U;b=U[O];){delete m[b.eventObjectId];O++}if(s||O)this.event_datasetChanged(this,p)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:C("sourceNodeChanged")&&
function(b,f){i.sourceNodeChanged.call(this,b,f);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:false,init:function(b,f){z.prototype.init.call(this,f);b&&this.setSourceNode(b)},setSourceNode:function(b){if(b instanceof o==false)b=null;if(b!==this.sourceNode){var f=this.sourceNode;if(f){f.removeHandler(this.listen.sourceNode,this);this.listen.sourceNode.childNodesModified.call(this,f,{deleted:f.childNodes})}if(b){b.addHandler(this.listen.sourceNode,this);this.listen.sourceNode.childNodesModified.call(this,
b,{inserted:b.childNodes})}this.sourceNode=b;this.event_sourceNodeChanged(this,f)}},destroy:function(){this.setSourceNode();z.prototype.destroy.call(this)}});var j=E(w,{multiple:false,event_datasetChanged:function(b,f){w.prototype.event_datasetChanged.call(this,b,f);if(f.inserted)for(var m=0,p;p=f.inserted[m];m++)if(!p.selected){p.selected=true;p.event_select()}if(f.deleted)for(m=0;p=f.deleted[m];m++)if(p.selected){p.selected=false;p.event_unselect()}},add:function(b){if(!this.multiple)if(this.itemCount)return this.set(b);
else b.splice(1);for(var f=[],m=0,p;p=b[m];m++)p.contextSelection==this&&p.selectable&&f.push(p);return w.prototype.add.call(this,f)},set:function(b){for(var f=[],m=0,p;p=b[m];m++)p.contextSelection==this&&p.selectable&&f.push(p);this.multiple||b.splice(1);return w.prototype.set.call(this,f)}});y.namespace("basis.dom.wrapper",K).extend({AbstractNode:o,InteractiveNode:F,Node:g,GroupingNode:n,PartitionNode:a,simpleTemplate:K,ChildNodesDataset:C,Selection:j})})(basis);
(function(y,A){function J(j,b){return R(b,true).getRule(j,true)}function L(j,b){var f=j.match(/^([^{]+)\{(.*)\}\s*$/);if(f){for(var m=f[1].trim().split(/\s*,\s*/),p=0;p<m.length;p++)this.addRule(m[p],f[2]||null,b++);return b-1}}function H(j,b){var f=w.createElement(!j?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:b?"alternate ":"",url:j.quote('"')}));w.tag(null,"HEAD")[0].appendChild(f);f=f.sheet||f.styleSheet;try{if(!f.cssRules)f.cssRules=f.rules}catch(m){}if(!f.insertRule)f.insertRule=
L;if(!f.deleteRule)f.deleteRule=f.removeRule;return f}function R(j,b){j||(j="DefaultGenericStyleSheet");if(!i[j])if(b)i[j]=new h(H());return i[j]}function M(j,b,f,m){m=m||{};b=b.qw();for(var p=0,s;s=b[p];p++)if(typeof q.style[s]!="undefined"){if(f)y.platformFeature["css-"+j]=s;l[j]={key:s,getter:m[s]};return}}function K(j,b){var f=l[j];if(j=f?f.key:j.replace(/^-ms-/,"ms-").camelize())return{key:j,value:f&&f.getter?f.getter(b):b}}function E(j,b,f){if(typeof j.setProperty=="function")return j.setProperty(b,
f);if(b=K(b,f))return j.style[b.key]=b.value}function I(j,b){for(var f in b)E(j,f,b[f]);return j}function C(j,b){return E(j,"display",typeof b=="string"?b:b?"":"none")}function F(j,b){return E(j,"visibility",b?"":"hidden")}function G(j){return g[j]||(g[j]=new RegExp("\\s*\\b"+j+"\\b"))}var z=A.document,w=y.dom,x=y.dom.event,t=y.Class,B=/\s*!important/i,c=String("important"),e=1,i={},l={},q=w.createElement("DIV");M("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(j){return"alpha(opacity:"+
parseInt(j*100)+")"}});M("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);M("float","cssFloat styleFloat");var h=t(null,{styleSheet:null,rules:null,init:function(j){this.styleSheet=j;this.rules=[];this.map_={}},getRule:function(j,b){if(!this.map_[j])if(b){for(var f=this.styleSheet,m=this.rules.length,p=f.insertRule(j+"{}",m),s=m;s<=p;s++)this.rules.push(new k(f.cssRules[s]));this.map_[j]=m!=p?new o(this.rules.splice(m)):this.rules[m]}return this.map_[j]},deleteRule:function(j){var b=
this.map_[j];if(b){b=b.rules||[b];for(var f=0;f<b.length;f++){var m=this.rules.indexOf(b[f]);this.stylesheet.deleteRule(m);this.rules.splice(m,1)}delete this.map_[j]}},destroy:function(){delete this.rules}}),k=t(null,{rule:null,selector:"",init:function(j){if(j){this.rule=j;this.selector=j.selectorText}},setProperty:function(j,b){var f,m=!!B.test(b),p=this.rule.style;if(m||(p.getPropertyPriority?p.getPropertyPriority(j)==c:false)){b=b.replace(B,"");if(f=K(j,b)){var s=f.key;if(p.setProperty){m||p.removeProperty(s);
p.setProperty(s,f.value,m?c:"")}else{f=s+": "+f.value+(m?" !"+c:"")+";";p.cssText=p.cssText.replace(new RegExp(p[s]?s+"\\s*:\\s*"+p[s]+"(\\s*!"+c+")?\\s*;?":"^","i"),f)}}}else E(this.rule,j,b)},setStyle:function(j){Object.iterate(j,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),o=t(null,{rules:null,init:function(j){this.rules=j},destroy:function(){delete this.rules}});["setProperty","setStyle","clear"].forEach(function(j){o.prototype[j]=
function(){for(var b,f=0;b=this.rules[f];f++)b[j].apply(b,arguments)}});var a={};["em","ex","px","%"].forEach(function(j){a[j=="%"?"percent":j]=function(b){return b==0||isNaN(b)?"0":b+j}});var d,g={},n=t(null,{init:function(j){this.element=j},toString:function(){return this.element.className},set:function(j){this.clear();j.qw().forEach(this.add,this)},replace:function(j,b,f){f=f||"";typeof j!="undefined"&&this.remove(f+j);typeof b!="undefined"&&this.add(f+b)},bool:function(j,b){b?this.add(j):this.remove(j)},
clear:function(){this.element.className=""},contains:function(j){return!!this.element.className.match(G(j))},item:function(j){return this.element.className.qw()[j]},add:function(j){this.element.className.match(G(j))||(this.element.className+=" "+j)},remove:function(j){var b=this.element.className;j=b.replace(G(j),"");if(j!=b)this.element.className=j},toggle:function(j){var b=this.contains(j);b?this.remove(j):this.add(j);return!b}});if(A.DOMTokenList&&z.documentElement.classList){t=n.prototype;Object.extend(A.DOMTokenList.prototype,
{set:t.set,replace:t.replace,bool:t.bool,clear:function(){for(var j=this.length;j-- >0;)this.remove(this[j])}});d=function(j){return(typeof j=="string"?w.get(j):j).classList}}else d=function(j){return new n(typeof j=="string"?w.get(j):j)};x.onLoad(function(){d(z.body).bool("opacity-not-support",!y.platformFeature["css-opacity"])});w.extend({setStyleProperty:E,setStyle:I,display:C,show:function(j){return C(j,1)},hide:function(j){return C(j)},visibility:F,visible:function(j){return F(j,1)},invisible:function(j){return F(j)}});
return y.namespace("basis.cssom").extend({setStyleProperty:E,setStyle:I,classList:d,uniqueRule:function(j){var b="genericRule-"+e++;j&&d(j).add(b);j=J("."+b);j.token=b;return j},cssRule:J,getStyleSheet:R,addStyleSheet:H,CssStyleSheetWrapper:h,CssRuleWrapper:k,CssRuleWrapperSet:o}).extend(a)})(basis,this);
(function(){function y(c){if(c instanceof x)return c.set;c=c.nodeType;if(isNaN(c)==false)return c==1?w:"nodeValue"}var A=basis.Class,J=basis.dom,L=basis.Cleaner,H=Function.getter,R=basis.cssom.classList,M=basis.EventObject,K=basis.TimeEventManager,E=M.createEvent,I=basis.data,C=I.DataObject,F=I.STATE,G=A(C,{event_change:E("change"),locked:false,lockValue_:null,extendConstructor_:false,updateCount:0,init:function(c,e,i){C.prototype.init.call(this,{});e&&this.addHandler(e);this.proxy=typeof i=="function"?
i:Function.$self;this.initValue=this.value=this.proxy(c)},set:function(c,e){var i=this.value,l=this.proxy?this.proxy(c):l,q=false;if(l!==i){this.value=l;q=true;this.updateCount+=1}if(!this.locked&&(q||e))this.event_change(l,i);return q},lock:function(){if(!this.locked){this.lockValue_=this.value;this.locked=true}},unlock:function(){if(this.locked){this.locked=false;this.value!==this.lockValue_&&this.event_change(this.value,this.lockValue_)}},update:function(c,e){return this.set(c,e)},reset:function(){this.set(this.initValue)},
destroy:function(){C.prototype.destroy.call(this);delete this.initValue;delete this.proxy;delete this.lockValue_;delete this.value}}),z={destroy:function(c){this.removeLink(c)}},w=function(c){J.insert(J.clear(this),c)},x=A(G,{links_:null,event_change:function(c,e){G.prototype.event_change.call(this,c,e);if(!(!this.links_.length||L.globalDestroy))for(var i=0,l;l=this.links_[i++];)this.power_(l,e)},init:function(c,e,i){G.prototype.init.call(this,c,e,i);this.links_=[];L.add(this)},addLink:function(c,
e,i){if(typeof c!="object"&&c instanceof Object==false)throw new Error("basis.data.property: Link to undefined object ignored");if(e==null)e=y(c);if(typeof i!="function")i=H(Function.$self,i);e={object:c,format:i,field:e,isEventObject:c instanceof M};this.links_.push(e);e.isEventObject&&c.addHandler(z,this);this.power_(e);return c},addLinkShortcut:function(c,e,i){return this.addLink(c,x.shortcut[e],i)},removeLink:function(c,e){if(this.links_!=null){var i=arguments.length<2;if(!i&&e==null)e=y(c);for(var l=
0,q=0,h;h=this.links_[q];q++)if(h.object===c&&(i||e==h.field))h.isEventObject&&h.object.removeHandler(z,this);else this.links_[l++]=h;this.links_.length=l}},clear:function(){for(var c=0,e;e=this.links_[c];c++)e.isEventObject&&e.object.removeHandler(z,this);this.links_.clear()},power_:function(c,e){var i=c.field;if(i!=null){var l=c.format(this.value),q=c.object;if(typeof i=="function")i.call(q,l,arguments.length<2?l:c.format(e));else q[i]=l}},destroy:function(){this.clear();G.prototype.destroy.call(this);
this.links_=null;L.remove(this)}});x.shortcut={className:function(c,e){R(this).replace(e,c)},show:function(c){J.display(this,!!c)},hide:function(c){J.display(this,!c)},disable:function(c){this.disabled=!!c},enable:function(c){this.disabled=!c}};var t=[F.READY,F.DEPRECATED,F.UNDEFINED,F.ERROR,F.PROCESSING],B={stateChanged:function(){this.fire(false,true)},update:function(){this.fire(true)},change:function(){this.fire(true)},destroy:function(c){this.remove(c)}};A=A(x,{calculateValue:function(){return this.value+
1},objects:[],timer_:null,valueChanged_:false,stateChanged_:true,state:F.UNDEFINED,extendConstructor_:true,init:function(){var c=this.handler;delete this.handler;x.prototype.init.call(this,this.value||0,c,this.proxy);if(this.objects.length){c=this.objects;this.objects=[];this.lock();this.add.apply(this,c);this.unlock()}else this.objects=[];this.valueChanged_=this.stateChanged_=!!this.calculateOnInit;this.update();L.add(this)},add:function(){for(var c=0,e=arguments.length;c<e;c++){var i=arguments[c];
if(i instanceof C)this.objects.add(i)&&i.addHandler(B,this);else throw new Error("basis.data.property: Instance of DataObject required");}this.fire(true,true)},remove:function(c){this.objects.remove(c)&&c.removeHandler(B,this);this.fire(true,true)},clear:function(){for(var c=0,e;e=this.objects[c];c++)e.removeHandler(B,this);this.objects.clear();this.fire(true,true)},fire:function(c,e){if(!this.locked){this.valueChanged_=this.valueChanged_||!!c;this.stateChanged_=this.stateChanged_||!!e;if(!this.timer_&&
(this.valueChanged_||this.stateChanged_)){this.timer_=true;K.add(this,"update",Date.now())}}},lock:function(){this.locked=true},unlock:function(){this.locked=false},update:function(){delete this.timer_;K.remove(this,"update");if(!L.globalDestroy){this.valueChanged_&&this.set(this.calculateValue());if(this.stateChanged_){var c=this.objects.length;if(c){for(var e=-2,i,l=0;l<c;l++){var q=this.objects[l],h=t.indexOf(String(q.state));if(h>e){i=q;e=h}}i&&this.setState(i.state,i.state.data)}else this.setState(F.UNDEFINED)}}this.stateChanged_=
this.valueChanged_=false},destroy:function(){this.lock();this.clear();K.remove(this,"update");x.prototype.destroy.call(this)}});basis.namespace("basis.data.property").extend({DataObjectSet:A,AbstractProperty:G,Property:x,PropertySet:A})})();
(function(y){function A(h,k){if(!h.length)return 0;var o,a,d=0,g=h.length-1;do{o=d+g>>1;a=h[o]||0;if(k<a)g=o-1;else if(k>a)d=o+1;else return k==a?o:0}while(d<=g);return o+(a<k)}function J(h,k){if(!h.length)return 0;var o,a,d,g=0,n=h.length-1;do{o=g+n>>1;d=h[o].value||0;if(d===a){d=h[o].object.eventObjectId;a=k.object.eventObjectId}else a=k.value||0;if(a<d)n=o-1;else if(a>d)g=o+1;else return a==d?o:0}while(g<=n);return o+(d<a)}function L(){for(var h=Object.slice(this.item_),k=this.index_.slice(this.offset,
this.offset+this.limit),o=[],a=0,d;d=k[a];a++){var g=d.object.eventObjectId;if(h[g])delete h[g];else o.push(d.object)}if(h=getDelta(o,values(h)))AggregateDataset.prototype.event_datasetChanged.call(this,this,h)}function H(h,k){h=Function.getter(h);var o=k+"_"+h.getterIdx_,a=w[o];if(!a){a=w[o]=this;this.indexType=k;this.indexClass=z[k];this.getter=h;this.key=o;this.createInstance=function(d){if(d instanceof F){var g=d.indexes&&d.indexes[this.key];if(!g){g=new this.indexClass(this.getter);g.addHandler(q,
d);g.key=this.key}return g}}}return a}function R(h,k,o){var a=h.indexCache_;h.lock();if(k)for(var d=0,g;g=k[d++];){var n=h.valueGetter(g);a[g.eventObjectId]=n;h.add(g,n)}if(o)for(d=0;g=o[d++];){h.remove(g,a[g.eventObjectId]);delete a[g.eventObjectId]}h.unlock()}var M=y.Class,K=y.TimeEventManager,E=y.data,I=E.KeyObjectMap,C=E.property.Property,F=E.AbstractDataset,G=E.Dataset.MapReduce;E=M(F,{valueGetter:Function.$true,index_:null,offset:0,limit:10,event_datasetChanged:function(h,k){var o;if(o=k.inserted)for(var a=
0;a<o.length;a++){var d=o[a];d={value:this.valueGetter(d),object:d};var g=J(this.index_,d);this.index_.splice(g,0,d)}if(o=k.deleted)for(a=0;a<o.length;a++){d=o[a];d={value:this.valueGetter(d),object:d};g=J(this.index_,d);this.index_.splice(g,1)}L.call(this)},init:function(h){this.index_=[];AggregateDataset.prototype.init.call(this,h)},setRange:function(h,k){this.offset=h;this.limit=k;L.call(this)}});var z=M(C,{autoDestroy:true,valueGetter:Function.$null,dataSource:null,init:function(h){C.prototype.init.call(this,
this.value||0);this.indexCache_={};this.valueGetter=h},add:function(){},remove:function(){},upd:function(){}});z.Sum=M(z,{add:function(h,k){this.value+=k},remove:function(h,k){this.value-=k},upd:function(h,k,o){this.set(this.value+k-o)}});z.Avg=M(z,{sum_:0,count_:0,add:function(h,k){this.sum_+=k;this.count_+=1;this.value=this.sum_/this.count_},remove:function(h,k){this.sum_-=k;this.count_-=1;this.value=this.count_?this.sum_/this.count_:0},upd:function(h,k,o){this.sum_+=k-o;this.set(this.sum_/this.count_)}});
z.Count=M(z,{valueGetter:Function.$true,add:function(h,k){if(k)this.value+=1},remove:function(h,k){if(k)this.value-=1},upd:function(h,k){this.set(this.value+(k?1:-1))}});z.Max=M(z,{init:function(h,k){this.stack=[];z.prototype.init.call(this,h,k)},add:function(h,k){this.stack.splice(A(this.stack,k),0,k);this.value=this.stack[this.stack.length-1]},remove:function(h,k){this.stack.remove(k);this.value=this.stack[this.stack.length-1]},upd:function(h,k,o){this.stack.splice(A(this.stack,o),1);this.stack.splice(A(this.stack,
k),0,k);this.set(this.stack[this.stack.length-1])}});z.Min=M(z,{init:function(h,k){this.stack=[];z.prototype.init.call(this,h,k)},add:function(h,k){this.stack.splice(A(this.stack,k),0,k);this.value=this.stack[0]},remove:function(h,k){this.stack.remove(k);this.value=this.stack[0]},upd:function(h,k,o){this.stack.splice(A(this.stack,o),1);this.stack.splice(A(this.stack,k),0,k);this.set(this.stack[0])}});var w={},x=function(h){return function(k){return new H(k,h)}},t=x("Sum"),B=x("Avg"),c=x("Count"),
e=x("Min");x=x("Max");var i={update:function(h){var k,o,a,d=h.eventObjectId;for(var g in this.indexes){a=this.indexes[g];k=a.indexCache_[d];o=a.valueGetter(h);if(o!==k){a.upd(h,o,k);a.indexCache_[d]=o}}}},l={datasetChanged:function(h,k){if(k.inserted)for(var o=0;h=k.inserted[o++];)h.addHandler(i,this);if(k.deleted)for(o=0;h=k.deleted[o++];)h.removeHandler(i,this);for(var a in this.indexes)R(this.indexes[a],k.inserted,k.deleted)},destroy:function(){for(var h in this.indexes)this.indexes[h].destroy()}},
q={destroy:function(h){this.removeIndex(h)}};F.prototype.createIndex=function(h){if(h instanceof H!=false){if(!this.indexes){this.indexes={};this.addHandler(l);l.datasetChanged.call(this,this,{inserted:this.getItems()})}var k=h.key;if(!this.indexes[k]){h=h.createInstance(this);this.indexes[k]=h;R(h,this.getItems())}return this.indexes[k]}};F.prototype.removeIndex=function(h){if(this.indexes&&this.indexes[h.key]){delete this.indexes[h.key];h.destroy();for(var k in this.indexes)return;this.removeHandler(l);
delete this.indexes}};M=M(G,{calcs:null,indexes:null,indexes_:null,timer_:null,indexUpdated:null,memberSourceMap:null,keyMap:null,event_sourceChanged:function(h,k){G.prototype.event_sourceChanged.call(this,h,k);var o;for(var a in this.indexes_){o=this.indexes_[a];if(k){this.removeIndex(a);k.removeIndex(this.indexes[a])}this.source&&this.addIndex(a,this.source.createIndex(o))}},listen:{sourceObject:{update:function(h,k){G.prototype.listen.sourceObject.update.call(this,h,k);this.stat.sourceObjectUpdate++;
this.sourceMap_[h.eventObjectId].updated=true;this.fireUpdate()}},index:{change:function(h){this.context.indexValues[this.key]=h;this.context.stat.indexUpdate++;this.context.indexUpdated=true;this.context.fireUpdate()}},member:{subscribersChanged:function(h,k){this.stat.subscribersChanged++;if(h.subscriberCount>0&&k==0){this.stat.subscribersChangedSucc++;this.calcMember(h)}}}},map:function(h){return this.keyMap.get(h,true)},addMemberRef:function(h,k){this.memberSourceMap[h.eventObjectId]=k.eventObjectId;
h.addHandler(this.listen.member,this);this.sourceMap_[k.eventObjectId].updated=true;h.subscriberCount>0&&this.calcMember(h)},removeMemberRef:function(h){delete this.memberSourceMap[h.eventObjectId];h.removeHandler(this.listen.member,this)},init:function(h){this.indexUpdated=false;this.indexesBind_={};this.memberSourceMap={};var k=this.indexes;this.indexes={};this.indexes_={};this.calcs=this.calcs||{};this.indexValues={};if(!this.keyMap||this.keyMap instanceof I==false)this.keyMap=new I(Object.complete({create:function(o,
a){return new this.itemClass(a)}},this.keyMap));this.stat={applyCount:0,indexUpdate:0,tryCalcMember:0,tryUpdateMember:0,calcCount:0,updateMember:0,fireUpdate:0,fireUpdateSucc:0,subscribersChanged:0,subscribersChangedSucc:0,update:0,sourceObjectUpdate:0};G.prototype.init.call(this,h);Object.iterate(k,this.addIndex,this)},addIndex:function(h,k){if(!this.indexes[h]){if(k instanceof H)if(this.indexes_[h])return;else{this.indexes_[h]=k;k=this.source&&this.source.createIndex(k)}if(k instanceof z){this.indexValues[h]=
k.value;this.indexes[h]=k;this.indexesBind_[h]={key:h,context:this};k.addHandler(this.listen.index,this.indexesBind_[h]);this.listen.index.change.call(this.indexesBind_[h],k.value)}}},removeIndex:function(h){if(this.indexes_[h]||this.indexes[h]){this.indexes[h]&&this.indexes[h].removeHandler(this.listen.index,this.indexesBind_[h]);delete this.indexValues[h];delete this.indexesBind_[h];delete this.indexes[h];delete this.indexes_[h]}},addCalc:function(h,k){this.calcs[h]=k;this.fireUpdate()},removeCalc:function(){delete this.calcs[name]},
fireUpdate:function(){this.stat.fireUpdate++;if(!this.timer_){this.stat.fireUpdateSucc++;this.timer_=true;K.add(this,"apply",Date.now())}},apply:function(){this.stat.applyCount++;for(var h in this.item_)this.calcMember(this.item_[h]);this.timer_=this.indexUpdated=false},calcMember:function(h){this.stat.tryCalcMember++;var k=this.sourceMap_[this.memberSourceMap[h.eventObjectId]];if(h.subscriberCount&&(k.updated||this.indexUpdated)){this.stat.tryUpdateMember++;k.updated=false;var o={},a,d;for(var g in this.calcs){this.stat.calcCount++;
a=this.calcs[g](k.sourceObject.data,this.indexValues);if(h.data[g]!==a&&(!isNaN(a)||!isNaN(h.data[g]))){o[g]=a;d=true}}if(d){this.stat.updateMember++;h.update(o)}}},getMember:function(h){return this.keyMap.get(h,true)},destroy:function(){this.indexesBind_=this.memberSourceMap=this.indexUpdated=this.calcs=this.timer_=null;this.keyMap.destroy();this.keyMap=null;for(var h in this.indexes)this.removeIndexConstructor(h);G.prototype.destroy.call(this)}});y.namespace("basis.data.index").extend({IndexedDataset:E,
IndexConstructor:H,Index:z,Sum:t,Avg:B,Count:c,Max:x,Min:e,IndexMap:M})})(basis);
(function(y){function A(r){h[r]=h[r]||0;return r+h[r]++}function J(){var r=Array.from(arguments),u=r.pop();typeof u!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var v=[],S=[],V=0,Z;V<r.length;V++){Z=r[V].quote('"');v.push(Z+" in delta");S.push("data["+Z+"]")}u=(new Function("calc","return function(delta, data, oldValue){"+(v.length?"if ("+v.join(" || ")+")":"")+"return calc("+S.join(", ")+");"+(v.length?"return oldValue;":"")+"}"))(u);u.args=r;
u.isCalcField=true;return u}function L(){return J.apply(null,Array.from(arguments).concat(function(){for(var r=[],u=arguments.length;u-- >0;){if(arguments[u]==null)return null;r.push(arguments[u])}return r.join("-")}))}var H=y.Class,R=y.Cleaner,M=Object.extend,K=Function.$self,E=Function.getter,I=y.data,C=y.EventObject,F=I.Dataset,G=I.Collection,z=I.Grouping,w=I.DataObject,x=I.STATE,t={},B={string:1,number:1},c=[],e=function(r){return isNaN(r)?null:Number(r)},i=function(r){return isNaN(r)?null:Number(r)},
l=function(r){return isNaN(r)?null:parseInt(r)},q=function(r){return r==null?null:String(r)},h={},k=y.Class(null,{init:function(r){var u=this.index={};this.normalize=r;this.valueWrapper=function(v,S){var V=r(v,S);if(V!==S&&u[V])return S;return V};this.calcWrapper=function(v,S){var V=r(v,S);if(V!==S&&u[V])throw"Duplicate value for index "+S+" => "+v;return V};R.add(this)},get:function(r,u){var v=this.index[r];if(v&&(!u||v instanceof u))return v},add:function(r,u){var v=this.index[r];if(u&&(!v||v===
u)){this.index[r]=u;return true}},remove:function(r,u){if(this.index[r]===u){delete this.index[r];return true}},destroy:function(){this.index=null}});I=function(r,u){return function(v){return r.prototype[u].call(this,v&&v.map(this.wrapper))}};var o=function(r,u){return function(v){if(!this.name)this.name=A(u);r.prototype.init.call(this,v)}},a=function(r){return function(u,v){F.setAccumulateState(true);u=(u||[]).map(this.wrapper);F.setAccumulateState(false);return r.prototype.sync.call(this,u,v)}},
d=H(F,{wrapper:Function.$self,init:o(F,"EntitySet"),sync:a(F),set:I(F,"set"),add:I(F,"add"),remove:I(F,"remove"),destroy:function(){F.prototype.destroy.call(this);delete this.wrapper}}),g=H(d,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),n=H(G,{init:o(G,"EntityCollection"),sync:a(G)});n.sourceHandler=G.sourceHandler;var j=H(z,{subsetClass:g,init:o(z,"EntityGrouping"),sync:a(z),getSubset:function(r,u){var v=z.prototype.getSubset.call(this,r,u);if(v)v.wrapper=
this.wrapper;return v}}),b=function(r){if(this instanceof b){var u=new f(r||K);return function(v,S){if(v!=null){S instanceof d||(S=u.createEntitySet());S.set(v instanceof F?v.getItems():Array.from(v));return S}else return null}}};b.className="basis.entity.EntitySetWrapper";var f=H(null,{init:function(r){this.wrapper=r},createEntitySet:function(){return new d({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),m=function(r){if(this instanceof m){var u=
function(P,W){if(P!=null){if(P===W||P.entityType===v)return P;var ba,ca=v.idField;if(B[typeof P]){if(!ca)return;ba=P;P={};P[ca]=ba}else if(v.compositeKey)ba=v.compositeKey(P,P);else if(ca)ba=P[ca];else if(Z){W=v.singleton;if(!W)return v.singleton=new V(P)}if(ba!=null&&S)W=S.get(ba,v.entityClass);if(W&&W.entityType===v)W.update(P);else W=new V(P);return W}else return v.singleton},v=new O(r||{},u),S=v.index__,V=v.entityClass,Z=v.isSingleton;M(u,{toString:function(){return this.typeName+"()"},entityType:v,
type:u,typeName:v.name,index:S,reader:function(P){return v.reader(P)},get:function(P){return v.get(P)},addField:function(P,W){v.addField(P,W)},all:v.all,createCollection:function(P,W,ba){var ca=v.collection_[P];if(!ca&&W)return v.collection_[P]=new n({wrapper:u,source:ba||v.all,rule:W});return ca},getCollection:function(P){return v.collection_[P]},createGrouping:function(P,W,ba){var ca=v.grouping_[P];if(!ca&&W)return v.grouping_[P]=new j({wrapper:u,source:ba||v.all,rule:W});return ca},getGrouping:function(P){return v.grouping_[P]},
getSlot:function(P,W){return v.getSlot(P,W)}});return u}};m.className="basis.entity.EntityTypeWrapper";var p=E("singleton"),s={};H(w,{});var O=H(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(r,u){this.name=r.name||A(this.name);this.index__=r.index;this.idFields={};c.push(this);this.isSingleton=r.isSingleton;this.wrapper=u;this.all=new g(Object.extend(r.all||{},{wrapper:u}));this.slot_={};if(r.extensible)this.extensible=true;this.fields=
{};this.defaults={};this.aliases={};this.getters={};Object.iterate(r.fields,this.addField,this);r.constrains&&r.constrains.forEach(function(S){this.addCalcField(null,S)},this);if(this.isSingleton)this.get=p;r.aliases&&Object.iterate(r.aliases,this.addAlias,this);this.collection_={};if(r.collections)for(var v in r.collections)this.collection_[v]=new n({name:v,wrapper:u,source:this.all,rule:r.collections[v]||Function.$true});this.grouping_={};if(r.groupings)for(v in r.groupings)this.grouping_[v]=new j({name:v,
wrapper:u,source:this.all,rule:r.groupings[v]||Function.$true});this.entityClass=U(this,this.all,this.index__,this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:u,typeName:this.name,getId:function(){return this.__id__}})},reader:function(r){var u={};if(B[typeof r]){if(this.idField){u[this.idField]=r;return u}return null}if(!r||r==null)return null;for(var v in r){var S=v in this.aliases?this.aliases[v]:"";if(S&&S in this.fields)u[S]=this.fields[S].reader?this.fields[S].reader(r[v]):
r[v]}return u},addAlias:function(r,u){if(u in this.fields)if(r in this.aliases==false)this.aliases[r]=u},addField:function(r,u){if(!this.all.itemCount){this.aliases[r]=r;if(typeof u=="function")u={type:u};if("type"in u&&typeof u.type!="function")u.type=K;var v=u.type||K;if([e,i,l,q].has(v))u.id=true;if(u.id){if(!this.index__)this.index__=new k(String);this.idFields[r]=true;if(this.idField||this.compositeKey){this.idField=null;this.compositeKey=L.apply(null,Object.keys(this.idFields))}else this.idField=
r}if(u.calc)this.addCalcField(r,u.calc,void 0);else this.fields[r]=v;this.defaults[r]="defValue"in u?u.defValue:v();this.getters["get_"+r]=function(){return this.data[r]};s[r]||(s[r]={destroy:function(){this.set(r,null)}})}},addCalcField:function(r,u,v){if(!(r&&this.fields[r])){if(!this.calcs)this.calcs=[];for(var S={args:u.args,wrapper:!v?u:function(W,ba,ca){return v(u(W,ba,ca))}},V=this.calcs.length,Z=0,P=0;P<this.calcs.length;P++)if(u.args.has(this.calcs[P].key))Z=P+1;if(r){S.key=r;for(P=0;P<this.calcs.length;P++)if(this.calcs[P].args.has(r)){V=
P;break}if(Z>V)return;if(this.idField&&r==this.idField)this.compositeKey=u;this.fields[r]=function(W,ba){typeof console!="undefined"&&console.log("Calculate fields are readonly");return ba}}else V=Z;this.calcs.splice(Math.min(V,Z),0,S)}},get:function(r){r=this.getId(r);if(r!=null)return this.index__.get(r,this.entityClass)},getId:function(r){if((this.idField||this.compositeKey)&&r!=null){if(B[typeof r])return r;if(r&&r.entityType===this)return r.__id__;if(r instanceof w)r=r.data;return this.compositeKey?
this.compositeKey(r,r):r[this.idField]}},getSlot:function(r){var u=this.getId(r);if(u!=null){var v=this.slot_[u];if(!v){if(B[typeof r]){v={};if(this.idField&&!this.compositeKey)v[this.idField]=r;r=v}v=this.slot_[u]=new w({delegate:this.get(u),data:r})}return v}}}),N=H(w,{init:C.prototype.init,event_rollbackUpdate:C.createEvent("rollbackUpdate")}),U=function(r,u,v,S,V,Z,P){function W(D,Q,Y){var $=false,aa=r.calcs,X=D.__id__,T=D.data;try{if(aa)for(var da=0,fa;fa=aa[da++];){var ea=fa.key;if(ea){var ha=
T[ea];T[ea]=fa.wrapper(Q,T,T[ea]);if(T[ea]!==ha){Q[ea]=ha;$=true}}else fa.wrapper(Q,T)}if(r.compositeKey)D.__id__=r.compositeKey(Q,T,D.__id__);else if(ca&&ca in Q)D.__id__=T[ca];D.__id__!==X&&r.index__.calcWrapper(D.__id__)}catch(ia){D.__id__=X;for(var ga in Q)D.data[ga]=Q[ga];if(Y)for(ga in Y)if(!D.modified)D.modified=Y;$=false}D.__id__!==X&&ba(D,X,D.__id__);return $}function ba(D,Q,Y){if(Q!=null){v.remove(Q,D);S[Q]&&S[Q].setDelegate()}if(Y!=null){v.add(Y,D);S[Y]&&S[Y].setDelegate(D)}}var ca=r.idField;
return H(N,P,{canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(D){N.prototype.init.call(this);this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var Q,Y={};for(var $ in V){if($ in D){Y[$]=Z[$];Q=V[$](D[$])}else Q=Z[$];if(Q&&Q!==this&&Q instanceof C)if(Q.addHandler(s[$],this))this.fieldHandlers_[$]=true;this.data[$]=Q}W(this,Y);u.event_datasetChanged(u,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+
")]"},get:function(D){return this.data[D]},set:function(D,Q,Y,$){var aa=V[D];if(!aa){if(!r.extensible)return;aa=K}var X,T=this.modified;Q=aa(Q,this.data[D]);aa=this.data[D];if(Q!==aa&&(!Q||!aa||Q.constructor!==Date||aa.constructor!==Date||+Q!==+aa))a:{X={};if(D!=ca)if(Y){if(!T)this.modified=T={};if(D in T===false){X.rollback={key:D,value:undefined};T[D]=aa}else if(T[D]===Q){X.rollback={key:D,value:Q};delete T[D];if(!Object.keys(T).length)this.modified=null}}else if(T&&D in T)if(T[D]!==Q){X.rollback=
{key:D,value:T[D]};T[D]=Q;break a}else return false;this.data[D]=Q;if(this.fieldHandlers_[D]){aa.removeHandler(s[D],this);this.fieldHandlers_[D]=false}if(Q&&Q!==this&&Q instanceof C)if(Q.addHandler(s[D],this))this.fieldHandlers_[D]=true;X.key=D;X.value=aa;X.delta={};X.delta[D]=aa}else if(!Y&&T&&D in T){X={rollback:{key:D,value:T[D]}};delete T[D];if(!Object.keys(T).length)this.modified=null}if(!$&&X){Y=X.key;D=X.delta||{};var da;if(X.rollback){da={};da[X.rollback.key]=X.rollback.value}if(W(this,D,
da))Y=true;if(Y){this.event_update(this,D);X.delta=D}da&&this.event_rollbackUpdate(this,da)}return X||false},update:function(D,Q){if(D){var Y,$={},aa,X={},T;for(var da in D)if(T=this.set(da,D[da],Q,true)){if(T.key){Y=true;$[T.key]=T.value}if(T.rollback){aa=true;X[T.rollback.key]=T.rollback.value}}if(W(this,$,X))Y=true;Y&&this.event_update(this,$);aa&&this.event_rollbackUpdate(this,X)}return Y?$:false},reset:function(){this.update(Z)},clear:function(){var D={};for(var Q in this.data)D[Q]=undefined;
return this.update(D)},commit:function(D){if(this.modified){var Q=this.modified;this.modified=null}this.update(D);Q&&this.event_rollbackUpdate(this,Q)},rollback:function(){if(this.state!=x.PROCESSING){if(this.modified){var D=this.modified;this.modified=null;this.update(D);this.event_rollbackUpdate(this,D)}this.setState(x.READY)}},destroy:function(){for(var D in this.fieldHandlers_)this.data[D].removeHandler(s[D],this);this.fieldHandlers_=t;this.__id__&&ba(this,this.__id__,null);w.prototype.destroy.call(this);
u.event_datasetChanged(u,{deleted:[this]});this.data=t;this.modified=null}})};y.namespace("basis.entity").extend({isEntity:function(r){return r&&r instanceof U},NumericId:e,NumberId:i,IntId:l,StringId:q,Index:k,CalculateField:J,EntityType:m,Entity:U,BaseEntity:N,EntitySetType:b,EntitySet:d,ReadOnlyEntitySet:g,Collection:n,Grouping:j})})(basis);
(function(y){var A=y.Class,J=y.dom,L=y.html.Template,H=y.cssom.classList,R=Function.getter,M=y.Cleaner,K=y.dom.wrapper.Node,E=y.dom.wrapper.PartitionNode,I=y.dom.wrapper.GroupingNode,C=A.ExtensibleProperty(),F=function(z){return{template:new L("<div/>"),action:C,cssClassName:null,event_update:function(w,x){z.event_update.call(this,w,x);this.templateUpdate(this.tmpl,"update",x)},event_select:function(w){z.event_select.call(this,w);H(this.tmpl.selected||this.tmpl.content||this.element).add("selected")},
event_unselect:function(w){z.event_unselect.call(this,w);H(this.tmpl.selected||this.tmpl.content||this.element).remove("selected")},event_disable:function(w){z.event_disable.call(this,w);H(this.tmpl.disabled||this.element).add("disabled")},event_enable:function(w){z.event_enable.call(this,w);H(this.tmpl.disabled||this.element).remove("disabled")},event_match:function(w){z.event_match.call(this,w);J.display(this.element,true)},event_unmatch:function(w){z.event_unmatch.call(this,w);J.display(this.element,
false)},init:function(w){this.tmpl={};if(this.template){this.template.createInstance(this.tmpl,this);this.element=this.tmpl.element;if(this.tmpl.childNodesHere){this.tmpl.childNodesElement=this.tmpl.childNodesHere.parentNode;this.tmpl.childNodesElement.insertPoint=this.tmpl.childNodesHere}if(this.content)J.insert(this.tmpl.content||this.element,this.content)}else this.element=this.tmpl.element=J.createElement();this.childNodesElement=this.tmpl.childNodesElement||this.element;z.init.call(this,w);if(this.id)this.element.id=
this.id;if(w=this.cssClassName){if(typeof w=="string")w={element:w};for(var x in w){var t=this.tmpl[x];if(t){t=H(t);for(var B=String(w[x]).qw(),c=0,e;e=B[c++];)t.add(e)}}}this.tmpl&&this.templateUpdate(this.tmpl);this.container&&J.insert(this.container,this.element)},templateAction:function(w,x){var t=this.action[w];t&&t.call(this,x)},templateUpdate:function(){},destroy:function(){var w=this.element;z.destroy.call(this);w&&w.parentNode&&w.parentNode.removeChild(w);this.template&&this.template.clearInstance(this.tmpl,
this);this.childNodesElement=this.tmpl=this.element=null}}};K=A(K,F,{});R=A(E,F,{titleGetter:R("data.title"),templateUpdate:function(z){if(z.titleText)z.titleText.nodeValue=String(this.titleGetter(this))}});F=function(z){return{insertBefore:function(w,x){w=z.insertBefore.call(this,w,x);var t=w.groupNode||this,B=w.nextSibling;t=t.childNodesElement||t.element||this.childNodesElement||this.element;var c=w.element;B=(B&&B.element.parentNode==t?B.element:null)||t.insertPoint||null;if(c.parentNode!==t||
c.nextSibling!==B)t.insertBefore(c,B);return w},removeChild:function(w){z.removeChild.call(this,w);var x=w.element,t=x.parentNode;t&&t.removeChild(x);return w},clear:function(w){if(w)for(var x=this.firstChild;x;){var t=x.element;t.parentNode&&t.parentNode.removeChild(t);x=x.nextSibling}z.clear.call(this,w)},setChildNodes:function(w,x){var t=J.createFragment(),B=this.localGrouping||this,c=B.childNodesElement||B.element;B.childNodesElement=t;z.setChildNodes.call(this,w,x);c.insertBefore(t,c.insertPoint||
null);B.childNodesElement=c}}};E=A(I,F,{childClass:R,event_ownerChanged:function(z,w){var x=this,t=this.owner,B=null;if(t)B=t.tmpl&&t.tmpl.groupsElement||t.childNodesElement||t.element;do x.element=x.childNodesElement=B;while(x=x.localGrouping);I.prototype.event_ownerChanged.call(this,z,w)}});E.prototype.localGroupingClass=E;var G=A(K,F,{childClass:K,childFactory:function(z){return new this.childClass(z)},localGroupingClass:E});A=A(G,{selection:{},init:function(z){this.document=this;G.prototype.init.call(this,
z);M.add(this)},destroy:function(){if(this.selection){this.selection.destroy();this.selection=null}G.prototype.destroy.call(this);M.remove(this)}});F=function(z,w){for(var x=z.match(/\{(this_[^\}]+)\}/g)||[],t=[],B=0;B<x.length;B++){var c=x[B].match(/\{(this_[^\|\}]+)\}/)[1];t.push("this.tmpl."+c+".nodeValue = "+c.replace(/_/g,"."))}return Function("tmpl_","config_","return "+function(e){return Object.extend({template:tmpl_,templateUpdate:function(i,l,q){e.templateUpdate.call(this,i,l,q);_code_()}},
config_)}.toString().replace("_code_()",t.join(";\n")))(new L(z),w)};y.namespace("basis.ui",F).extend({simpleTemplate:F,Node:K,Container:G,PartitionNode:R,GroupingNode:E,Control:A})})(basis);
