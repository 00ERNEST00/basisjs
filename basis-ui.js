/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(l){function p(a,b){for(var c in b)a[c]=b[c];return a}function u(a,b){for(var c in b)!1==c in a&&(a[c]=b[c]);return a}function A(a){return null==a||void 0==a}function v(a){return a}function C(a){var b={};a.names=function(a){return Object.slice(b,"string"==typeof a?a.qw():a)};a.extend=function(a){u(b,a);p(this,a);return this};return a}function B(a,b){for(var c=a.split("."),d=l,g,e,f;c.length;)if(g=c.shift(),e=(e?e+".":"")+g,d[g]||(d[g]=C((!c.length?b:null)||function(){},e),f&&(f.namespaces_[e]=
d[g])),d=d[g],!f&&(f=d,!f.namespaces_))f.namespaces_={};return s[a]=d}p(Object,{extend:p,complete:u,keys:function(a){var b=[],c;for(c in a)b.push(c);return b},values:function(a){var b=[],c;for(c in a)b.push(a[c]);return b},slice:function(a,b){var c={};if(!b)return p(c,a);for(var d=0,g;g=b[d++];)g in a&&(c[g]=a[g]);return c},splice:function(a,b){var c={};if(!b)return p(c,a);for(var d=0,g;g=b[d++];)g in a&&(c[g]=a[g],delete a[g]);return c},iterate:function(a,b,c){var d=[],g;for(g in a)d.push(b.call(c,
g,a[g]));return d},coalesce:function(){for(var a=arguments,b=0;b<a.length;b++)if(null!=a[b])return a[b]}});var x=function(){},r=function(){var a=1,b={},c={};a++;return function(d,g){var e,f;if(!g){if(d.getter)return d.getter;if("function"==typeof d)return d}if("function"!=typeof d)c[d]?e=c[d]:(e=new Function("object","return object != null ? object."+d+" : object"),e.path=d,e.getterIdx_=a++,c[d]=e);else if(e=d,!e.getterIdx_)e.getterIdx_=a++;f=e.getterIdx_;var h=b[f];if(h)if("undefined"==typeof g){if(h.nmg)return h.nmg}else for(f=
0;f<h.length;f++){if(h[f].modificator===g)return h[f].getter}else h=b[f]=[];var m=!0;switch(g&&typeof g){case "string":f=function(f){return g.format(e(f))};break;case "function":f=function(f){return g(e(f))};break;case "object":m=!1;f=function(f){return g[e(f)]};break;default:f=e.path?e:function(f){return e(f)}}if(m&&(h.push({getter:f,modificator:g}),"undefined"==typeof g))h.nmg=f;return f.getter=f}}();p(Function,{$undefined:function(a){return void 0==a},$defined:function(a){return void 0!=a},$isNull:A,
$isNotNull:function(a){return null!=a&&void 0!=a},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:v,$const:function(a){return function(){return a}},$false:function(){return!1},$true:function(){return!0},$null:function(){return null},$undef:x,getter:r,def:function(a,b,c){c=c||A;return function(d){d=a(d);return c(d)?b:d}},wrapper:function(a){return function(b){var c={};c[a]=b;return c}},lazyInit:function(a,b){var c=0,d;return function(){c++||(d=a.apply(b||this,arguments));
return d}},lazyInitAndRun:function(a,b,c){var d=0,g;return function(){d++||(g=a.call(c||this));b.apply(g,arguments);return g}},runOnce:function(a,b){var c=0;return function(){if(!c++)return a.apply(b||this,arguments)}}});u(Function.prototype,{bind:function(a){var b=this,c=Array.from(arguments,1);return c.length?function(){return b.apply(a,c.concat.apply(c,arguments))}:function(){return b.apply(a,arguments)}}});u(Array,{isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)}});
p(Array,{from:function(a,b){if(null!=a){var c=a.length;if("undefined"==typeof c)return[a];b||(b=0);if(0<c-b){for(var d=[],g=0,e=b;e<c;)d[g++]=a[e++];return d}}return[]},create:function(a,b,c){for(var d=[],g="function"==typeof b,e=0;e<a;e++)d[e]=g?b.call(c,e,d):b;return d}});u(Array.prototype,{indexOf:function(a,b){b=parseInt(b)||0;if(0>b)return-1;for(;b<this.length;b++)if(this[b]===a)return b;return-1},lastIndexOf:function(a,b){for(var c=this.length,b=parseInt(b),b=isNaN(b)||b>=c?c-1:(b+c)%c;0<=b;b--)if(this[b]===
a)return b;return-1},forEach:function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)},every:function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0},some:function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1},filter:function(a,b){for(var c=[],d=0,g=this.length;d<g;d++)d in this&&a.call(b,this[d],d,this)&&c.push(this[d]);return c},map:function(a,b){for(var c=[],d=0,g=this.length;d<
g;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c},reduce:function(a,b){var c=this.length,d=arguments.length;if(0==c&&1==d)throw new TypeError;var g,e=0;1<d&&(g=b,e=1);for(d=0;d<c;d++)d in this&&(g=e++?a.call(null,g,this[d],d,this):this[d]);return g}});p(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[0<=a?a:this.length+a]},search:function(a,b,c){Array.lastSearchIndex=
-1;for(var b=Function.getter(b||v),c=parseInt(c)||0,d=this.length;c<d;c++)if(b(this[c])===a)return this[Array.lastSearchIndex=c]},lastSearch:function(a,b,c){Array.lastSearchIndex=-1;for(var b=Function.getter(b||v),d=this.length,c=isNaN(c)||null==c?d:parseInt(c),d=c>d?d:c;0<d--;)if(b(this[d])===a)return this[Array.lastSearchIndex=d]},binarySearchPos:function(a,b,c,d,g,e){if(!this.length)return d?-1:0;var b=Function.getter(b||v),c=!!c,f,g=isNaN(g)?0:g,h=isNaN(e)?this.length-1:e;do if(e=g+h>>1,f=b(this[e]),
c?a>f:a<f)h=e-1;else if(c?a<f:a>f)g=e+1;else return a==f?e:d?-1:0;while(g<=h);return d?-1:e+(f<a^c)},binarySearch:function(a,b){return this.binarySearchPos(a,b,!1,!0)},add:function(a){return-1==this.indexOf(a)&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return-1!=a&&!!this.splice(a,1)},has:function(a){return-1!=this.indexOf(a)},merge:function(a){return this.reduce(p,a||{})},sortAsObject:function(a,b,c){a=Function.getter(a);c=c?-1:1;return this.map(function(b,c){return{i:c,v:a(b)}}).sort(b||
function(a,b){return c*(a.v>b.v||-(a.v<b.v)||(a.i>b.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){if(this!==a)this.length=0,this.push.apply(this,a);return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var w=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);if(2>a.length)a[1]=this.length;return w.apply(this,a)}}var q={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",
nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};u(String,{toLowerCase:function(a){return(""+a).toLowerCase()},toUpperCase:function(a){return(""+a).toUpperCase()},trim:function(a){return(""+a).trim()},trimLeft:function(a){return(""+a).trimLeft()},trimRight:function(a){return(""+a).trimRight()},isEmpty:function(a){return null==a||""==""+a},isNotEmpty:function(a){return null!=a&&""!=""+a}});u(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,
"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});p(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(b){if(a)throw b;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],b=this.length,c=0;c<b;c++)a[c]=this.charAt(c);return a},repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,
"\\$&")},format:function(a){for(var b={},c=0;c<arguments.length;c++)b[c]=arguments[c];"object"==typeof a&&p(b,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(a,c,e,f,h){a=c in b?b[c]:h?"":a;return e&&!isNaN(a)?(a=Number(a),"."==e?a.toFixed(f):a.lead(f)):a})},quote:function(a,b){var a=a||'"',b=b||q[a]||a,c=(1==a.length?a:"")+(1==b.length?b:"");return a+(c?this.replace(RegExp("["+c.forRegExp()+"]","g"),"\\$&"):this)+b},capitalize:function(){return this.charAt(0).toUpperCase()+
this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});String.format=String.prototype.format;if(11!="|||".split(/\|/).length+"|||".split(/(\|)/).length)String.prototype.split=function(a){if(""==a||a&&""==a.source)return this.toArray();var b=[],c=0,d;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));d=a.exec(this);)d[0]=
this.substring(c,d.index),b.push.apply(b,d),c=a.lastIndex;else for(;-1!=(d=this.indexOf(a,c));)b.push(this.substring(c,d)),c=d+a.length;b.push(this.substr(c));return b};if("2"!="12".substr(-1)){var t=String.prototype.substr;String.prototype.substr=function(a,b){return t.call(this,0>a?Math.max(0,this.length+a):a,b)}}p(Number.prototype,{fit:function(a,b){return!isNaN(a)&&this<a?Number(a):!isNaN(b)&&this>b?Number(b):this},between:function(a,b){return!isNaN(this)&&this>=a&&this<=b},quote:function(a,b){return(this+
"").quote(a,b)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return 0>this?-1:+(0<this)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},lead:function(a,b){return(this+"").replace(/\d+/,function(c){return 1<(a-=c.length-1)?Array(a).join(b||0)+c:c})},group:function(a,b){return(this+"").replace(/\d+/,function(c){return c.replace(/\d/g,function(d,g){return!g+(c.length-g)%(a||3)?d:(b||" ")+d})})},format:function(a,b,c,d,g){a=this.toFixed(a);if(b||g)a=
a.replace(/(\d+)(\.?)/,function(a,f,h){return(b?Number(f).group(3,b):f)+(h?g||h:"")});c&&(a=a.replace(/^-?/,"$&"+(c||"")));return a+(d||"")}});u(Date,{now:function(){return+new Date}});1900>(new Date).getYear()&&p(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&100>a?Number(a)+1900:a)}});var s={},z=function(){function a(a,f){for(var h=s[a],m=f?f.split(/\./):[];h&&m.length;)h=h[m.shift()];return h}var b=l.document?l.document.getElementsByTagName("SCRIPT"):
null,c=(b?b[b.length-1].src:module.filename).replace(/[^\/]+$/,""),d={},g;"function"==typeof require?g=function(a){return require(requirePath+a.replace(/\./g,"/"))}:(g=function(b,f){var h=b.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],m=b.substr(h.length?h.length+1:0),y=a(h,m),F=/^basis\./.test(h)?c:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!s[h]||!y)if(/^https?:/.test(F)){if(d[b])throw"Attempt to load namespace, probably cycle require";d[b]=1;var F=F+
(f||"")+b.replace(/\./g,"/")+".js",i=new XMLHttpRequest;i.open("POST",F,!1);i.send(null);if(200==i.status){try{(new Function(i.responseText)).call(l)}catch(I){throw I;}g.sequence.push(b.replace(/\./g,"/")+".js")}else if(404==i.status&&m)z(h);else throw"!";}else throw"Path `"+b+"` can't be resolved";return y||a(h,m)},g.sequence=[]);return g}(),k=function(){function a(a){return"function"==typeof a&&a.basisClass_}var b=Function(),c=1;p(b,{className:"basis.Class",extendConstructor_:!1,prototype:{constructor:null,
init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=x}},create:function(e){"function"!=typeof e&&(e=b);var f=Function();f.prototype=e.prototype;for(var f={className:e.className+"._SubClass_",basisClass_:!0,superClass_:e,extendConstructor_:!!e.extendConstructor_,__extend__:function(f){return f&&("object"==typeof f||"function"==typeof f&&!a(f))?b.create.call(null,F,f):f},extend:b.extend,subclass:function(){return b.create.apply(null,
[F].concat(Array.from(arguments)))},prototype:new f},h=arguments,m=1;m<h.length;m++)f.extend("function"==typeof h[m]&&!a(h[m])?h[m](e.prototype):h[m]);var y={},F=f.extendConstructor_?function(f,a){this.eventObjectId=c++;var o,m;for(m in f)o=this[m],this[m]=o&&o.__extend__?o.__extend__(f[m]):f[m];this.init(a||y)}:function(){this.eventObjectId=c++;this.init.apply(this,arguments)};f.prototype.constructor=F;p(F,f);return F},extend:function(a){var f=this.prototype;if(a.prototype)a=a.prototype;var h=Object.keys(a);
a.toString!==Object.prototype.toString&&h.add("toString");for(var m=h.length;0<m--;){var b=h[m],c=a[b],i=f[b];"className"==b||"extendConstructor_"==b?this[b]=c:f[b]=i&&i.__extend__?i.__extend__(c):c}return this}});var d=function(a,f){return{__extend__:function(a){var m=Function();m.prototype=this;m=new m;f(m,a);return m}}.__extend__(a)},g=function(a){return d(a,p)};return B("basis.Class",b.create).extend({BaseClass:b,create:b.create,isClass:a,CustomExtendProperty:d,ExtensibleProperty:g,NestedExtProperty:function(a){return d(a,
function(a,b){for(var m in b){var y=a[m];a[m]=y&&y.__extend__?y.__extend__(b[m]):g(b[m])}})}})}(),j=function(){function a(a){var f=c[a];f||(f=c[a]=function(){var f=this.handlers_,m,y;if(f&&f.length)for(var f=b.call(f),c=f.length;0<c--;)m=f[c],y=m.handler[a],"function"==typeof y&&y.apply(m.thisObject,arguments)});return f}var b=Array.prototype.slice,c={},d,g=k(null,{handlers_:null,event_destroy:d=a("destroy","object"),listen:k.NestedExtProperty(),extendConstructor_:!0,init:function(){if(this.handler)(this.handlers_||
(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(a,f){var b=this.handlers_;if(!b)b=this.handlers_=[];f||(f=this);for(var m=b.length,y;0<m--;)if(y=b[m],y.handler===a&&y.thisObject===f)return!1;return!!b.push({handler:a,thisObject:f||this})},removeHandler:function(a,f){var b=this.handlers_;if(b){f||(f=this);for(var m=b.length,y;0<m--;)if(y=b[m],y.handler===a&&y.thisObject===f)return!!b.splice(m,1);return!1}},destroy:function(){if(this.handlers_)d.call(this,
this),this.handlers_=null}});g.createEvent=a;g.event=c;return g}(),n=function(){var a=[];return{add:function(b){null!=b&&a.push(b)},remove:function(b){a.remove(b)}}}();(function(){function a(a){if(b){if(a.source!=l||a.data!=c)return;basis.dom.event.kill(a)}d.length&&(a=d.shift(),delete g[a.key],a.fn())}var b="function"==typeof addEventListener&&"function"==typeof postMessage,c="zeroTimeoutMessage",d=[],g={},e=1;b&&l.addEventListener("message",a,!0);var f=setTimeout;l.setTimeout=function(m,h){var F;
h?F=f.call(l,m,h):(F={key:"z"+e++,fn:"function"==typeof m?m:new Function(m)},g[F.key]=F,d.push(F),b?postMessage(c,"*"):F.timer=f.call(l,a,0),F=F.key);return F};var h=clearTimeout;l.clearTimeout=function(a){if(/z\d+/.test(a)){var f=g[a];f&&(clearTimeout(f.timer),d.remove(f),delete g[a])}else return h.call(l,a)}})();var D=function(){function a(){if(!y)if(e.length){var a=Date.now(),f=Math.max(e[0].eventTime,a);f<h&&(clearTimeout(m),m=setTimeout(c,(h=f)-a))}else m=clearTimeout(m),h=d}function b(m,b){var h=
m.eventObjectId,o=f[b]&&f[b][h];o&&(e.remove(o),delete f[b][h],a())}function c(){var m=Date.now(),m=e.binarySearchPos(m+15,g);y=!0;e.splice(0,m).forEach(function(a){delete f[a.eventName][a.object.eventObjectId];a.callback.call(a.object)});y=!1;h=d;a()}var d=2E12,g=r("eventTime"),e=[],f={},h=d,m=null,y=!1;n.add({destroy:function(){y=!0;clearTimeout(m);e.length=0;f=null}});return{add:function(m,h,y){var o=m.eventObjectId,c=f[h];c||(c=f[h]={});var d=c[o];if(d){if(isNaN(y))return b(m,h);if(d.eventTime==
y)return;e.remove(d);d.eventTime=y}else{if(isNaN(y))return;d=c[o]={eventName:h,object:m,eventTime:y,callback:m[h]}}e.splice(e.binarySearchPos(y,g),0,d);a()},remove:b}}();B("basis").extend({namespace:B,platformFeature:{},EventObject:j,TimeEventManager:D,Cleaner:n,require:z});l.basis.locale={}})(this);
(function(l,p){function u(j){for(var n=1E6,j=(""+j).split("."),k=0,a=0;4>k&&k<j.length;k++,n/=100)a+=j[k]*n;return a}function A(){for(var j=0;j<arguments.length;j++){var n=arguments[j].toLowerCase();if(n in C){if(C[n])return!0}else{var k=n.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(k){C[n]=!1;var a=k[1].toLowerCase(),b=u(k[3]),k=k[4]||"=";if(a=B[a])return C[n]=!b||"="==k&&a==b||"+"==k&&a>=b||"-"==k&&a<b}}}return!1}var v="basis.ua",C={},B={},x=p.navigator&&p.navigator.userAgent,r="unknown",w={MSIE:["Internet Explorer",
"msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},q;for(q in w)if(!("MSIE"==q&&p.opera)&&!("Safari"==q&&x.match(/chrome/i))&&!("AppleWebKit"==q&&x.match(/iphone/i))&&x.match(RegExp(q+".(\\d+(\\.\\d+)*)","i")))for(var t=w[q],s=p.opera&&"function"==
typeof p.opera.version?p.opera.version():RegExp.$1,z=u(s),r=t[0]+" "+s,s=0;s<t.length;s++)B[t[s].toLowerCase()]=z;l.platformFeature.datauri=!1;x="undefined"!=typeof Image?new Image:{};x.onload=function(){l.platformFeature.datauri=!0};x.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";if(A("IE7-"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(k){}v=l.namespace(v);v.toString=function(){return r};return v.extend({testImage:x,prettyName:r,test:A,
is:function(j){return A(j)},Cookies:{set:function(j,k,l,a){document.cookie=j+"="+(null==k?"":escape(k))+";path="+(a||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)+(l?";expires="+(new Date(Date.now()+1E3*l)).toGMTString():"")},get:function(j){return(j=document.cookie.match(RegExp("(^|;)\\s*"+j+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(j[2])},remove:function(j,k){document.cookie=j+"=;expires="+(new Date(0)).toGMTString()+";path="+(k||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)}}})})(basis,
this);
(function(l,p){function u(a,f,b){if(null!=f)return a.insertBefore(c(f)?f:B(f),b||null)}function A(a){return r("",a.cloneNode(!0)).innerHTML}function v(a){return c(a)||a&&a.nodeType?a:"string"==typeof a?s.getElementById(a):null}function C(f,b,h){var i,c=[],h="string"==typeof h?getter(h):h||Function.$true;b&26&&h(f)&&c.push(f);switch(b){case 1:case 2:for(i=f;(i=i[j])&&i!==f.document;)h(i)&&c.push(i);break;case 64:for(i=f[n];i;)h(i)&&c.push(i),i=i[D];break;case 4:case 8:f[n]&&(b=new d(f),b.nodes(h,c));
break;case 128:b=new d(f,h);for(b.cursor_=f[D]||f[j];i=b.next();)c.push(i);break;case 256:for(i=f;i=i[D];)h(i)&&c.push(i);break;case 32:h(f[j])&&c.push(f[j]);break;case 512:b=new d(f,h,d.BACKWARD);for(b.cursor_=f[a]||f[j];i=b.next();)c.push(i);break;case 1024:for(i=f;i=i[a];)h(i)&&c.push(i)}return c}function B(a){return s.createTextNode(null!=a?a:"")}function x(){for(var a=s.createDocumentFragment(),f=arguments.length,b=x.array=[],h=0;h<f;h++)b.push(u(a,arguments[h]));return a}function r(a,b){var c=
void 0!=a&&"string"!=typeof a,i=(c?a.description:a)||"",d="div",o=i.match(/^([a-z0-9\_\-]+)(.*)$/i);o&&(d=o[1],i=o[2]);if(""!=i){for(var E=[],G={},g;o=h.exec(i);){if(o[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+i+"\n\nProblem place:\n> "+i.substr(0,o.index)+"--\>"+i.substr(o.index)+"<--");g=o[1]||o[2]||o[3];o[1]?G.id=g:o[2]?E.push(g):"class"!=g&&(G[g]=o[4]?t(o[5],o[6],o[7]):g)}e&&G.name&&/^(input|textarea|select)$/i.test(d)&&(d="<"+d+" name="+G.name+">")}i=
s.createElement(d);if(G){if(G.style&&f)i.style.cssText=G.style;for(var k in G)i.setAttribute(k,G[k],0)}if(E&&E.length)i.className=E.join(" ");1<arguments.length&&u(i,x.apply(0,Array.from(arguments,1).flatten()));if(c&&(a.css&&l.cssom&&l.cssom.setStyle(i,a.css),l.dom.event))for(var j in a)"function"==typeof a[j]?l.dom.event.addHandler(i,j,a[j],i):a[j]instanceof l.dom.event.Handler&&l.dom.event.addHandler(i,j,a[j].handler,a[j].thisObject);return i}function w(a,f){return a[j]?a[j].replaceChild(f,a):
a}function q(a){if(s.selection){var f=s.selection.createRange();0!=f.compareEndPoints("StartToEnd",f)&&f.collapse(a);return f.getBookmark().charCodeAt(2)-2}}var t=Object.coalesce,s=p.document,z=l.Class,k=s.createElement("div"),j="parentNode",n="firstChild",D="nextSibling",a="previousSibling",b;b="function"==typeof k.compareDocumentPosition?function(a,f){return a.compareDocumentPosition(f)}:function(a,f){return a==f?0:a.document!=f.document?33:a.sourceIndex>f.sourceIndex?2|8*f.contains(childA):4|16*
a.contains(childB)};var c;if("undefined"!=typeof Node){if(c=function(a){return a instanceof Node},!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else c=function(a){return a&&a.ownerDocument===s};var d=z(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,f,b){this.setRoot(a);this.setDirection(b);if("function"==typeof f)this.filter=f},setDirection:function(f){Object.extend(this,f?{a:"lastChild",b:a,c:D,d:n}:{a:n,b:D,c:a,d:"lastChild"})},
setRoot:function(a){this.root_=a||s;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,f){var b;f||(f=[]);for(this.reset();b=this.next(a);)f.push(b);return f},next:function(a){var a=a||this.filter,f=this.cursor_||this.root_;do for(var b=f[this.a];!b;){if(f===this.root_)return this.cursor_=null;(b=f[this.b])||(f=f[j])}while(!a(f=b));return this.cursor_=f},prev:function(a){var a=a||
this.filter,f=this.cursor_,b=this.c,h=this.d;do{var c=f?f[b]:this.root_[h];if(c){for(;c[h];)c=c[h];f=c}else f&&(f=f[j]);if(!f||f===this.root_){f=null;break}}while(!a(f));return this.cursor_=f},destroy:function(){this.cursor_=this.root_=null}});d.BACKWARD=!0;var g="textContent innerText nodeValue".qw(),e=function(){var a=s.createElement("input");a.name="a";return!/name/.test(A(a))}(),f;k.setAttribute("style","color: red");f="red"!==k.style.color;var h=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return l.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:d,outerHTML:A,textContent:function(a){for(var f=0,b;b=g[f++];)if(null!=a[b])return a[b];return C(a,4,function(a){return 3==a.nodeType}).map(getter("nodeValue")).join("")},get:v,tag:function(a,f){a=v(a)||s;return"*"==f&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(f||"*"))},axis:C,findAncestor:function(a,f,b){for(;a&&a!==b;){if(f(a))return a;a=a.parentNode}},createElement:r,createText:B,createFragment:x,insert:function(a,
f,b,h){a=v(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(b){case void 0:case "end":h=null;break;case "begin":h=a[n];break;case "before":break;case "after":h=h[D];break;default:h=Number(b).between(0,a.childNodes.length)?a.childNodes[b]:null}b=!c(a);if(!f||!Array.isArray(f))b=b?f&&a.insertBefore(f,h):u(a,f,h);else if(b)for(var b=[],e=0,o=f.length;e<o;e++)b[e]=a.insertBefore(f[e],h);else a.insertBefore(x.apply(0,f),h),b=x.array;return b},remove:function(a){return a[j]?
a[j].removeChild(a):a},replace:w,swap:function(a,f){if(a===f||b(a,f)&25)return!1;w(a,k);w(f,a);w(k,f);return!0},clone:function(a,f){var b=a.cloneNode(!f);b.attachEvent&&C(b,8).forEach(Event.clearHandlers);return b},clear:function(a){for(a=v(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,f,b){var h=[],b=Function.getter(b||Function.$self),c;for(c in f)for(var o=0;o<a.length;o++){var e=b(a[o]);h[o]=f[c](a[o],o,e)?r(c,e):a[o]}return h},setAttribute:function(a,f,b){null==b?a.removeAttribute(f):
a.setAttribute(f,b)},parentOf:function(a,f){return a.contains(f)},isInside:function(a,f){return a==f||f.contains(a)},focus:function(a,f){try{a=v(a),a.focus(),f&&a.select&&a.select()}catch(b){}},setSelectionRange:function(a,f,b){3>arguments.length&&(b=f);if(a.setSelectionRange)a.setSelectionRange(f,b);else if(a.createTextRange){var h=a.createTextRange();h.collapse(!0);h.moveStart("character",f);h.moveEnd("character",b-f);h.select()}},getSelectionStart:function(a){return"undefined"!=typeof a.selectionStart?
a.selectionStart:q(!0)},getSelectionEnd:function(a){return"undefined"!=typeof a.selectionEnd?a.selectionEnd:q(!1)}})})(basis,this);
(function(l,p){function u(a){return a||p.event}function A(a){return"string"==typeof a?t.get(a):a}function v(a){a=u(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function C(a){a=u(a);a.preventDefault?a.preventDefault():a.returnValue=!1}function B(a){var b=Array.from(j[a.type]);if(b)for(var c=b.length;0<c--;){var d=b[c];d.handler.call(d.thisObject,a)}}function x(a,b,c,d){a=A(a);if(!a)throw Error("Event.addHandler: can't attach event listener to undefined");if("function"!=typeof c)throw Error("Event.addHandler: handler must be a function");
a[z]||(a[z]={});var g={handler:c,thisObject:d},e=a[z],f=e[b];if(f){for(a=0;b=f[a];a++)if(b.handler===c&&b.thisObject===d)return;f.push(g)}else f=e[b]=[g],f.fireEvent=function(a){a=u(a);if(n&&a&&"undefined"==typeof a.returnValue){B(a);if(!0===a.cancelBubble)return;if("undefined"==typeof a.returnValue)a.returnValue=!0}for(var b=0,c;c=f[b++];)c.handler.call(c.thisObject,a)},a.addEventListener?a.addEventListener(b,f.fireEvent,!1):a.attachEvent("on"+b,f.fireEvent)}function r(a,b,c,d){var a=A(a),g=a[z];
if(g&&(g=g[b]))for(var e=0,f;f=g[e];e++)if(f.handler===c&&f.thisObject===d){g.splice(e,1);g.length||w(a,b);break}}function w(a,b){var a=A(a),c=a[z];if(c)if("string"!=typeof b)for(b in c)w(a,b);else{var d=c[b];d&&(a.removeEventListener?a.removeEventListener(b,d.fireEvent,!1):a.detachEvent("on"+b,d.fireEvent),delete c[b])}}var q=p.document,t=l.dom,s=Function.$null,z="__basisEvents",k={mousewheel:["mousewheel","DOMMouseScroll"]},j={},n=!q.addEventListener,D=function(){function a(){b++||setTimeout(function(){for(var a=
0;a<c.length;a++)c[a].callback.call(c[a].thisObject)},10)}var b=!1,c=[];if(l.ua.is("ie7-"))(function(){var b="_"+Date.now();q.write('<script id="'+b+'" defer src="//:"><\/script>');A(b).onreadystatechange=function(){"complete"==this.readyState&&(t.remove(this),a())}})();else if(l.ua.is("safari525-"))var d=setInterval(function(){/loaded|complete/.test(q.readyState)&&(clearInterval(d),a())},15);else x(q,"DOMContentLoaded",a,!1);x(q,"load",a,!1);x(p,"load",a,!1);return function(a,e){b||c.push({callback:a,
thisObject:e})}}();return l.namespace("basis.dom.event",u).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return k[a]||[a]},Handler:function(a,b){this.handler=a;this.thisObject=b},sender:function(a){a=u(a);return a.target||a.srcElement},cancelBubble:v,
cancelDefault:C,kill:function(a,b){(b=A(b))?x(b,a,Event.kill):(C(a),v(a))},key:function(a){a=u(a);return a.keyCode||a.which||0},charCode:function(a){a=u(a);return a.charCode||a.keyCode||0},mouseButton:function(a,b){a=u(a);return"number"==typeof a.which?a.which==b.VALUE:a.button&b.BIT},mouseX:function(a){a=u(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+(q.documentElement.scrollLeft||q.body.scrollLeft)},mouseY:function(a){a=u(a);return a.changedTouches?a.changedTouches[0].pageY:
"pageY"in a?a.pageY:a.clientY+(q.documentElement.scrollTop||q.body.scrollTop)},wheelDelta:function(a){a=u(a);return"wheelDelta"in a?a.wheelDelta/120:"DOMMouseScroll"==a.type?-a.detail/3:0},addGlobalHandler:function(a,b,c){var d=j[a];if(d)for(a=d.length;0<a--;){var g=d[a];if(g.handler===b&&g.thisObject===c)return}else q.addEventListener?q.addEventListener(a,B,!0):x(q,a,s),d=j[a]=[];d.push({handler:b,thisObject:c})},removeGlobalHandler:function(a,b,c){var d=j[a];if(d)for(var g=0,e;e=d[g];g++)if(e.handler===
b&&e.thisObject===c){d.splice(g,1);d.length||(delete j[a],q.removeEventListener?q.removeEventListener(a,B,!0):r(q,a,s));break}},addHandler:x,addHandlers:function(a,b,c){var a=A(a),d;for(d in b)x(a,d,b[d],c)},removeHandler:r,clearHandlers:w,fireEvent:function(a,b){var a=A(a),c=a[z];c&&c[b]&&c[b].fireEvent()},onLoad:D,onUnload:function(a,b){x(p,"unload",a,b)}})})(basis,this);
(function(){function l(a,b,c){for(var e=1,d;b;)b&1&&(d=z[e],c&e?(a.addHandler(d.handler,d.context),d.action(d.context.add,a)):(a.removeHandler(d.handler,d.context),d.action(d.context.remove,a))),b>>=1,e<<=1}function p(a,b){var c={},e;if(a&&a.length)e=c.inserted=a;if(b&&b.length)e=c.deleted=b;if(e)return c}function u(a){return Array.isArray(a)?a.map(u):{data:a}}var A=basis.Class,v=basis.EventObject,C=Object.values,B=Function.$self,x=Function.$true,r=Function.$false,w=v.createEvent,q=v.event,t={},s=
[],z={},k=1,j={NONE:0,MASK:0,regType:function(a,b,c){z[k]={handler:b,action:c,context:{add:function(b,h){if(h){var c=j[a]+"_"+b.eventObjectId;if(!h.subscribers_)h.subscribers_={};if(!h.subscribers_[c]){var e=h.subscriberCount;h.subscribers_[c]=b;h.subscriberCount+=1;h.event_subscribersChanged(h,e)}}},remove:function(b,h){if(h){var c=j[a]+"_"+b.eventObjectId;if(h.subscribers_[c]){var e=h.subscriberCount;delete h.subscribers_[c];h.subscriberCount-=1;h.event_subscribersChanged(h,e)}}}}};j[a]=k;j.MASK|=
k;k<<=1}};j.regType("DELEGATE",{delegateChanged:function(a,b){this.remove(a,b);this.add(a,a.delegate)}},function(a,b){a(b,b.delegate)});j.regType("TARGET",{targetChanged:function(a,b){this.remove(a,b);this.add(a,a.target)}},function(a,b){a(b,b.target)});j.regType("SOURCE",{sourceChanged:function(a,b){this.remove(a,b);this.add(a,a.source)},sourcesChanged:function(a,b){var c;if(c=b.inserted)for(var e=c.length;0<e--;)this.add(a,c[e]);if(c=b.deleted)for(e=c.length;0<e--;)this.remove(a,c[e])}},function(a,
b){for(var c=b.sources||[b.source],e=0,d;d=c[e++];)a(b,d)});var n=A(v,{state:"ready",data:null,canHaveDelegate:!0,delegate:null,root:null,cascadeDestroy:!1,isTarget:!1,target:null,active:!1,subscribeTo:j.DELEGATE+j.TARGET,subscriberCount:0,subscribers_:null,event_update:w("update","object","delta"),event_stateChanged:w("stateChanged","object","oldState"),event_delegateChanged:w("delegateChanged","object","oldDelegate"),event_rootChanged:w("rootChanged","object","oldRoot"),event_targetChanged:w("targetChanged",
"object","oldTarget")&&function(a,b){var c=this.listen.target;c&&(b&&b.removeHandler(c,this),this.target&&this.target.addHandler(c,this));q.targetChanged.call(this,a,b)},event_subscribersChanged:w("subscribersChanged","object"),event_activeChanged:w("activeChanged","object"),listen:{delegate:{update:function(a,b){this.data=a.data;this.event_update(this,b)},stateChanged:function(a,b){this.state=a.state;this.event_stateChanged(this,b)},targetChanged:function(a,b){this.target=a.target;this.event_targetChanged(this,
b)},rootChanged:function(a,b){this.data=a.data;this.event_rootChanged(this,b)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},init:function(a){v.prototype.init.call(this,a);if(a=this.delegate)this.delegate=null,this.data=a.data,this.state=a.state,this.setDelegate(a);else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&l(this,this.subscribeTo,j.MASK)},isConnected:function(a){if(a instanceof n){for(;a&&a!==this&&a!==a.delegate;)a=
a.delegate;return a===this}return!1},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&a&&a instanceof n){if(a.delegate&&this.isConnected(a))return!1}else a=null;if(this.delegate!==a){var b=this.state,c=this.data,e=this.delegate,d=this.target,i=this.root,g={};e&&e.removeHandler(this.listen.delegate,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;a.addHandler(this.listen.delegate,
this);for(var o in a.data)!1===o in c&&(g[o]=void 0);for(o in c)c[o]!==a.data[o]&&(g[o]=c[o])}else for(o in this.target=this.delegate=null,this.root=this,this.data={},c)this.data[o]=c[o];this.event_delegateChanged(this,e);this.root!==i&&this.event_rootChanged(this,i);this.target!==d&&this.event_targetChanged(this,d);if(a){for(o in g){this.event_update(this,g);break}b!==this.state&&(""+b!=this.state||b.data!==this.state.data)&&this.event_stateChanged(this,b)}return!0}return!1},setState:function(a,
b){var c=this.target||this.getRootDelegate();if(c!==this)return c.setState(a,b);return this.state!=""+a||this.state.data!=b?(c=this.state,this.state=Object(""+a),this.state.data=b,this.event_stateChanged(this,c),!0):!1},deprecate:function(){"processing"!=this.state&&this.setState("deprecated")},update:function(a){var b=this.target||this.getRootDelegate();if(b!==this)return b.update(a);if(a){var b={},c=0,e;for(e in a)this.data[e]!==a[e]&&(c++,b[e]=this.data[e],this.data[e]=a[e]);if(c)return this.event_update(this,
b),b}return!1},setActive:function(a){a=!!a;return this.active!=a?(this.active=a,this.event_activeChanged(this),l(this,this.subscribeTo,j.MASK*a),!0):!1},setSubscription:function(a){var a=a&j.MASK,b=this.subscribeTo^a;return b?(this.subscribeTo=a,this.active&&l(this,b,a),!0):!1},destroy:function(){this.active&&l(this,this.subscribeTo,0);this.delegate&&this.setDelegate();v.prototype.destroy.call(this);this.data=t;this.state="undefined";this.target=this.root=null}}),D=A(null,{itemClass:n,keyGetter:B,
map_:null,extendConstructor_:!0,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var b={};a instanceof n?b.delegate=a:b.data={id:a,title:a};return new this.itemClass(b)},get:function(a,b){var c=a instanceof n?a.eventObjectId:a,e=this.map_[c];!e&&b&&(e=this.map_[c]=this.create(a,b),e.addHandler({destroy:function(){delete this.map_[c]}},this));return e},destroy:function(){basis.Cleaner.remove(this);for(var a=C(this.map_),
b=0,c;c=a[b++];)c.destroy()}}),a=A(n,{state:"undefined",itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:w("datasetChanged","dataset","delta")&&function(a,b){var c,e=0,d=0,i;if(c=b.inserted)for(;i=c[e];)this.item_[i.eventObjectId]=i,e++;if(c=b.deleted)for(;i=c[d];)delete this.item_[i.eventObjectId],d++;this.itemCount+=e-d;this.cache_=null;q.datasetChanged.call(this,a,b)},init:function(a){n.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!(!a||
!this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=C(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var b=[];if(a)for(var c in this.item_)if(b.push(this.item_[c])>=a)break;return b},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();n.prototype.destroy.call(this);this.cache_=s;this.itemCount=0;this.item_=this.memberMap_=null}}),
b=A(a,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&this.remove([a])}}},init:function(b){a.prototype.init.call(this,b);if(b=this.items)this.set(b),this.items=null},add:function(a){for(var b,c=this.memberMap_,e=[],d=0;d<a.length;d++){var i=a[d];if(i instanceof n){var g=i.eventObjectId;c[g]||(c[g]=i,i.addHandler(this.listen.item,this),e.push(i))}}e.length&&this.event_datasetChanged(this,b={inserted:e});return b},remove:function(a){for(var b,c=this.memberMap_,e=[],d=0;d<a.length;d++){var i=
a[d];if(i instanceof n){var g=i.eventObjectId;c[g]&&(i.removeHandler(this.listen.item,this),delete c[g],e.push(i))}}e.length&&this.event_datasetChanged(this,b={deleted:e});return b},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var b=this.memberMap_,c={},e=[],d=[],i,g,o,E=0;E<a.length;E++)if(i=a[E],i instanceof n)g=i.eventObjectId,c[g]=i,b[g]||(b[g]=i,i.addHandler(this.listen.item,this),d.push(i));for(g in b)c[g]||(i=b[g],i.removeHandler(this.listen.item,
this),delete b[g],e.push(i));(o=p(d,e))&&this.event_datasetChanged(this,o);return o},sync:function(a,c){if(a){b.setAccumulateState(!0);for(var e=this.memberMap_,d,g,i={},I=[],o,E=0;E<a.length;E++)if(d=a[E],d instanceof n)g=d.eventObjectId,i[g]=d,e[g]||I.push(d);for(g in this.item_)i[g]||this.item_[g].destroy();c&&I.length&&(o=this.add(I));b.setAccumulateState(!1);return o}},clear:function(){var a,b=this.getItems();if(b.length){for(a=b.length;0<a--;)b[a].removeHandler(this.listen.item,this);this.event_datasetChanged(this,
a={deleted:b});this.memberMap_={}}return a}});b.setAccumulateState=function(){function b(a){var f=a.dataset;g.call(f,f,a)}function c(a,e){var h=a.eventObjectId,i=e.inserted,d=e.deleted,m=o[h];if(i&&d)return m&&(delete o[h],b(m)),g.call(a,a,e);if(m){var y=m[i?"inserted":"deleted"];if(y)return y.push.apply(y,i||d);b(m)}o[h]=e;e.dataset=a}function e(){i=1;setAccumulateState(!1)}var d=a.prototype,g=d.event_datasetChanged,i=0,I,o={};return function(a){if(a){if(0==i)d.event_datasetChanged=c,I=setTimeout(e,
0);i++}else if(i-=0<i,0==i)clearTimeout(I),d.event_datasetChanged=g,a=o,o={},C(a).forEach(b)}}();var c=A(a,{subscribeTo:j.SOURCE,event_sourcesChanged:w("sourcesChanged","dataset","delta"),sources:null,rule:function(a){return 0<a},listen:{source:{datasetChanged:function(a,b){var c=this.memberMap_,e={},d,i;if(b.inserted)for(var g=0;d=b.inserted[g];g++)i=d.eventObjectId,c[i]?c[i].count++:c[i]={count:1,object:d},e[i]=c[i];if(b.deleted)for(g=0;d=b.deleted[g];g++)i=d.eventObjectId,e[i]=c[i],c[i].count--;
this.applyRule(e)},destroy:function(a){this.removeSource(a)}}},init:function(b){a.prototype.init.call(this,b);b=this.sources;this.sources=[];b&&b.forEach(this.addSource,this)},setRule:function(a){if("function"!=typeof a)a=c.UNION;if(this.rule!==a)this.rule=a,this.applyRule()},applyRule:function(a){var b=this.memberMap_,c=this.rule,e=this.sources.length,d=[],i=[],g,o,E;a||(a=b);for(var G in a)g=b[G],o=e&&g.count&&c(g.count,e),o!=!!this.item_[G]&&(o?d:i).push(g.object),0==g.count&&delete b[G];(E=p(d,
i))&&this.event_datasetChanged(this,E)},addSource:function(b){if(b instanceof a&&this.sources.add(b)){b.addHandler(this.listen.source,this);var c=this.memberMap_,e;for(e in b.item_)c[e]?c[e].count++:c[e]={count:1,object:b.item_[e]};this.applyRule();this.event_sourcesChanged(this,{inserted:[b]});return!0}},removeSource:function(a){if(this.sources.remove(a)){a.removeHandler(this.listen.source,this);var b=this.memberMap_,c;for(c in a.item_)b[c].count--;this.applyRule();this.event_sourcesChanged(this,
{deleted:[a]});return!0}},setSources:function(b){for(var c=Array.from(this.sources),e=0,d;d=b[e];e++)d instanceof a&&(c.remove(d)||this.addSource(d));c.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){a.prototype.destroy.call(this);this.sources=null}});c.UNION=c.prototype.rule;c.INTERSECTION=function(a,b){return a==b};c.DIFFERENCE=function(a){return 1==a};c.MORE_THAN_ONE_INCLUDE=function(a,b){return 1==b||1<a};c.AT_LEAST_ONE_EXCLUDE=
function(a,b){return 1==b||a<b};var d=function(a){return!this.has(a)},g=A(a,{minuend:null,subtrahend:null,listen:{minuend:{datasetChanged:function(a,b){if(this.subtrahend){var c=p(b.inserted&&b.inserted.filter(d,this.subtrahend),b.deleted&&b.deleted.filter(this.has,this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(a,b){if(this.minuend){var c=p(b.deleted&&b.deleted.filter(d,this),b.inserted&&b.inserted.filter(this.has,
this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(b){a.prototype.init.call(this,b);var b=this.minuend,c=this.subtrahend;this.subtrahend=this.minuend=null;(b||c)&&this.setOperands(b,c)},setOperands:function(b,c){var e;!1==b instanceof a&&(b=null);!1==c instanceof a&&(c=null);var d=this.minuend,g=this.subtrahend;if(d!==b)d&&d.removeHandler(this.listen.minuend,this),(this.minuend=b)&&b.addHandler(this.listen.minuend,this);if(g!==c)g&&
g.removeHandler(this.listen.subtrahend,this),(this.subtrahend=c)&&c.addHandler(this.listen.subtrahend,this);if(!b||!c)this.itemCount&&this.event_datasetChanged(this,e={deleted:this.getItems()});else{var d=[],g=[],i;for(i in this.item_)(!b.item_[i]||c.item_[i])&&d.push(this.item_[i]);for(i in b.item_)!this.item_[i]&&!c.item_[i]&&g.push(b.item_[i]);(e=p(g,d))&&this.event_datasetChanged(this,e)}return e},clear:function(){this.setOperands()}}),e=A(a,{source:null,event_sourceChanged:w("sourceChanged",
"dataset","oldSource"),map:B,reduce:r,rule:r,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:{update:function(a){var b=this.map?this.map(a):a;if(!1==b instanceof n||this.reduce(b))b=null;var c=this.sourceMap_[a.eventObjectId],e=c.member;if(e!=b){var d=this.memberMap_,i,g,o;c.member=b;if(e)c=e.eventObjectId,this.removeMemberRef&&this.removeMemberRef(e,a),0==--d[c]&&(delete d[c],o=[e]);if(b)e=b.eventObjectId,this.addMemberRef&&this.addMemberRef(b,a),d[e]?d[e]++:(d[e]=1,g=
[b]);(i=p(g,o))&&this.event_datasetChanged(this,i)}}},source:{datasetChanged:function(a,c){var e=this.sourceMap_,d=this.memberMap_,g=[],i=[],j,o,E;b.setAccumulateState(!0);if(c.inserted)for(var G=0;j=c.inserted[G];G++){E=this.map?this.map(j):j;if(!1==E instanceof n||this.reduce(E))E=null;j.addHandler(this.listen.sourceObject,this);e[j.eventObjectId]={sourceObject:j,member:E};if(E)o=E.eventObjectId,d[o]?d[o]++:(d[o]=1,g.push(E)),this.addMemberRef&&this.addMemberRef(E,j)}if(c.deleted)for(G=0;j=c.deleted[G];G++)if(o=
j.eventObjectId,E=e[o].member,j.removeHandler(this.listen.sourceObject,this),delete e[o],E)o=E.eventObjectId,0==--d[o]&&(delete d[o],i.push(E)),this.removeMemberRef&&this.removeMemberRef(E,j);b.setAccumulateState(!1);(c=p(g,i))&&this.event_datasetChanged(this,c)},destroy:function(){this.setSource()}}},init:function(b){a.prototype.init.call(this,b);this.sourceMap_={};if(b=this.source)this.source=null,this.setSource(b)},setRule:function(a){"function"!=typeof a&&(a=x);if(this.rule!==a)return this.rule=
a,this.applyRule()},setMap:function(a){"function"!=typeof a&&(a=B);if(this.map!==a)return this.map=a,this.applyRule()},setSource:function(b){!1==b instanceof a&&(b=null);if(this.source!==b){var c=this.source;c&&(c.removeHandler(this.listen.source,this),this.listen.source.datasetChanged.call(this,c,{deleted:c.getItems()}));if(this.source=b)b.addHandler(this.listen.source,this),this.listen.source.datasetChanged.call(this,b,{inserted:b.getItems()});this.event_sourceChanged(this,c)}},applyRule:function(){var a=
this.sourceMap_,b=this.memberMap_,c,e,d,i,g,o=[],E=[],G,K;for(K in a){g=a[K];i=g.sourceObject;c=g.member;e=this.map?this.map(i):i;if(!1==e instanceof n||this.reduce(e))e=null;if(c!=e){g.member=e;if(c)d=c.eventObjectId,this.removeMemberRef&&this.removeMemberRef(c,i),b[d]--;if(e)c=e.eventObjectId,this.addMemberRef&&this.addMemberRef(e,i),c in b?b[c]++:(b[c]=1,o.push(e))}}for(d in this.item_)0==b[d]&&(delete b[d],E.push(this.item_[d]));(G=p(o,E))&&this.event_datasetChanged(this,G);return G},clear:function(){this.setSource()},
destroy:function(){a.prototype.destroy.call(this);this.sourceMap_=null}}),r=A(e,{reduce:function(a){return!this.rule(a)},rule:x}),A=A(e,{map:function(a){return this.keyMap.resolve(a)},rule:x,subsetClass:a,keyMap:null,addMemberRef:function(a,b){a.event_datasetChanged(a,{inserted:[b]})},removeMemberRef:function(a,b){a.event_datasetChanged(a,{deleted:[b]})},init:function(a){if(!this.keyMap||!1==this.keyMap instanceof D)this.keyMap=new D(Object.extend({keyGetter:this.rule,itemClass:this.subsetClass},
this.keyMap));e.prototype.init.call(this,a)},getSubset:function(a,b){return this.keyMap.get(a,b)},destroy:function(){e.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});Object.extend(b,{Merge:c,Subtract:g,MapReduce:e,Subset:r,Split:A});basis.namespace("basis.data",u).extend({STATE:{UNDEFINED:"undefined",READY:"ready",PROCESSING:"processing",ERROR:"error",DEPRECATED:"deprecated"},Subscription:j,Object:n,DataObject:n,KeyObjectMap:D,AbstractDataset:a,Dataset:b,AggregateDataset:c,
Collection:r,Grouping:A});basis.namespace("basis.data.dataset").extend({Merge:c,Subtract:g,MapReduce:e,Subset:r,Split:A})})(basis,this);
(function(l,p){function u(a,c,d,g){for(var c=c.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i),e=j(),f,h=0;h<c.length;h++)h%2?(f=c[h].split(/\|/),a.getters[f[0]]=d+"childNodes["+g+"]",f=1<f.length?f[1]:f[0]):f=c[h].length?c[h]:null,null!=f&&(k&&(e.lastChild&&e.appendChild(x.createComment("")),g++),e.appendChild(n(f)),g++);return e}function A(a){return function(c){if(!c||!("click"==c.type&&3==c.which)){var d=l.dom.event.sender(c),g,e;do if(g=d.getAttributeNode&&d.getAttributeNode(a))break;while(d=d.parentNode);
if(d&&g){do if(e=d.basisObjectId)if((e=t[e])&&e.templateAction){d=g.nodeValue.qw();g=0;for(var f;f=d[g++];)e.templateAction(f,l.dom.event(c));break}while(d=d.parentNode)}}}}function v(a,c,d){c=c.trim();if(!c)return"";for(var g="",e;e=z.exec(c);){var f=e[2],h=e[4]||e[5]||f;e[3]&&(a.getters[e[3]]=d+'.getAttributeNode("'+f+'")');if(e=f.match(/^event-([a-z]+)/i)){var m=e[1];if(!q[m]){q[m]=!0;e=0;for(var m=l.dom.event.browserEvents(m),j;j=m[e++];)l.dom.event.addGlobalHandler(j,A(f))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(a,b){var a=l.dom.event(a),c=this,o;do if(o=c.basisObjectId)if((o=t[o])&&o.templateAction){for(var c=b.qw(),f=0,e;e=c[f++];)o.templateAction(e,l.dom.event(a));break}while(c=c.parentNode)}}g+="class"==f?h.trim().replace(/^(.)|\s+/g,".$1"):"["+f+(h?"="+h.quote('"'):"")+"]"}return g}function C(a,c){if(!a.stack)a.stack=[];if(!a.source)a.source=a.str;c||(c=".");for(var d=j(),g,e=0,f,h=a.stack;f=s.exec(a.str);){g=RegExp.leftContext;a.str=a.str.substr(g.length+f[0].length);if(g.length)d.appendChild(u(a,
g,c,e)),e=d.childNodes.length;if(f[5]){if(f[5]==h[h.length-1])return h.pop(),d;throw"Wrong end tag";}if(f[6])f[7]&&(a.getters[f[7]]=c+"childNodes["+e+"]"),d.appendChild(x.createComment(f[6]));else{g=f[1];var m=f[2],k=!!f[4],n=c+"childNodes["+e+"]";f=r.createElement(g+v(a,f[3],n));m&&(a.getters[m]=n);k||(h.push(g),f.appendChild(C(a,n+".")));d.appendChild(f)}e++}a.str.length&&d.appendChild(u(a,a.str,c,e));if(h.length)throw"No end tag for "+h.reverse();return d}function B(a){if(!this.proto){a=this.source;
if("function"==typeof a)this.source=a=a();for(var a=a.trim(),a={str:a,getters:{element:".childNodes[0]"}},c=C(a),a=Object.iterate(a.getters,function(a,b){for(var f=a.split(/\|/).map(String.format,"obj_.{0}"),e=b.split(/(\.?childNodes\[(\d+)\])/),d=c,g=0;g<e.length;g+=3){var o=e[g+2];if(!o)break;e[g+2]="";d=d.childNodes[o];d.previousSibling?d.nextSibling||(e[g+1]=".lastChild"):e[g+1]=".firstChild"}return{name:f[0],alias:f.join("="),path:"dom_"+e.join("")}}).sortAsObject("path"),d=0;d<a.length;d++)for(var g=
RegExp("^"+a[d].path.forRegExp()),e=d+1,f;f=a[e++];)f.path=f.path.replace(g,a[d].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(a,b){obj_=a||{};dom_=proto_.cloneNode(!0);_code_();if(b&&obj_.element){var c=obj_.element.basisObjectId=map_.seed++;map_[c]=b}return obj_}.toString().replace("_code_()",a.map(String.format,"{alias}={path};\n").join(""))))(c,t);this.clearInstance=(new Function("map_","var obj_; return "+function(a){obj_=a;(a=obj_.element&&obj_.element.basisObjectId)&&
delete map_[a];_code_()}.toString().replace("_code_()",a.map(String.format,"{alias}=null;\n").join(""))))(t)}}var x=p.document,r=l.dom,w=l.Class,q={},t={seed:1},s=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<\!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,z=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;r.createFragment();var k=1==r.createElement("","a","b").cloneNode(!0).childNodes.length,j=r.createFragment,n=
r.createText,D=w(null,{__extend__:function(a){return a instanceof D?a:new D(a)},init:function(a){this.source=a},createInstance:function(a,c){B.call(this);return this.createInstance(a,c)},clearInstance:function(){B.call(this)}}),a=x.createElement("DIV");return l.namespace("basis.html").extend({Template:D,escape:function(a){return r.createElement("DIV",r.createText(a)).innerHTML},unescape:function(b){a.innerHTML=b;return a.firstChild.nodeValue},string2Html:function(b){a.innerHTML=b;return r.createFragment.apply(null,
Array.from(a.childNodes))}})})(basis,this);
(function(l){function p(a){return a.sortingValue||0}function u(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return+(a>b)||-(a<b)}function A(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return-(a>b)||+(a<b)}function v(a){return a.childNodes.sort(a.localSortingDesc?A:u)}function C(a,b){a.childNodes=b;a.firstChild=b[0]||null;a.lastChild=b[b.length-1]||null;for(var c=b.length-1;0<=c;c--)b[c].nextSibling=b[c+1]||null,b[c].previousSibling=b[c-1]||null,a.insertBefore(b[c],b[c].nextSibling)}function B(a,
b){var c=a.childFactory||a.document&&a.document.childFactory,f,b=Object.extend({document:a.document,contextSelection:a.selection||a.contextSelection},b);if(c&&(f=c.call(a,b),f instanceof a.childClass))return f;if(!f)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(a.childClass&&a.childClass.className)+" but "+(f&&f.constructor&&f.constructor.className)+")";}function x(){return l.ui.apply(this,arguments)}var r=l.Class,w=l.dom,q=l.data,t=
q.Subscription,s=q.DataObject,z=q.AbstractDataset,k=q.Dataset,j=w.AXIS_DESCENDANT,n=w.AXIS_DESCENDANT_OR_SELF,D=Function.getter,a=Object.complete,b=w.axis,q=l.EventObject.createEvent,c=l.EventObject.event;t.regType("DATASOURCE",{dataSourceChanged:function(a,b){this.remove(a,b);this.add(a,a.dataSource)}},function(a,b){a(b,b.dataSource)});var d=r.ExtensibleProperty(),g={ownerChanged:function(){},destroy:function(a){w.replace(a.element,this)}},e=function(){var a=this.key,b=this.config,c=this.owner,f=
"function"!=typeof b.existsIf||b.existsIf(c),e=c.satellite[a];if(f){var f="delegate"in b,d="dataSource"in b,i="function"==typeof b.delegate?b.delegate(c):null,h="function"==typeof b.dataSource?b.dataSource(c):null;if(e)f&&e.setDelegate(i),d&&e.setDataSource(h);else{var H=c.tmpl[b.replace||a],e={owner:c};if(f)e.delegate=i;if(d)e.dataSource=h;b.config&&Object.complete(e,"function"==typeof b.config?b.config(c):b.config);e=new b.instanceOf(e);c.satellite[a]=e;H&&e instanceof l.ui.Node&&e.element&&(w.replace(H,
e.element),e.addHandler(g,H))}}else if(e)e.destroy(),e.owner=null,delete c.satellite[a]},f=r.CustomExtendProperty({update:!0},function(a,b){for(var c in b)a[c]=b[c]?e:null}),h=r(s,{event_update:function(a,b){s.prototype.event_update.call(this,a,b);var c=this.parentNode;c&&(c.matchFunction&&(this.match(),this.match(c.matchFunction)),c.insertBefore(this,this.nextSibling))},event_childNodesModified:q("childNodesModified","node","delta"),event_dataSourceChanged:q("dataSourceChanged","node","oldDataSource"),
event_localGroupingChanged:q("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:q("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:q("ownerChanged","node","oldOwner"),event_satellitesChanged:q("satellitesChanged","node","delta"),subscribeTo:s.prototype.subscribeTo+t.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegateParent:!1,nodeType:"DOMWrapperNode",canHaveChildren:!1,childNodes:null,dataSource:null,colMap_:null,
destroyDataSourceMember:!0,document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:!1,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:d,satellite:null,owner:null,init:function(a){var b=this.dataSource,c=this.childNodes,i=this.localGrouping;if(b)this.dataSource=null;s.prototype.init.call(this,a);if(i)this.localGrouping=null,this.setLocalGrouping(i);if(this.canHaveChildren)this.childNodes=[],b?(this.dataSource=
null,this.setDataSource(b)):c&&this.setChildNodes(c);else{if(c)this.childNodes=null;if(b)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==d)for(var g in this.satelliteConfig)if(a=this.satelliteConfig[g],r.isClass(a)&&(a={instanceOf:a}),"object"==typeof a){b={key:g,owner:this,config:a};a=a.hook?f.__extend__(a.hook):f;for(g in a)if(a[g]===e){this.addHandler(a,b);break}e.call(b)}if(g=this.owner)this.owner=null,this.setOwner(g)},appendChild:function(){},insertBefore:function(){},
removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return 0<this.childNodes.length},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||!1==a instanceof h)a=null;if(this.owner!==a){var b=this.owner;b&&b.removeHandler(this.listen.owner,this);(this.owner=a)&&a.addHandler(this.listen.owner,this);this.event_ownerChanged(this,b)}},destroy:function(){s.prototype.destroy.call(this);
this.dataSource?this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping)this.localGrouping.destroy(),this.localGrouping=null;this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var b=this.satellite[a];b.destroy();b.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=this.document=null}}),m=r(h,{autoDestroyIfEmpty:!1,nodes:null,
first:null,last:null,init:function(a){this.nodes=[];h.prototype.init.call(this,a)},insert:function(a,b){var c=this.nodes,e=b?c.indexOf(b):c.length;if(-1==e)e=c.length;c.splice(e,0,a);this.first=c[0]||null;this.last=c[c.length-1]||null;a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var b=this.nodes;if(b.remove(a))this.first=b[0]||null,this.last=b[b.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]});!this.first&&this.autoDestroyIfEmpty&&
this.destroy()},clear:function(){if(this.first){for(var a=this.nodes,b=a.length;0<b--;)a[b].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){h.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),y={canHaveChildren:!0,childClass:h,childFactory:null,listen:{dataSource:{datasetChanged:function(a,b){var c={},e=[];if(b.deleted)if(c.deleted=e,this.childNodes.length==b.deleted.length){e.push.apply(e,
this.childNodes);var f=this.dataSource;this.dataSource=null;this.clear(!0);this.dataSource=f;this.colMap_={}}else for(var f=0,d;d=b.deleted[f];f++){d=d.eventObjectId;var i=this.colMap_[d];delete this.colMap_[d];i.canHaveDelegate=!0;this.removeChild(i);e.push(i)}if(b.inserted){c.inserted=[];for(f=0;d=b.inserted[f];f++)i=B(this,{cascadeDestroy:!1,delegate:d}),i.canHaveDelegate=!1,this.colMap_[d.eventObjectId]=i,c.inserted.push(i),this.firstChild&&this.insertBefore(i)}this.firstChild?this.event_childNodesModified(this,
c):this.setChildNodes(c.inserted);if(this.destroyDataSourceMember&&e.length)for(f=0;d=e[f];f++)d.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},insertBefore:function(a,c){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(a.firstChild){var e=this;do if(e==a)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";while(e=e.parentNode)}if(this.dataSource&&
!this.dataSource.has(a.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";!1==a instanceof this.childClass&&(a=B(this,a instanceof s?{delegate:a}:a));var f=a.parentNode===this,d=a.groupNode,i=this.localGrouping,e=this.localSorting,g=this.childNodes,h=null,H=-1;if(i){h=i.getGroupNode(a);i=h.nodes;if(f&&a.nextSibling===c&&d===h)return a;e?(e=e(a)||0,H=i.binarySearchPos(e,p,this.localSortingDesc),a.sortingValue=e):H=c&&c.groupNode===h?i.indexOf(c):i.length;
if(H<i.length)c=i[H];else if(h.last)c=h.last.nextSibling;else{e=h;for(c=null;(e=e.nextSibling)&&!(c=e.first););}if(a===c||f&&a.nextSibling===c)return d!==h&&(d&&d.remove(a),h.insert(a)),a;H=-1}else if(e){var H=this.localSortingDesc,i=a.nextSibling,m=a.previousSibling,e=e(a)||0;if(f){if(e===a.localSorting)return a;if((!i||(H?i.sortingValue<=e:i.sortingValue>=e))&&(!m||(H?m.sortingValue>=e:m.sortingValue<=e)))return a.sortingValue=e,a}H=g.binarySearchPos(e,p,H);c=g[H];a.sortingValue=e;if(a===c||f&&
i===c)return a}else{if(c&&c.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(f){if(a.nextSibling===c)return a;if(a===c)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}f?(a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.previousSibling=null,a.nextSibling=null,-1==H?g.remove(a):(e=g.indexOf(a),g.splice(e,1),e<
H&&H--),d&&d.remove(a)):a.parentNode&&a.parentNode.removeChild(a);d!=h&&h.insert(a,c);if(c){-1==H&&(H=g.indexOf(c));if(-1==H)throw"basis.dom.wrapper: Node was not found";a.nextSibling=c;g.splice(H,0,a)}else H=g.length,g.push(a),c={previousSibling:this.lastChild},this.lastChild=a;a.parentNode=this;a.previousSibling=c.previousSibling;0==H?this.firstChild=a:c.previousSibling.nextSibling=a;c.previousSibling=a;var k=!1,n=!1,y=this.selection||this.contextSelection;if(!a.document&&a.document!==this.document)k=
this.document,a.document=this.document;if(!a.contextSelection&&a.contextSelection!==y)a.contextSelection=y,n=!a.selection,a.selected&&y.add([a]);a.firstChild&&(k||n)&&b(a,j).forEach(function(a){if(k&&!a.document)a.document=k;if(n&&!a.contextSelection)a.selected&&a.unselect(),a.contextSelection=y});f||(a.match&&a.match(this.matchFunction),a.autoDelegateParent&&a.setDelegate(this),this.dataSource||this.event_childNodesModified(this,{inserted:[a]}));return a},removeChild:function(a){if(null==a||a.parentNode!==
this)throw"basis.dom.wrapper: Node was not found";if(!1==a instanceof this.childClass)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(a))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(a),1);a.parentNode=null;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling;a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:
this.firstChild=a.nextSibling;a.nextSibling=null;a.previousSibling=null;a.document===this.document&&b(a,n).forEach(function(a){if(a.document==this.document)a.document=null},this);if(a.contextSelection){for(var c=a.contextSelection,e=a,f=[];e;){if(e.contextSelection===c)e.selected&&f.push(e),e.contextSelection=null;if(!e.selection&&e.firstChild)e=e.firstChild;else if(e.nextSibling)e=e.nextSibling;else for(;e=e.parentNode;)if(e.nextSibling){e=e.nextSibling;break}}c.remove(f)}a.groupNode&&a.groupNode.remove(a);
this.dataSource||this.event_childNodesModified(this,{deleted:[a]});a.autoDelegateParent&&a.setDelegate();return a},replaceChild:function(a,b){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(null==b||b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(a,b);return this.removeChild(b)},clear:function(a){if(this.dataSource)this.setDataSource();else if(this.firstChild){var c=this.childNodes;this.lastChild=
this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:c});for(var e=c.length;0<e--;){var f=c[e];f.parentNode=null;f.groupNode=null;a?((f.selection||f.document)&&b(f,w.AXIS_DESCENDANT_OR_SELF).forEach(function(a){if(this.selection&&a.selection===this.selection)a.selected&&a.selection.remove([a]),a.selection=null;if(a.document===this.document)a.document=null},this),f.nextSibling=null,f.previousSibling=null,f.autoDelegateParent&&f.setDelegate()):f.destroy()}if(this.localGrouping){a=
this.localGrouping.childNodes;for(e=a.length-1;c=a[e];e--)c.clear()}}},setChildNodes:function(a,b){this.dataSource||this.clear(!!b);if(a&&(!1=="length"in a&&(a=[a]),a.length)){var c=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var e=0,f=a.length;e<f;e++)this.insertBefore(a[e]);this.event_childNodesModified=c;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||!this.canHaveChildren||!1==a instanceof z)a=null;if(this.dataSource!==
a){var b=this.dataSource;if(b)this.colMap_=this.dataSource=null,b.removeHandler(this.listen.dataSource,this),b.itemCount&&this.clear();if(a)this.dataSource=a,this.colMap_={},a.addHandler(this.listen.dataSource,this),a.itemCount&&this.listen.dataSource.datasetChanged.call(this,a,{inserted:a.getItems()});this.event_dataSourceChanged(this,b)}},setLocalGrouping:function(a){if("function"==typeof a||"string"==typeof a)a={groupGetter:D(a)};!1==a instanceof i&&(a=null!=a&&"object"==typeof a?new this.localGroupingClass(Object.complete({},
a)):null);if(this.localGrouping!==a){var b=this.localGrouping,c;if(this.localGrouping){if(!a&&(this.localGrouping=null,this.firstChild)){c=this.localSorting?v(this):this.childNodes;for(var e=c.length;0<e--;)c[e].groupNode=null;C(this,c)}b.setOwner()}if(a&&(this.localGrouping=a,a.setOwner(this),this.firstChild)){c=this.localSorting?v(this):this.childNodes;for(e=0;a=c[e];e++)a.groupNode=this.localGrouping.getGroupNode(a);for(e=0;a=c[e];e++)a.groupNode.nodes.push(a);c.length=0;for(e=this.localGrouping.nullGroup;e;e=
e.nextSibling)a=e.nodes,e.first=a[0]||null,e.last=a[a.length-1]||null,c.push.apply(c,a),e.event_childNodesModified(e,{inserted:a});C(this,c)}this.event_localGroupingChanged(this,b)}},setLocalSorting:function(a,b){a&&(a=D(a));if(this.localSorting!=a||this.localSortingDesc!=!!b){var c=this.localSorting,e=this.localSortingDesc;this.localSortingDesc=!!b;this.localSorting=a||null;if(a&&this.firstChild){var f=[],d;for(d=this.firstChild;d;d=d.nextSibling)d.sortingValue=a(d)||0;if(this.localGrouping)for(var i=
this.localGrouping.nullGroup;i;i=i.nextSibling)d=i.nodes=v({childNodes:i.nodes,localSortingDesc:this.localSortingDesc}),i.first=d[0]||null,i.last=d[d.length-1]||null,f.push.apply(f,d);else f=v(this);C(this,f)}this.event_localSortingChanged(this,c,e)}},setMatchFunction:function(a){if(this.matchFunction!=a){this.matchFunction=a;for(var b=this.lastChild;b;b=b.previousSibling)b.match(a)}}},t=r(h,{event_enable:q("enable","node"),event_disable:q("disable","node"),event_select:q("select","node"),event_unselect:q("unselect",
"node"),event_match:q("match","node"),event_unmatch:q("unmatch","node"),selectable:!0,selected:!1,selection:null,contextSelection:null,matchFunction:null,matched:!0,disabled:!1,init:function(a){if(this.selection&&!1==this.selection instanceof z)this.selection=new I(this.selection);h.prototype.init.call(this,a);this.disabled&&this.event_disable(this);if(this.selected)this.selected=!1,this.select(!0)},setSelection:function(a){if(this.selection==a)return!1;var c=this.selection;b(this,j,function(b){if(b.contextSelection==
c)b.selected&&c&&c.remove([b]),b.contextSelection=a});this.selection=a;return!0},hasOwnSelection:function(){return!!this.selection},select:function(a){var b=this.selected,c=this.contextSelection;if(c)a?b?c.remove([this]):c.add([this]):this.selectable&&c.set([this]);else if(!b&&this.selectable&&!this.isDisabled())this.selected=!0,this.event_select(this);return this.selected!=b},unselect:function(){var a=this.selected;if(a){var b=this.contextSelection;b?b.remove([this]):(this.selected=!1,this.event_unselect(this))}return this.selected!=
a},enable:function(){if(this.disabled)this.disabled=!1,this.event_enable(this)},disable:function(){if(!this.disabled)this.disabled=!0,this.event_disable(this)},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!w.findAncestor(this,D("disabled"))},match:function(a){if("function"!=typeof a)if(this.matched){if(this.underMatch_)this.underMatch_(this,!0),this.underMatch_=null}else this.matched=!0,this.event_match(this);else if(a(this)){if(this.underMatch_=a,!this.matched)this.matched=
!0,this.event_match(this)}else if(this.underMatch_=null,this.matched)this.matched=!1,this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),delete this.selection);this.unselect();h.prototype.destroy.call(this)}}),F=r(t,y,{}),i=r(h,y,{event_childNodesModified:function(a,b){c.childNodesModified.call(this,a,b);this.nullGroup.nextSibling=this.firstChild;if(b.inserted&&this.dataSource&&this.nullGroup.first)for(var e=this.owner,f=Array.from(this.nullGroup.nodes),
d=f.length;0<d--;)e.insertBefore(f[d],f[d].nextSibling)},event_ownerChanged:function(a,b){b&&b.localGrouping===this&&b.setLocalGrouping(null,!0);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);c.ownerChanged.call(this,a,b);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:!0,autoDestroyEmptyGroups:!0,titleGetter:D("data.title"),groupGetter:Function.$undef,childClass:m,childFactory:function(b){return new this.childClass(a(b,{titleGetter:this.titleGetter,
autoDestroyIfEmpty:this.dataSource?!1:this.autoDestroyEmptyGroups}))},init:function(a){this.map_={};this.nullGroup=new m({autoDestroyIfEmpty:!1});h.prototype.init.call(this,a)},getGroupNode:function(a){var a=this.groupGetter(a),b=a instanceof s,c=this.map_[b?a.eventObjectId:a];!c&&!this.dataSource&&(c=this.appendChild(b?{delegate:a}:{data:{id:a,title:a}}));return c||this.nullGroup},insertBefore:function(a,b){a=y.insertBefore.call(this,a,b);if(!1=="groupId_"in a)a.groupId_=a.delegate?a.delegate.eventObjectId:
a.data.id,this.map_[a.groupId_]=a;if(a.first){var c=this.owner,e=c.childNodes,f=a.first,d=a.last,i,g,h;for(i=a;(i=i.previousSibling)&&!(h=i.last););if(!h)h=this.nullGroup.last;for(i=a;(i=i.nextSibling)&&!(g=i.first););if(f.previousSibling!==h||d.nextSibling!==g){if(f.previousSibling)f.previousSibling.nextSibling=d.nextSibling;if(d.nextSibling)d.nextSibling.previousSibling=f.previousSibling;i=e.splice(e.indexOf(f),a.nodes.length);var m=e.indexOf(g);i.unshift(-1!=m?m:e.length,0);e.splice.apply(e,i);
f.previousSibling=h;d.nextSibling=g;if(h)h.nextSibling=f;if(g)g.previousSibling=d;c.firstChild=e[0];c.lastChild=e[e.length-1]}}return a},removeChild:function(a){y.removeChild.call(this,a);delete this.map_[a.groupId_];return a},clear:function(){y.clear.call(this);this.map_={}},destroy:function(){this.setOwner();h.prototype.destroy.call(this);this.map_=null}});h.prototype.localGroupingClass=i;var q=r(z,{autoDestroy:!0,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,b){var c=this.memberMap_,
e={},f=0,d=0,i=b.inserted,g=b.deleted;if(i&&i.length)for(e.inserted=i;a=i[f];)c[a.eventObjectId]=a,f++;if(g&&g.length)for(e.deleted=g;a=g[d];)delete c[a.eventObjectId],d++;(f||d)&&this.event_datasetChanged(this,e)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:q("sourceNodeChanged")&&function(a,b){c.sourceNodeChanged.call(this,a,b);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:!1,init:function(a,b){z.prototype.init.call(this,
b);a&&this.setSourceNode(a)},setSourceNode:function(a){!1==a instanceof h&&(a=null);if(a!==this.sourceNode){var b=this.sourceNode;b&&(b.removeHandler(this.listen.sourceNode,this),this.listen.sourceNode.childNodesModified.call(this,b,{deleted:b.childNodes}));a&&(a.addHandler(this.listen.sourceNode,this),this.listen.sourceNode.childNodesModified.call(this,a,{inserted:a.childNodes}));this.sourceNode=a;this.event_sourceNodeChanged(this,b)}},destroy:function(){this.setSourceNode();z.prototype.destroy.call(this)}}),
I=r(k,{multiple:!1,event_datasetChanged:function(a,b){k.prototype.event_datasetChanged.call(this,a,b);if(b.inserted)for(var c=0,e;e=b.inserted[c];c++)if(!e.selected)e.selected=!0,e.event_select();if(b.deleted)for(c=0;e=b.deleted[c];c++)if(e.selected)e.selected=!1,e.event_unselect()},add:function(a){if(!this.multiple){if(this.itemCount)return this.set(a);a.splice(1)}for(var b=[],c=0,e;e=a[c];c++)e.contextSelection==this&&e.selectable&&b.push(e);return k.prototype.add.call(this,b)},set:function(a){for(var b=
[],c=0,e;e=a[c];c++)e.contextSelection==this&&e.selectable&&b.push(e);this.multiple||a.splice(1);return k.prototype.set.call(this,b)}});l.namespace("basis.dom.wrapper",x).extend({AbstractNode:h,InteractiveNode:t,Node:F,GroupingNode:i,PartitionNode:m,simpleTemplate:x,ChildNodesDataset:q,Selection:I})})(basis);
(function(l,p){function u(a,b){return C(b,!0).getRule(a,!0)}function A(a,b){var c=a.match(/^([^{]+)\{(.*)\}\s*$/);if(c){for(var e=c[1].trim().split(/\s*,\s*/),f=0;f<e.length;f++)this.addRule(e[f],c[2]||null,b++);return b-1}}function v(a,b){var c=k.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:b?"alternate ":"",url:a.quote('"')}));k.tag(null,"HEAD")[0].appendChild(c);c=c.sheet||c.styleSheet;try{if(!c.cssRules)c.cssRules=c.rules}catch(e){}if(!c.insertRule)c.insertRule=
A;if(!c.deleteRule)c.deleteRule=c.removeRule;return c}function C(a,c){a||(a="DefaultGenericStyleSheet");b[a]||c&&(b[a]=new g(v()));return b[a]}function B(a,b,e,f){for(var f=f||{},b=b.qw(),g=0,h;h=b[g];g++)if("undefined"!=typeof d.style[h]){e&&(l.platformFeature["css-"+a]=h);c[a]={key:h,getter:f[h]};break}}function x(a,b){var e=c[a];if(a=e?e.key:a.replace(/^-ms-/,"ms-").camelize())return{key:a,value:e&&e.getter?e.getter(b):b}}function r(a,b,c){if("function"==typeof a.setProperty)return a.setProperty(b,
c);if(b=x(b,c))return a.style[b.key]=b.value}function w(a,b){for(var c in b)r(a,c,b[c]);return a}function q(a,b){return r(a,"display","string"==typeof b?b:b?"":"none")}function t(a,b){return r(a,"visibility",b?"":"hidden")}function s(a){return y[a]||(y[a]=RegExp("\\s*\\b"+a+"\\b"))}var z=p.document,k=l.dom,j=l.dom.event,n=l.Class,D=/\s*!important/i,a=1,b={},c={},d=k.createElement("DIV");B("opacity","opacity MozOpacity KhtmlOpacity filter",!0,{fitler:function(a){return"alpha(opacity:"+parseInt(100*
a)+")"}});B("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",!0);B("float","cssFloat styleFloat");var g=n(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[];this.map_={}},getRule:function(a,b){if(!this.map_[a]&&b){for(var c=this.styleSheet,d=this.rules.length,g=c.insertRule(a+"{}",d),h=d;h<=g;h++)this.rules.push(new e(c.cssRules[h]));this.map_[a]=d!=g?new f(this.rules.splice(d)):this.rules[d]}return this.map_[a]},deleteRule:function(a){var b=this.map_[a];
if(b){for(var b=b.rules||[b],c=0;c<b.length;c++){var e=this.rules.indexOf(b[c]);this.stylesheet.deleteRule(e);this.rules.splice(e,1)}delete this.map_[a]}},destroy:function(){delete this.rules}}),e=n(null,{rule:null,selector:"",init:function(a){if(a)this.rule=a,this.selector=a.selectorText},setProperty:function(a,b){var c,e=!!D.test(b),f=this.rule.style;if(e||f.getPropertyPriority&&"important"==f.getPropertyPriority(a)){if(b=b.replace(D,""),c=x(a,b)){var d=c.key;f.setProperty?(e||f.removeProperty(d),
f.setProperty(d,c.value,e?"important":"")):f.cssText=f.cssText.replace(RegExp(f[d]?d+"\\s*:\\s*"+f[d]+"(\\s*!important)?\\s*;?":"^","i"),d+": "+c.value+(e?" !important":"")+";")}}else r(this.rule,a,b)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),f=n(null,{rules:null,init:function(a){this.rules=a},destroy:function(){delete this.rules}});["setProperty","setStyle","clear"].forEach(function(a){f.prototype[a]=
function(){for(var b,c=0;b=this.rules[c];c++)b[a].apply(b,arguments)}});var h={};["em","ex","px","%"].forEach(function(a){h["%"==a?"percent":a]=function(b){return 0==b||isNaN(b)?"0":b+a}});var m,y={},F=n(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,b,c){c=c||"";"undefined"!=typeof a&&this.remove(c+a);"undefined"!=typeof b&&this.add(c+b)},bool:function(a,b){b?this.add(a):this.remove(a)},
clear:function(){this.element.className=""},contains:function(a){return!!this.element.className.match(s(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(s(a))||(this.element.className+=" "+a)},remove:function(a){var b=this.element.className,a=b.replace(s(a),"");if(a!=b)this.element.className=a},toggle:function(a){var b=this.contains(a);b?this.remove(a):this.add(a);return!b}});p.DOMTokenList&&z.documentElement.classList?(n=F.prototype,Object.extend(p.DOMTokenList.prototype,
{set:n.set,replace:n.replace,bool:n.bool,clear:function(){for(var a=this.length;0<a--;)this.remove(this[a])}}),m=function(a){return("string"==typeof a?k.get(a):a).classList}):m=function(a){return new F("string"==typeof a?k.get(a):a)};j.onLoad(function(){m(z.body).bool("opacity-not-support",!l.platformFeature["css-opacity"])});k.extend({setStyleProperty:r,setStyle:w,display:q,show:function(a){return q(a,1)},hide:function(a){return q(a)},visibility:t,visible:function(a){return t(a,1)},invisible:function(a){return t(a)}});
return l.namespace("basis.cssom").extend({setStyleProperty:r,setStyle:w,classList:m,uniqueRule:function(b){var c="genericRule-"+a++;b&&m(b).add(c);b=u("."+c);b.token=c;return b},cssRule:u,getStyleSheet:C,addStyleSheet:v,CssStyleSheetWrapper:g,CssRuleWrapper:e,CssRuleWrapperSet:f}).extend(h)})(basis,this);
(function(){function l(a){if(a instanceof j)return a.set;a=a.nodeType;if(!1==isNaN(a))return 1==a?k:"nodeValue"}var p=basis.Class,u=basis.dom,A=basis.Cleaner,v=Function.getter,C=basis.cssom.classList,B=basis.EventObject,x=basis.TimeEventManager,r=B.createEvent,w=basis.data,q=w.DataObject,t=w.STATE,s=p(q,{event_change:r("change"),locked:!1,lockValue_:null,extendConstructor_:!1,updateCount:0,init:function(a,b,c){q.prototype.init.call(this,{});b&&this.addHandler(b);this.proxy="function"==typeof c?c:
Function.$self;this.initValue=this.value=this.proxy(a)},set:function(a,b){var c=this.value,d=this.proxy?this.proxy(a):d,g=!1;if(d!==c)this.value=d,g=!0,this.updateCount+=1;!this.locked&&(g||b)&&this.event_change(d,c);return g},lock:function(){if(!this.locked)this.lockValue_=this.value,this.locked=!0},unlock:function(){if(this.locked)this.locked=!1,this.value!==this.lockValue_&&this.event_change(this.value,this.lockValue_)},update:function(a,b){return this.set(a,b)},reset:function(){this.set(this.initValue)},
destroy:function(){q.prototype.destroy.call(this);delete this.initValue;delete this.proxy;delete this.lockValue_;delete this.value}}),z={destroy:function(a){this.removeLink(a)}},k=function(a){u.insert(u.clear(this),a)},j=p(s,{links_:null,event_change:function(a,b){s.prototype.event_change.call(this,a,b);if(this.links_.length&&!A.globalDestroy)for(var c=0,d;d=this.links_[c++];)this.power_(d,b)},init:function(a,b,c){s.prototype.init.call(this,a,b,c);this.links_=[];A.add(this)},addLink:function(a,b,
c){if("object"!=typeof a&&!1==a instanceof Object)throw Error("basis.data.property: Link to undefined object ignored");null==b&&(b=l(a));"function"!=typeof c&&(c=v(Function.$self,c));b={object:a,format:c,field:b,isEventObject:a instanceof B};this.links_.push(b);b.isEventObject&&a.addHandler(z,this);this.power_(b);return a},addLinkShortcut:function(a,b,c){return this.addLink(a,j.shortcut[b],c)},removeLink:function(a,b){if(null!=this.links_){var c=2>arguments.length;!c&&null==b&&(b=l(a));for(var d=
0,g=0,e;e=this.links_[g];g++)e.object===a&&(c||b==e.field)?e.isEventObject&&e.object.removeHandler(z,this):this.links_[d++]=e;this.links_.length=d}},clear:function(){for(var a=0,b;b=this.links_[a];a++)b.isEventObject&&b.object.removeHandler(z,this);this.links_.clear()},power_:function(a,b){var c=a.field;if(null!=c){var d=a.format(this.value),g=a.object;"function"==typeof c?c.call(g,d,2>arguments.length?d:a.format(b)):g[c]=d}},destroy:function(){this.clear();s.prototype.destroy.call(this);this.links_=
null;A.remove(this)}});j.shortcut={className:function(a,b){C(this).replace(b,a)},show:function(a){u.display(this,!!a)},hide:function(a){u.display(this,!a)},disable:function(a){this.disabled=!!a},enable:function(a){this.disabled=!a}};var n=[t.READY,t.DEPRECATED,t.UNDEFINED,t.ERROR,t.PROCESSING],D={stateChanged:function(){this.fire(!1,!0)},update:function(){this.fire(!0)},change:function(){this.fire(!0)},destroy:function(a){this.remove(a)}},p=p(j,{calculateValue:function(){return this.value+1},objects:[],
timer_:null,valueChanged_:!1,stateChanged_:!0,state:t.UNDEFINED,extendConstructor_:!0,init:function(){var a=this.handler;delete this.handler;j.prototype.init.call(this,this.value||0,a,this.proxy);this.objects.length?(a=this.objects,this.objects=[],this.lock(),this.add.apply(this,a),this.unlock()):this.objects=[];this.valueChanged_=this.stateChanged_=!!this.calculateOnInit;this.update();A.add(this)},add:function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];if(c instanceof q)this.objects.add(c)&&
c.addHandler(D,this);else throw Error("basis.data.property: Instance of DataObject required");}this.fire(!0,!0)},remove:function(a){this.objects.remove(a)&&a.removeHandler(D,this);this.fire(!0,!0)},clear:function(){for(var a=0,b;b=this.objects[a];a++)b.removeHandler(D,this);this.objects.clear();this.fire(!0,!0)},fire:function(a,b){if(!this.locked&&(this.valueChanged_=this.valueChanged_||!!a,this.stateChanged_=this.stateChanged_||!!b,!this.timer_&&(this.valueChanged_||this.stateChanged_)))this.timer_=
!0,x.add(this,"update",Date.now())},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},update:function(){delete this.timer_;x.remove(this,"update");if(!A.globalDestroy&&(this.valueChanged_&&this.set(this.calculateValue()),this.stateChanged_)){var a=this.objects.length;if(a){for(var b=-2,c,d=0;d<a;d++){var g=this.objects[d],e=n.indexOf(""+g.state);e>b&&(c=g,b=e)}c&&this.setState(c.state,c.state.data)}else this.setState(t.UNDEFINED)}this.stateChanged_=this.valueChanged_=!1},destroy:function(){this.lock();
this.clear();x.remove(this,"update");j.prototype.destroy.call(this)}});basis.namespace("basis.data.property").extend({DataObjectSet:p,AbstractProperty:s,Property:j,PropertySet:p})})();
(function(l){function p(a,b){if(!a.length)return 0;var c,d,g=0,j=a.length-1;do if(c=g+j>>1,d=a[c]||0,b<d)j=c-1;else if(b>d)g=c+1;else return b==d?c:0;while(g<=j);return c+(d<b)}function u(a,b){if(!a.length)return 0;var c,d,g,j=0,i=a.length-1;do if(c=j+i>>1,g=a[c].value||0,g===d?(g=a[c].object.eventObjectId,d=b.object.eventObjectId):d=b.value||0,d<g)i=c-1;else if(d>g)j=c+1;else return d==g?c:0;while(j<=i);return c+(g<d)}function A(){for(var a=Object.slice(this.item_),b=this.index_.slice(this.offset,
this.offset+this.limit),c=[],d,g=0,j;j=b[g];g++){var i=j.object.eventObjectId;a[i]?delete a[i]:c.push(j.object)}(d=getDelta(c,values(a)))&&AggregateDataset.prototype.event_datasetChanged.call(this,this,d)}function v(a,b){var a=Function.getter(a),c=b+"_"+a.getterIdx_,d=k[c];if(!d)d=k[c]=this,this.indexType=b,this.indexClass=z[b],this.getter=a,this.key=c,this.createInstance=function(a){if(a instanceof t){var b=a.indexes&&a.indexes[this.key];if(!b)b=new this.indexClass(this.getter),b.addHandler(g,a),
b.key=this.key;return b}};return d}function C(a,b,c){var d=a.indexCache_;a.lock();if(b)for(var g=0,j;j=b[g++];){var i=a.valueGetter(j);d[j.eventObjectId]=i;a.add(j,i)}if(c)for(g=0;j=c[g++];)a.remove(j,d[j.eventObjectId]),delete d[j.eventObjectId];a.unlock()}var B=l.Class,x=l.TimeEventManager,r=l.data,w=r.KeyObjectMap,q=r.property.Property,t=r.AbstractDataset,s=r.Dataset.MapReduce,r=B(t,{valueGetter:Function.$true,index_:null,offset:0,limit:10,event_datasetChanged:function(a,b){var c;if(c=b.inserted)for(var d=
0;d<c.length;d++){var g=c[d],g={value:this.valueGetter(g),object:g},j=u(this.index_,g);this.index_.splice(j,0,g)}if(c=b.deleted)for(d=0;d<c.length;d++)g=c[d],g={value:this.valueGetter(g),object:g},j=u(this.index_,g),this.index_.splice(j,1);A.call(this)},init:function(a){this.index_=[];AggregateDataset.prototype.init.call(this,a)},setRange:function(a,b){this.offset=a;this.limit=b;A.call(this)}}),z=B(q,{autoDestroy:!0,valueGetter:Function.$null,dataSource:null,init:function(a){q.prototype.init.call(this,
this.value||0);this.indexCache_={};this.valueGetter=a},add:function(){},remove:function(){},upd:function(){}});z.Sum=B(z,{add:function(a,b){this.value+=b},remove:function(a,b){this.value-=b},upd:function(a,b,c){this.set(this.value+b-c)}});z.Avg=B(z,{sum_:0,count_:0,add:function(a,b){this.sum_+=b;this.count_+=1;this.value=this.sum_/this.count_},remove:function(a,b){this.sum_-=b;this.value=(this.count_-=1)?this.sum_/this.count_:0},upd:function(a,b,c){this.sum_+=b-c;this.set(this.sum_/this.count_)}});
z.Count=B(z,{valueGetter:Function.$true,add:function(a,b){b&&(this.value+=1)},remove:function(a,b){b&&(this.value-=1)},upd:function(a,b){this.set(this.value+(b?1:-1))}});z.Max=B(z,{init:function(a,b){this.stack=[];z.prototype.init.call(this,a,b)},add:function(a,b){this.stack.splice(p(this.stack,b),0,b);this.value=this.stack[this.stack.length-1]},remove:function(a,b){this.stack.remove(b);this.value=this.stack[this.stack.length-1]},upd:function(a,b,c){this.stack.splice(p(this.stack,c),1);this.stack.splice(p(this.stack,
b),0,b);this.set(this.stack[this.stack.length-1])}});z.Min=B(z,{init:function(a,b){this.stack=[];z.prototype.init.call(this,a,b)},add:function(a,b){this.stack.splice(p(this.stack,b),0,b);this.value=this.stack[0]},remove:function(a,b){this.stack.remove(b);this.value=this.stack[0]},upd:function(a,b,c){this.stack.splice(p(this.stack,c),1);this.stack.splice(p(this.stack,b),0,b);this.set(this.stack[0])}});var k={},j=function(a){return function(b){return new v(b,a)}},n=j("Sum"),D=j("Avg"),a=j("Count"),
b=j("Min"),j=j("Max"),c={update:function(a){var b,c,d,g=a.eventObjectId,j;for(j in this.indexes)d=this.indexes[j],b=d.indexCache_[g],c=d.valueGetter(a),c!==b&&(d.upd(a,c,b),d.indexCache_[g]=c)}},d={datasetChanged:function(a,b){if(b.inserted)for(var d=0;a=b.inserted[d++];)a.addHandler(c,this);if(b.deleted)for(d=0;a=b.deleted[d++];)a.removeHandler(c,this);for(var g in this.indexes)C(this.indexes[g],b.inserted,b.deleted)},destroy:function(){for(var a in this.indexes)this.indexes[a].destroy()}},g={destroy:function(a){this.removeIndex(a)}};
t.prototype.createIndex=function(a){if(!1!=a instanceof v){if(!this.indexes)this.indexes={},this.addHandler(d),d.datasetChanged.call(this,this,{inserted:this.getItems()});var b=a.key;this.indexes[b]||(a=a.createInstance(this),this.indexes[b]=a,C(a,this.getItems()));return this.indexes[b]}};t.prototype.removeIndex=function(a){if(this.indexes&&this.indexes[a.key]){delete this.indexes[a.key];a.destroy();for(var b in this.indexes)return;this.removeHandler(d);delete this.indexes}};B=B(s,{calcs:null,indexes:null,
indexes_:null,timer_:null,indexUpdated:null,memberSourceMap:null,keyMap:null,event_sourceChanged:function(a,b){s.prototype.event_sourceChanged.call(this,a,b);var c,d;for(d in this.indexes_)c=this.indexes_[d],b&&(this.removeIndex(d),b.removeIndex(this.indexes[d])),this.source&&this.addIndex(d,this.source.createIndex(c))},listen:{sourceObject:{update:function(a,b){s.prototype.listen.sourceObject.update.call(this,a,b);this.sourceMap_[a.eventObjectId].updated=!0;this.fireUpdate()}},index:{change:function(a){var b=
this.indexMap;b.indexValues[this.key]=a;b.indexUpdated=!0;b.fireUpdate()}},member:{subscribersChanged:function(a,b){0<a.subscriberCount&&0==b&&this.calcMember(a)}}},map:function(a){return this.keyMap.get(a,!0)},addMemberRef:function(a,b){this.memberSourceMap[a.eventObjectId]=b.eventObjectId;a.addHandler(this.listen.member,this);this.sourceMap_[b.eventObjectId].updated=!0;0<a.subscriberCount&&this.calcMember(a)},removeMemberRef:function(a){delete this.memberSourceMap[a.eventObjectId];a.removeHandler(this.listen.member,
this)},init:function(a){this.indexUpdated=!1;this.indexesBind_={};this.memberSourceMap={};var b=this.indexes;this.indexes={};this.indexes_={};this.calcs=this.calcs||{};this.indexValues={};if(!this.keyMap||!1==this.keyMap instanceof w)this.keyMap=new w(Object.complete({create:function(a,b){return new this.itemClass(b)}},this.keyMap));s.prototype.init.call(this,a);Object.iterate(b,this.addIndex,this)},addIndex:function(a,b){if(!this.indexes[a]){if(b instanceof v){if(this.indexes_[a])return;this.indexes_[a]=
b;b=this.source&&this.source.createIndex(b)}if(b instanceof z)this.indexValues[a]=b.value,this.indexes[a]=b,this.indexesBind_[a]={key:a,indexMap:this},b.addHandler(this.listen.index,this.indexesBind_[a]),this.listen.index.change.call(this.indexesBind_[a],b.value)}},removeIndex:function(a){if(this.indexes_[a]||this.indexes[a])this.indexes[a]&&this.indexes[a].removeHandler(this.listen.index,this.indexesBind_[a]),delete this.indexValues[a],delete this.indexesBind_[a],delete this.indexes[a],delete this.indexes_[a]},
addCalc:function(a,b){this.calcs[a]=b;this.fireUpdate()},removeCalc:function(){delete this.calcs[name]},lock:function(){Object.values(this.indexes).forEach(function(a){a.lock()})},unlock:function(){Object.values(this.indexes).forEach(function(a){a.unlock()})},fireUpdate:function(){if(!this.timer_)this.timer_=!0,x.add(this,"apply",Date.now())},apply:function(){for(var a in this.item_)this.calcMember(this.item_[a]);this.timer_=this.indexUpdated=!1},calcMember:function(a){var b=this.sourceMap_[this.memberSourceMap[a.eventObjectId]];
if(a.subscriberCount&&(b.updated||this.indexUpdated)){b.updated=!1;var c={},d,g,j;for(j in this.calcs)if(d=this.calcs[j](b.sourceObject.data,this.indexValues),a.data[j]!==d&&(!isNaN(d)||!isNaN(a.data[j])))c[j]=d,g=!0;g&&a.update(c)}},getMember:function(a){return this.keyMap.get(a,!0)},destroy:function(){this.indexesBind_=this.memberSourceMap=this.indexUpdated=this.calcs=this.timer_=null;this.keyMap.destroy();this.keyMap=null;for(var a in this.indexes)this.removeIndexConstructor(a);s.prototype.destroy.call(this)}});
l.namespace("basis.data.index").extend({IndexedDataset:r,IndexConstructor:v,Index:z,Sum:n,Avg:D,Count:a,Max:j,Min:b,IndexMap:B})})(basis);
(function(l){function p(a){e[a]=e[a]||0;return a+e[a]++}function u(){var a=Array.from(arguments),b=a.pop();"function"!=typeof b&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=
!0;return b}function A(){return u.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;0<b--;){if(null==arguments[b])return null;a.push(arguments[b])}return a.join("-")}))}var v=l.Class,C=l.Cleaner,B=Object.extend,x=Function.$self,r=Function.getter,w=l.data,q=l.EventObject,t=w.Dataset,s=w.Collection,z=w.Grouping,k=w.DataObject,j=w.STATE,n={},D={string:1,number:1},a=[],b=function(a){return isNaN(a)?null:Number(a)},c=function(a){return isNaN(a)?null:Number(a)},d=function(a){return isNaN(a)?
null:parseInt(a)},g=function(a){return null==a?null:""+a},e={},f=l.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+c;return e};C.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=b,!0},remove:function(a,
b){if(this.index[a]===b)return delete this.index[a],!0},destroy:function(){this.index=null}}),w=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},h=function(a,b){return function(c){if(!this.name)this.name=p(b);a.prototype.init.call(this,c)}},m=function(a){return function(b,c){t.setAccumulateState(!0);b=(b||[]).map(this.wrapper);t.setAccumulateState(!1);return a.prototype.sync.call(this,b,c)}},y=v(t,{wrapper:Function.$self,init:h(t,"EntitySet"),sync:m(t),set:w(t,
"set"),add:w(t,"add"),remove:w(t,"remove"),destroy:function(){t.prototype.destroy.call(this);delete this.wrapper}}),F=v(y,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),i=v(s,{init:h(s,"EntityCollection"),sync:m(s)});i.sourceHandler=s.sourceHandler;var I=v(z,{subsetClass:F,init:h(z,"EntityGrouping"),sync:m(z),getSubset:function(a,b){var c=z.prototype.getSubset.call(this,a,b);if(c)c.wrapper=this.wrapper;return c}}),o=function(a){if(this instanceof o){var b=
new E(a||x);return function(a,c){return null!=a?(c instanceof y||(c=b.createEntitySet()),c.set(a instanceof t?a.getItems():Array.from(a)),c):null}}};o.className="basis.entity.EntitySetWrapper";var E=v(null,{init:function(a){this.wrapper=a},createEntitySet:function(){return new y({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),G=function(a){if(this instanceof G){var b=function(a,b){if(null!=a){if(a===b||a.entityType===c)return a;var g,i=c.idField;
if(D[typeof a]){if(!i)return;g=a;a={};a[i]=g}else if(c.compositeKey)g=c.compositeKey(a,a);else if(i)g=a[i];else if(f&&(b=c.singleton,!b))return c.singleton=new e(a);null!=g&&d&&(b=d.get(g,c.entityClass));b&&b.entityType===c?b.update(a):b=new e(a);return b}return c.singleton},c=new N(a||{},b),d=c.index__,e=c.entityClass,f=c.isSingleton;B(b,{toString:function(){return this.typeName+"()"},entityType:c,type:b,typeName:c.name,index:d,reader:function(a){return c.reader(a)},get:function(a){return c.get(a)},
addField:function(a,b){c.addField(a,b)},all:c.all,createCollection:function(a,d,e){var f=c.collection_[a];return!f&&d?c.collection_[a]=new i({wrapper:b,source:e||c.all,rule:d}):f},getCollection:function(a){return c.collection_[a]},createGrouping:function(a,d,e){var f=c.grouping_[a];return!f&&d?c.grouping_[a]=new I({wrapper:b,source:e||c.all,rule:d}):f},getGrouping:function(a){return c.grouping_[a]},getSlot:function(a,b){return c.getSlot(a,b)}});return b}};G.className="basis.entity.EntityTypeWrapper";
var K=r("singleton"),J={};v(k,{});var N=v(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:!1,index__:null,slot_:null,init:function(b,c){this.name=b.name||p(this.name);this.index__=b.index;this.idFields={};a.push(this);this.isSingleton=b.isSingleton;this.wrapper=c;this.all=new F(Object.extend(b.all||{},{wrapper:c}));this.slot_={};if(b.extensible)this.extensible=!0;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(b.fields,this.addField,this);b.constrains&&
b.constrains.forEach(function(a){this.addCalcField(null,a)},this);if(this.isSingleton)this.get=K;b.aliases&&Object.iterate(b.aliases,this.addAlias,this);this.collection_={};if(b.collections)for(var d in b.collections)this.collection_[d]=new i({name:d,wrapper:c,source:this.all,rule:b.collections[d]||Function.$true});this.grouping_={};if(b.groupings)for(d in b.groupings)this.grouping_[d]=new I({name:d,wrapper:c,source:this.all,rule:b.groupings[d]||Function.$true});this.entityClass=M(this,this.all,this.index__,
this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:c,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(D[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||null==a)return null;for(var c in a){var d=c in this.aliases?this.aliases[c]:"";d&&d in this.fields&&(b[d]=this.fields[d].reader?this.fields[d].reader(a[c]):a[c])}return b},addAlias:function(a,b){b in this.fields&&!1==a in this.aliases&&(this.aliases[a]=b)},addField:function(a,
e){if(!this.all.itemCount){this.aliases[a]=a;"function"==typeof e&&(e={type:e});if("type"in e&&"function"!=typeof e.type)e.type=x;var i=e.type||x;if([b,c,d,g].has(i))e.id=!0;if(e.id){if(!this.index__)this.index__=new f(String);this.idFields[a]=!0;this.idField||this.compositeKey?(this.idField=null,this.compositeKey=A.apply(null,Object.keys(this.idFields))):this.idField=a}e.calc?this.addCalcField(a,e.calc,void 0):this.fields[a]=i;this.defaults[a]="defValue"in e?e.defValue:i();this.getters["get_"+a]=
function(){return this.data[a]};J[a]||(J[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){if(!this.calcs)this.calcs=[];for(var d={args:b.args,wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=g;break}if(f>e)return;if(this.idField&&a==this.idField)this.compositeKey=b;this.fields[a]=function(a,
b){"undefined"!=typeof console&&console.log("Calculate fields are readonly");return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(null!=a)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&null!=a){if(D[typeof a])return a;if(a&&a.entityType===this)return a.__id__;if(a instanceof k)a=a.data;return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);if(null!=b){var c=
this.slot_[b];c||(D[typeof a]&&(c={},this.idField&&!this.compositeKey&&(c[this.idField]=a),a=c),c=this.slot_[b]=new k({delegate:this.get(b),data:a}));return c}}}),L=v(k,{init:q.prototype.init,event_rollbackUpdate:q.createEvent("rollbackUpdate")}),M=function(a,b,c,d,e,f,g){function i(b,c,d){var e=!1,f=a.calcs,g=b.__id__,j=b.data;try{if(f)for(var k=0,n;n=f[k++];){var o=n.key;if(o){var l=j[o];j[o]=n.wrapper(c,j,j[o]);j[o]!==l&&(c[o]=l,e=!0)}else n.wrapper(c,j)}if(a.compositeKey)b.__id__=a.compositeKey(c,
j,b.__id__);else if(m&&m in c)b.__id__=j[m];b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(z){b.__id__=g;for(var p in c)b.data[p]=c[p];if(d)for(p in d)if(!b.modified)b.modified=d;e=!1}b.__id__!==g&&h(b,g,b.__id__);return e}function h(a,b,e){null!=b&&(c.remove(b,a),d[b]&&d[b].setDelegate());null!=e&&(c.add(e,a),d[e]&&d[e].setDelegate(a))}var m=a.idField;return v(L,g,{canHaveDelegate:!1,modified:null,isTarget:!0,extendConstructor_:!1,init:function(a){L.prototype.init.call(this);this.fieldHandlers_=
{};this.data={};this.root=this;this.target=this;var c,d={},g;for(g in e)g in a?(d[g]=f[g],c=e[g](a[g])):c=f[g],c&&c!==this&&c instanceof q&&c.addHandler(J[g],this)&&(this.fieldHandlers_[g]=!0),this.data[g]=c;i(this,d);b.event_datasetChanged(b,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,f){var g=e[b];if(!g){if(!a.extensible)return;g=x}var h,j=this.modified,c=g(c,this.data[b]),
g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{h={};if(b!=m)if(d){if(!j)this.modified=j={};if(!1===b in j)h.rollback={key:b,value:void 0},j[b]=g;else if(j[b]===c&&(h.rollback={key:b,value:c},delete j[b],!Object.keys(j).length))this.modified=null}else if(j&&b in j)if(j[b]!==c){h.rollback={key:b,value:j[b]};j[b]=c;break a}else return!1;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(J[b],this),this.fieldHandlers_[b]=!1);c&&c!==this&&c instanceof q&&
c.addHandler(J[b],this)&&(this.fieldHandlers_[b]=!0);h.key=b;h.value=g;h.delta={};h.delta[b]=g}else if(!d&&j&&b in j&&(h={rollback:{key:b,value:j[b]}},delete j[b],!Object.keys(j).length))this.modified=null;if(!f&&h){var d=h.key,b=h.delta||{},k;if(h.rollback)k={},k[h.rollback.key]=h.rollback.value;i(this,b,k)&&(d=!0);if(d)this.event_update(this,b),h.delta=b;k&&this.event_rollbackUpdate(this,k)}return h||!1},update:function(a,b){if(a){var c,d={},e,f={},g,h;for(h in a)if(g=this.set(h,a[h],b,!0)){if(g.key)c=
!0,d[g.key]=g.value;if(g.rollback)e=!0,f[g.rollback.key]=g.rollback.value}i(this,d,f)&&(c=!0);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:!1},reset:function(){this.update(f)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=j.PROCESSING){if(this.modified){var a=this.modified;
this.modified=null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(j.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.data[a].removeHandler(J[a],this);this.fieldHandlers_=n;this.__id__&&h(this,this.__id__,null);k.prototype.destroy.call(this);b.event_datasetChanged(b,{deleted:[this]});this.data=n;this.modified=null}})};l.namespace("basis.entity").extend({isEntity:function(a){return a&&a instanceof M},NumericId:b,NumberId:c,IntId:d,StringId:g,Index:f,CalculateField:u,
EntityType:G,Entity:M,BaseEntity:L,EntitySetType:o,EntitySet:y,ReadOnlyEntitySet:F,Collection:i,Grouping:I})})(basis);
(function(l){var p=l.Class,u=l.dom,A=l.html.Template,v=l.cssom.classList,C=Function.getter,B=l.Cleaner,x=l.dom.wrapper.Node,r=l.dom.wrapper.PartitionNode,w=l.dom.wrapper.GroupingNode,q=p.ExtensibleProperty(),t=function(l){return{template:new A("<div/>"),action:q,cssClassName:null,event_update:function(k,j){l.event_update.call(this,k,j);this.templateUpdate(this.tmpl,"update",j)},event_select:function(k){l.event_select.call(this,k);v(this.tmpl.selected||this.tmpl.content||this.element).add("selected")},
event_unselect:function(k){l.event_unselect.call(this,k);v(this.tmpl.selected||this.tmpl.content||this.element).remove("selected")},event_disable:function(k){l.event_disable.call(this,k);v(this.tmpl.disabled||this.element).add("disabled")},event_enable:function(k){l.event_enable.call(this,k);v(this.tmpl.disabled||this.element).remove("disabled")},event_match:function(k){l.event_match.call(this,k);u.display(this.element,!0)},event_unmatch:function(k){l.event_unmatch.call(this,k);u.display(this.element,
!1)},init:function(k){this.tmpl={};if(this.template){this.template.createInstance(this.tmpl,this);this.element=this.tmpl.element;if(this.tmpl.childNodesHere)this.tmpl.childNodesElement=this.tmpl.childNodesHere.parentNode,this.tmpl.childNodesElement.insertPoint=this.tmpl.childNodesHere;this.content&&u.insert(this.tmpl.content||this.element,this.content)}else this.element=this.tmpl.element=u.createElement();this.childNodesElement=this.tmpl.childNodesElement||this.element;l.init.call(this,k);if(this.id)this.element.id=
this.id;if(k=this.cssClassName){"string"==typeof k&&(k={element:k});for(var j in k){var n=this.tmpl[j];if(n)for(var n=v(n),p=(""+k[j]).qw(),a=0,b;b=p[a++];)n.add(b)}}this.tmpl&&this.templateUpdate(this.tmpl);this.container&&u.insert(this.container,this.element)},templateAction:function(k,j){var n=this.action[k];n&&n.call(this,j)},templateUpdate:function(){},destroy:function(){var k=this.element;l.destroy.call(this);k&&k.parentNode&&k.parentNode.removeChild(k);this.template&&this.template.clearInstance(this.tmpl,
this);this.childNodesElement=this.tmpl=this.element=null}}},x=p(x,t,{}),C=p(r,t,{titleGetter:C("data.title"),templateUpdate:function(l){if(l.titleText)l.titleText.nodeValue=""+this.titleGetter(this)}}),t=function(l){return{insertBefore:function(k,j){var k=l.insertBefore.call(this,k,j),n=k.groupNode||this,p=k.nextSibling,n=n.childNodesElement||n.element||this.childNodesElement||this.element,a=k.element,p=(p&&p.element.parentNode==n?p.element:null)||n.insertPoint||null;(a.parentNode!==n||a.nextSibling!==
p)&&n.insertBefore(a,p);return k},removeChild:function(k){l.removeChild.call(this,k);var j=k.element,n=j.parentNode;n&&n.removeChild(j);return k},clear:function(k){if(k)for(var j=this.firstChild;j;){var n=j.element;n.parentNode&&n.parentNode.removeChild(n);j=j.nextSibling}l.clear.call(this,k)},setChildNodes:function(k,j){var n=u.createFragment(),p=this.localGrouping||this,a=p.childNodesElement||p.element;p.childNodesElement=n;l.setChildNodes.call(this,k,j);a.insertBefore(n,a.insertPoint||null);p.childNodesElement=
a}}},r=p(w,t,{childClass:C,event_ownerChanged:function(l,k){var j=this,n=this.owner,p=null;n&&(p=n.tmpl&&n.tmpl.groupsElement||n.childNodesElement||n.element,p.appendChild(this.nullElement));do j.element=j.childNodesElement=p;while(j=j.localGrouping);w.prototype.event_ownerChanged.call(this,l,k)},init:function(l){this.element=this.childNodesElement=this.nullElement=u.createFragment();w.prototype.init.call(this,l)}});r.prototype.localGroupingClass=r;var s=p(x,t,{childClass:x,childFactory:function(l){return new this.childClass(l)},
localGroupingClass:r}),p=p(s,{selection:{},init:function(l){this.document=this;s.prototype.init.call(this,l);B.add(this)},destroy:function(){if(this.selection)this.selection.destroy(),this.selection=null;s.prototype.destroy.call(this);B.remove(this)}}),t=function(l,k){for(var j=l.match(/\{(this_[^\}]+)\}/g)||[],n=[],p=0;p<j.length;p++){var a=j[p].match(/\{(this_[^\|\}]+)\}/)[1];n.push("this.tmpl."+a+".nodeValue = "+a.replace(/_/g,"."))}return Function("tmpl_","config_","return "+function(a){return Object.extend({template:tmpl_,
templateUpdate:function(c,d,g){a.templateUpdate.call(this,c,d,g);_code_()}},config_)}.toString().replace("_code_()",n.join(";\n")))(new A(l),k)};l.namespace("basis.ui",t).extend({simpleTemplate:t,Node:x,Container:s,PartitionNode:C,GroupingNode:r,Control:p})})(basis);
