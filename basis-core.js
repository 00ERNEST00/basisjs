/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(w){function z(c,f){for(var i in f)c[i]=f[i];return c}function L(c,f){for(var i in f)if(i in c==false)c[i]=f[i];return c}function N(c){return c==null||c==undefined}function F(c){return c}function T(c){var f={};c.names=function(i){return Object.slice(f,typeof i=="string"?i.qw():i)};c.extend=function(i){L(f,i);z(this,i);return this};return c}function U(c,f){for(var i=c.split("."),l=w,o,p,q;i.length;){o=i.shift();p=(p?p+".":"")+o;if(!l[o]){l[o]=T((!i.length?f:null)||function(){},p);if(q)q.namespaces_[p]=
l[o]}l=l[o];if(!q){q=l;if(!q.namespaces_)q.namespaces_={}}}return G[c]=l}z(Object,{extend:z,complete:L,keys:function(c){var f=[];for(var i in c)f.push(i);return f},values:function(c){var f=[];for(var i in c)f.push(c[i]);return f},slice:function(c,f){var i={};if(!f)return z(i,c);for(var l=0,o;o=f[l++];)if(o in c)i[o]=c[o];return i},splice:function(c,f){var i={};if(!f)return z(i,c);for(var l=0,o;o=f[l++];)if(o in c){i[o]=c[o];delete c[o]}return i},iterate:function(c,f,i){var l=[];for(var o in c)l.push(f.call(i,
o,c[o]));return l},coalesce:function(){for(var c=arguments,f=0;f<c.length;f++)if(c[f]!=null)return c[f]}});var H=function(){},A=function(){var c=1,f={},i={},l=function(o){return o.modificator};l.getter=l;l.getterIdx_=c++;return function(o,p){var q,r;if(!p){if(o.getter)return o.getter;if(typeof o=="function")return o}if(typeof o!="function")if(i[o])q=i[o];else{q=new Function("object","return object != null ? object."+o+" : object");q.path=o;q.getterIdx_=c++;i[o]=q}else{q=o;if(!q.getterIdx_)q.getterIdx_=
c++}r=q.getterIdx_;var a=f[r];if(a)if(typeof p=="undefined"){if(a.nmg)return a.nmg}else for(r=0;r<a.length;r++){if(a[r].modificator===p)return a[r].getter}else a=f[r]=[];var d=true;switch(p&&typeof p){case "string":r=function(h){return p.format(q(h))};break;case "function":r=function(h){return p(q(h))};break;case "object":d=false;r=function(h){return p[q(h)]};break;default:r=q.path?q:function(h){return q(h)}}if(d){a.push({getter:r,modificator:p});if(typeof p=="undefined")a.nmg=r}return r.getter=r}}();
z(Function,{$undefined:function(c){return c==undefined},$defined:function(c){return c!=undefined},$isNull:N,$isNotNull:function(c){return c!=null&&c!=undefined},$isSame:function(c){return c===this},$isNotSame:function(c){return c!==this},$self:F,$const:function(c){return function(){return c}},$false:function(){return false},$true:function(){return true},$null:function(){return null},$undef:H,getter:A,def:function(c,f,i){i=i||N;return function(l){l=c(l);return i(l)?f:l}},wrapper:function(c){return function(f){var i=
{};i[c]=f;return i}},lazyInit:function(c,f){var i=0,l,o;return l=function(){if(!i++){l.inited=true;l.data=o=c.apply(f||this,arguments)}return o}},lazyInitAndRun:function(c,f,i){var l=0,o,p;return o=function(){if(!l++){o.inited=true;o.data=p=c.call(i||this)}f.apply(p,arguments);return p}},runOnce:function(c,f){var i=0;return function(){if(!i++)return c.apply(f||this,arguments)}}});L(Function.prototype,{bind:function(c){var f=this,i=Array.from(arguments,1);return i.length?function(){return f.apply(c,
i.concat.apply(i,arguments))}:function(){return f.apply(c,arguments)}}});L(Array,{isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"}});z(Array,{from:function(c,f){if(c!=null){var i=c.length;if(typeof i=="undefined")return[c];f||(f=0);if(i-f>0){for(var l=[],o=0,p=f;p<i;)l[o++]=c[p++];return l}}return[]},create:function(c,f,i){for(var l=[],o=0;o<c;o++)l[o]=typeof f=="function"?f.call(i,o,l):f;return l}});L(Array.prototype,{indexOf:function(c,f){f=parseInt(f)||0;if(f<0)return-1;
for(;f<this.length;f++)if(this[f]===c)return f;return-1},lastIndexOf:function(c,f){var i=this.length;f=parseInt(f);for(f=isNaN(f)||f>=i?i-1:(f+i)%i;f>=0;f--)if(this[f]===c)return f;return-1},forEach:function(c,f){for(var i=0,l=this.length;i<l;i++)i in this&&c.call(f,this[i],i,this)},every:function(c,f){for(var i=0,l=this.length;i<l;i++)if(i in this&&!c.call(f,this[i],i,this))return false;return true},some:function(c,f){for(var i=0,l=this.length;i<l;i++)if(i in this&&c.call(f,this[i],i,this))return true;
return false},filter:function(c,f){for(var i=[],l=0,o=this.length;l<o;l++)l in this&&c.call(f,this[l],l,this)&&i.push(this[l]);return i},map:function(c,f){for(var i=[],l=0,o=this.length;l<o;l++)if(l in this)i[l]=c.call(f,this[l],l,this);return i},reduce:function(c,f){var i=this.length,l=arguments.length;if(i==0&&l==1)throw new TypeError;var o,p=0;if(l>1){o=f;p=1}for(l=0;l<i;l++)if(l in this)o=p++?c.call(null,o,this[l],l,this):this[l];return o}});z(Array.prototype,{flatten:function(){return this.concat.apply([],
this)},repeat:function(c){return Array.create(parseInt(c)||0,this).flatten()},item:function(c){c=parseInt(c||0);return this[c>=0?c:this.length+c]},search:function(c,f,i){Array.lastSearchIndex=-1;f=Function.getter(f||F);i=parseInt(i)||0;for(var l=this.length;i<l;i++)if(f(this[i])===c)return this[Array.lastSearchIndex=i]},lastSearch:function(c,f,i){Array.lastSearchIndex=-1;f=Function.getter(f||F);var l=this.length;i=isNaN(i)||i==null?l:parseInt(i);for(l=i>l?l:i;l-- >0;)if(f(this[l])===c)return this[Array.lastSearchIndex=
l]},binarySearchPos:function(c,f,i,l,o,p){if(!this.length)return l?-1:0;f=Function.getter(f||F);i=!!i;var q;o=isNaN(o)?0:o;var r=isNaN(p)?this.length-1:p;do{p=o+r>>1;q=f(this[p]);if(i?c>q:c<q)r=p-1;else if(i?c<q:c>q)o=p+1;else return c==q?p:l?-1:0}while(o<=r);return l?-1:p+(q<c^i)},binarySearch:function(c,f){return this.binarySearchPos(c,f,false,true)},add:function(c){return this.indexOf(c)==-1&&!!this.push(c)},remove:function(c){c=this.indexOf(c);return c!=-1&&!!this.splice(c,1)},has:function(c){return this.indexOf(c)!=
-1},merge:function(c){return this.reduce(z,c||{})},sortAsObject:function(c,f,i){c=Function.getter(c);i=i?-1:1;return this.map(function(l,o){return{i:o,v:c(l)}}).sort(f||function(l,o){return i*(l.v>o.v||-(l.v<o.v)||(l.i>o.i?1:-1))}).map(function(l){return this[l.i]},this)},set:function(c){if(this!==c){this.length=0;this.push.apply(this,c)}return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var B=Array.prototype.splice;Array.prototype.splice=function(){var c=Array.from(arguments);
if(c.length<2)c[1]=this.length;return B.apply(this,c)}}var y={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};L(String,{toLowerCase:function(c){return String(c).toLowerCase()},toUpperCase:function(c){return String(c).toUpperCase()},trim:function(c){return String(c).trim()},trimLeft:function(c){return String(c).trimLeft()},
trimRight:function(c){return String(c).trimRight()},isEmpty:function(c){return c==null||String(c)==""},isNotEmpty:function(c){return c!=null&&String(c)!=""}});L(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});z(String.prototype,{toObject:function(c){try{return Function("return 0,"+this)()}catch(f){if(c)throw f;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:
function(){for(var c=[],f=this.length,i=0;i<f;i++)c[i]=this.charAt(i);return c},repeat:function(c){return(new Array(parseInt(c)+1||0)).join(this)},qw:function(){var c=this.trim();return c?c.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(c){for(var f={},i=0;i<arguments.length;i++)f[i]=arguments[i];typeof c=="object"&&z(f,c);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(l,o,p,q,r){l=o in f?f[o]:r?"":
l;if(p&&!isNaN(l)){l=Number(l);return p=="."?l.toFixed(q):l.lead(q)}return l})},quote:function(c,f){c=c||'"';f=f||y[c]||c;var i=(c.length==1?c:"")+(f.length==1?f:"");return c+(i?this.replace(new RegExp("["+i.forRegExp()+"]","g"),"\\$&"):this)+f},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(c,f){return f.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(c){return"-"+c.toLowerCase()})}});
String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=11)String.prototype.split=function(c){if(c==""||c&&c.source=="")return this.toArray();var f=[],i=0,l;if(c instanceof RegExp)for(c.global||(c=new RegExp(c.source,/\/([mi]*)$/.exec(c)[1]+"g"));l=c.exec(this);){l[0]=this.substring(i,l.index);f.push.apply(f,l);i=c.lastIndex}else for(;(l=this.indexOf(c,i))!=-1;){f.push(this.substring(i,l));i=l+c.length}f.push(this.substr(i));return f};if("12".substr(-1)!="2"){var M=
String.prototype.substr;String.prototype.substr=function(c,f){return M.call(this,c<0?Math.max(0,this.length+c):c,f)}}z(Number.prototype,{fit:function(c,f){if(!isNaN(c)&&this<c)return Number(c);if(!isNaN(f)&&this>f)return Number(f);return this},between:function(c,f){return!isNaN(this)&&this>=c&&this<=f},quote:function(c,f){return(this+"").quote(c,f)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(c){return!c||isNaN(c)?0:
Math.floor(this/c)*c},lead:function(c,f){return(this+"").replace(/\d+/,function(i){return(c-=i.length-1)>1?Array(c).join(f||0)+i:i})},group:function(c,f){return(this+"").replace(/\d+/,function(i){return i.replace(/\d/g,function(l,o){return!o+(i.length-o)%(c||3)?l:(f||" ")+l})})},format:function(c,f,i,l,o){c=this.toFixed(c);if(f||o)c=c.replace(/(\d+)(\.?)/,function(p,q,r){return(f?Number(q).group(3,f):q)+(r?o||r:"")});if(i)c=c.replace(/^-?/,"$&"+(i||""));return c+(l||"")}});L(Date,{now:function(){return+new Date}});
(new Date).getYear()<1900&&z(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(c){return this.setFullYear(!isNaN(c)&&c<100?Number(c)+1900:c)}});var G={},R=function(){function c(p,q){for(var r=G[p],a=q?q.split(/\./):[];r&&a.length;)r=r[a.shift()];return r}var f=w.document?w.document.getElementsByTagName("SCRIPT"):null,i=(f?f[f.length-1].src:module.filename).replace(/[^\/]+$/,""),l={},o;if(typeof require=="function")o=function(p){return require(requirePath+p.replace(/\./g,
"/"))};else{o=function(p,q){var r=p.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],a=p.substr(r.length?r.length+1:0),d=c(r,a),h=/^basis\./.test(r)?i:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!G[r]||!d)if(/^https?:/.test(h))if(l[p])throw"Attempt to load namespace, probably cycle require";else{l[p]=1;h=h+(q||"")+p.replace(/\./g,"/")+".js";var k=new XMLHttpRequest;k.open("POST",h,false);k.send(null);if(k.status==200){try{(new Function(k.responseText)).call(w)}catch(g){throw g;
}o.sequence.push(p.replace(/\./g,"/")+".js")}else if(k.status==404&&a)R(r);else throw"!";}else throw"Path `"+p+"` can't be resolved";return d||c(r,a)};o.sequence=[]}return o}(),P=function(){function c(p){return typeof p=="function"&&p.basisClass_}var f=Function(),i={id:1};z(f,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var p in this)this[p]=null;this.destroy=
H}},create:function(p){if(typeof p!="function")p=f;var q=Function();q.prototype=p.prototype;q={className:p.className+"._SubClass_",basisClass_:true,superClass_:p,extendConstructor_:!!p.extendConstructor_,__extend__:function(k){return k&&(typeof k=="object"||typeof k=="function"&&!c(k))?f.create.call(null,h,k):k},extend:f.extend,subclass:function(){return f.create.apply(null,[h].concat(Array.from(arguments)))},prototype:new q};for(var r=arguments,a=1;a<r.length;a++)q.extend(typeof r[a]=="function"&&
!c(r[a])?r[a](p.prototype):r[a]);var d={},h=q.extendConstructor_?function(k,g){this.eventObjectId=i.id++;var b;for(var e in k){b=this[e];this[e]=b&&b.__extend__?b.__extend__(k[e]):k[e]}this.init(g||d)}:function(){this.eventObjectId=i.id++;this.init.apply(this,arguments)};q.prototype.constructor=h;z(h,q);return h},extend:function(p){var q=this.prototype;if(p.prototype)p=p.prototype;var r=Object.keys(p);p.toString!==Object.prototype.toString&&r.add("toString");for(var a=r.length;a-- >0;){var d=r[a],
h=p[d],k=q[d];if(d=="className"||d=="extendConstructor_")this[d]=h;else q[d]=k&&k.__extend__?k.__extend__(h):h}return this}});var l=function(p,q){return{__extend__:function(r){var a=Function();a.prototype=this;a=new a;q(a,r);return a}}.__extend__(p)},o=function(p){return l(p,z)};return U("basis.Class",f.create).extend({BaseClass:f,create:f.create,isClass:c,CustomExtendProperty:l,ExtensibleProperty:o,NestedExtProperty:function(p){return l(p,function(q,r){for(var a in r){var d=q[a];q[a]=d&&d.__extend__?
d.__extend__(r[a]):o(r[a])}})}})}(),C=function(){function c(p){var q=i[p];q||(q=i[p]=function(){var r=this.handlers_,a,d;if(r&&r.length){r=f.call(r);for(var h=r.length;h-- >0;){a=r[h];d=a.handler[p];typeof d=="function"&&d.apply(a.thisObject,arguments)}}});return q}var f=Array.prototype.slice,i={},l,o=P(null,{handlers_:null,event_destroy:l=c("destroy","object"),listen:P.NestedExtProperty(),extendConstructor_:true,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,
thisObject:this.handlerContext||this})},addHandler:function(p,q){var r=this.handlers_;if(!r)r=this.handlers_=[];q||(q=this);for(var a=r.length,d;a-- >0;){d=r[a];if(d.handler===p&&d.thisObject===q)return false}return!!r.push({handler:p,thisObject:q||this})},removeHandler:function(p,q){var r=this.handlers_;if(r){q||(q=this);for(var a=r.length,d;a-- >0;){d=r[a];if(d.handler===p&&d.thisObject===q)return!!r.splice(a,1)}return false}},destroy:function(){if(this.handlers_){l.call(this,this);this.handlers_=
null}}});o.createEvent=c;o.event=i;return o}(),x=function(){var c=[];return{add:function(f){f!=null&&c.push(f)},remove:function(f){c.remove(f)}}}();(function(){function c(a){if(f){if(a.source!=w||a.data!=i)return;basis.dom.event.kill(a)}if(l.length){a=l.shift();delete o[a.key];a.fn()}}var f=typeof addEventListener=="function"&&typeof postMessage=="function",i="zeroTimeoutMessage",l=[],o={},p=1;f&&w.addEventListener("message",c,true);var q=setTimeout;w.setTimeout=function(a,d){var h;if(d)h=q.call(w,
a,d);else{h={key:"z"+p++,fn:typeof a=="function"?a:new Function(a)};o[h.key]=h;l.push(h);if(f)postMessage(i,"*");else h.timer=q.call(w,c,0);h=h.key}return h};var r=clearTimeout;w.clearTimeout=function(a){if(/z\d+/.test(a)){var d=o[a];if(d){clearTimeout(d.timer);l.remove(d);delete o[a]}}else return r.call(w,a)}})();var E=function(){function c(){if(!d)if(p.length){var h=Date.now(),k=Math.max(p[0].eventTime,h);if(k<r){clearTimeout(a);a=setTimeout(i,(r=k)-h)}}else{a=clearTimeout(a);r=l}}function f(h,
k){var g=h.eventObjectId,b=q[k]&&q[k][g];if(b){p.remove(b);delete q[k][g];c()}}function i(){var h=Date.now();h=p.binarySearchPos(h+15,o);d=true;p.splice(0,h).forEach(function(k){delete q[k.eventName][k.object.eventObjectId];k.callback.call(k.object)});d=false;r=l;c()}var l=2E12,o=A("eventTime"),p=[],q={},r=l,a=null,d=false;x.add({destroy:function(){d=true;clearTimeout(a);p.length=0;q=null}});return{add:function(h,k,g){var b=h.eventObjectId,e=q[k];e||(e=q[k]={});var j=e[b];if(j){if(isNaN(g))return f(h,
k);if(j.eventTime==g)return;p.remove(j);j.eventTime=g}else{if(isNaN(g))return;j=e[b]={eventName:k,object:h,eventTime:g,callback:h[k]}}p.splice(p.binarySearchPos(g,o),0,j);c()},remove:f}}();U("basis").extend({namespace:U,platformFeature:{},EventObject:C,TimeEventManager:E,Cleaner:x,require:R});w.basis.locale={}})(this);
(function(w,z){function L(x){var E=1E6;x=String(x).split(".");for(var c=0,f=0;c<4&&c<x.length;c++,E/=100)f+=x[c]*E;return f}function N(){for(var x=0;x<arguments.length;x++){var E=arguments[x].toLowerCase();if(E in T){if(T[E])return true}else{var c=E.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(c){T[E]=false;var f=c[1].toLowerCase(),i=L(c[3]);c=c[4]||"=";if(f=U[f])return T[E]=!i||c=="="&&f==i||c=="+"&&f>=i||c=="-"&&f<i}}}return false}var F="basis.ua",T={},U={},H=z.navigator&&z.navigator.userAgent,A=
"unknown",B="unknown",y={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]};for(var M in y)if(!(M=="MSIE"&&z.opera))if(!(M=="Safari"&&H.match(/chrome/i)))if(!(M=="AppleWebKit"&&H.match(/iphone/i)))if(H.match(new RegExp(M+
".(\\d+(\\.\\d+)*)","i"))){var G=y[M],R=z.opera&&typeof z.opera.version=="function"?z.opera.version():RegExp.$1,P=L(R);A=G[0]+P;B=G[0]+" "+R;for(A=0;A<G.length;A++)U[G[A].toLowerCase()]=P}w.platformFeature.datauri=false;H=typeof Image!="undefined"?new Image:{};H.onload=function(){w.platformFeature.datauri=true};H.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";y={set:function(x,E,c,f){document.cookie=x+"="+(E==null?"":escape(E))+";path="+(f||(location.pathname.indexOf("/")==
0?"":"/")+location.pathname)+(c?";expires="+(new Date(Date.now()+c*1E3)).toGMTString():"")},get:function(x){return(x=document.cookie.match(new RegExp("(^|;)\\s*"+x+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(x[2])},remove:function(x,E){document.cookie=x+"=;expires="+(new Date(0)).toGMTString()+";path="+(E||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)}};if(N("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(C){}F=w.namespace(F);F.toString=function(){return B};return F.extend({testImage:H,
prettyName:B,test:N,is:function(x){return N(x)},Cookies:y})})(basis,this);
(function(w,z){function L(a,d,h){if(d!=null)return a.insertBefore(i(d)?d:U(d),h||null)}function N(a){return A("",a.cloneNode(true)).innerHTML}function F(a){return i(a)||a&&a.nodeType?a:typeof a=="string"?G.getElementById(a):null}function T(a,d,h){var k,g=[];h=typeof h=="string"?getter(h):h||Function.$true;d&26&&h(a)&&g.push(a);switch(d){case 1:case 2:for(k=a;(k=k[C])&&k!==a.document;)h(k)&&g.push(k);break;case 64:for(k=a[x];k;){h(k)&&g.push(k);k=k[E]}break;case 4:case 8:if(a[x]){d=new l(a);d.nodes(h,
g)}break;case 128:d=new l(a,h);for(d.cursor_=a[E]||a[C];k=d.next();)g.push(k);break;case 256:for(k=a;k=k[E];)h(k)&&g.push(k);break;case 32:h(a[C])&&g.push(a[C]);break;case 512:d=new l(a,h,l.BACKWARD);for(d.cursor_=a[c]||a[C];k=d.next();)g.push(k);break;case 1024:for(k=a;k=k[c];)h(k)&&g.push(k);break}return g}function U(a){return G.createTextNode(a!=null?a:"")}function H(){for(var a=G.createDocumentFragment(),d=arguments.length,h=H.array=[],k=0;k<d;k++)h.push(L(a,arguments[k]));return a}function A(a){var d=
a!=undefined&&typeof a!="string",h=(d?a.description:a)||"",k="div",g=h.match(/^([a-z0-9\_\-]+)(.*)$/i);if(g){k=g[1];h=g[2]}if(h!=""){for(var b=[],e={},j;g=r.exec(h);){if(g[8])throw new Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+h+"\n\nProblem place:\n> "+h.substr(0,g.index)+"--\>"+h.substr(g.index)+"<--");j=g[1]||g[2]||g[3];if(g[1])e.id=j;else if(g[2])b.push(j);else if(j!="class")e[j]=g[4]?M(g[5],g[6],g[7]):j}if(p&&e.name&&/^(input|textarea|select)$/i.test(k))k=
"<"+k+" name="+e.name+">"}h=G.createElement(k);if(e){if(e.style&&q)h.style.cssText=e.style;for(var m in e)h.setAttribute(m,e[m],0)}if(b&&b.length)h.className=b.join(" ");arguments.length>1&&L(h,H.apply(0,Array.from(arguments,1).flatten()));if(d){a.css&&w.cssom&&w.cssom.setStyle(h,a.css);if(w.dom.event)for(var s in a)if(typeof a[s]=="function")w.dom.event.addHandler(h,s,a[s],h);else a[s]instanceof w.dom.event.Handler&&w.dom.event.addHandler(h,s,a[s].handler,a[s].thisObject)}return h}function B(a,d){return a[C]?
a[C].replaceChild(d,a):a}function y(a){if(G.selection){var d=G.selection.createRange();d.compareEndPoints("StartToEnd",d)!=0&&d.collapse(a);return d.getBookmark().charCodeAt(2)-2}}var M=Object.coalesce,G=z.document,R=w.Class,P=G.createElement("div"),C="parentNode",x="firstChild",E="nextSibling",c="previousSibling",f;f=typeof P.compareDocumentPosition=="function"?function(a,d){return a.compareDocumentPosition(d)}:function(a,d){if(a==d)return 0;if(a.document!=d.document)return 33;return a.sourceIndex>
d.sourceIndex?2|8*d.contains(childA):4|16*a.contains(childB)};var i;if(typeof Node!="undefined"){i=function(a){return a instanceof Node};if(!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else i=function(a){return a&&a.ownerDocument===G};var l=R(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,d,h){this.setRoot(a);this.setDirection(h);if(typeof d=="function")this.filter=d},setDirection:function(a){Object.extend(this,a?{a:"lastChild",
b:c,c:E,d:x}:{a:x,b:E,c:c,d:"lastChild"})},setRoot:function(a){this.root_=a||G;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,d){var h;d||(d=[]);for(this.reset();h=this.next(a);)d.push(h);return d},next:function(a){a=a||this.filter;var d=this.cursor_||this.root_;do for(var h=d[this.a];!h;){if(d===this.root_)return this.cursor_=null;(h=d[this.b])||(d=d[C])}while(!a(d=h));return this.cursor_=
d},prev:function(a){a=a||this.filter;var d=this.cursor_,h=this.c,k=this.d;do{var g=d?d[h]:this.root_[k];if(g){for(;g[k];)g=g[k];d=g}else if(d)d=d[C];if(!d||d===this.root_){d=null;break}}while(!a(d));return this.cursor_=d},destroy:function(){this.cursor_=this.root_=null}});l.BACKWARD=true;var o="textContent innerText nodeValue".qw(),p=function(){var a=G.createElement("input");a.name="a";return!/name/.test(N(a))}(),q;P.setAttribute("style","color: red");q=P.style.color!=="red";var r=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return w.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:l,outerHTML:N,textContent:function(a){for(var d=0,h;h=o[d++];)if(a[h]!=null)return a[h];return T(a,4,function(k){return k.nodeType==3}).map(getter("nodeValue")).join("")},get:F,tag:function(a,d){a=F(a)||G;return d=="*"&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(d||"*"))},axis:T,findAncestor:function(a,d,h){for(;a&&a!==h;){if(d(a))return a;a=a.parentNode}},createElement:A,createText:U,createFragment:H,insert:function(a,
d,h,k){a=F(a);if(!a)throw new Error("basis.dom.insert: destination node can't be null");switch(h){case undefined:case "end":k=null;break;case "begin":k=a[x];break;case "before":break;case "after":k=k[E];break;default:k=Number(h).between(0,a.childNodes.length)?a.childNodes[h]:null}h=!i(a);if(!d||!Array.isArray(d))h=h?d&&a.insertBefore(d,k):L(a,d,k);else if(h){h=[];for(var g=0,b=d.length;g<b;g++)h[g]=a.insertBefore(d[g],k)}else{a.insertBefore(H.apply(0,d),k);h=H.array}return h},remove:function(a){return a[C]?
a[C].removeChild(a):a},replace:B,swap:function(a,d){if(a===d||f(a,d)&25)return false;B(a,P);B(d,a);B(P,d);return true},clone:function(a,d){var h=a.cloneNode(!d);h.attachEvent&&T(h,8).forEach(Event.clearHandlers);return h},clear:function(a){for(a=F(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,d,h){var k=[];h=Function.getter(h||Function.$self);for(var g in d)for(var b=0;b<a.length;b++){var e=h(a[b]);k[b]=d[g](a[b],b,e)?A(g,e):a[b]}return k},setAttribute:function(a,d,h){h==null?
a.removeAttribute(d):a.setAttribute(d,h)},parentOf:function(a,d){return a.contains(d)},isInside:function(a,d){return a==d||d.contains(a)},focus:function(a,d){try{a=F(a);a.focus();d&&a.select&&a.select()}catch(h){}},setSelectionRange:function(a,d,h){if(arguments.length<3)h=d;if(a.setSelectionRange)a.setSelectionRange(d,h);else if(a.createTextRange){var k=a.createTextRange();k.collapse(true);k.moveStart("character",d);k.moveEnd("character",h-d);k.select()}},getSelectionStart:function(a){return typeof a.selectionStart!=
"undefined"?a.selectionStart:y(true)},getSelectionEnd:function(a){return typeof a.selectionEnd!="undefined"?a.selectionEnd:y(false)}})})(basis,this);
(function(w,z){function L(c){return c||z.event}function N(c){return typeof c=="string"?M.get(c):c}function F(c){c=L(c);if(c.stopPropagation)c.stopPropagation();else c.cancelBubble=true}function T(c){c=L(c);if(c.preventDefault)c.preventDefault();else c.returnValue=false}function U(c){var f=Array.from(C[c.type]);if(f)for(var i=f.length;i-- >0;){var l=f[i];l.handler.call(l.thisObject,c)}}function H(c,f,i,l){c=N(c);if(!c)throw new Error("Event.addHandler: can't attach event listener to undefined");if(typeof i!=
"function")throw new Error("Event.addHandler: handler must be a function");c[R]||(c[R]={});var o={handler:i,thisObject:l},p=c[R],q=p[f];if(q){for(c=0;f=q[c];c++)if(f.handler===i&&f.thisObject===l)return;q.push(o)}else{q=p[f]=[o];q.fireEvent=function(r){r=L(r);if(x&&r)if(typeof r.returnValue=="undefined"){U(r);if(r.cancelBubble===true)return;if(typeof r.returnValue=="undefined")r.returnValue=true}for(var a=0,d;d=q[a++];)d.handler.call(d.thisObject,r)};c.addEventListener?c.addEventListener(f,q.fireEvent,
false):c.attachEvent("on"+f,q.fireEvent)}}function A(c,f,i,l){c=N(c);var o=c[R];if(o)if(o=o[f])for(var p=0,q;q=o[p];p++)if(q.handler===i&&q.thisObject===l){o.splice(p,1);o.length||B(c,f);return}}function B(c,f){c=N(c);var i=c[R];if(i)if(typeof f!="string")for(f in i)B(c,f);else{var l=i[f];if(l){c.removeEventListener?c.removeEventListener(f,l.fireEvent,false):c.detachEvent("on"+f,l.fireEvent);delete i[f]}}}var y=z.document,M=w.dom,G=Function.$null,R="__basisEvents",P={mousewheel:["mousewheel","DOMMouseScroll"]},
C={},x=!y.addEventListener,E=function(){function c(){f++||setTimeout(function(){for(var o=0;o<i.length;o++)i[o].callback.call(i[o].thisObject)},10)}var f=false,i=[];if(w.ua.is("ie7-"))(function(){var o="_"+Date.now();y.write('<script id="'+o+'" defer src="//:"><\/script>');N(o).onreadystatechange=function(){if(this.readyState=="complete"){M.remove(this);c()}}})();else if(w.ua.is("safari525-"))var l=setInterval(function(){if(/loaded|complete/.test(y.readyState)){clearInterval(l);c()}},15);else H(y,
"DOMContentLoaded",c,false);H(y,"load",c,false);H(z,"load",c,false);return function(o,p){f||i.push({callback:o,thisObject:p})}}();return w.namespace("basis.dom.event",L).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(c){return P[c]||[c]},Handler:function(c,
f){this.handler=c;this.thisObject=f},sender:function(c){c=L(c);return c.target||c.srcElement},cancelBubble:F,cancelDefault:T,kill:function(c,f){if(f=N(f))H(f,c,Event.kill);else{T(c);F(c)}},key:function(c){c=L(c);return c.keyCode||c.which||0},charCode:function(c){c=L(c);return c.charCode||c.keyCode||0},mouseButton:function(c,f){c=L(c);return typeof c.which=="number"?c.which==f.VALUE:c.button&f.BIT},mouseX:function(c){c=L(c);return c.changedTouches?c.changedTouches[0].pageX:"pageX"in c?c.pageX:c.clientX+
(y.documentElement.scrollLeft||y.body.scrollLeft)},mouseY:function(c){c=L(c);return c.changedTouches?c.changedTouches[0].pageY:"pageY"in c?c.pageY:c.clientY+(y.documentElement.scrollTop||y.body.scrollTop)},wheelDelta:function(c){c=L(c);return"wheelDelta"in c?c.wheelDelta/120:c.type=="DOMMouseScroll"?-c.detail/3:0},addGlobalHandler:function(c,f,i){var l=C[c];if(l)for(c=l.length;c-- >0;){var o=l[c];if(o.handler===f&&o.thisObject===i)return}else{y.addEventListener?y.addEventListener(c,U,true):H(y,c,
G);l=C[c]=[]}l.push({handler:f,thisObject:i})},removeGlobalHandler:function(c,f,i){var l=C[c];if(l)for(var o=0,p;p=l[o];o++)if(p.handler===f&&p.thisObject===i){l.splice(o,1);if(!l.length){delete C[c];y.removeEventListener?y.removeEventListener(c,U,true):A(y,c,G)}return}},addHandler:H,addHandlers:function(c,f,i){c=N(c);for(var l in f)H(c,l,f[l],i)},removeHandler:A,clearHandlers:B,fireEvent:function(c,f){c=N(c);var i=c[R];i&&i[f]&&i[f].fireEvent()},onLoad:E,onUnload:function(c,f){H(z,"unload",c,f)}})})(basis,
this);
(function(){function w(a,d,h){for(var k=1,g;d;){if(d&1){g=R[k];if(h&k){a.addHandler(g.handler,g.context);g.action(g.context.add,a)}else{a.removeHandler(g.handler,g.context);g.action(g.context.remove,a)}}d>>=1;k<<=1}}function z(a,d){var h={},k;if(a&&a.length)k=h.inserted=a;if(d&&d.length)k=h.deleted=d;if(k)return h}function L(a){return Array.isArray(a)?a.map(L):{data:a}}var N=basis.Class,F=basis.EventObject,T=Object.values,U=Function.$self,H=Function.$true,A=Function.$false,B=F.createEvent,y=F.event,
M={},G=[],R={},P=1,C={NONE:0,MASK:0,regType:function(a,d,h){R[P]={handler:d,action:h,context:{add:function(k,g){if(g){var b=C[a]+"_"+k.eventObjectId;if(!g.subscribers_)g.subscribers_={};if(!g.subscribers_[b]){var e=g.subscriberCount;g.subscribers_[b]=k;g.subscriberCount+=1;g.event_subscribersChanged(g,e)}}},remove:function(k,g){if(g){var b=C[a]+"_"+k.eventObjectId;if(g.subscribers_[b]){var e=g.subscriberCount;delete g.subscribers_[b];g.subscriberCount-=1;g.event_subscribersChanged(g,e)}}}}};C[a]=
P;C.MASK|=P;P<<=1}};C.regType("DELEGATE",{delegateChanged:function(a,d){this.remove(a,d);this.add(a,a.delegate)}},function(a,d){a(d,d.delegate)});C.regType("TARGET",{targetChanged:function(a,d){this.remove(a,d);this.add(a,a.target)}},function(a,d){a(d,d.target)});C.regType("SOURCE",{sourceChanged:function(a,d){this.remove(a,d);this.add(a,a.source)},sourcesChanged:function(a,d){var h;if(h=d.inserted)for(var k=h.length;k-- >0;)this.add(a,h[k]);if(h=d.deleted)for(k=h.length;k-- >0;)this.remove(a,h[k])}},
function(a,d){for(var h=d.sources||[d.source],k=0,g;g=h[k++];)a(d,g)});var x=N(F,{state:"ready",data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,target:null,active:false,subscribeTo:C.DELEGATE+C.TARGET,subscriberCount:0,subscribers_:null,event_update:B("update","object","delta"),event_stateChanged:B("stateChanged","object","oldState"),event_delegateChanged:B("delegateChanged","object","oldDelegate"),event_rootChanged:B("rootChanged","object","oldRoot"),event_targetChanged:B("targetChanged",
"object","oldTarget")&&function(a,d){var h=this.listen.target;if(h){d&&d.removeHandler(h,this);this.target&&this.target.addHandler(h,this)}y.targetChanged.call(this,a,d)},event_subscribersChanged:B("subscribersChanged","object"),event_activeChanged:B("activeChanged","object"),listen:{delegate:{update:function(a,d){this.data=a.data;this.event_update(this,d)},stateChanged:function(a,d){this.state=a.state;this.event_stateChanged(this,d)},targetChanged:function(a,d){this.target=a.target;this.event_targetChanged(this,
d)},rootChanged:function(a,d){this.data=a.data;this.event_rootChanged(this,d)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},init:function(a){F.prototype.init.call(this,a);if(a=this.delegate){this.delegate=null;this.data=a.data;this.state=a.state;this.setDelegate(a)}else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&w(this,this.subscribeTo,C.MASK)},isConnected:function(a){if(a instanceof x){for(;a&&a!==this&&a!==a.delegate;)a=
a.delegate;return a===this}return false},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&a&&a instanceof x){if(a.delegate&&this.isConnected(a))return false}else a=null;if(this.delegate!==a){var d=this.state,h=this.data,k=this.delegate,g=this.target,b=this.root,e={};k&&k.removeHandler(this.listen.delegate,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;
a.addHandler(this.listen.delegate,this);for(var j in a.data)if(j in h===false)e[j]=undefined;for(j in h)if(h[j]!==a.data[j])e[j]=h[j]}else{this.target=this.delegate=null;this.root=this;this.data={};for(j in h)this.data[j]=h[j]}this.event_delegateChanged(this,k);this.root!==b&&this.event_rootChanged(this,b);this.target!==g&&this.event_targetChanged(this,g);if(a){for(j in e){this.event_update(this,e);break}if(d!==this.state&&(String(d)!=this.state||d.data!==this.state.data))this.event_stateChanged(this,
d)}return true}return false},setState:function(a,d){var h=this.target||this.getRootDelegate();if(h!==this)return h.setState(a,d);if(this.state!=String(a)||this.state.data!=d){h=this.state;this.state=Object(String(a));this.state.data=d;this.event_stateChanged(this,h);return true}return false},deprecate:function(){this.state!="processing"&&this.setState("deprecated")},update:function(a){var d=this.target||this.getRootDelegate();if(d!==this)return d.update(a);if(a){d={};var h=0;for(var k in a)if(this.data[k]!==
a[k]){h++;d[k]=this.data[k];this.data[k]=a[k]}if(h){this.event_update(this,d);return d}}return false},setActive:function(a){a=!!a;if(this.active!=a){this.active=a;this.event_activeChanged(this);w(this,this.subscribeTo,C.MASK*a);return true}return false},setSubscription:function(a){a=a&C.MASK;var d=this.subscribeTo^a;if(d){this.subscribeTo=a;this.active&&w(this,d,a);return true}return false},destroy:function(){this.active&&w(this,this.subscribeTo,0);this.delegate&&this.setDelegate();F.prototype.destroy.call(this);
this.data=M;this.state="undefined";this.target=this.root=null}}),E=N(null,{itemClass:x,keyGetter:U,map_:null,extendConstructor_:true,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var d={};if(a instanceof x)d.delegate=a;else d.data={id:a,title:a};return new this.itemClass(d)},get:function(a,d){var h=a instanceof x?a.eventObjectId:a,k=this.map_[h];if(!k&&d){k=this.map_[h]=this.create(a,d);k.addHandler({destroy:function(){delete this.map_[h]}},
this)}return k},destroy:function(){basis.Cleaner.remove(this);for(var a=T(this.map_),d=0,h;h=a[d++];)h.destroy()}}),c=N(x,{state:"undefined",itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:B("datasetChanged","dataset","delta")&&function(a,d){var h,k=0,g=0,b;if(h=d.inserted)for(;b=h[k];){this.item_[b.eventObjectId]=b;k++}if(h=d.deleted)for(;b=h[g];){delete this.item_[b.eventObjectId];g++}this.itemCount+=k-g;this.cache_=null;y.datasetChanged.call(this,a,d)},init:function(a){x.prototype.init.call(this,
a);this.memberMap_={};this.item_={}},has:function(a){return!!(a&&this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=T(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var d=[];if(a)for(var h in this.item_)if(d.push(this.item_[h])>=a)break;return d},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();x.prototype.destroy.call(this);
this.cache_=G;this.itemCount=0;this.item_=this.memberMap_=null}}),f=N(c,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&this.remove([a])}}},init:function(a){c.prototype.init.call(this,a);if(a=this.items){this.set(a);this.items=null}},add:function(a){for(var d,h=this.memberMap_,k=[],g=0;g<a.length;g++){var b=a[g];if(b instanceof x){var e=b.eventObjectId;if(!h[e]){h[e]=b;b.addHandler(this.listen.item,this);k.push(b)}}}if(k.length)this.event_datasetChanged(this,d={inserted:k});return d},
remove:function(a){for(var d,h=this.memberMap_,k=[],g=0;g<a.length;g++){var b=a[g];if(b instanceof x){var e=b.eventObjectId;if(h[e]){b.removeHandler(this.listen.item,this);delete h[e];k.push(b)}}}if(k.length)this.event_datasetChanged(this,d={deleted:k});return d},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var d=this.memberMap_,h={},k=[],g=[],b,e,j=0;j<a.length;j++){b=a[j];if(b instanceof x){e=b.eventObjectId;h[e]=b;if(!d[e]){d[e]=b;b.addHandler(this.listen.item,
this);g.push(b)}}}for(e in d)if(!h[e]){b=d[e];b.removeHandler(this.listen.item,this);delete d[e];k.push(b)}if(a=z(g,k))this.event_datasetChanged(this,a);return a},sync:function(a,d){if(a){f.setAccumulateState(true);for(var h=this.memberMap_,k,g,b={},e=[],j,m=0;m<a.length;m++){k=a[m];if(k instanceof x){g=k.eventObjectId;b[g]=k;h[g]||e.push(k)}}for(g in this.item_)b[g]||this.item_[g].destroy();if(d&&e.length)j=this.add(e);f.setAccumulateState(false);return j}},clear:function(){var a,d=this.getItems();
if(d.length){for(a=d.length;a-- >0;)d[a].removeHandler(this.listen.item,this);this.event_datasetChanged(this,a={deleted:d});this.memberMap_={}}return a}});f.setAccumulateState=function(){function a(m){var s=m.dataset;g.call(s,s,m)}function d(m,s){var I=m.eventObjectId,D=s.inserted,S=s.deleted,n=j[I];if(D&&S){if(n){delete j[I];a(n)}return g.call(m,m,s)}if(n){var t=n[D?"inserted":"deleted"];if(t)return t.push.apply(t,D||S);else a(n)}j[I]=s;s.dataset=m}function h(){b=1;setAccumulateState(false)}var k=
c.prototype,g=k.event_datasetChanged,b=0,e,j={};return function(m){if(m){if(b==0){k.event_datasetChanged=d;e=setTimeout(h,0)}b++}else{b-=b>0;if(b==0){clearTimeout(e);k.event_datasetChanged=g;m=j;j={};T(m).forEach(a)}}}}();var i={datasetChanged:function(a,d){var h=this.memberMap_,k={},g,b;if(d.inserted)for(var e=0;g=d.inserted[e];e++){b=g.eventObjectId;if(h[b])h[b].count++;else h[b]={count:1,object:g};k[b]=h[b]}if(d.deleted)for(e=0;g=d.deleted[e];e++){b=g.eventObjectId;k[b]=h[b];h[b].count--}this.applyRule(k)},
destroy:function(a){this.removeSource(a)}},l=N(c,{subscribeTo:C.SOURCE,event_sourcesChanged:B("sourcesChanged","dataset","delta"),sources:null,rule:function(a){return a>0},listen:{source:i},init:function(a){c.prototype.init.call(this,a);a=this.sources;this.sources=[];a&&a.forEach(this.addSource,this)},setRule:function(a){if(typeof a!="function")a=l.UNION;if(this.rule!==a){this.rule=a;this.applyRule()}},applyRule:function(a){var d=this.memberMap_,h=this.rule,k=this.sources.length,g=[],b=[],e,j;a||
(a=d);for(var m in a){e=d[m];j=k&&e.count&&h(e.count,k);if(j!=!!this.item_[m])(j?g:b).push(e.object);e.count==0&&delete d[m]}if(a=z(g,b))this.event_datasetChanged(this,a)},addSource:function(a){if(a instanceof c)if(this.sources.add(a)){a.addHandler(this.listen.source,this);var d=this.memberMap_;for(var h in a.item_)if(d[h])d[h].count++;else d[h]={count:1,object:a.item_[h]};this.applyRule();this.event_sourcesChanged(this,{inserted:[a]});return true}},removeSource:function(a){if(this.sources.remove(a)){a.removeHandler(this.listen.source,
this);var d=this.memberMap_;for(var h in a.item_)d[h].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[a]});return true}},setSources:function(a){for(var d=Array.from(this.sources),h=0,k;k=a[h];h++)if(k instanceof c)d.remove(k)||this.addSource(k);d.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){c.prototype.destroy.call(this);this.sources=null}});l.UNION=l.prototype.rule;l.INTERSECTION=function(a,d){return a==
d};l.DIFFERENCE=function(a){return a==1};l.MORE_THAN_ONE_INCLUDE=function(a,d){return d==1||a>1};l.AT_LEAST_ONE_EXCLUDE=function(a,d){return d==1||a<d};var o=function(a){return!this.has(a)};i=N(c,{minuend:null,subtrahend:null,listen:{minuend:{datasetChanged:function(a,d){if(this.subtrahend){var h=z(d.inserted&&d.inserted.filter(o,this.subtrahend),d.deleted&&d.deleted.filter(this.has,this));h&&this.event_datasetChanged(this,h)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(a,
d){if(this.minuend){var h=z(d.deleted&&d.deleted.filter(o,this),d.inserted&&d.inserted.filter(this.has,this));h&&this.event_datasetChanged(this,h)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(a){c.prototype.init.call(this,a);a=this.minuend;var d=this.subtrahend;this.subtrahend=this.minuend=null;if(a||d)this.setOperands(a,d)},setOperands:function(a,d){var h;if(a instanceof c==false)a=null;if(d instanceof c==false)d=null;var k=this.minuend,g=this.subtrahend;if(k!==a){k&&
k.removeHandler(this.listen.minuend,this);if(this.minuend=a)a.addHandler(this.listen.minuend,this)}if(g!==d){g&&g.removeHandler(this.listen.subtrahend,this);if(this.subtrahend=d)d.addHandler(this.listen.subtrahend,this)}if(!a||!d){if(this.itemCount)this.event_datasetChanged(this,h={deleted:this.getItems()})}else{h=[];k=[];for(var b in this.item_)if(!a.item_[b]||d.item_[b])h.push(this.item_[b]);for(b in a.item_)!this.item_[b]&&!d.item_[b]&&k.push(a.item_[b]);if(h=z(k,h))this.event_datasetChanged(this,
h)}return h},clear:function(){this.setOperands()}});var p={update:function(a){var d=this.map?this.map(a):a;if(d instanceof x==false||this.reduce(d))d=null;var h=this.sourceMap_[a.eventObjectId],k=h.member;if(k!=d){var g=this.memberMap_,b,e;h.member=d;if(k){h=k.eventObjectId;this.removeMemberRef&&this.removeMemberRef(k,a);if(--g[h]==0){delete g[h];e=[k]}}if(d){k=d.eventObjectId;this.addMemberRef&&this.addMemberRef(d,a);if(g[k])g[k]++;else{g[k]=1;b=[d]}}if(a=z(b,e))this.event_datasetChanged(this,a)}}},
q={datasetChanged:function(a,d){var h=this.sourceMap_,k=this.memberMap_,g=[],b=[],e,j,m;f.setAccumulateState(true);if(d.inserted)for(var s=0;e=d.inserted[s];s++){m=this.map?this.map(e):e;if(m instanceof x==false||this.reduce(m))m=null;e.addHandler(this.listen.sourceObject,this);h[e.eventObjectId]={sourceObject:e,member:m};if(m){j=m.eventObjectId;if(k[j])k[j]++;else{k[j]=1;g.push(m)}this.addMemberRef&&this.addMemberRef(m,e)}}if(d.deleted)for(s=0;e=d.deleted[s];s++){j=e.eventObjectId;m=h[j].member;
e.removeHandler(this.listen.sourceObject,this);delete h[j];if(m){j=m.eventObjectId;if(--k[j]==0){delete k[j];b.push(m)}this.removeMemberRef&&this.removeMemberRef(m,e)}}f.setAccumulateState(false);if(d=z(g,b))this.event_datasetChanged(this,d)},destroy:function(){this.setSource()}},r=N(c,{source:null,event_sourceChanged:B("sourceChanged","dataset","oldSource"),map:U,reduce:A,rule:A,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:p,source:q},init:function(a){c.prototype.init.call(this,
a);this.sourceMap_={};if(a=this.source){this.source=null;this.setSource(a)}},setRule:function(a){if(typeof a!="function")a=H;if(this.rule!==a){this.rule=a;return this.applyRule()}},setMap:function(a){if(typeof a!="function")a=U;if(this.map!==a){this.map=a;return this.applyRule()}},setSource:function(a){if(a instanceof c==false)a=null;if(this.source!==a){var d=this.source;if(d){d.removeHandler(this.listen.source,this);this.listen.source.datasetChanged.call(this,d,{deleted:d.getItems()})}if(this.source=
a){a.addHandler(this.listen.source,this);this.listen.source.datasetChanged.call(this,a,{inserted:a.getItems()})}this.event_sourceChanged(this,d)}},applyRule:function(){var a=this.sourceMap_,d=this.memberMap_,h,k,g,b,e,j=[],m=[];for(var s in a){e=a[s];b=e.sourceObject;h=e.member;k=this.map?this.map(b):b;if(k instanceof x==false||this.reduce(k))k=null;if(h!=k){e.member=k;if(h){g=h.eventObjectId;this.removeMemberRef&&this.removeMemberRef(h,b);d[g]--}if(k){h=k.eventObjectId;this.addMemberRef&&this.addMemberRef(k,
b);if(h in d)d[h]++;else{d[h]=1;j.push(k)}}}}for(g in this.item_)if(d[g]==0){delete d[g];m.push(this.item_[g])}if(a=z(j,m))this.event_datasetChanged(this,a);return a},clear:function(){this.setSource()},destroy:function(){c.prototype.destroy.call(this);this.sourceMap_=null}});A=N(r,{reduce:function(a){return!this.rule(a)},rule:H});N=N(r,{map:function(a){return this.keyMap.resolve(a)},rule:H,subsetClass:c,keyMap:null,addMemberRef:function(a,d){a.event_datasetChanged(a,{inserted:[d]})},removeMemberRef:function(a,
d){a.event_datasetChanged(a,{deleted:[d]})},init:function(a){if(!this.keyMap||this.keyMap instanceof E==false)this.keyMap=new E(Object.extend({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));r.prototype.init.call(this,a)},getSubset:function(a,d){return this.keyMap.get(a,d)},destroy:function(){r.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});Object.extend(f,{Merge:l,Subtract:i,MapReduce:r,Subset:A,Split:N});basis.namespace("basis.data",L).extend({STATE:{UNDEFINED:"undefined",
READY:"ready",PROCESSING:"processing",ERROR:"error",DEPRECATED:"deprecated"},Subscription:C,Object:x,DataObject:x,KeyObjectMap:E,AbstractDataset:c,Dataset:f,AggregateDataset:l,Collection:A,Grouping:N});basis.namespace("basis.data.dataset").extend({Merge:l,Subtract:i,MapReduce:r,Subset:A,Split:N})})();
(function(w,z){function L(f,i,l,o){i=i.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i);for(var p=C(),q,r=0;r<i.length;r++){if(r%2){q=i[r].split(/\|/);f.getters[q[0]]=l+"childNodes["+o+"]";q=q.length>1?q[1]:q[0]}else q=i[r].length?i[r]:null;if(q!=null){if(P){p.lastChild&&p.appendChild(H.createComment(""));o++}p.appendChild(x(q));o++}}return p}function N(f){return function(i){if(!(i&&i.type=="click"&&i.which==3)){var l=w.dom.event.sender(i),o,p;do if(o=l.getAttributeNode&&l.getAttributeNode(f))break;while(l=
l.parentNode);if(l&&o){do if(p=l.basisObjectId)if((p=M[p])&&p.templateAction){l=o.nodeValue.qw();o=0;for(var q;q=l[o++];)p.templateAction(q,w.dom.event(i));break}while(l=l.parentNode)}}}}function F(f,i,l){i=i.trim();if(!i)return"";for(var o="",p;p=R.exec(i);){var q=p[2],r=p[4]||p[5]||q;if(p[3])f.getters[p[3]]=l+'.getAttributeNode("'+q+'")';if(p=q.match(/^event-([a-z]+)/i)){var a=p[1];if(!y[a]){y[a]=true;p=0;a=w.dom.event.browserEvents(a);for(var d;d=a[p++];)w.dom.event.addGlobalHandler(d,N(q))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(h,k){h=w.dom.event(h);var g=this,b;do if(b=g.basisObjectId)if((b=M[b])&&b.templateAction){g=k.qw();for(var e=0,j;j=g[e++];)b.templateAction(j,w.dom.event(h));break}while(g=g.parentNode)}}o+=q=="class"?r.trim().replace(/^(.)|\s+/g,".$1"):"["+q+(r?"="+r.quote('"'):"")+"]"}return o}function T(f,i){if(!f.stack)f.stack=[];if(!f.source)f.source=f.str;i||(i=".");for(var l=C(),o,p=0,q,r=f.stack;q=G.exec(f.str);){o=RegExp.leftContext;f.str=f.str.substr(o.length+q[0].length);if(o.length){l.appendChild(L(f,
o,i,p));p=l.childNodes.length}if(q[5])if(q[5]==r[r.length-1]){r.pop();return l}else throw"Wrong end tag";if(q[6]){if(q[7])f.getters[q[7]]=i+"childNodes["+p+"]";l.appendChild(H.createComment(q[6]))}else{o=q[1];var a=q[2],d=!!q[4],h=i+"childNodes["+p+"]";q=A.createElement(o+F(f,q[3],h));if(a)f.getters[a]=h;if(!d){r.push(o);q.appendChild(T(f,h+"."))}l.appendChild(q)}p++}f.str.length&&l.appendChild(L(f,f.str,i,p));if(r.length)throw"No end tag for "+r.reverse();return l}function U(f){if(!this.proto){f=
this.source;if(typeof f=="function")this.source=f=f();f=f.trim();f={str:f,getters:{element:".childNodes[0]"}};var i=T(f);f=Object.iterate(f.getters,function(r,a){for(var d=r.split(/\|/).map(String.format,"obj_.{0}"),h=a.split(/(\.?childNodes\[(\d+)\])/),k=i,g=0;g<h.length;g+=3){var b=h[g+2];if(!b)break;h[g+2]="";k=k.childNodes[b];if(k.previousSibling)k.nextSibling||(h[g+1]=".lastChild");else h[g+1]=".firstChild"}return{name:d[0],alias:d.join("="),path:"dom_"+h.join("")}}).sortAsObject("path");for(var l=
0;l<f.length;l++)for(var o=new RegExp("^"+f[l].path.forRegExp()),p=l+1,q;q=f[p++];)q.path=q.path.replace(o,f[l].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(r,a){obj_=r||{};dom_=proto_.cloneNode(true);_code_();if(a&&obj_.element){var d=obj_.element.basisObjectId=map_.seed++;map_[d]=a}return obj_}.toString().replace("_code_()",f.map(String.format,"{alias}={path};\n").join(""))))(i,M);this.clearInstance=(new Function("map_","var obj_; return "+function(r){obj_=
r;(r=obj_.element&&obj_.element.basisObjectId)&&delete map_[r];_code_()}.toString().replace("_code_()",f.map(String.format,"{alias}=null;\n").join(""))))(M)}}var H=z.document,A=w.dom,B=w.Class,y={},M={seed:1},G=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,R=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;A.createFragment();var P=A.createElement("","a","b").cloneNode(true).childNodes.length==
1,C=A.createFragment,x=A.createText,E=B(null,{__extend__:function(f){return f instanceof E?f:new E(f)},init:function(f){this.source=f},createInstance:function(f,i){U.call(this);return this.createInstance(f,i)},clearInstance:function(){U.call(this)}}),c=H.createElement("DIV");return w.namespace("basis.html").extend({Template:E,escape:function(f){return A.createElement("DIV",A.createText(f)).innerHTML},unescape:function(f){c.innerHTML=f;return c.firstChild.nodeValue},string2Html:function(f){c.innerHTML=
f;return A.createFragment.apply(null,Array.from(c.childNodes))}})})(basis,this);
(function(w){function z(b){return b.sortingValue||0}function L(b,e){b=b.sortingValue||0;e=e.sortingValue||0;return+(b>e)||-(b<e)}function N(b,e){b=b.sortingValue||0;e=e.sortingValue||0;return-(b>e)||+(b<e)}function F(b){return b.childNodes.sort(b.localSortingDesc?N:L)}function T(b,e){b.childNodes=e;b.firstChild=e[0]||null;b.lastChild=e[e.length-1]||null;for(var j=e.length-1;j>=0;j--){e[j].nextSibling=e[j+1]||null;e[j].previousSibling=e[j-1]||null;b.insertBefore(e[j],e[j].nextSibling)}}function U(b,
e){var j=b.childFactory||b.document&&b.document.childFactory,m;e=Object.extend({document:b.document,contextSelection:b.selection||b.contextSelection},e);if(j){m=j.call(b,e);if(m instanceof b.childClass)return m}if(!m)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(b.childClass&&b.childClass.className)+" but "+(m&&m.constructor&&m.constructor.className)+")";}function H(){return w.ui.apply(this,arguments)}var A=w.Class,B=w.dom,y=w.data,M=
y.Subscription,G=y.DataObject,R=y.AbstractDataset,P=y.Dataset,C=B.AXIS_DESCENDANT,x=B.AXIS_DESCENDANT_OR_SELF,E=Function.getter,c=Object.complete,f=B.axis;y=w.EventObject.createEvent;var i=w.EventObject.event;M.regType("DATASOURCE",{dataSourceChanged:function(b,e){this.remove(b,e);this.add(b,b.dataSource)}},function(b,e){b(e,e.dataSource)});var l=A.ExtensibleProperty(),o={ownerChanged:function(){},destroy:function(b){B.replace(b.element,this)}},p=function(){var b=this.key,e=this.config,j=this.owner,
m=typeof e.existsIf!="function"||e.existsIf(j),s=j.satellite[b];if(m){m="delegate"in e;var I="dataSource"in e,D=typeof e.delegate=="function"?e.delegate(j):null,S=typeof e.dataSource=="function"?e.dataSource(j):null;if(s){m&&s.setDelegate(D);I&&s.setDataSource(S)}else{var n=j.tmpl[e.replace||b];s={owner:j};if(m)s.delegate=D;if(I)s.dataSource=S;if(e.config)Object.complete(s,typeof e.config=="function"?e.config(j):e.config);s=new e.instanceOf(s);j.satellite[b]=s;if(n&&s instanceof w.ui.Node&&s.element){B.replace(n,
s.element);s.addHandler(o,n)}}}else if(s){s.destroy();s.owner=null;delete j.satellite[b]}},q=A.CustomExtendProperty({update:true},function(b,e){for(var j in e)b[j]=e[j]?p:null}),r=A(G,{event_update:function(b,e){G.prototype.event_update.call(this,b,e);var j=this.parentNode;if(j){if(j.matchFunction){this.match();this.match(j.matchFunction)}j.insertBefore(this,this.nextSibling)}},event_childNodesModified:y("childNodesModified","node","delta"),event_dataSourceChanged:y("dataSourceChanged","node","oldDataSource"),
event_localGroupingChanged:y("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:y("localSortingChanged","node"),event_ownerChanged:y("ownerChanged","node","oldOwner"),event_satellitesChanged:y("satellitesChanged","node","delta"),subscribeTo:G.prototype.subscribeTo+M.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegateParent:false,nodeType:"DOMWrapperNode",canHaveChildren:false,childNodes:null,dataSource:null,colMap_:null,destroyDataSourceMember:true,
document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:false,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:l,satellite:null,owner:null,init:function(b){var e=this.dataSource,j=this.childNodes,m=this.localGrouping;if(e)this.dataSource=null;G.prototype.init.call(this,b);if(m){this.localGrouping=null;this.setLocalGrouping(m)}if(this.canHaveChildren){this.childNodes=[];if(e){this.dataSource=null;
this.setDataSource(e)}else j&&this.setChildNodes(j)}else{if(j)this.childNodes=null;if(e)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==l)for(var s in this.satelliteConfig){b=this.satelliteConfig[s];if(A.isClass(b))b={instanceOf:b};if(typeof b=="object"){e={key:s,owner:this,config:b};b=b.hook?q.__extend__(b.hook):q;for(s in b)if(b[s]===p){this.addHandler(b,e);break}p.call(e)}}if(s=this.owner){this.owner=null;this.setOwner(s)}},appendChild:function(){},insertBefore:function(){},
removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(b){if(!b||b instanceof r==false)b=null;if(this.owner!==b){var e=this.owner;e&&e.removeHandler(this.listen.owner,this);if(this.owner=b)b.addHandler(this.listen.owner,this);this.event_ownerChanged(this,e)}},destroy:function(){G.prototype.destroy.call(this);
if(this.dataSource)this.setDataSource();else this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping){this.localGrouping.destroy();this.localGrouping=null}this.owner&&this.setOwner();if(this.satellite){for(var b in this.satellite){var e=this.satellite[b];e.destroy();e.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=this.document=null}}),a=A(r,{autoDestroyIfEmpty:false,
nodes:null,first:null,last:null,init:function(b){this.nodes=[];r.prototype.init.call(this,b)},insert:function(b,e){var j=this.nodes,m=e?j.indexOf(e):j.length;if(m==-1)m=j.length;j.splice(m,0,b);this.first=j[0]||null;this.last=j[j.length-1]||null;b.groupNode=this;this.event_childNodesModified(this,{inserted:[b]})},remove:function(b){var e=this.nodes;if(e.remove(b)){this.first=e[0]||null;this.last=e[e.length-1]||null;b.groupNode=null;this.event_childNodesModified(this,{deleted:[b]})}!this.first&&this.autoDestroyIfEmpty&&
this.destroy()},clear:function(){if(this.first){for(var b=this.nodes,e=b.length;e-- >0;)b[e].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:b});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){r.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),d={canHaveChildren:true,childClass:r,childFactory:null,listen:{dataSource:{datasetChanged:function(b,e){var j={},m=[];if(e.deleted){j.deleted=m;if(this.childNodes.length==e.deleted.length){m.push.apply(m,
this.childNodes);var s=this.dataSource;this.dataSource=null;this.clear(true);this.dataSource=s;this.colMap_={}}else{s=0;for(var I;I=e.deleted[s];s++){I=I.eventObjectId;var D=this.colMap_[I];delete this.colMap_[I];D.canHaveDelegate=true;this.removeChild(D);m.push(D)}}}if(e.inserted){j.inserted=[];for(s=0;I=e.inserted[s];s++){D=U(this,{cascadeDestroy:false,delegate:I});D.canHaveDelegate=false;this.colMap_[I.eventObjectId]=D;j.inserted.push(D);this.firstChild&&this.insertBefore(D)}}this.firstChild?this.event_childNodesModified(this,
j):this.setChildNodes(j.inserted);if(this.destroyDataSourceMember&&m.length)for(s=0;I=m[s];s++)I.destroy()},destroy:function(b){this.dataSource===b&&this.setDataSource()}}},appendChild:function(b){return this.insertBefore(b)},insertBefore:function(b,e){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(b.firstChild){var j=this;do if(j==b)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";while(j=j.parentNode)}if(this.dataSource&&
!this.dataSource.has(b.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(b instanceof this.childClass==false)b=U(this,b instanceof G?{delegate:b}:b);var m=b.parentNode===this,s=b.groupNode,I=this.localGrouping;j=this.localSorting;var D=this.childNodes,S=null,n=-1;if(I){S=I.getGroupNode(b);I=S.nodes;if(m&&b.nextSibling===e&&s===S)return b;if(j){j=j(b)||0;n=I.binarySearchPos(j,z,this.localSortingDesc);b.sortingValue=j}else n=e&&e.groupNode===S?
I.indexOf(e):I.length;if(n<I.length)e=I[n];else if(S.last)e=S.last.nextSibling;else{j=S;for(e=null;j=j.nextSibling;)if(e=j.first)break}if(b===e||m&&b.nextSibling===e){if(s!==S){s&&s.remove(b);S.insert(b)}return b}n=-1}else if(j){n=this.localSortingDesc;I=b.nextSibling;var t=b.previousSibling;j=j(b)||0;if(m){if(j===b.localSorting)return b;if((!I||(n?I.sortingValue<=j:I.sortingValue>=j))&&(!t||(n?t.sortingValue>=j:t.sortingValue<=j))){b.sortingValue=j;return b}}n=D.binarySearchPos(j,z,n);e=D[n];b.sortingValue=
j;if(b===e||m&&I===e)return b}else{if(e&&e.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(m){if(b.nextSibling===e)return b;if(b===e)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}if(m){if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;b.previousSibling=null;b.nextSibling=null;if(n==-1)D.remove(b);
else{j=D.indexOf(b);D.splice(j,1);j<n&&n--}s&&s.remove(b)}else b.parentNode&&b.parentNode.removeChild(b);s!=S&&S.insert(b,e);if(e){if(n==-1)n=D.indexOf(e);if(n==-1)throw"basis.dom.wrapper: Node was not found";b.nextSibling=e;D.splice(n,0,b)}else{n=D.length;D.push(b);e={previousSibling:this.lastChild};this.lastChild=b}b.parentNode=this;b.previousSibling=e.previousSibling;if(n==0)this.firstChild=b;else e.previousSibling.nextSibling=b;e.previousSibling=b;var u=false,O=false,V=this.selection||this.contextSelection;
if(!b.document&&b.document!==this.document){u=this.document;b.document=this.document}if(!b.contextSelection&&b.contextSelection!==V){b.contextSelection=V;O=!b.selection;b.selected&&V.add([b])}if(b.firstChild&&(u||O))f(b,C).forEach(function(Z){if(u&&!Z.document)Z.document=u;if(O&&!Z.contextSelection){Z.selected&&Z.unselect();Z.contextSelection=V}});if(!m){b.match&&b.match(this.matchFunction);b.autoDelegateParent&&b.setDelegate(this);this.dataSource||this.event_childNodesModified(this,{inserted:[b]})}return b},
removeChild:function(b){if(b==null||b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(b instanceof this.childClass==false)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(b))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(b),1);b.parentNode=null;if(b.nextSibling)b.nextSibling.previousSibling=b.previousSibling;else this.lastChild=b.previousSibling;
if(b.previousSibling)b.previousSibling.nextSibling=b.nextSibling;else this.firstChild=b.nextSibling;b.nextSibling=null;b.previousSibling=null;b.document===this.document&&f(b,x).forEach(function(s){if(s.document==this.document)s.document=null},this);if(b.contextSelection){for(var e=b.contextSelection,j=b,m=[];j;){if(j.contextSelection===e){j.selected&&m.push(j);j.contextSelection=null}if(!j.selection&&j.firstChild)j=j.firstChild;else if(j.nextSibling)j=j.nextSibling;else for(;j=j.parentNode;)if(j.nextSibling){j=
j.nextSibling;break}}e.remove(m)}b.groupNode&&b.groupNode.remove(b);this.dataSource||this.event_childNodesModified(this,{deleted:[b]});b.autoDelegateParent&&b.setDelegate();return b},replaceChild:function(b,e){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(e==null||e.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(b,e);return this.removeChild(e)},clear:function(b){if(this.dataSource)this.setDataSource();
else if(this.firstChild){var e=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:e});for(var j=e.length;j-- >0;){var m=e[j];m.parentNode=null;m.groupNode=null;if(b){if(m.selection||m.document)f(m,B.AXIS_DESCENDANT_OR_SELF).forEach(function(s){if(this.selection&&s.selection===this.selection){s.selected&&s.selection.remove([s]);s.selection=null}if(s.document===this.document)s.document=null},this);m.nextSibling=null;m.previousSibling=null;
m.autoDelegateParent&&m.setDelegate()}else m.destroy()}this.localGrouping&&this.localGrouping.clear()}},setChildNodes:function(b,e){this.dataSource||this.clear(!!e);if(b){if("length"in b==false)b=[b];if(b.length){var j=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var m=0,s=b.length;m<s;m++)this.insertBefore(b[m]);this.event_childNodesModified=j;this.event_childNodesModified(this,{inserted:this.childNodes})}}},setDataSource:function(b){if(!b||!this.canHaveChildren||
b instanceof R==false)b=null;if(this.dataSource!==b){var e=this.dataSource;if(e){this.colMap_=this.dataSource=null;e.removeHandler(this.listen.dataSource,this);e.itemCount&&this.clear()}if(b){this.dataSource=b;this.colMap_={};b.addHandler(this.listen.dataSource,this);b.itemCount&&this.listen.dataSource.datasetChanged.call(this,b,{inserted:b.getItems()})}this.event_dataSourceChanged(this,e)}},setLocalGrouping:function(b){if(typeof b=="function"||typeof b=="string")b={groupGetter:E(b)};if(b instanceof
k==false)b=b!=null&&typeof b=="object"?new this.localGroupingClass(Object.complete({},b)):null;if(this.localGrouping!==b){var e=this.localGrouping,j;if(this.localGrouping){if(!b&&this.firstChild){this.localGrouping=null;j=this.localSorting?F(this):this.childNodes;for(var m=j.length;m-- >0;)j[m].groupNode=null;T(this,j)}e.setOwner()}if(b){this.localGrouping=b;b.setOwner(this);if(this.firstChild){j=this.localSorting?F(this):this.childNodes;for(m=0;b=j[m];m++)b.groupNode=this.localGrouping.getGroupNode(b);
j=j;for(m=0;b=j[m];m++)b.groupNode.nodes.push(b);j.length=0;for(m=this.localGrouping.nullGroup;m;m=m.nextSibling){b=m.nodes;m.first=b[0]||null;m.last=b[b.length-1]||null;j.push.apply(j,b);m.event_childNodesModified(m,{inserted:b})}T(this,j)}}this.event_localGroupingChanged(this,e)}},setLocalSorting:function(b,e){if(b)b=E(b);if(this.localSorting!=b||this.localSortingDesc!=!!e){this.localSortingDesc=!!e;this.localSorting=b||null;if(b&&this.firstChild){var j=[],m;for(m=this.firstChild;m;m=m.nextSibling)m.sortingValue=
b(m)||0;if(this.localGrouping)for(var s=this.localGrouping.nullGroup;s;s=s.nextSibling){m=s.nodes=F({childNodes:s.nodes,localSortingDesc:this.localSortingDesc});s.first=m[0]||null;s.last=m[m.length-1]||null;j.push.apply(j,m)}else j=F(this);T(this,j)}this.event_localSortingChanged(this)}},setMatchFunction:function(b){if(this.matchFunction!=b){this.matchFunction=b;for(var e=this.lastChild;e;e=e.previousSibling)e.match(b)}}};M=A(r,{event_enable:y("enable","node"),event_disable:y("disable","node"),event_select:y("select",
"node"),event_unselect:y("unselect","node"),event_match:y("match","node"),event_unmatch:y("unmatch","node"),selectable:true,selected:false,selection:null,contextSelection:null,matchFunction:null,matched:true,disabled:false,init:function(b){if(this.selection&&this.selection instanceof R==false)this.selection=new g(this.selection);r.prototype.init.call(this,b);this.disabled&&this.event_disable(this);if(this.selected){this.selected=false;this.select(true)}},setSelection:function(b){if(this.selection==
b)return false;var e=this.selection;f(this,C,function(j){if(j.contextSelection==e){j.selected&&e&&e.remove([j]);j.contextSelection=b}});this.selection=b;return true},hasOwnSelection:function(){return!!this.selection},select:function(b){var e=this.selected,j=this.contextSelection;if(j)if(b)e?j.remove([this]):j.add([this]);else this.selectable&&j.set([this]);else if(!e&&this.selectable&&!this.isDisabled()){this.selected=true;this.event_select(this)}return this.selected!=e},unselect:function(){var b=
this.selected;if(b){var e=this.contextSelection;if(e)e.remove([this]);else{this.selected=false;this.event_unselect(this)}}return this.selected!=b},enable:function(){if(this.disabled){this.disabled=false;this.event_enable(this)}},disable:function(){if(!this.disabled){this.disabled=true;this.event_disable(this)}},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!B.findAncestor(this,E("disabled"))},match:function(b){if(typeof b!="function")if(this.matched){if(this.underMatch_){this.underMatch_(this,
true);this.underMatch_=null}}else{this.matched=true;this.event_match(this)}else if(b(this)){this.underMatch_=b;if(!this.matched){this.matched=true;this.event_match(this)}}else{this.underMatch_=null;if(this.matched){this.matched=false;this.event_unmatch(this)}}},setMatchFunction:function(){},destroy:function(){if(this.hasOwnSelection()){this.selection.destroy();delete this.selection}this.unselect();r.prototype.destroy.call(this)}});var h=A(M,d,{}),k=A(r,d,{event_childNodesModified:function(b,e){i.childNodesModified.call(this,
b,e);this.nullGroup.nextSibling=this.firstChild;if(e.inserted&&this.dataSource&&this.nullGroup.first)for(var j=this.owner,m=Array.from(this.nullGroup.nodes),s=m.length;s-- >0;)j.insertBefore(m[s],m[s].nextSibling)},event_ownerChanged:function(b,e){e&&e.localGrouping===this&&e.setLocalGrouping(null,true);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);i.ownerChanged.call(this,b,e);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:true,
autoDestroyEmptyGroups:true,titleGetter:E("data.title"),groupGetter:Function.$undef,childClass:a,childFactory:function(b){return new this.childClass(c(b,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups}))},init:function(b){this.map_={};this.nullGroup=new a({autoDestroyIfEmpty:false});r.prototype.init.call(this,b)},getGroupNode:function(b){b=this.groupGetter(b);var e=b instanceof G,j=this.map_[e?b.eventObjectId:b];if(!j&&!this.dataSource)j=this.appendChild(e?
{delegate:b}:{data:{id:b,title:b}});return j||this.nullGroup},insertBefore:function(b,e){b=d.insertBefore.call(this,b,e);if("groupId_"in b==false){b.groupId_=b.delegate?b.delegate.eventObjectId:b.data.id;this.map_[b.groupId_]=b}if(b.first){var j=this.owner,m=j.childNodes,s=b.first,I=b.last,D,S,n;for(D=b;D=D.previousSibling;)if(n=D.last)break;if(!n)n=this.nullGroup.last;for(D=b;D=D.nextSibling;)if(S=D.first)break;if(s.previousSibling!==n||I.nextSibling!==S){if(s.previousSibling)s.previousSibling.nextSibling=
I.nextSibling;if(I.nextSibling)I.nextSibling.previousSibling=s.previousSibling;D=m.splice(m.indexOf(s),b.nodes.length);var t=m.indexOf(S);D.unshift(t!=-1?t:m.length,0);m.splice.apply(m,D);s.previousSibling=n;I.nextSibling=S;if(n)n.nextSibling=s;if(S)S.previousSibling=I;j.firstChild=m[0];j.lastChild=m[m.length-1]}}return b},removeChild:function(b){d.removeChild.call(this,b);delete this.map_[b.groupId_];return b},clear:function(){d.clear.call(this);this.map_={}},destroy:function(){this.setOwner();r.prototype.destroy.call(this);
this.map_=null}});r.prototype.localGroupingClass=k;y=A(R,{autoDestroy:true,sourceNode:null,listen:{sourceNode:{childNodesModified:function(b,e){var j=this.memberMap_,m={},s=0,I=0,D=e.inserted,S=e.deleted;if(D&&D.length)for(m.inserted=D;b=D[s];){j[b.eventObjectId]=b;s++}if(S&&S.length)for(m.deleted=S;b=S[I];){delete j[b.eventObjectId];I++}if(s||I)this.event_datasetChanged(this,m)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:y("sourceNodeChanged")&&
function(b,e){i.sourceNodeChanged.call(this,b,e);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:false,init:function(b,e){R.prototype.init.call(this,e);b&&this.setSourceNode(b)},setSourceNode:function(b){if(b instanceof r==false)b=null;if(b!==this.sourceNode){var e=this.sourceNode;if(e){e.removeHandler(this.listen.sourceNode,this);this.listen.sourceNode.childNodesModified.call(this,e,{deleted:e.childNodes})}if(b){b.addHandler(this.listen.sourceNode,this);this.listen.sourceNode.childNodesModified.call(this,
b,{inserted:b.childNodes})}this.sourceNode=b;this.event_sourceNodeChanged(this,e)}},destroy:function(){this.setSourceNode();R.prototype.destroy.call(this)}});var g=A(P,{multiple:false,event_datasetChanged:function(b,e){P.prototype.event_datasetChanged.call(this,b,e);if(e.inserted)for(var j=0,m;m=e.inserted[j];j++)if(!m.selected){m.selected=true;m.event_select()}if(e.deleted)for(j=0;m=e.deleted[j];j++)if(m.selected){m.selected=false;m.event_unselect()}},add:function(b){if(!this.multiple)if(this.itemCount)return this.set(b);
else b.splice(1);for(var e=[],j=0,m;m=b[j];j++)m.contextSelection==this&&m.selectable&&e.push(m);return P.prototype.add.call(this,e)},set:function(b){for(var e=[],j=0,m;m=b[j];j++)m.contextSelection==this&&m.selectable&&e.push(m);this.multiple||b.splice(1);return P.prototype.set.call(this,e)}});w.namespace("basis.dom.wrapper",H).extend({AbstractNode:r,InteractiveNode:M,Node:h,GroupingNode:k,PartitionNode:a,simpleTemplate:H,ChildNodesDataset:y,Selection:g})})(basis);
(function(w,z){function L(g,b){return T(b,true).getRule(g,true)}function N(g,b){var e=g.match(/^([^{]+)\{(.*)\}\s*$/);if(e){for(var j=e[1].trim().split(/\s*,\s*/),m=0;m<j.length;m++)this.addRule(j[m],e[2]||null,b++);return b-1}}function F(g,b){var e=P.createElement(!g?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:b?"alternate ":"",url:g.quote('"')}));P.tag(null,"HEAD")[0].appendChild(e);e=e.sheet||e.styleSheet;try{if(!e.cssRules)e.cssRules=e.rules}catch(j){}if(!e.insertRule)e.insertRule=
N;if(!e.deleteRule)e.deleteRule=e.removeRule;return e}function T(g,b){g||(g="DefaultGenericStyleSheet");if(!i[g])if(b)i[g]=new p(F());return i[g]}function U(g,b,e,j){j=j||{};b=b.qw();for(var m=0,s;s=b[m];m++)if(typeof o.style[s]!="undefined"){if(e)w.platformFeature["css-"+g]=s;l[g]={key:s,getter:j[s]};return}}function H(g,b){var e=l[g];if(g=e?e.key:g.replace(/^-ms-/,"ms-").camelize())return{key:g,value:e&&e.getter?e.getter(b):b}}function A(g,b,e){if(typeof g.setProperty=="function")return g.setProperty(b,
e);if(b=H(b,e))return g.style[b.key]=b.value}function B(g,b){for(var e in b)A(g,e,b[e]);return g}function y(g,b){return A(g,"display",typeof b=="string"?b:b?"":"none")}function M(g,b){return A(g,"visibility",b?"":"hidden")}function G(g){return h[g]||(h[g]=new RegExp("\\s*\\b"+g+"\\b"))}var R=z.document,P=w.dom,C=w.dom.event,x=w.Class,E=/\s*!important/i,c=String("important"),f=1,i={},l={},o=P.createElement("DIV");U("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(g){return"alpha(opacity:"+
parseInt(g*100)+")"}});U("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);U("float","cssFloat styleFloat");var p=x(null,{styleSheet:null,rules:null,init:function(g){this.styleSheet=g;this.rules=[];this.map_={}},getRule:function(g,b){if(!this.map_[g])if(b){for(var e=this.styleSheet,j=this.rules.length,m=e.insertRule(g+"{}",j),s=j;s<=m;s++)this.rules.push(new q(e.cssRules[s]));this.map_[g]=j!=m?new r(this.rules.splice(j)):this.rules[j]}return this.map_[g]},deleteRule:function(g){var b=
this.map_[g];if(b){b=b.rules||[b];for(var e=0;e<b.length;e++){var j=this.rules.indexOf(b[e]);this.stylesheet.deleteRule(j);this.rules.splice(j,1)}delete this.map_[g]}},destroy:function(){delete this.rules}}),q=x(null,{rule:null,selector:"",init:function(g){if(g){this.rule=g;this.selector=g.selectorText}},setProperty:function(g,b){var e,j=!!E.test(b),m=this.rule.style;if(j||(m.getPropertyPriority?m.getPropertyPriority(g)==c:false)){b=b.replace(E,"");if(e=H(g,b)){var s=e.key;if(m.setProperty){j||m.removeProperty(s);
m.setProperty(s,e.value,j?c:"")}else{e=s+": "+e.value+(j?" !"+c:"")+";";m.cssText=m.cssText.replace(new RegExp(m[s]?s+"\\s*:\\s*"+m[s]+"(\\s*!"+c+")?\\s*;?":"^","i"),e)}}}else A(this.rule,g,b)},setStyle:function(g){Object.iterate(g,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),r=x(null,{rules:null,init:function(g){this.rules=g},destroy:function(){delete this.rules}});["setProperty","setStyle","clear"].forEach(function(g){r.prototype[g]=
function(){for(var b,e=0;b=this.rules[e];e++)b[g].apply(b,arguments)}});var a={};["em","ex","px","%"].forEach(function(g){a[g=="%"?"percent":g]=function(b){return b==0||isNaN(b)?"0":b+g}});var d,h={},k=x(null,{init:function(g){this.element=g},toString:function(){return this.element.className},set:function(g){this.clear();g.qw().forEach(this.add,this)},replace:function(g,b,e){e=e||"";typeof g!="undefined"&&this.remove(e+g);typeof b!="undefined"&&this.add(e+b)},bool:function(g,b){b?this.add(g):this.remove(g)},
clear:function(){this.element.className=""},contains:function(g){return!!this.element.className.match(G(g))},item:function(g){return this.element.className.qw()[g]},add:function(g){this.element.className.match(G(g))||(this.element.className+=" "+g)},remove:function(g){var b=this.element.className;g=b.replace(G(g),"");if(g!=b)this.element.className=g},toggle:function(g){var b=this.contains(g);b?this.remove(g):this.add(g);return!b}});if(z.DOMTokenList&&R.documentElement.classList){x=k.prototype;Object.extend(z.DOMTokenList.prototype,
{set:x.set,replace:x.replace,bool:x.bool,clear:function(){for(var g=this.length;g-- >0;)this.remove(this[g])}});d=function(g){return(typeof g=="string"?P.get(g):g).classList}}else d=function(g){return new k(typeof g=="string"?P.get(g):g)};C.onLoad(function(){d(R.body).bool("opacity-not-support",!w.platformFeature["css-opacity"])});P.extend({setStyleProperty:A,setStyle:B,display:y,show:function(g){return y(g,1)},hide:function(g){return y(g)},visibility:M,visible:function(g){return M(g,1)},invisible:function(g){return M(g)}});
return w.namespace("basis.cssom").extend({setStyleProperty:A,setStyle:B,classList:d,uniqueRule:function(g){var b="genericRule-"+f++;g&&d(g).add(b);g=L("."+b);g.token=b;return g},cssRule:L,getStyleSheet:T,addStyleSheet:F,CssStyleSheetWrapper:p,CssRuleWrapper:q,CssRuleWrapperSet:r}).extend(a)})(basis,this);
(function(w){function z(n){p[n]=p[n]||0;return n+p[n]++}function L(){var n=Array.from(arguments),t=n.pop();typeof t!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var u=[],O=[],V=0,Z;V<n.length;V++){Z=n[V].quote('"');u.push(Z+" in delta");O.push("data["+Z+"]")}t=(new Function("calc","return function(delta, data, oldValue){"+(u.length?"if ("+u.join(" || ")+")":"")+"return calc("+O.join(", ")+");"+(u.length?"return oldValue;":"")+"}"))(t);t.args=n;
t.isCalcField=true;return t}function N(){return L.apply(null,Array.from(arguments).concat(function(){for(var n=[],t=arguments.length;t-- >0;){if(arguments[t]==null)return null;n.push(arguments[t])}return n.join("-")}))}var F=w.Class,T=w.Cleaner,U=Object.extend,H=Function.$self,A=Function.getter,B=w.data,y=w.EventObject,M=B.Dataset,G=B.Collection,R=B.Grouping,P=B.DataObject,C=B.STATE,x={},E={string:1,number:1},c=[],f=function(n){return isNaN(n)?null:Number(n)},i=function(n){return isNaN(n)?null:Number(n)},
l=function(n){return isNaN(n)?null:parseInt(n)},o=function(n){return n==null?null:String(n)},p={},q=w.Class(null,{init:function(n){var t=this.index={};this.normalize=n;this.valueWrapper=function(u,O){var V=n(u,O);if(V!==O&&t[V])return O;return V};this.calcWrapper=function(u,O){var V=n(u,O);if(V!==O&&t[V])throw"Duplicate value for index "+O+" => "+u;return V};T.add(this)},get:function(n,t){var u=this.index[n];if(u&&(!t||u instanceof t))return u},add:function(n,t){var u=this.index[n];if(t&&(!u||u===
t)){this.index[n]=t;return true}},remove:function(n,t){if(this.index[n]===t){delete this.index[n];return true}},destroy:function(){this.index=null}});B=function(n,t){return function(u){return n.prototype[t].call(this,u&&u.map(this.wrapper))}};var r=function(n,t){return function(u){if(!this.name)this.name=z(t);n.prototype.init.call(this,u)}},a=function(n){return function(t,u){M.setAccumulateState(true);t=(t||[]).map(this.wrapper);M.setAccumulateState(false);return n.prototype.sync.call(this,t,u)}},
d=F(M,{wrapper:Function.$self,init:r(M,"EntitySet"),sync:a(M),set:B(M,"set"),add:B(M,"add"),remove:B(M,"remove"),destroy:function(){M.prototype.destroy.call(this);delete this.wrapper}}),h=F(d,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),k=F(G,{init:r(G,"EntityCollection"),sync:a(G)});k.sourceHandler=G.sourceHandler;var g=F(R,{subsetClass:h,init:r(R,"EntityGrouping"),sync:a(R),getSubset:function(n,t){var u=R.prototype.getSubset.call(this,n,t);if(u)u.wrapper=
this.wrapper;return u}}),b=function(n){if(this instanceof b){var t=new e(n||H);return function(u,O){if(u!=null){O instanceof d||(O=t.createEntitySet());O.set(u instanceof M?u.getItems():Array.from(u));return O}else return null}}};b.className="basis.entity.EntitySetWrapper";var e=F(null,{init:function(n){this.wrapper=n},createEntitySet:function(){return new d({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),j=function(n){if(this instanceof j){var t=
function(J,W){if(J!=null){if(J===W||J.entityType===u)return J;var ba,ca=u.idField;if(E[typeof J]){if(!ca)return;ba=J;J={};J[ca]=ba}else if(u.compositeKey)ba=u.compositeKey(J,J);else if(ca)ba=J[ca];else if(Z){W=u.singleton;if(!W)return u.singleton=new V(J)}if(ba!=null&&O)W=O.get(ba,u.entityClass);if(W&&W.entityType===u)W.update(J);else W=new V(J);return W}else return u.singleton},u=new I(n||{},t),O=u.index__,V=u.entityClass,Z=u.isSingleton;U(t,{toString:function(){return this.typeName+"()"},entityType:u,
type:t,typeName:u.name,index:O,reader:function(J){return u.reader(J)},get:function(J){return u.get(J)},addField:function(J,W){u.addField(J,W)},all:u.all,createCollection:function(J,W,ba){var ca=u.collection_[J];if(!ca&&W)return u.collection_[J]=new k({wrapper:t,source:ba||u.all,rule:W});return ca},getCollection:function(J){return u.collection_[J]},createGrouping:function(J,W,ba){var ca=u.grouping_[J];if(!ca&&W)return u.grouping_[J]=new g({wrapper:t,source:ba||u.all,rule:W});return ca},getGrouping:function(J){return u.grouping_[J]},
getSlot:function(J,W){return u.getSlot(J,W)}});return t}};j.className="basis.entity.EntityTypeWrapper";var m=A("singleton"),s={};F(P,{});var I=F(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(n,t){this.name=n.name||z(this.name);this.index__=n.index;this.idFields={};c.push(this);this.isSingleton=n.isSingleton;this.wrapper=t;this.all=new h(Object.extend(n.all||{},{wrapper:t}));this.slot_={};if(n.extensible)this.extensible=true;this.fields=
{};this.defaults={};this.aliases={};this.getters={};Object.iterate(n.fields,this.addField,this);n.constrains&&n.constrains.forEach(function(O){this.addCalcField(null,O)},this);if(this.isSingleton)this.get=m;n.aliases&&Object.iterate(n.aliases,this.addAlias,this);this.collection_={};if(n.collections)for(var u in n.collections)this.collection_[u]=new k({name:u,wrapper:t,source:this.all,rule:n.collections[u]||Function.$true});this.grouping_={};if(n.groupings)for(u in n.groupings)this.grouping_[u]=new g({name:u,
wrapper:t,source:this.all,rule:n.groupings[u]||Function.$true});this.entityClass=S(this,this.all,this.index__,this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:t,typeName:this.name,getId:function(){return this.__id__}})},reader:function(n){var t={};if(E[typeof n]){if(this.idField){t[this.idField]=n;return t}return null}if(!n||n==null)return null;for(var u in n){var O=u in this.aliases?this.aliases[u]:"";if(O&&O in this.fields)t[O]=this.fields[O].reader?this.fields[O].reader(n[u]):
n[u]}return t},addAlias:function(n,t){if(t in this.fields)if(n in this.aliases==false)this.aliases[n]=t},addField:function(n,t){if(!this.all.itemCount){this.aliases[n]=n;if(typeof t=="function")t={type:t};if("type"in t&&typeof t.type!="function")t.type=H;var u=t.type||H;if([f,i,l,o].has(u))t.id=true;if(t.id){if(!this.index__)this.index__=new q(String);this.idFields[n]=true;if(this.idField||this.compositeKey){this.idField=null;this.compositeKey=N.apply(null,Object.keys(this.idFields))}else this.idField=
n}if(t.calc)this.addCalcField(n,t.calc,void 0);else this.fields[n]=u;this.defaults[n]="defValue"in t?t.defValue:u();this.getters["get_"+n]=function(){return this.data[n]};s[n]||(s[n]={destroy:function(){this.set(n,null)}})}},addCalcField:function(n,t,u){if(!(n&&this.fields[n])){if(!this.calcs)this.calcs=[];for(var O={args:t.args,wrapper:!u?t:function(W,ba,ca){return u(t(W,ba,ca))}},V=this.calcs.length,Z=0,J=0;J<this.calcs.length;J++)if(t.args.has(this.calcs[J].key))Z=J+1;if(n){O.key=n;for(J=0;J<this.calcs.length;J++)if(this.calcs[J].args.has(n)){V=
J;break}if(Z>V)return;if(this.idField&&n==this.idField)this.compositeKey=t;this.fields[n]=function(W,ba){typeof console!="undefined"&&console.log("Calculate fields are readonly");return ba}}else V=Z;this.calcs.splice(Math.min(V,Z),0,O)}},get:function(n){n=this.getId(n);if(n!=null)return this.index__.get(n,this.entityClass)},getId:function(n){if((this.idField||this.compositeKey)&&n!=null){if(E[typeof n])return n;if(n&&n.entityType===this)return n.__id__;if(n instanceof P)n=n.data;return this.compositeKey?
this.compositeKey(n,n):n[this.idField]}},getSlot:function(n){var t=this.getId(n);if(t!=null){var u=this.slot_[t];if(!u){if(E[typeof n]){u={};if(this.idField&&!this.compositeKey)u[this.idField]=n;n=u}u=this.slot_[t]=new P({delegate:this.get(t),data:n})}return u}}}),D=F(P,{init:y.prototype.init,event_rollbackUpdate:y.createEvent("rollbackUpdate")}),S=function(n,t,u,O,V,Z,J){function W(v,K,Y){var $=false,aa=n.calcs,X=v.__id__,Q=v.data;try{if(aa)for(var da=0,fa;fa=aa[da++];){var ea=fa.key;if(ea){var ha=
Q[ea];Q[ea]=fa.wrapper(K,Q,Q[ea]);if(Q[ea]!==ha){K[ea]=ha;$=true}}else fa.wrapper(K,Q)}if(n.compositeKey)v.__id__=n.compositeKey(K,Q,v.__id__);else if(ca&&ca in K)v.__id__=Q[ca];v.__id__!==X&&n.index__.calcWrapper(v.__id__)}catch(ia){v.__id__=X;for(var ga in K)v.data[ga]=K[ga];if(Y)for(ga in Y)if(!v.modified)v.modified=Y;$=false}v.__id__!==X&&ba(v,X,v.__id__);return $}function ba(v,K,Y){if(K!=null){u.remove(K,v);O[K]&&O[K].setDelegate()}if(Y!=null){u.add(Y,v);O[Y]&&O[Y].setDelegate(v)}}var ca=n.idField;
return F(D,J,{canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(v){D.prototype.init.call(this);this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var K,Y={};for(var $ in V){if($ in v){Y[$]=Z[$];K=V[$](v[$])}else K=Z[$];if(K&&K!==this&&K instanceof y)if(K.addHandler(s[$],this))this.fieldHandlers_[$]=true;this.data[$]=K}W(this,Y);t.event_datasetChanged(t,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+
")]"},get:function(v){return this.data[v]},set:function(v,K,Y,$){var aa=V[v];if(!aa){if(!n.extensible)return;aa=H}var X,Q=this.modified;K=aa(K,this.data[v]);aa=this.data[v];if(K!==aa&&(!K||!aa||K.constructor!==Date||aa.constructor!==Date||+K!==+aa))a:{X={};if(v!=ca)if(Y){if(!Q)this.modified=Q={};if(v in Q===false){X.rollback={key:v,value:undefined};Q[v]=aa}else if(Q[v]===K){X.rollback={key:v,value:K};delete Q[v];if(!Object.keys(Q).length)this.modified=null}}else if(Q&&v in Q)if(Q[v]!==K){X.rollback=
{key:v,value:Q[v]};Q[v]=K;break a}else return false;this.data[v]=K;if(this.fieldHandlers_[v]){aa.removeHandler(s[v],this);this.fieldHandlers_[v]=false}if(K&&K!==this&&K instanceof y)if(K.addHandler(s[v],this))this.fieldHandlers_[v]=true;X.key=v;X.value=aa;X.delta={};X.delta[v]=aa}else if(!Y&&Q&&v in Q){X={rollback:{key:v,value:Q[v]}};delete Q[v];if(!Object.keys(Q).length)this.modified=null}if(!$&&X){Y=X.key;v=X.delta||{};var da;if(X.rollback){da={};da[X.rollback.key]=X.rollback.value}if(W(this,v,
da))Y=true;if(Y){this.event_update(this,v);X.delta=v}da&&this.event_rollbackUpdate(this,da)}return X||false},update:function(v,K){if(v){var Y,$={},aa,X={},Q;for(var da in v)if(Q=this.set(da,v[da],K,true)){if(Q.key){Y=true;$[Q.key]=Q.value}if(Q.rollback){aa=true;X[Q.rollback.key]=Q.rollback.value}}if(W(this,$,X))Y=true;Y&&this.event_update(this,$);aa&&this.event_rollbackUpdate(this,X)}return Y?$:false},reset:function(){this.update(Z)},clear:function(){var v={};for(var K in this.data)v[K]=undefined;
return this.update(v)},commit:function(v){if(this.modified){var K=this.modified;this.modified=null}this.update(v);K&&this.event_rollbackUpdate(this,K)},rollback:function(){if(this.state!=C.PROCESSING){if(this.modified){var v=this.modified;this.modified=null;this.update(v);this.event_rollbackUpdate(this,v)}this.setState(C.READY)}},destroy:function(){for(var v in this.fieldHandlers_)this.data[v].removeHandler(s[v],this);this.fieldHandlers_=x;this.__id__&&ba(this,this.__id__,null);P.prototype.destroy.call(this);
t.event_datasetChanged(t,{deleted:[this]});this.data=x;this.modified=null}})};w.namespace("basis.entity").extend({isEntity:function(n){return n&&n instanceof S},NumericId:f,NumberId:i,IntId:l,StringId:o,Index:q,CalculateField:L,EntityType:j,Entity:S,BaseEntity:D,EntitySetType:b,EntitySet:d,ReadOnlyEntitySet:h,Collection:k,Grouping:g})})(basis);
