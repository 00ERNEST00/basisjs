/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(k){function q(a,d){for(var j in d)a[j]=d[j];return a}function v(a,d){for(var j in d)j in a==false&&(a[j]=d[j]);return a}function z(a){return a==null||a==void 0}function t(a){return a}function A(a){var d={};a.names=function(a){return Object.slice(d,typeof a=="string"?a.qw():a)};a.extend=function(a){v(d,a);q(this,a);return this};return a}function y(a,d){for(var j=a.split("."),b=k,c,g,h;j.length;)if(c=j.shift(),g=(g?g+".":"")+c,b[c]||(b[c]=A((!j.length?d:null)||function(){},g),h&&(h.namespaces_[g]=
b[c])),b=b[c],!h&&(h=b,!h.namespaces_))h.namespaces_={};return l[a]=b}q(Object,{extend:q,complete:v,keys:function(a){var d=[],b;for(b in a)d.push(b);return d},values:function(a){var d=[],b;for(b in a)d.push(a[b]);return d},slice:function(a,d){var b={};if(!d)return q(b,a);for(var e=0,c;c=d[e++];)c in a&&(b[c]=a[c]);return b},splice:function(a,d){var b={};if(!d)return q(b,a);for(var e=0,c;c=d[e++];)c in a&&(b[c]=a[c],delete a[c]);return b},iterate:function(a,d,b){var e=[],c;for(c in a)e.push(d.call(b,
c,a[c]));return e},coalesce:function(){for(var a=arguments,d=0;d<a.length;d++)if(a[d]!=null)return a[d]}});var p=function(){},s=function(){var a=1,d={},b={};a++;return function(e,c){var g,h;if(!c){if(e.getter)return e.getter;if(typeof e=="function")return e}if(typeof e!="function")b[e]?g=b[e]:(g=new Function("object","return object != null ? object."+e+" : object"),g.path=e,g.getterIdx_=a++,b[e]=g);else if(g=e,!g.getterIdx_)g.getterIdx_=a++;h=g.getterIdx_;var m=d[h];if(m)if(typeof c=="undefined"){if(m.nmg)return m.nmg}else for(h=
0;h<m.length;h++){if(m[h].modificator===c)return m[h].getter}else m=d[h]=[];var n=true;switch(c&&typeof c){case "string":h=function(a){return c.format(g(a))};break;case "function":h=function(a){return c(g(a))};break;case "object":n=false;h=function(a){return c[g(a)]};break;default:h=g.path?g:function(a){return g(a)}}if(n&&(m.push({getter:h,modificator:c}),typeof c=="undefined"))m.nmg=h;return h.getter=h}}();q(Function,{$undefined:function(a){return a==void 0},$defined:function(a){return a!=void 0},
$isNull:z,$isNotNull:function(a){return a!=null&&a!=void 0},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:t,$const:function(a){return function(){return a}},$false:function(){return false},$true:function(){return true},$null:function(){return null},$undef:p,getter:s,def:function(a,d,b){b=b||z;return function(e){e=a(e);return b(e)?d:e}},wrapper:function(a){return function(d){var b={};b[a]=d;return b}},lazyInit:function(a,d){var b=0,e;return function(){b++||(e=a.apply(d||
this,arguments));return e}},lazyInitAndRun:function(a,d,b){var e=0,c;return function(){e++||(c=a.call(b||this));d.apply(c,arguments);return c}},runOnce:function(a,d){var b=0;return function(){if(!b++)return a.apply(d||this,arguments)}}});v(Function.prototype,{bind:function(a){var d=this,b=Array.from(arguments,1);return b.length?function(){return d.apply(a,b.concat.apply(b,arguments))}:function(){return d.apply(a,arguments)}}});v(Array,{isArray:function(a){return Object.prototype.toString.call(a)===
"[object Array]"}});q(Array,{from:function(a,d){if(a!=null){var b=a.length;if(typeof b=="undefined")return[a];d||(d=0);if(b-d>0){for(var e=[],c=0,g=d;g<b;)e[c++]=a[g++];return e}}return[]},create:function(a,d,b){for(var c=[],f=typeof d=="function",g=0;g<a;g++)c[g]=f?d.call(b,g,c):d;return c}});v(Array.prototype,{indexOf:function(a,d){d=parseInt(d)||0;if(d<0)return-1;for(;d<this.length;d++)if(this[d]===a)return d;return-1},lastIndexOf:function(a,d){for(var b=this.length,d=parseInt(d),d=isNaN(d)||d>=
b?b-1:(d+b)%b;d>=0;d--)if(this[d]===a)return d;return-1},forEach:function(a,d){for(var b=0,c=this.length;b<c;b++)b in this&&a.call(d,this[b],b,this)},every:function(a,d){for(var b=0,c=this.length;b<c;b++)if(b in this&&!a.call(d,this[b],b,this))return false;return true},some:function(a,d){for(var b=0,c=this.length;b<c;b++)if(b in this&&a.call(d,this[b],b,this))return true;return false},filter:function(a,d){for(var b=[],c=0,f=this.length;c<f;c++)c in this&&a.call(d,this[c],c,this)&&b.push(this[c]);
return b},map:function(a,d){for(var b=[],c=0,f=this.length;c<f;c++)c in this&&(b[c]=a.call(d,this[c],c,this));return b},reduce:function(a,d){var b=this.length,c=arguments.length;if(b==0&&c==1)throw new TypeError;var f,g=0;c>1&&(f=d,g=1);for(c=0;c<b;c++)c in this&&(f=g++?a.call(null,f,this[c],c,this):this[c]);return f}});q(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[a>=
0?a:this.length+a]},search:function(a,b,c){Array.lastSearchIndex=-1;for(var b=Function.getter(b||t),c=parseInt(c)||0,e=this.length;c<e;c++)if(b(this[c])===a)return this[Array.lastSearchIndex=c]},lastSearch:function(a,b,c){Array.lastSearchIndex=-1;for(var b=Function.getter(b||t),e=this.length,c=isNaN(c)||c==null?e:parseInt(c),e=c>e?e:c;e-- >0;)if(b(this[e])===a)return this[Array.lastSearchIndex=e]},binarySearchPos:function(a,b,c,e,f,g){if(!this.length)return e?-1:0;var b=Function.getter(b||t),c=!!c,
h,f=isNaN(f)?0:f,m=isNaN(g)?this.length-1:g;do if(g=f+m>>1,h=b(this[g]),c?a>h:a<h)m=g-1;else if(c?a<h:a>h)f=g+1;else return a==h?g:e?-1:0;while(f<=m);return e?-1:g+(h<a^c)},binarySearch:function(a,b){return this.binarySearchPos(a,b,false,true)},add:function(a){return this.indexOf(a)==-1&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return a!=-1&&!!this.splice(a,1)},has:function(a){return this.indexOf(a)!=-1},merge:function(a){return this.reduce(q,a||{})},sortAsObject:function(a,b,c){a=Function.getter(a);
c=c?-1:1;return this.map(function(b,d){return{i:d,v:a(b)}}).sort(b||function(a,b){return c*(a.v>b.v||-(a.v<b.v)||(a.i>b.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){if(this!==a)this.length=0,this.push.apply(this,a);return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var x=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);if(a.length<2)a[1]=this.length;return x.apply(this,a)}}var i={"<":">","[":"]","(":")",
"{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};v(String,{toLowerCase:function(a){return String(a).toLowerCase()},toUpperCase:function(a){return String(a).toUpperCase()},trim:function(a){return String(a).trim()},trimLeft:function(a){return String(a).trimLeft()},trimRight:function(a){return String(a).trimRight()},isEmpty:function(a){return a==
null||String(a)==""},isNotEmpty:function(a){return a!=null&&String(a)!=""}});v(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});q(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(b){if(a)throw b;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],b=this.length,c=0;c<b;c++)a[c]=this.charAt(c);return a},
repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(a){for(var b={},c=0;c<arguments.length;c++)b[c]=arguments[c];typeof a=="object"&&q(b,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(a,c,j,h,m){a=c in b?b[c]:m?"":a;return j&&!isNaN(a)?(a=Number(a),j=="."?a.toFixed(h):a.lead(h)):a})},quote:function(a,
b){var a=a||'"',b=b||i[a]||a,c=(a.length==1?a:"")+(b.length==1?b:"");return a+(c?this.replace(RegExp("["+c.forRegExp()+"]","g"),"\\$&"):this)+b},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=
11)String.prototype.split=function(a){if(a==""||a&&a.source=="")return this.toArray();var b=[],c=0,e;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));e=a.exec(this);)e[0]=this.substring(c,e.index),b.push.apply(b,e),c=a.lastIndex;else for(;(e=this.indexOf(a,c))!=-1;)b.push(this.substring(c,e)),c=e+a.length;b.push(this.substr(c));return b};if("12".substr(-1)!="2"){var w=String.prototype.substr;String.prototype.substr=function(a,b){return w.call(this,a<0?Math.max(0,
this.length+a):a,b)}}q(Number.prototype,{fit:function(a,b){return!isNaN(a)&&this<a?Number(a):!isNaN(b)&&this>b?Number(b):this},between:function(a,b){return!isNaN(this)&&this>=a&&this<=b},quote:function(a,b){return(this+"").quote(a,b)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},lead:function(a,b){return(this+"").replace(/\d+/,function(c){return(a-=c.length-1)>1?Array(a).join(b||
0)+c:c})},group:function(a,b){return(this+"").replace(/\d+/,function(c){return c.replace(/\d/g,function(e,f){return!f+(c.length-f)%(a||3)?e:(b||" ")+e})})},format:function(a,b,c,e,f){a=this.toFixed(a);if(b||f)a=a.replace(/(\d+)(\.?)/,function(a,c,e){return(b?Number(c).group(3,b):c)+(e?f||e:"")});c&&(a=a.replace(/^-?/,"$&"+(c||"")));return a+(e||"")}});v(Date,{now:function(){return+new Date}});(new Date).getYear()<1900&&q(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&
a<100?Number(a)+1900:a)}});var l={},r=function(){function a(a,b){for(var c=l[a],d=b?b.split(/\./):[];c&&d.length;)c=c[d.shift()];return c}var b=k.document?k.document.getElementsByTagName("SCRIPT"):null,c=(b?b[b.length-1].src:module.filename).replace(/[^\/]+$/,""),e={},f;typeof require=="function"?f=function(a){return require(requirePath+a.replace(/\./g,"/"))}:(f=function(b,d){var m=b.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],n=b.substr(m.length?m.length+1:0),C=a(m,n),D=/^basis\./.test(m)?
c:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!l[m]||!C)if(/^https?:/.test(D))if(e[b])throw"Attempt to load namespace, probably cycle require";else{e[b]=1;var D=D+(d||"")+b.replace(/\./g,"/")+".js",G=new XMLHttpRequest;G.open("POST",D,false);G.send(null);if(G.status==200){try{(new Function(G.responseText)).call(k)}catch(i){throw i;}f.sequence.push(b.replace(/\./g,"/")+".js")}else if(G.status==404&&n)r(m);else throw"!";}else throw"Path `"+b+"` can't be resolved";return C||
a(m,n)},f.sequence=[]);return f}(),B=function(){function a(a){return typeof a=="function"&&a.basisClass_}var b=Function(),c=1,e={},f=function(){for(var a in{toString:1})return;return true}();q(b,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=p}},create:function(f){typeof f!="function"&&(f=b);var n=Function();n.prototype=
f.prototype;for(var n=new n,C={className:f.className+"._SubClass_",basisClass_:true,superClass_:f,extendConstructor_:!!f.extendConstructor_,__extend__:function(c){return c&&(typeof c=="object"||typeof c=="function"&&!a(c))&&c!==e?b.create.call(null,o,c):c},extend:b.extend,subclass:function(){return b.create.apply(null,[o].concat(Array.from(arguments)))},prototype:n},g=arguments,h=1;h<g.length;h++)C.extend(typeof g[h]=="function"&&!a(g[h])?g[h](f.prototype):g[h]);var i={},o=C.extendConstructor_?function(a,
b){this.eventObjectId=c++;var o,d;for(d in a)o=this[d],this[d]=o&&o.__extend__?o.__extend__(a[d]):a[d];this.init(b||i)}:function(){this.eventObjectId=c++;this.init.apply(this,arguments)};n.constructor=o;for(var H in n)n[H]===e&&(n[H]=o);q(o,C);return o},extend:function(a){var b=this.prototype;if(a.prototype)a=a.prototype;for(var c in a){var d=a[c],e=b[c];c=="className"||c=="extendConstructor_"?this[c]=d:b[c]=e&&e.__extend__?e.__extend__(d):d}if(f&&a[c="toString"]!==Object.prototype[c])b[c]=a[c];return this}});
var g=function(a,b){return{__extend__:function(a){var c=Function();c.prototype=this;c=new c;b(c,a);return c}}.__extend__(a)},h=function(a){return g(a,q)};return y("basis.Class",b.create).extend({SELF:e,BaseClass:b,create:b.create,isClass:a,CustomExtendProperty:g,ExtensibleProperty:h,NestedExtProperty:function(a){return g(a,function(a,b){for(var c in b){var d=a[c];a[c]=d&&d.__extend__?d.__extend__(b[c]):h(b[c])}})}})}(),u=function(){function a(a){var e=c[a];e||(e=c[a]=function(){var c=this.handlers_,
n,e;if(c&&c.length)for(var c=b.call(c),j=c.length;j-- >0;)n=c[j],e=n.handler[a],typeof e=="function"&&e.apply(n.thisObject,arguments)});return e}var b=Array.prototype.slice,c={},e,f=B(null,{handlers_:null,event_destroy:e=a("destroy","object"),listen:B.NestedExtProperty(),extendConstructor_:true,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(a,b){var c=this.handlers_;if(!c)c=this.handlers_=
[];b||(b=this);for(var d=c.length,e;d-- >0;)if(e=c[d],e.handler===a&&e.thisObject===b)return false;return!!c.push({handler:a,thisObject:b||this})},removeHandler:function(a,b){var c=this.handlers_;if(c){b||(b=this);for(var d=c.length,e;d-- >0;)if(e=c[d],e.handler===a&&e.thisObject===b)return!!c.splice(d,1);return false}},destroy:function(){if(this.handlers_)e.call(this,this),this.handlers_=null}});f.createEvent=a;f.event=c;return f}(),b=function(){var a=[];return{add:function(b){b!=null&&a.push(b)},
remove:function(b){a.remove(b)}}}();(function(){function a(a){if(b){if(a.source!=k||a.data!=c)return;basis.dom.event.kill(a)}e.length&&(a=e.shift(),delete f[a.key],a.fn())}var b=typeof addEventListener=="function"&&typeof postMessage=="function",c="zeroTimeoutMessage",e=[],f={},g=1;b&&k.addEventListener("message",a,true);var h=setTimeout;k.setTimeout=function(n,C){var D;C?D=h.call(k,n,C):(D={key:"z"+g++,fn:typeof n=="function"?n:new Function(n)},f[D.key]=D,e.push(D),b?postMessage(c,"*"):D.timer=h.call(k,
a,0),D=D.key);return D};var m=clearTimeout;k.clearTimeout=function(a){if(/z\d+/.test(a)){var b=f[a];b&&(clearTimeout(b.timer),e.remove(b),delete f[a])}else return m.call(k,a)}})();var c=function(){function a(){if(!C)if(g.length){var a=Date.now(),b=Math.max(g[0].eventTime,a);b<m&&(clearTimeout(n),n=setTimeout(j,(m=b)-a))}else n=clearTimeout(n),m=e}function c(b,d){var e=b.eventObjectId,o=h[d]&&h[d][e];o&&(g.remove(o),delete h[d][e],a())}function j(){var b=Date.now(),b=g.binarySearchPos(b+15,f);C=true;
g.splice(0,b).forEach(function(a){delete h[a.eventName][a.object.eventObjectId];a.callback.call(a.object)});C=false;m=e;a()}var e=2E12,f=s("eventTime"),g=[],h={},m=e,n=null,C=false;b.add({destroy:function(){C=true;clearTimeout(n);g.length=0;h=null}});return{add:function(b,e,n){var o=b.eventObjectId,H=h[e];H||(H=h[e]={});var E=H[o];if(E){if(isNaN(n))return c(b,e);if(E.eventTime==n)return;g.remove(E);E.eventTime=n}else{if(isNaN(n))return;E=H[o]={eventName:e,object:b,eventTime:n,callback:b[e]}}g.splice(g.binarySearchPos(n,
f),0,E);a()},remove:c}}();y("basis").extend({namespace:y,platformFeature:{},EventObject:u,TimeEventManager:c,Cleaner:b,require:r});k.basis.locale={}})(this);
(function(k,q){function v(i){for(var b=1E6,i=String(i).split("."),c=0,a=0;c<4&&c<i.length;c++,b/=100)a+=i[c]*b;return a}function z(){for(var i=0;i<arguments.length;i++){var b=arguments[i].toLowerCase();if(b in A){if(A[b])return true}else{var c=b.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(c){A[b]=false;var a=c[1].toLowerCase(),d=v(c[3]),c=c[4]||"=";if(a=y[a])return A[b]=!d||c=="="&&a==d||c=="+"&&a>=d||c=="-"&&a<d}}}return false}var t="basis.ua",A={},y={},p=q.navigator&&q.navigator.userAgent,s="unknown",
x={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},i;for(i in x)if(!(i=="MSIE"&&q.opera)&&!(i=="Safari"&&p.match(/chrome/i))&&!(i=="AppleWebKit"&&p.match(/iphone/i))&&p.match(RegExp(i+".(\\d+(\\.\\d+)*)","i")))for(var w=
x[i],l=q.opera&&typeof q.opera.version=="function"?q.opera.version():RegExp.$1,r=v(l),s=w[0]+" "+l,l=0;l<w.length;l++)y[w[l].toLowerCase()]=r;k.platformFeature.datauri=false;p=typeof Image!="undefined"?new Image:{};p.onload=function(){k.platformFeature.datauri=true};p.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";if(z("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(B){}t=k.namespace(t);t.toString=function(){return s};return t.extend({testImage:p,
prettyName:s,test:z,is:function(i){return z(i)},Cookies:{set:function(i,b,c,a){document.cookie=i+"="+(b==null?"":escape(b))+";path="+(a||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)+(c?";expires="+(new Date(Date.now()+c*1E3)).toGMTString():"")},get:function(i){return(i=document.cookie.match(RegExp("(^|;)\\s*"+i+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(i[2])},remove:function(i,b){document.cookie=i+"=;expires="+(new Date(0)).toGMTString()+";path="+(b||(location.pathname.indexOf("/")==
0?"":"/")+location.pathname)}}})})(basis,this);
(function(k,q){function v(a,b,c){if(b!=null)return a.insertBefore(j(b)?b:y(b),c||null)}function z(a){return s("",a.cloneNode(true)).innerHTML}function t(a){return j(a)||a&&a.nodeType?a:typeof a=="string"?l.getElementById(a):null}function A(d,j,f){var g,h=[],f=typeof f=="string"?getter(f):f||Function.$true;j&26&&f(d)&&h.push(d);switch(j){case 1:case 2:for(g=d;(g=g[u])&&g!==d.document;)f(g)&&h.push(g);break;case 64:for(g=d[b];g;)f(g)&&h.push(g),g=g[c];break;case 4:case 8:d[b]&&(j=new e(d),j.nodes(f,
h));break;case 128:j=new e(d,f);for(j.cursor_=d[c]||d[u];g=j.next();)h.push(g);break;case 256:for(g=d;g=g[c];)f(g)&&h.push(g);break;case 32:f(d[u])&&h.push(d[u]);break;case 512:j=new e(d,f,e.BACKWARD);for(j.cursor_=d[a]||d[u];g=j.next();)h.push(g);break;case 1024:for(g=d;g=g[a];)f(g)&&h.push(g)}return h}function y(a){return l.createTextNode(a!=null?a:"")}function p(){for(var a=l.createDocumentFragment(),b=arguments.length,c=p.array=[],d=0;d<b;d++)c.push(v(a,arguments[d]));return a}function s(a,b){var c=
a!=void 0&&typeof a!="string",d=(c?a.description:a)||"",e="div",o=d.match(/^([a-z0-9\_\-]+)(.*)$/i);o&&(e=o[1],d=o[2]);if(d!=""){for(var H=[],E={},K;o=m.exec(d);){if(o[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+d+"\n\nProblem place:\n> "+d.substr(0,o.index)+"--\>"+d.substr(o.index)+"<--");K=o[1]||o[2]||o[3];o[1]?E.id=K:o[2]?H.push(K):K!="class"&&(E[K]=o[4]?w(o[5],o[6],o[7]):K)}g&&E.name&&/^(input|textarea|select)$/i.test(e)&&(e="<"+e+" name="+E.name+">")}d=
l.createElement(e);if(E){if(E.style&&h)d.style.cssText=E.style;for(var j in E)d.setAttribute(j,E[j],0)}if(H&&H.length)d.className=H.join(" ");arguments.length>1&&v(d,p.apply(0,Array.from(arguments,1).flatten()));if(c&&(a.css&&k.cssom&&k.cssom.setStyle(d,a.css),k.dom.event))for(var f in a)typeof a[f]=="function"?k.dom.event.addHandler(d,f,a[f],d):a[f]instanceof k.dom.event.Handler&&k.dom.event.addHandler(d,f,a[f].handler,a[f].thisObject);return d}function x(a,b){return a[u]?a[u].replaceChild(b,a):
a}function i(a){if(l.selection){var b=l.selection.createRange();b.compareEndPoints("StartToEnd",b)!=0&&b.collapse(a);return b.getBookmark().charCodeAt(2)-2}}var w=Object.coalesce,l=q.document,r=k.Class,B=l.createElement("div"),u="parentNode",b="firstChild",c="nextSibling",a="previousSibling",d;d=typeof B.compareDocumentPosition=="function"?function(a,b){return a.compareDocumentPosition(b)}:function(a,b){return a==b?0:a.document!=b.document?33:a.sourceIndex>b.sourceIndex?2|8*b.contains(childA):4|16*
a.contains(childB)};var j;if(typeof Node!="undefined"){if(j=function(a){return a instanceof Node},!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else j=function(a){return a&&a.ownerDocument===l};var e=r(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,b,c){this.setRoot(a);this.setDirection(c);if(typeof b=="function")this.filter=b},setDirection:function(d){Object.extend(this,d?{a:"lastChild",b:a,c:c,d:b}:{a:b,b:c,c:a,d:"lastChild"})},
setRoot:function(a){this.root_=a||l;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,b){var c;b||(b=[]);for(this.reset();c=this.next(a);)b.push(c);return b},next:function(a){var a=a||this.filter,b=this.cursor_||this.root_;do for(var c=b[this.a];!c;){if(b===this.root_)return this.cursor_=null;(c=b[this.b])||(b=b[u])}while(!a(b=c));return this.cursor_=b},prev:function(a){var a=a||
this.filter,b=this.cursor_,c=this.c,d=this.d;do{var e=b?b[c]:this.root_[d];if(e){for(;e[d];)e=e[d];b=e}else b&&(b=b[u]);if(!b||b===this.root_){b=null;break}}while(!a(b));return this.cursor_=b},destroy:function(){this.cursor_=this.root_=null}});e.BACKWARD=true;var f="textContent innerText nodeValue".qw(),g=function(){var a=l.createElement("input");a.name="a";return!/name/.test(z(a))}(),h;B.setAttribute("style","color: red");h=B.style.color!=="red";var m=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return k.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:e,outerHTML:z,textContent:function(a){for(var b=0,c;c=f[b++];)if(a[c]!=null)return a[c];return A(a,4,function(a){return a.nodeType==3}).map(getter("nodeValue")).join("")},get:t,tag:function(a,b){a=t(a)||l;return b=="*"&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(b||"*"))},axis:A,findAncestor:function(a,b,c){for(;a&&a!==c;){if(b(a))return a;a=a.parentNode}},createElement:s,createText:y,createFragment:p,insert:function(a,
d,e,f){a=t(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(e){case void 0:case "end":f=null;break;case "begin":f=a[b];break;case "before":break;case "after":f=f[c];break;default:f=Number(e).between(0,a.childNodes.length)?a.childNodes[e]:null}e=!j(a);if(!d||!Array.isArray(d))e=e?d&&a.insertBefore(d,f):v(a,d,f);else if(e)for(var e=[],g=0,o=d.length;g<o;g++)e[g]=a.insertBefore(d[g],f);else a.insertBefore(p.apply(0,d),f),e=p.array;return e},remove:function(a){return a[u]?
a[u].removeChild(a):a},replace:x,swap:function(a,b){if(a===b||d(a,b)&25)return false;x(a,B);x(b,a);x(B,b);return true},clone:function(a,b){var c=a.cloneNode(!b);c.attachEvent&&A(c,8).forEach(Event.clearHandlers);return c},clear:function(a){for(a=t(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,b,c){var d=[],c=Function.getter(c||Function.$self),e;for(e in b)for(var o=0;o<a.length;o++){var f=c(a[o]);d[o]=b[e](a[o],o,f)?s(e,f):a[o]}return d},setAttribute:function(a,b,c){c==null?
a.removeAttribute(b):a.setAttribute(b,c)},parentOf:function(a,b){return a.contains(b)},isInside:function(a,b){return a==b||b.contains(a)},focus:function(a,b){try{a=t(a),a.focus(),b&&a.select&&a.select()}catch(c){}},setSelectionRange:function(a,b,c){arguments.length<3&&(c=b);if(a.setSelectionRange)a.setSelectionRange(b,c);else if(a.createTextRange){var d=a.createTextRange();d.collapse(true);d.moveStart("character",b);d.moveEnd("character",c-b);d.select()}},getSelectionStart:function(a){return typeof a.selectionStart!=
"undefined"?a.selectionStart:i(true)},getSelectionEnd:function(a){return typeof a.selectionEnd!="undefined"?a.selectionEnd:i(false)}})})(basis,this);
(function(k,q){function v(a){return a||q.event}function z(a){return typeof a=="string"?w.get(a):a}function t(a){a=v(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=true}function A(a){a=v(a);a.preventDefault?a.preventDefault():a.returnValue=false}function y(a){var b=Array.from(u[a.type]);if(b)for(var c=b.length;c-- >0;){var e=b[c];e.handler.call(e.thisObject,a)}}function p(a,c,j,e){a=z(a);if(!a)throw Error("Event.addHandler: can't attach event listener to undefined");if(typeof j!="function")throw Error("Event.addHandler: handler must be a function");
a[r]||(a[r]={});var f={handler:j,thisObject:e},g=a[r],h=g[c];if(h){for(a=0;c=h[a];a++)if(c.handler===j&&c.thisObject===e)return;h.push(f)}else h=g[c]=[f],h.fireEvent=function(a){a=v(a);if(b&&a&&typeof a.returnValue=="undefined"){y(a);if(a.cancelBubble===true)return;if(typeof a.returnValue=="undefined")a.returnValue=true}for(var c=0,d;d=h[c++];)d.handler.call(d.thisObject,a)},a.addEventListener?a.addEventListener(c,h.fireEvent,false):a.attachEvent("on"+c,h.fireEvent)}function s(a,b,c,e){var a=z(a),
f=a[r];if(f&&(f=f[b]))for(var g=0,h;h=f[g];g++)if(h.handler===c&&h.thisObject===e){f.splice(g,1);f.length||x(a,b);break}}function x(a,b){var a=z(a),c=a[r];if(c)if(typeof b!="string")for(b in c)x(a,b);else{var e=c[b];e&&(a.removeEventListener?a.removeEventListener(b,e.fireEvent,false):a.detachEvent("on"+b,e.fireEvent),delete c[b])}}var i=q.document,w=k.dom,l=Function.$null,r="__basisEvents",B={mousewheel:["mousewheel","DOMMouseScroll"]},u={},b=!i.addEventListener,c=function(){function a(){b++||setTimeout(function(){for(var a=
0;a<c.length;a++)c[a].callback.call(c[a].thisObject)},10)}var b=false,c=[];if(k.ua.is("ie7-"))(function(){var b="_"+Date.now();i.write('<script id="'+b+'" defer src="//:"><\/script>');z(b).onreadystatechange=function(){this.readyState=="complete"&&(w.remove(this),a())}})();else if(k.ua.is("safari525-"))var e=setInterval(function(){/loaded|complete/.test(i.readyState)&&(clearInterval(e),a())},15);else p(i,"DOMContentLoaded",a,false);p(i,"load",a,false);p(q,"load",a,false);return function(a,e){b||c.push({callback:a,
thisObject:e})}}();return k.namespace("basis.dom.event",v).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return B[a]||[a]},Handler:function(a,b){this.handler=a;this.thisObject=b},sender:function(a){a=v(a);return a.target||a.srcElement},cancelBubble:t,
cancelDefault:A,kill:function(a,b){(b=z(b))?p(b,a,Event.kill):(A(a),t(a))},key:function(a){a=v(a);return a.keyCode||a.which||0},charCode:function(a){a=v(a);return a.charCode||a.keyCode||0},mouseButton:function(a,b){a=v(a);return typeof a.which=="number"?a.which==b.VALUE:a.button&b.BIT},mouseX:function(a){a=v(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+(i.documentElement.scrollLeft||i.body.scrollLeft)},mouseY:function(a){a=v(a);return a.changedTouches?a.changedTouches[0].pageY:
"pageY"in a?a.pageY:a.clientY+(i.documentElement.scrollTop||i.body.scrollTop)},wheelDelta:function(a){a=v(a);return"wheelDelta"in a?a.wheelDelta/120:a.type=="DOMMouseScroll"?-a.detail/3:0},addGlobalHandler:function(a,b,c){var e=u[a];if(e)for(a=e.length;a-- >0;){var f=e[a];if(f.handler===b&&f.thisObject===c)return}else i.addEventListener?i.addEventListener(a,y,true):p(i,a,l),e=u[a]=[];e.push({handler:b,thisObject:c})},removeGlobalHandler:function(a,b,c){var e=u[a];if(e)for(var f=0,g;g=e[f];f++)if(g.handler===
b&&g.thisObject===c){e.splice(f,1);e.length||(delete u[a],i.removeEventListener?i.removeEventListener(a,y,true):s(i,a,l));break}},addHandler:p,addHandlers:function(a,b,c){var a=z(a),e;for(e in b)p(a,e,b[e],c)},removeHandler:s,clearHandlers:x,fireEvent:function(a,b){var a=z(a),c=a[r];c&&c[b]&&c[b].fireEvent()},onLoad:c,onUnload:function(a,b){p(q,"unload",a,b)}})})(basis,this);
(function(){function k(b,c,a){for(var d=1,j;c;)c&1&&(j=i[d],a&d?(b.addHandler(j.handler,j.context),j.action(j.context.add,b)):(b.removeHandler(j.handler,j.context),j.action(j.context.remove,b))),c>>=1,d<<=1}function q(b){return Array.isArray(b)?b.map(q):{data:b}}var v=basis.Class,z=basis.EventObject,t=Object.values,A=Function.$self,y=z.createEvent,p=z.event,s={},x=[],i={},w=1,l={NONE:0,MASK:0,add:function(b,c,a){i[w]={handler:c,action:a,context:{add:function(a,c){if(c){var e=l[b]+"_"+a.eventObjectId;
if(!c.subscribers_)c.subscribers_={};if(!c.subscribers_[e]){var f=c.subscriberCount;c.subscribers_[e]=a;c.subscriberCount+=1;c.event_subscribersChanged(c,f)}}},remove:function(a,c){if(c){var e=l[b]+"_"+a.eventObjectId;if(c.subscribers_[e]){var f=c.subscriberCount;delete c.subscribers_[e];c.subscriberCount-=1;c.event_subscribersChanged(c,f)}}}}};l[b]=w;l.MASK|=w;w<<=1}};l.add("DELEGATE",{delegateChanged:function(b,c){this.remove(b,c);this.add(b,b.delegate)}},function(b,c){b(c,c.delegate)});l.add("TARGET",
{targetChanged:function(b,c){this.remove(b,c);this.add(b,b.target)}},function(b,c){b(c,c.target)});var r=v(z,{state:"ready",data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,target:null,active:false,subscribeTo:l.DELEGATE+l.TARGET,subscriberCount:0,subscribers_:null,event_update:y("update","object","delta"),event_stateChanged:y("stateChanged","object","oldState"),event_delegateChanged:y("delegateChanged","object","oldDelegate"),event_rootChanged:y("rootChanged",
"object","oldRoot"),event_targetChanged:y("targetChanged","object","oldTarget")&&function(b,c){var a=this.listen.target;a&&(c&&c.removeHandler(a,this),this.target&&this.target.addHandler(a,this));p.targetChanged.call(this,b,c)},event_subscribersChanged:y("subscribersChanged","object"),event_activeChanged:y("activeChanged","object"),listen:{delegate:{update:function(b,c){this.data=b.data;this.event_update(this,c)},stateChanged:function(b,c){this.state=b.state;this.event_stateChanged(this,c)},targetChanged:function(b,
c){this.target=b.target;this.event_targetChanged(this,c)},rootChanged:function(b,c){this.data=b.data;this.event_rootChanged(this,c)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},init:function(b){z.prototype.init.call(this,b);if(b=this.delegate)this.delegate=null,this.data=b.data,this.state=b.state,this.setDelegate(b);else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&k(this,this.subscribeTo,l.MASK)},isConnected:function(b){if(b instanceof
r){for(;b&&b!==this&&b!==b.delegate;)b=b.delegate;return b===this}return false},getRootDelegate:function(){for(var b=this;b.delegate&&b.delegate!==b;)b=b.delegate;return b},setDelegate:function(b){if(this.canHaveDelegate&&b&&b instanceof r){if(b.delegate&&this.isConnected(b))return false}else b=null;if(this.delegate!==b){var c=this.state,a=this.data,d=this.delegate,j=this.target,e=this.root,f={};d&&d.removeHandler(this.listen.delegate,this);if(b){this.delegate=b;this.root=b.root;this.data=b.data;
this.state=b.state;this.target=b.target;b.addHandler(this.listen.delegate,this);for(var g in b.data)g in a===false&&(f[g]=void 0);for(g in a)a[g]!==b.data[g]&&(f[g]=a[g])}else for(g in this.target=this.delegate=null,this.root=this,this.data={},a)this.data[g]=a[g];this.event_delegateChanged(this,d);this.root!==e&&this.event_rootChanged(this,e);this.target!==j&&this.event_targetChanged(this,j);if(b){for(g in f){this.event_update(this,f);break}c!==this.state&&(String(c)!=this.state||c.data!==this.state.data)&&
this.event_stateChanged(this,c)}return true}return false},setState:function(b,c){var a=this.target||this.getRootDelegate();if(a!==this)return a.setState(b,c);return this.state!=String(b)||this.state.data!=c?(a=this.state,this.state=Object(String(b)),this.state.data=c,this.event_stateChanged(this,a),true):false},deprecate:function(){this.state!="processing"&&this.setState("deprecated")},update:function(b){var c=this.target||this.getRootDelegate();if(c!==this)return c.update(b);if(b){var c={},a=0,d;
for(d in b)this.data[d]!==b[d]&&(a++,c[d]=this.data[d],this.data[d]=b[d]);if(a)return this.event_update(this,c),c}return false},setActive:function(b){b=!!b;return this.active!=b?(this.active=b,this.event_activeChanged(this),k(this,this.subscribeTo,l.MASK*b),true):false},setSubscription:function(b){b&=l.MASK;var c=this.subscribeTo^b;return c?(this.subscribeTo=b,this.active&&k(this,c,b),true):false},destroy:function(){this.active&&k(this,this.subscribeTo,0);this.delegate&&this.setDelegate();z.prototype.destroy.call(this);
this.data=s;this.state="undefined";this.target=this.root=null}}),A=v(null,{itemClass:r,keyGetter:A,map_:null,extendConstructor_:true,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(b){return this.get(this.keyGetter(b),b)},create:function(b){var c={};b instanceof r?c.delegate=b:c.data={id:b,title:b};return new this.itemClass(c)},get:function(b,c){var a=b instanceof r?b.eventObjectId:b,d=this.map_[a];!d&&c&&(d=this.map_[a]=this.create(b,c),d.addHandler({destroy:function(){delete this.map_[a]}},
this));return d},destroy:function(){basis.Cleaner.remove(this);for(var b=t(this.map_),c=0,a;a=b[c++];)a.destroy()}}),B=v(r,{state:"undefined",itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:y("datasetChanged","dataset","delta")&&function(b,c){var a,d=0,j=0,e;if(a=c.inserted)for(;e=a[d];)this.item_[e.eventObjectId]=e,d++;if(a=c.deleted)for(;e=a[j];)delete this.item_[e.eventObjectId],j++;this.itemCount+=d-j;this.cache_=null;p.datasetChanged.call(this,b,c)},init:function(b){r.prototype.init.call(this,
b);this.memberMap_={};this.item_={}},has:function(b){return!(!b||!this.item_[b.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=t(this.item_);return this.cache_},pick:function(){for(var b in this.item_)return this.item_[b];return null},top:function(b){var c=[];if(b)for(var a in this.item_)if(c.push(this.item_[a])>=b)break;return c},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();r.prototype.destroy.call(this);
this.cache_=x;this.itemCount=0;this.item_=this.memberMap_=null}}),u=v(B,{listen:{item:{destroy:function(b){this.memberMap_[b.eventObjectId]&&this.remove([b])}}},init:function(b){B.prototype.init.call(this,b);if(b=this.items)this.set(b),this.items=null},add:function(b){for(var c,a=this.memberMap_,d=[],j=0;j<b.length;j++){var e=b[j];if(e instanceof r){var f=e.eventObjectId;a[f]||(a[f]=e,e.addHandler(this.listen.item,this),d.push(e))}}d.length&&this.event_datasetChanged(this,c={inserted:d});return c},
remove:function(b){for(var c,a=this.memberMap_,d=[],j=0;j<b.length;j++){var e=b[j];if(e instanceof r){var f=e.eventObjectId;a[f]&&(e.removeHandler(this.listen.item,this),delete a[f],d.push(e))}}d.length&&this.event_datasetChanged(this,c={deleted:d});return c},set:function(b){if(!this.itemCount)return this.add(b);if(!b.length)return this.clear();for(var c=this.memberMap_,a={},d=[],j=[],e,f,g,h=0;h<b.length;h++)if(e=b[h],e instanceof r)f=e.eventObjectId,a[f]=e,c[f]||(c[f]=e,e.addHandler(this.listen.item,
this),j.push(e));for(f in c)a[f]||(e=c[f],e.removeHandler(this.listen.item,this),delete c[f],d.push(e));var m;var b={},i;if(j&&j.length)i=b.inserted=j;if(d&&d.length)i=b.deleted=d;i&&(m=b);(g=m)&&this.event_datasetChanged(this,g);return g},sync:function(b,c){if(b){u.setAccumulateState(true);for(var a=this.memberMap_,d,j,e={},f=[],g,h=0;h<b.length;h++)if(d=b[h],d instanceof r)j=d.eventObjectId,e[j]=d,a[j]||f.push(d);for(j in this.item_)e[j]||this.item_[j].destroy();c&&f.length&&(g=this.add(f));u.setAccumulateState(false);
return g}},clear:function(){var b,c=this.getItems();if(c.length){for(b=c.length;b-- >0;)c[b].removeHandler(this.listen.item,this);this.event_datasetChanged(this,b={deleted:c});this.memberMap_={}}return b}});u.setAccumulateState=function(){function b(a){var b=a.dataset;j.call(b,b,a)}function c(a,c){var d=a.eventObjectId,e=c.inserted,f=c.deleted,i=g[d];if(e&&f)return i&&(delete g[d],b(i)),j.call(a,a,c);if(i){var k=i[e?"inserted":"deleted"];if(k)return k.push.apply(k,e||f);else b(i)}g[d]=c;c.dataset=
a}function a(){e=1;setAccumulateState(false)}var d=B.prototype,j=d.event_datasetChanged,e=0,f,g={};return function(h){if(h){if(e==0)d.event_datasetChanged=c,f=setTimeout(a,0);e++}else if(e-=e>0,e==0)clearTimeout(f),d.event_datasetChanged=j,h=g,g={},t(h).forEach(b)}}();basis.namespace("basis.data",q).extend({STATE:{UNDEFINED:"undefined",READY:"ready",PROCESSING:"processing",ERROR:"error",DEPRECATED:"deprecated"},SUBSCRIPTION:l,Object:r,DataObject:r,KeyObjectMap:A,AbstractDataset:B,Dataset:u})})(basis,
this);
(function(k,q){function v(a,c,e,f){for(var c=c.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i),g=u(),h,i=0;i<c.length;i++)i%2?(h=c[i].split(/\|/),a.getters[h[0]]=e+"childNodes["+f+"]",h=h.length>1?h[1]:h[0]):h=c[i].length?c[i]:null,h!=null&&(B&&(g.lastChild&&g.appendChild(p.createComment("")),f++),g.appendChild(b(h)),f++);return g}function z(a){return function(b){if(!b||!(b.type=="click"&&b.which==3)){var c=k.dom.event.sender(b),f,g;do if(f=c.getAttributeNode&&c.getAttributeNode(a))break;while(c=c.parentNode);if(c&&
f){do if(g=c.basisObjectId)if((g=w[g])&&g.templateAction){c=f.nodeValue.qw();f=0;for(var h;h=c[f++];)g.templateAction(h,k.dom.event(b));break}while(c=c.parentNode)}}}}function t(a,b,c){b=b.trim();if(!b)return"";for(var f="",g;g=r.exec(b);){var h=g[2],m=g[4]||g[5]||h;g[3]&&(a.getters[g[3]]=c+'.getAttributeNode("'+h+'")');if(g=h.match(/^event-([a-z]+)/i)){var l=g[1];if(!i[l]){i[l]=true;g=0;for(var l=k.dom.event.browserEvents(l),q;q=l[g++];)k.dom.event.addGlobalHandler(q,z(h))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(a,b){var a=k.dom.event(a),c=this,o;do if(o=c.basisObjectId)if((o=w[o])&&o.templateAction){for(var c=b.qw(),d=0,E;E=c[d++];)o.templateAction(E,k.dom.event(a));break}while(c=c.parentNode)}}f+=h=="class"?m.trim().replace(/^(.)|\s+/g,".$1"):"["+h+(m?"="+m.quote('"'):"")+"]"}return f}function A(a,b){if(!a.stack)a.stack=[];if(!a.source)a.source=a.str;b||(b=".");for(var c=u(),f,g=0,h,i=a.stack;h=l.exec(a.str);){f=RegExp.leftContext;a.str=a.str.substr(f.length+h[0].length);if(f.length)c.appendChild(v(a,
f,b,g)),g=c.childNodes.length;if(h[5])if(h[5]==i[i.length-1])return i.pop(),c;else throw"Wrong end tag";if(h[6])h[7]&&(a.getters[h[7]]=b+"childNodes["+g+"]"),c.appendChild(p.createComment(h[6]));else{f=h[1];var k=h[2],q=!!h[4],r=b+"childNodes["+g+"]";h=s.createElement(f+t(a,h[3],r));k&&(a.getters[k]=r);q||(i.push(f),h.appendChild(A(a,r+".")));c.appendChild(h)}g++}a.str.length&&c.appendChild(v(a,a.str,b,g));if(i.length)throw"No end tag for "+i.reverse();return c}function y(a){if(!this.proto){a=this.source;
if(typeof a=="function")this.source=a=a();for(var a=a.trim(),a={str:a,getters:{element:".childNodes[0]"}},b=A(a),a=Object.iterate(a.getters,function(a,c){for(var d=a.split(/\|/).map(String.format,"obj_.{0}"),e=c.split(/(\.?childNodes\[(\d+)\])/),f=b,g=0;g<e.length;g+=3){var o=e[g+2];if(!o)break;e[g+2]="";f=f.childNodes[o];f.previousSibling?f.nextSibling||(e[g+1]=".lastChild"):e[g+1]=".firstChild"}return{name:d[0],alias:d.join("="),path:"dom_"+e.join("")}}).sortAsObject("path"),c=0;c<a.length;c++)for(var f=
RegExp("^"+a[c].path.forRegExp()),g=c+1,h;h=a[g++];)h.path=h.path.replace(f,a[c].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(a,b){obj_=a||{};dom_=proto_.cloneNode(true);_code_();if(b&&obj_.element){var c=obj_.element.basisObjectId=map_.seed++;map_[c]=b}return obj_}.toString().replace("_code_()",a.map(String.format,"{alias}={path};\n").join(""))))(b,w);this.clearInstance=(new Function("map_","var obj_; return "+function(a){obj_=a;(a=obj_.element&&obj_.element.basisObjectId)&&
delete map_[a];_code_()}.toString().replace("_code_()",a.map(String.format,"{alias}=null;\n").join(""))))(w)}}var p=q.document,s=k.dom,x=k.Class,i={},w={seed:1},l=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<\!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,r=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;s.createFragment();var B=s.createElement("","a","b").cloneNode(true).childNodes.length==1,u=s.createFragment,
b=s.createText,c=x(null,{__extend__:function(a){return a instanceof c?a:new c(a)},init:function(a){this.source=a},createInstance:function(a,b){y.call(this);return this.createInstance(a,b)},clearInstance:function(){y.call(this)}}),a=p.createElement("DIV");return k.namespace("basis.html").extend({Template:c,escape:function(a){return s.createElement("DIV",s.createText(a)).innerHTML},unescape:function(b){a.innerHTML=b;return a.firstChild.nodeValue},string2Html:function(b){a.innerHTML=b;return s.createFragment.apply(null,
Array.from(a.childNodes))}})})(basis,this);
(function(k){function q(a){return a.sortingValue||0}function v(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return+(a>b)||-(a<b)}function z(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return-(a>b)||+(a<b)}function t(a){return a.childNodes.sort(a.localSortingDesc?z:v)}function A(a,b){var c=b.length-1;a.childNodes=b;a.firstChild=b[0]||null;a.lastChild=b[c]||null;for(var d=c;c=b[d];d--)c.nextSibling=b[d+1]||null,c.previousSibling=b[d-1]||null,a.insertBefore(c,c.nextSibling)}function y(a,b){var c=a.childFactory||
a.document&&a.document.childFactory,d,b=Object.extend({document:a.document,contextSelection:a.selection||a.contextSelection},b);if(c&&(d=c.call(a,b),d instanceof a.childClass))return d;if(!d)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(a.childClass&&a.childClass.className)+" but "+(d&&d.constructor&&d.constructor.className)+")";}function p(){return k.ui.apply(this,arguments)}var s=k.Class,x=k.dom,i=k.data,w=i.SUBSCRIPTION,l=i.DataObject,
r=i.AbstractDataset,B=i.Dataset,u=x.AXIS_DESCENDANT,b=x.AXIS_DESCENDANT_OR_SELF,c=Function.getter,a=Object.complete,d=x.axis,i=k.EventObject.createEvent,j=k.EventObject.event;w.add("DATASOURCE",{dataSourceChanged:function(a,b){this.remove(a,b);this.add(a,a.dataSource)}},function(a,b){a(b,b.dataSource)});var e=s.ExtensibleProperty(),f={ownerChanged:function(){},destroy:function(a){x.replace(a.element,this)}},g=function(){var a=this.key,b=this.config,c=this.owner,d=typeof b.existsIf!="function"||b.existsIf(c),
e=c.satellite[a];if(d){var d="delegate"in b,g="dataSource"in b,h=typeof b.delegate=="function"?b.delegate(c):null,j=typeof b.dataSource=="function"?b.dataSource(c):null;if(e)d&&e.setDelegate(h),g&&e.setDataSource(j);else{var F=c.tmpl[b.replace||a],e={owner:c};if(d)e.delegate=h;if(g)e.dataSource=j;b.config&&Object.complete(e,typeof b.config=="function"?b.config(c):b.config);e=new b.instanceOf(e);c.satellite[a]=e;F&&e instanceof k.ui.Node&&e.element&&(x.replace(F,e.element),e.addHandler(f,F))}}else if(e)e.destroy(),
e.owner=null,delete c.satellite[a]},h=s.CustomExtendProperty({update:true},function(a,b){for(var c in b)a[c]=b[c]?g:null}),m=s(l,{event_update:function(a,b){l.prototype.event_update.call(this,a,b);var c=this.parentNode;c&&(c.matchFunction&&(this.match(),this.match(c.matchFunction)),c.insertBefore(this,this.nextSibling))},event_childNodesModified:i("childNodesModified","node","delta"),event_dataSourceChanged:i("dataSourceChanged","node","oldDataSource"),event_localGroupingChanged:i("localGroupingChanged",
"node","oldGroupingNode"),event_localSortingChanged:i("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:i("ownerChanged","node","oldOwner"),event_satellitesChanged:i("satellitesChanged","node","delta"),subscribeTo:l.prototype.subscribeTo+w.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegateParent:false,nodeType:"DOMWrapperNode",canHaveChildren:false,childNodes:null,dataSource:null,colMap_:null,destroyDataSourceMember:true,document:null,
parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:false,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:e,satellite:null,owner:null,init:function(a){var b=this.dataSource,c=this.childNodes,d=this.localGrouping;if(b)this.dataSource=null;l.prototype.init.call(this,a);if(d)this.localGrouping=null,this.setLocalGrouping(d);if(this.canHaveChildren)this.childNodes=[],b?(this.dataSource=null,this.setDataSource(b)):
c&&this.setChildNodes(c);else{if(c)this.childNodes=null;if(b)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==e)for(var f in this.satelliteConfig)if(a=this.satelliteConfig[f],s.isClass(a)&&(a={instanceOf:a}),typeof a=="object"){b={key:f,owner:this,config:a};a=a.hook?h.__extend__(a.hook):h;for(f in a)if(a[f]===g){this.addHandler(a,b);break}g.call(b)}if(f=this.owner)this.owner=null,this.setOwner(f)},appendChild:function(){},insertBefore:function(){},removeChild:function(){},
replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||a instanceof m==false)a=null;if(this.owner!==a){var b=this.owner;b&&b.removeHandler(this.listen.owner,this);(this.owner=a)&&a.addHandler(this.listen.owner,this);this.event_ownerChanged(this,b)}},destroy:function(){l.prototype.destroy.call(this);this.dataSource?
this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping)this.localGrouping.destroy(),this.localGrouping=null;this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var b=this.satellite[a];b.destroy();b.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=this.document=null}}),n=s(m,{autoDestroyIfEmpty:false,nodes:null,first:null,last:null,
init:function(a){this.nodes=[];m.prototype.init.call(this,a)},insert:function(a,b){var c=this.nodes,d=b?c.indexOf(b):-1;d==-1?(c.push(a),this.last=a):c.splice(d,0,a);this.first=c[0];a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var b=this.nodes;if(b.remove(a))this.first=b[0]||null,this.last=b[b.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]});!this.first&&this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var a=
this.nodes,b=a.length;b-- >0;)a[b].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){m.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),C={canHaveChildren:true,childClass:m,childFactory:null,listen:{dataSource:{datasetChanged:function(a,b){var c={},d=[];if(b.deleted)if(c.deleted=d,this.childNodes.length==b.deleted.length){d.push.apply(d,this.childNodes);var e=this.dataSource;
this.dataSource=null;this.clear(true);this.dataSource=e;this.colMap_={}}else for(var e=0,f;f=b.deleted[e];e++){f=f.eventObjectId;var g=this.colMap_[f];delete this.colMap_[f];g.canHaveDelegate=true;this.removeChild(g);d.push(g)}if(b.inserted){c.inserted=[];for(e=0;f=b.inserted[e];e++)g=y(this,{cascadeDestroy:false,delegate:f}),g.canHaveDelegate=false,this.colMap_[f.eventObjectId]=g,c.inserted.push(g),this.firstChild&&this.insertBefore(g)}this.firstChild?this.event_childNodesModified(this,c):this.setChildNodes(c.inserted);
if(this.destroyDataSourceMember&&d.length)for(e=0;f=d[e];e++)f.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},insertBefore:function(a,b){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(a.firstChild){var c=this;do if(c==a)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";while(c=c.parentNode)}if(this.dataSource&&!this.dataSource.has(a.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";
a instanceof this.childClass==false&&(a=y(this,a instanceof l?{delegate:a}:a));var e=a.parentNode===this,f=a.groupNode,g=this.localGrouping,h=this.localSorting,j,F=this.childNodes,i,I,k=null,c=-1,m=false,n;if(e)n=a.nextSibling,I=a.previousSibling;if(h&&(b=null,j=this.localSortingDesc,i=h(a)||0,e))if(i===a.sortingValue)m=true;else if((!n||(j?n.sortingValue<=i:n.sortingValue>=i))&&(!I||(j?I.sortingValue>=i:I.sortingValue<=i)))a.sortingValue=i,m=true;if(g){k=g.getGroupNode(a);I=k.nodes;if(f===k&&(m||
e&&n===b))return a;h?m?c=n&&n.groupNode===k?I.indexOf(n):I.length:(c=I.binarySearchPos(i,q,j),a.sortingValue=i):c=b&&b.groupNode===k?I.indexOf(b):I.length;if(c<I.length)b=I[c];else if(k.last)b=k.last.nextSibling;else{c=k;for(b=null;c=c.nextSibling;)if(b=c.first)break}if(a===b||e&&a.nextSibling===b)return f!==k&&(f&&f.remove(a),k.insert(a)),a;c=-1}else if(h){if(m)return a;c=F.binarySearchPos(i,q,j);b=F[c];a.sortingValue=i;if(a===b||e&&n===b)return a}else{if(b&&b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";
if(e){if(n===b)return a;if(a===b)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}e?(a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.previousSibling=null,a.nextSibling=null,c==-1?F.remove(a):(j=F.indexOf(a),F.splice(j,1),j<c&&c--),f&&(f.remove(a),f=null)):a.parentNode&&a.parentNode.removeChild(a);f!=k&&k.insert(a,b);if(b){c==
-1&&(c=F.indexOf(b));if(c==-1)throw"basis.dom.wrapper: Node was not found";a.nextSibling=b;F.splice(c,0,a)}else c=F.length,F.push(a),b={previousSibling:this.lastChild},this.lastChild=a;a.parentNode=this;a.previousSibling=b.previousSibling;c==0?this.firstChild=a:b.previousSibling.nextSibling=a;b.previousSibling=a;var p=false,r=false,s=this.selection||this.contextSelection;if(!a.document&&a.document!==this.document)p=this.document,a.document=this.document;if(!a.contextSelection&&a.contextSelection!==
s)a.contextSelection=s,r=!a.selection,a.selected&&s.add([a]);a.firstChild&&(p||r)&&d(a,u).forEach(function(a){if(p&&!a.document)a.document=p;if(r&&!a.contextSelection)a.selected&&a.unselect(),a.contextSelection=s});e||(a.match&&a.match(this.matchFunction),a.autoDelegateParent&&a.setDelegate(this),this.dataSource||this.event_childNodesModified(this,{inserted:[a]}));return a},removeChild:function(a){if(a==null||a.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(a instanceof this.childClass==
false)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(a))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(a),1);a.parentNode=null;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling;a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling;a.nextSibling=null;a.previousSibling=null;a.document===
this.document&&d(a,b).forEach(function(a){if(a.document==this.document)a.document=null},this);if(a.contextSelection){for(var c=a.contextSelection,e=a,f=[];e;){if(e.contextSelection===c)e.selected&&f.push(e),e.contextSelection=null;if(!e.selection&&e.firstChild)e=e.firstChild;else if(e.nextSibling)e=e.nextSibling;else for(;e=e.parentNode;)if(e.nextSibling){e=e.nextSibling;break}}c.remove(f)}a.groupNode&&a.groupNode.remove(a);this.dataSource||this.event_childNodesModified(this,{deleted:[a]});a.autoDelegateParent&&
a.setDelegate();return a},replaceChild:function(a,b){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(b==null||b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(a,b);return this.removeChild(b)},clear:function(a){if(this.dataSource)this.setDataSource();else if(this.firstChild){var b=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:b});for(var c=
b.length;c-- >0;){var e=b[c];e.parentNode=null;e.groupNode=null;a?((e.selection||e.document)&&d(e,x.AXIS_DESCENDANT_OR_SELF).forEach(function(a){if(this.selection&&a.selection===this.selection)a.selected&&a.selection.remove([a]),a.selection=null;if(a.document===this.document)a.document=null},this),e.nextSibling=null,e.previousSibling=null,e.autoDelegateParent&&e.setDelegate()):e.destroy()}if(this.localGrouping){a=this.localGrouping.childNodes;for(c=a.length-1;b=a[c];c--)b.clear()}}},setChildNodes:function(a,
b){this.dataSource||this.clear(!!b);if(a&&("length"in a==false&&(a=[a]),a.length)){var c=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var d=0,e=a.length;d<e;d++)this.insertBefore(a[d]);this.event_childNodesModified=c;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||!this.canHaveChildren||a instanceof r==false)a=null;if(this.dataSource!==a){var b=this.dataSource;if(b)this.colMap_=this.dataSource=null,b.removeHandler(this.listen.dataSource,
this),b.itemCount&&this.clear();if(a)this.dataSource=a,this.colMap_={},a.addHandler(this.listen.dataSource,this),a.itemCount&&this.listen.dataSource.datasetChanged.call(this,a,{inserted:a.getItems()});this.event_dataSourceChanged(this,b)}},setLocalGrouping:function(a){if(typeof a=="function"||typeof a=="string")a={groupGetter:c(a)};a instanceof G==false&&(a=a!=null&&typeof a=="object"?new this.localGroupingClass(Object.complete({},a)):null);if(this.localGrouping!==a){var b=this.localGrouping,d;if(this.localGrouping){if(!a&&
(this.localGrouping=null,this.firstChild)){d=this.localSorting?t(this):this.childNodes;for(var e=d.length;e-- >0;)d[e].groupNode=null;A(this,d)}b.setOwner()}if(a&&(this.localGrouping=a,a.setOwner(this),this.firstChild)){d=this.localSorting?t(this):this.childNodes;for(e=0;a=d[e];e++)a.groupNode=this.localGrouping.getGroupNode(a);for(e=0;a=d[e];e++)a.groupNode.nodes.push(a);d.length=0;for(e=this.localGrouping.nullGroup;e;e=e.nextSibling)a=e.nodes,e.first=a[0]||null,e.last=a[a.length-1]||null,d.push.apply(d,
a),e.event_childNodesModified(e,{inserted:a});A(this,d)}this.event_localGroupingChanged(this,b)}},setLocalSorting:function(a,b){a&&(a=c(a));if(this.localSorting!=a||this.localSortingDesc!=!!b){var d=this.localSorting,e=this.localSortingDesc;this.localSortingDesc=!!b;this.localSorting=a||null;if(a&&this.firstChild){var f=[],g;for(g=this.firstChild;g;g=g.nextSibling)g.sortingValue=a(g)||0;if(this.localGrouping)for(var h=this.localGrouping.nullGroup;h;h=h.nextSibling)g=h.nodes=t({childNodes:h.nodes,
localSortingDesc:this.localSortingDesc}),h.first=g[0]||null,h.last=g[g.length-1]||null,f.push.apply(f,g);else f=t(this);A(this,f)}this.event_localSortingChanged(this,d,e)}},setMatchFunction:function(a){if(this.matchFunction!=a){this.matchFunction=a;for(var b=this.lastChild;b;b=b.previousSibling)b.match(a)}}},w=s(m,{event_enable:i("enable","node"),event_disable:i("disable","node"),event_select:i("select","node"),event_unselect:i("unselect","node"),event_match:i("match","node"),event_unmatch:i("unmatch",
"node"),selectable:true,selected:false,selection:null,contextSelection:null,matchFunction:null,matched:true,disabled:false,init:function(a){if(this.selection&&this.selection instanceof r==false)this.selection=new J(this.selection);m.prototype.init.call(this,a);this.disabled&&this.event_disable(this);if(this.selected)this.selected=false,this.select(true)},setSelection:function(a){if(this.selection==a)return false;var b=this.selection;d(this,u,function(c){if(c.contextSelection==b)c.selected&&b&&b.remove([c]),
c.contextSelection=a});this.selection=a;return true},hasOwnSelection:function(){return!!this.selection},select:function(a){var b=this.selected,c=this.contextSelection;if(c)a?b?c.remove([this]):c.add([this]):this.selectable&&c.set([this]);else if(!b&&this.selectable&&!this.isDisabled())this.selected=true,this.event_select(this);return this.selected!=b},unselect:function(){var a=this.selected;if(a){var b=this.contextSelection;b?b.remove([this]):(this.selected=false,this.event_unselect(this))}return this.selected!=
a},enable:function(){if(this.disabled)this.disabled=false,this.event_enable(this)},disable:function(){if(!this.disabled)this.disabled=true,this.event_disable(this)},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!x.findAncestor(this,c("disabled"))},match:function(a){if(typeof a!="function")if(this.matched){if(this.underMatch_)this.underMatch_(this,true),this.underMatch_=null}else this.matched=true,this.event_match(this);else if(a(this)){if(this.underMatch_=a,!this.matched)this.matched=
true,this.event_match(this)}else if(this.underMatch_=null,this.matched)this.matched=false,this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),delete this.selection);this.unselect();m.prototype.destroy.call(this)}}),D=s(w,C,{}),G=s(m,C,{event_childNodesModified:function(a,b){j.childNodesModified.call(this,a,b);this.nullGroup.nextSibling=this.firstChild;if(b.inserted&&this.dataSource&&this.nullGroup.first)for(var c=this.owner,
d=Array.from(this.nullGroup.nodes),e=d.length;e-- >0;)c.insertBefore(d[e],d[e].nextSibling)},event_ownerChanged:function(a,b){b&&b.localGrouping===this&&b.setLocalGrouping(null,true);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);j.ownerChanged.call(this,a,b);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:true,autoDestroyEmptyGroups:true,titleGetter:c("data.title"),groupGetter:Function.$undef,childClass:n,childFactory:function(b){return new this.childClass(a(b,
{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups}))},init:function(a){this.map_={};this.nullGroup=new n({autoDestroyIfEmpty:false});m.prototype.init.call(this,a)},getGroupNode:function(a){var a=this.groupGetter(a),b=a instanceof l,c=this.map_[b?a.eventObjectId:a];!c&&!this.dataSource&&(c=this.appendChild(b?{delegate:a}:{data:{id:a,title:a}}));return c||this.nullGroup},insertBefore:function(a,b){a=C.insertBefore.call(this,a,b);if("groupId_"in a==false)a.groupId_=
a.delegate?a.delegate.eventObjectId:a.data.id,this.map_[a.groupId_]=a;if(a.first){var c=this.owner,d=c.childNodes,e=a.first,f=a.last,g,h,F;for(g=a;g=g.previousSibling;)if(F=g.last)break;if(!F)F=this.nullGroup.last;for(g=a;g=g.nextSibling;)if(h=g.first)break;if(e.previousSibling!==F||f.nextSibling!==h){if(e.previousSibling)e.previousSibling.nextSibling=f.nextSibling;if(f.nextSibling)f.nextSibling.previousSibling=e.previousSibling;g=d.splice(d.indexOf(e),a.nodes.length);var j=d.indexOf(h);g.unshift(j!=
-1?j:d.length,0);d.splice.apply(d,g);e.previousSibling=F;f.nextSibling=h;if(F)F.nextSibling=e;if(h)h.previousSibling=f;c.firstChild=d[0];c.lastChild=d[d.length-1]}}return a},removeChild:function(a){C.removeChild.call(this,a);delete this.map_[a.groupId_];return a},clear:function(){C.clear.call(this);this.map_={}},destroy:function(){this.setOwner();m.prototype.destroy.call(this);this.map_=null}});m.prototype.localGroupingClass=G;var i=s(r,{autoDestroy:true,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,
b){var c=this.memberMap_,d={},e=0,f=0,g=b.inserted,h=b.deleted;if(g&&g.length)for(d.inserted=g;a=g[e];)c[a.eventObjectId]=a,e++;if(h&&h.length)for(d.deleted=h;a=h[f];)delete c[a.eventObjectId],f++;(e||f)&&this.event_datasetChanged(this,d)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:i("sourceNodeChanged")&&function(a,b){j.sourceNodeChanged.call(this,a,b);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:false,init:function(a,
b){r.prototype.init.call(this,b);a&&this.setSourceNode(a)},setSourceNode:function(a){a instanceof m==false&&(a=null);if(a!==this.sourceNode){var b=this.sourceNode;b&&(b.removeHandler(this.listen.sourceNode,this),this.listen.sourceNode.childNodesModified.call(this,b,{deleted:b.childNodes}));a&&(a.addHandler(this.listen.sourceNode,this),this.listen.sourceNode.childNodesModified.call(this,a,{inserted:a.childNodes}));this.sourceNode=a;this.event_sourceNodeChanged(this,b)}},destroy:function(){this.setSourceNode();
r.prototype.destroy.call(this)}}),J=s(B,{multiple:false,event_datasetChanged:function(a,b){B.prototype.event_datasetChanged.call(this,a,b);if(b.inserted)for(var c=0,d;d=b.inserted[c];c++)if(!d.selected)d.selected=true,d.event_select();if(b.deleted)for(c=0;d=b.deleted[c];c++)if(d.selected)d.selected=false,d.event_unselect()},add:function(a){if(!this.multiple)if(this.itemCount)return this.set(a);else a.splice(1);for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);return B.prototype.add.call(this,
b)},set:function(a){for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);this.multiple||a.splice(1);return B.prototype.set.call(this,b)}});k.namespace("basis.dom.wrapper",p).extend({AbstractNode:m,InteractiveNode:w,Node:D,GroupingNode:G,PartitionNode:n,simpleTemplate:p,ChildNodesDataset:i,Selection:J})})(basis);
(function(k,q){function v(a,b){return A(b,true).getRule(a,true)}function z(a,b){var c=a.match(/^([^{]+)\{(.*)\}\s*$/);if(c){for(var d=c[1].trim().split(/\s*,\s*/),e=0;e<d.length;e++)this.addRule(d[e],c[2]||null,b++);return b-1}}function t(a,b){var c=u.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:b?"alternate ":"",url:a.quote('"')}));u.tag(null,"HEAD")[0].appendChild(c);c=c.sheet||c.styleSheet;try{if(!c.cssRules)c.cssRules=c.rules}catch(d){}if(!c.insertRule)c.insertRule=
z;if(!c.deleteRule)c.deleteRule=c.removeRule;return c}function A(a,b){a||(a="DefaultGenericStyleSheet");e[a]||b&&(e[a]=new h(t()));return e[a]}function y(a,b,c,d){for(var d=d||{},b=b.qw(),e=0,h;h=b[e];e++)if(typeof g.style[h]!="undefined"){c&&(k.platformFeature["css-"+a]=h);f[a]={key:h,getter:d[h]};break}}function p(a,b){var c=f[a];if(a=c?c.key:a.replace(/^-ms-/,"ms-").camelize())return{key:a,value:c&&c.getter?c.getter(b):b}}function s(a,b,c){if(typeof a.setProperty=="function")return a.setProperty(b,
c);if(b=p(b,c))return a.style[b.key]=b.value}function x(a,b){for(var c in b)s(a,c,b[c]);return a}function i(a,b){return s(a,"display",typeof b=="string"?b:b?"":"none")}function w(a,b){return s(a,"visibility",b?"":"hidden")}function l(a){return G[a]||(G[a]=RegExp("\\s*\\b"+a+"\\b"))}function r(a,b){var c=(b?"g":"s")+a;return o[c]||(o[c]=RegExp((b?"":"\\s*")+"\\b"+a+".*\\b"))}var B=q.document,u=k.dom,b=k.dom.event,c=k.Class,a=/\s*!important/i,d=String("important"),j=1,e={},f={},g=u.createElement("DIV");
y("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(a){return"alpha(opacity:"+parseInt(a*100)+")"}});y("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);y("float","cssFloat styleFloat");var h=c(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[];this.map_={}},getRule:function(a,b){if(!this.map_[a]&&b){for(var c=this.styleSheet,d=this.rules.length,e=c.insertRule(a+"{}",d),f=d;f<=e;f++)this.rules.push(new m(c.cssRules[f]));this.map_[a]=
d!=e?new n(this.rules.splice(d)):this.rules[d]}return this.map_[a]},deleteRule:function(a){var b=this.map_[a];if(b){for(var b=b.rules||[b],c=0;c<b.length;c++){var d=this.rules.indexOf(b[c]);this.stylesheet.deleteRule(d);this.rules.splice(d,1)}delete this.map_[a]}},destroy:function(){delete this.rules}}),m=c(null,{rule:null,selector:"",init:function(a){if(a)this.rule=a,this.selector=a.selectorText},setProperty:function(b,c){var e,f=!!a.test(c),g=this.rule.style;if(f||g.getPropertyPriority&&g.getPropertyPriority(b)==
d){if(c=c.replace(a,""),e=p(b,c)){var h=e.key;g.setProperty?(f||g.removeProperty(h),g.setProperty(h,e.value,f?d:"")):g.cssText=g.cssText.replace(RegExp(g[h]?h+"\\s*:\\s*"+g[h]+"(\\s*!"+d+")?\\s*;?":"^","i"),h+": "+e.value+(f?" !"+d:"")+";")}}else s(this.rule,b,c)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),n=c(null,{rules:null,init:function(a){this.rules=a},destroy:function(){delete this.rules}});
["setProperty","setStyle","clear"].forEach(function(a){n.prototype[a]=function(){for(var b,c=0;b=this.rules[c];c++)b[a].apply(b,arguments)}});var C={};["em","ex","px","%"].forEach(function(a){C[a=="%"?"percent":a]=function(b){return b==0||isNaN(b)?"0":b+a}});var D,G={},J=c(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,b,c){c=c||"";typeof a!="undefined"&&this.remove(c+a);typeof b!=
"undefined"&&this.add(c+b)},bool:function(a,b){b?this.add(a):this.remove(a)},clear:function(){this.element.className=""},contains:function(a){return!!this.element.className.match(l(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(l(a))||(this.element.className+=" "+a)},remove:function(a){var b=this.element.className,a=b.replace(l(a),"");if(a!=b)this.element.className=a},toggle:function(a){var b=this.contains(a);b?this.remove(a):this.add(a);
return!b}}),o={},H=c(null,{delim:"-",init:function(a,b){this.classList=b;this.prefix=a+this.delim},add:function(a){this.classList.add(this.prefix+a)},remove:function(a){this.classList.remove(this.prefix+a)},items:function(){var a=this.classList.toString();if(a)return a.toString().match(r(this.prefix,true))},set:function(a){var b=this.items(),a=typeof a!="undefined"?this.prefix+a:"",c=this.classList;if(b)if(b.length==1){if(b[0]===a)return;c.remove(b[0])}else this.clear();a&&c.add(a)},clear:function(){this.items().forEach(this.classList.remove,
this.classList)}});q.DOMTokenList&&B.documentElement.classList?(c=J.prototype,Object.extend(q.DOMTokenList.prototype,{set:c.set,replace:c.replace,bool:c.bool,clear:function(){for(var a=this.length;a-- >0;)this.remove(this[a])},setPrefixToken:c.setPrefixToken}),D=function(a){return(typeof a=="string"?u.get(a):a).classList}):D=function(a){return new J(typeof a=="string"?u.get(a):a)};b.onLoad(function(){D(B.body).bool("opacity-not-support",!k.platformFeature["css-opacity"])});u.extend({setStyleProperty:s,
setStyle:x,display:i,show:function(a){return i(a,1)},hide:function(a){return i(a)},visibility:w,visible:function(a){return w(a,1)},invisible:function(a){return w(a)}});return k.namespace("basis.cssom").extend({setStyleProperty:s,setStyle:x,classList:function(a,b){return b?new H(b,D(a)):D(a)},uniqueRule:function(a){var b="genericRule-"+j++;a&&D(a).add(b);a=v("."+b);a.token=b;return a},cssRule:v,getStyleSheet:A,addStyleSheet:t,CssStyleSheetWrapper:h,CssRuleWrapper:m,CssRuleWrapperSet:n}).extend(C)})(basis,
this);
(function(){function k(b,c){var a={},d;if(b&&b.length)d=a.inserted=b;if(c&&c.length)d=a.deleted=c;if(d)return a}var q=basis.Class,v=Object.extend,z=Function.$self,t=Function.$true,A=Function.$false,y=basis.EventObject.createEvent,p=basis.data.SUBSCRIPTION,s=basis.data.DataObject,x=basis.data.KeyObjectMap,i=basis.data.AbstractDataset,w=basis.data.Dataset;p.add("SOURCE",{sourceChanged:function(b,c){this.remove(b,c);this.add(b,b.source)},sourcesChanged:function(b,c){var a;if(a=c.inserted)for(var d=a.length;d-- >
0;)this.add(b,a[d]);if(a=c.deleted)for(d=a.length;d-- >0;)this.remove(b,a[d])}},function(b,c){for(var a=c.sources||[c.source],d=0,j;j=a[d++];)b(c,j)});p.add("MINUEND",{operandsChanged:function(b,c){this.minuend!==c&&(this.remove(b,c),this.add(b,b.minuend))}},function(b,c){b(c,c.minuend)});p.add("SUBTRAHEND",{operandsChanged:function(b,c,a){this.subtrahend!==a&&(this.remove(b,a),this.add(b,b.subtrahend))}},function(b,c){b(c,c.subtrahend)});var l=q(i,{subscribeTo:p.SOURCE,event_sourcesChanged:y("sourcesChanged",
"dataset","delta"),sources:null,rule:function(b){return b>0},listen:{source:{datasetChanged:function(b,c){var a=this.memberMap_,d={},j,e;if(c.inserted)for(var f=0;j=c.inserted[f];f++)e=j.eventObjectId,a[e]?a[e].count++:a[e]={count:1,object:j},d[e]=a[e];if(c.deleted)for(f=0;j=c.deleted[f];f++)e=j.eventObjectId,d[e]=a[e],a[e].count--;this.applyRule(d)},destroy:function(b){this.removeSource(b)}}},init:function(b){i.prototype.init.call(this,b);b=this.sources;this.sources=[];b&&b.forEach(this.addSource,
this)},setRule:function(b){if(typeof b!="function")b=l.UNION;if(this.rule!==b)this.rule=b,this.applyRule()},applyRule:function(b){var c=this.memberMap_,a=this.rule,d=this.sources.length,j=[],e=[],f,g,h;b||(b=c);for(var i in b)f=c[i],g=d&&f.count&&a(f.count,d),g!=!!this.item_[i]&&(g?j:e).push(f.object),f.count==0&&delete c[i];(h=k(j,e))&&this.event_datasetChanged(this,h)},addSource:function(b){if(b instanceof i&&this.sources.add(b)){b.addHandler(this.listen.source,this);var c=this.memberMap_,a;for(a in b.item_)c[a]?
c[a].count++:c[a]={count:1,object:b.item_[a]};this.applyRule();this.event_sourcesChanged(this,{inserted:[b]});return true}},removeSource:function(b){if(this.sources.remove(b)){b.removeHandler(this.listen.source,this);var c=this.memberMap_,a;for(a in b.item_)c[a].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[b]});return true}},setSources:function(b){for(var c=Array.from(this.sources),a=0,d;d=b[a];a++)d instanceof i&&(c.remove(d)||this.addSource(d));c.forEach(this.removeSource,this)},
clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){i.prototype.destroy.call(this);this.sources=null}});l.UNION=l.prototype.rule;l.INTERSECTION=function(b,c){return b==c};l.DIFFERENCE=function(b){return b==1};l.MORE_THAN_ONE_INCLUDE=function(b,c){return c==1||b>1};l.AT_LEAST_ONE_EXCLUDE=function(b,c){return c==1||b<c};var r=function(b){return!this.has(b)},B=q(i,{subscribeTo:p.MINUEND+p.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:y("operandsChanged",
"dataset","oldMinuend","oldSubtrahend"),listen:{minuend:{datasetChanged:function(b,c){if(this.subtrahend){var a=k(c.inserted&&c.inserted.filter(r,this.subtrahend),c.deleted&&c.deleted.filter(this.has,this));a&&this.event_datasetChanged(this,a)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(b,c){if(this.minuend){var a=k(c.deleted&&c.deleted.filter(r,this),c.inserted&&c.inserted.filter(this.has,this));a&&this.event_datasetChanged(this,a)}},destroy:function(){this.setOperands(this.minuend,
null)}}},init:function(b){i.prototype.init.call(this,b);var b=this.minuend,c=this.subtrahend;this.subtrahend=this.minuend=null;(b||c)&&this.setOperands(b,c)},setOperands:function(b,c){var a,d=false;b instanceof i==false&&(b=null);c instanceof i==false&&(c=null);var j=this.minuend,e=this.subtrahend;if(j!==b)d=true,j&&j.removeHandler(this.listen.minuend,this),(this.minuend=b)&&b.addHandler(this.listen.minuend,this);if(e!==c)d=true,e&&e.removeHandler(this.listen.subtrahend,this),(this.subtrahend=c)&&
c.addHandler(this.listen.subtrahend,this);if(!d)return false;this.event_operandsChanged(this,j,e);if(!b||!c)this.itemCount&&this.event_datasetChanged(this,a={deleted:this.getItems()});else{var d=[],j=[],f;for(f in this.item_)(!b.item_[f]||c.item_[f])&&d.push(this.item_[f]);for(f in b.item_)!this.item_[f]&&!c.item_[f]&&j.push(b.item_[f]);(a=k(j,d))&&this.event_datasetChanged(this,a)}return a},clear:function(){this.setOperands()}}),u=q(i,{subscribeTo:p.SOURCE,source:null,event_sourceChanged:y("sourceChanged",
"dataset","oldSource"),map:z,reduce:A,rule:A,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:{update:function(b){var c=this.map?this.map(b):b;if(c instanceof s==false||this.reduce(c))c=null;var a=this.sourceMap_[b.eventObjectId],d=a.member;if(d!=c){var j=this.memberMap_,e,f,g;a.member=c;if(d)a=d.eventObjectId,this.removeMemberRef&&this.removeMemberRef(d,b),--j[a]==0&&(delete j[a],g=[d]);if(c)d=c.eventObjectId,this.addMemberRef&&this.addMemberRef(c,b),j[d]?j[d]++:(j[d]=
1,f=[c]);(e=k(f,g))&&this.event_datasetChanged(this,e)}}},source:{datasetChanged:function(b,c){var a=this.sourceMap_,d=this.memberMap_,j=[],e=[],f,g,h;w.setAccumulateState(true);if(c.inserted)for(var i=0;f=c.inserted[i];i++){h=this.map?this.map(f):f;if(h instanceof s==false||this.reduce(h))h=null;f.addHandler(this.listen.sourceObject,this);a[f.eventObjectId]={sourceObject:f,member:h};if(h)g=h.eventObjectId,d[g]?d[g]++:(d[g]=1,j.push(h)),this.addMemberRef&&this.addMemberRef(h,f)}if(c.deleted)for(i=
0;f=c.deleted[i];i++)if(g=f.eventObjectId,h=a[g].member,f.removeHandler(this.listen.sourceObject,this),delete a[g],h)g=h.eventObjectId,--d[g]==0&&(delete d[g],e.push(h)),this.removeMemberRef&&this.removeMemberRef(h,f);w.setAccumulateState(false);(c=k(j,e))&&this.event_datasetChanged(this,c)},destroy:function(){this.setSource()}}},init:function(b){i.prototype.init.call(this,b);this.sourceMap_={};if(b=this.source)this.source=null,this.setSource(b)},setRule:function(b){typeof b!="function"&&(b=t);if(this.rule!==
b)return this.rule=b,this.applyRule()},setMap:function(b){typeof b!="function"&&(b=z);if(this.map!==b)return this.map=b,this.applyRule()},setSource:function(b){b instanceof i==false&&(b=null);if(this.source!==b){var c=this.source;c&&(c.removeHandler(this.listen.source,this),this.listen.source.datasetChanged.call(this,c,{deleted:c.getItems()}));if(this.source=b)b.addHandler(this.listen.source,this),this.listen.source.datasetChanged.call(this,b,{inserted:b.getItems()});this.event_sourceChanged(this,
c)}},applyRule:function(){var b=this.sourceMap_,c=this.memberMap_,a,d,i,e,f,g=[],h=[],l,n;for(n in b){f=b[n];e=f.sourceObject;a=f.member;d=this.map?this.map(e):e;if(d instanceof s==false||this.reduce(d))d=null;if(a!=d){f.member=d;if(a)i=a.eventObjectId,this.removeMemberRef&&this.removeMemberRef(a,e),c[i]--;if(d)a=d.eventObjectId,this.addMemberRef&&this.addMemberRef(d,e),a in c?c[a]++:(c[a]=1,g.push(d))}}for(i in this.item_)c[i]==0&&(delete c[i],h.push(this.item_[i]));(l=k(g,h))&&this.event_datasetChanged(this,
l);return l},clear:function(){this.setSource()},destroy:function(){i.prototype.destroy.call(this);this.sourceMap_=null}}),A=q(u,{reduce:function(b){return!this.rule(b)},rule:t}),q=q(u,{map:function(b){return this.keyMap.resolve(b)},rule:t,subsetClass:i,keyMap:null,addMemberRef:function(b,c){b.event_datasetChanged(b,{inserted:[c]})},removeMemberRef:function(b,c){b.event_datasetChanged(b,{deleted:[c]})},init:function(b){if(!this.keyMap||this.keyMap instanceof x==false)this.keyMap=new x(v({keyGetter:this.rule,
itemClass:this.subsetClass},this.keyMap));u.prototype.init.call(this,b)},getSubset:function(b,c){return this.keyMap.get(b,c)},destroy:function(){u.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});basis.namespace("basis.data.dataset").extend({Merge:l,Subtract:B,MapReduce:u,Subset:A,Split:q})})(basis,this);
(function(k){function q(a){g[a]=g[a]||0;return a+g[a]++}function v(){var a=Array.from(arguments),b=a.pop();typeof b!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=
true;return b}function z(){return v.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;b-- >0;){if(arguments[b]==null)return null;a.push(arguments[b])}return a.join("-")}))}var t=k.Class,A=k.Cleaner,y=Object.extend,p=Function.$self,s=Function.getter,x=k.data,i=k.EventObject,w=x.Dataset,l=x.dataset.Subset,r=x.dataset.Split,B=x.DataObject,u=x.STATE,b={},c={string:1,number:1},a=[],d=function(a){return isNaN(a)?null:Number(a)},j=function(a){return isNaN(a)?null:Number(a)},
e=function(a){return isNaN(a)?null:parseInt(a)},f=function(a){return a==null?null:String(a)},g={},h=k.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+c;return e};A.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=
b,true},remove:function(a,b){if(this.index[a]===b)return delete this.index[a],true},destroy:function(){this.index=null}}),x=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},m=function(a,b){return function(c){if(!this.name)this.name=q(b);a.prototype.init.call(this,c)}},n=function(a){return function(b,c){w.setAccumulateState(true);b=(b||[]).map(this.wrapper);w.setAccumulateState(false);return a.prototype.sync.call(this,b,c)}},C=t(w,{wrapper:Function.$self,init:m(w,
"EntitySet"),sync:n(w),set:x(w,"set"),add:x(w,"add"),remove:x(w,"remove"),destroy:function(){w.prototype.destroy.call(this);delete this.wrapper}}),D=t(C,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),G=t(l,{init:m(l,"EntityCollection"),sync:n(l)});G.sourceHandler=l.sourceHandler;var J=t(r,{subsetClass:D,init:m(r,"EntityGrouping"),sync:n(r),getSubset:function(a,b){var c=r.prototype.getSubset.call(this,a,b);if(c)c.wrapper=this.wrapper;return c}}),o=function(a){if(this instanceof
o){var b=new H(a||p);return function(a,c){return a!=null?(c instanceof C||(c=b.createEntitySet()),c.set(a instanceof w?a.getItems():Array.from(a)),c):null}}};o.className="basis.entity.EntitySetWrapper";var H=t(null,{init:function(a){this.wrapper=a},createEntitySet:function(){return new C({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),E=function(a){if(this instanceof E){var b=function(a,b){if(a!=null){if(a===b||a.entityType===d)return a;var h,
i=d.idField;if(c[typeof a]){if(!i)return;h=a;a={};a[i]=h}else if(d.compositeKey)h=d.compositeKey(a,a);else if(i)h=a[i];else if(g&&(b=d.singleton,!b))return d.singleton=new f(a);h!=null&&e&&(b=e.get(h,d.entityClass));b&&b.entityType===d?b.update(a):b=new f(a);return b}else return d.singleton},d=new O(a||{},b),e=d.index__,f=d.entityClass,g=d.isSingleton;y(b,{toString:function(){return this.typeName+"()"},entityType:d,type:b,typeName:d.name,index:e,reader:function(a){return d.reader(a)},get:function(a){return d.get(a)},
addField:function(a,b){d.addField(a,b)},all:d.all,createCollection:function(a,c,e){var f=d.collection_[a];return!f&&c?d.collection_[a]=new G({wrapper:b,source:e||d.all,rule:c}):f},getCollection:function(a){return d.collection_[a]},createGrouping:function(a,c,e){var f=d.grouping_[a];return!f&&c?d.grouping_[a]=new J({wrapper:b,source:e||d.all,rule:c}):f},getGrouping:function(a){return d.grouping_[a]},getSlot:function(a,b){return d.getSlot(a,b)}});return b}};E.className="basis.entity.EntityTypeWrapper";
var K=s("singleton"),L={};t(B,{});var O=t(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(b,c){this.name=b.name||q(this.name);this.index__=b.index;this.idFields={};a.push(this);this.isSingleton=b.isSingleton;this.wrapper=c;this.all=new D(Object.extend(b.all||{},{wrapper:c}));this.slot_={};if(b.extensible)this.extensible=true;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(b.fields,this.addField,this);b.constrains&&
b.constrains.forEach(function(a){this.addCalcField(null,a)},this);if(this.isSingleton)this.get=K;b.aliases&&Object.iterate(b.aliases,this.addAlias,this);this.collection_={};if(b.collections)for(var d in b.collections)this.collection_[d]=new G({name:d,wrapper:c,source:this.all,rule:b.collections[d]||Function.$true});this.grouping_={};if(b.groupings)for(d in b.groupings)this.grouping_[d]=new J({name:d,wrapper:c,source:this.all,rule:b.groupings[d]||Function.$true});this.entityClass=N(this,this.all,this.index__,
this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:c,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(c[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||a==null)return null;for(var d in a){var e=d in this.aliases?this.aliases[d]:"";e&&e in this.fields&&(b[e]=this.fields[e].reader?this.fields[e].reader(a[d]):a[d])}return b},addAlias:function(a,b){b in this.fields&&a in this.aliases==false&&(this.aliases[a]=b)},addField:function(a,
b){if(!this.all.itemCount){this.aliases[a]=a;typeof b=="function"&&(b={type:b});if("type"in b&&typeof b.type!="function")b.type=p;var c=b.type||p;if([d,j,e,f].has(c))b.id=true;if(b.id){if(!this.index__)this.index__=new h(String);this.idFields[a]=true;this.idField||this.compositeKey?(this.idField=null,this.compositeKey=z.apply(null,Object.keys(this.idFields))):this.idField=a}b.calc?this.addCalcField(a,b.calc,void 0):this.fields[a]=c;this.defaults[a]="defValue"in b?b.defValue:c();this.getters["get_"+
a]=function(){return this.data[a]};L[a]||(L[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){if(!this.calcs)this.calcs=[];for(var d={args:b.args,wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=g;break}if(f>e)return;if(this.idField&&a==this.idField)this.compositeKey=b;this.fields[a]=
function(a,b){typeof console!="undefined"&&console.log("Calculate fields are readonly");return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(a!=null)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&a!=null){if(c[typeof a])return a;if(a&&a.entityType===this)return a.__id__;if(a instanceof B)a=a.data;return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);if(b!=
null){var d=this.slot_[b];d||(c[typeof a]&&(d={},this.idField&&!this.compositeKey&&(d[this.idField]=a),a=d),d=this.slot_[b]=new B({delegate:this.get(b),data:a}));return d}}}),M=t(B,{init:i.prototype.init,event_rollbackUpdate:i.createEvent("rollbackUpdate")}),N=function(a,c,d,e,f,g,h){function j(b,c,d){var e=false,f=a.calcs,g=b.__id__,h=b.data;try{if(f)for(var i=0,m;m=f[i++];){var n=m.key;if(n){var o=h[n];h[n]=m.wrapper(c,h,h[n]);h[n]!==o&&(c[n]=o,e=true)}else m.wrapper(c,h)}if(a.compositeKey)b.__id__=
a.compositeKey(c,h,b.__id__);else if(l&&l in c)b.__id__=h[l];b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(q){b.__id__=g;for(var p in c)b.data[p]=c[p];if(d)for(p in d)if(!b.modified)b.modified=d;e=false}b.__id__!==g&&k(b,g,b.__id__);return e}function k(a,b,c){b!=null&&(d.remove(b,a),e[b]&&e[b].setDelegate());c!=null&&(d.add(c,a),e[c]&&e[c].setDelegate(a))}var l=a.idField;return t(M,h,{canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(a){M.prototype.init.call(this);
this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var b,d={},e;for(e in f)e in a?(d[e]=g[e],b=f[e](a[e])):b=g[e],b&&b!==this&&b instanceof i&&b.addHandler(L[e],this)&&(this.fieldHandlers_[e]=true),this.data[e]=b;j(this,d);c.event_datasetChanged(c,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,e){var g=f[b];if(!g){if(!a.extensible)return;g=p}var h,k=this.modified,
c=g(c,this.data[b]),g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{h={};if(b!=l)if(d){if(!k)this.modified=k={};if(b in k===false)h.rollback={key:b,value:void 0},k[b]=g;else if(k[b]===c&&(h.rollback={key:b,value:c},delete k[b],!Object.keys(k).length))this.modified=null}else if(k&&b in k)if(k[b]!==c){h.rollback={key:b,value:k[b]};k[b]=c;break a}else return false;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(L[b],this),this.fieldHandlers_[b]=false);
c&&c!==this&&c instanceof i&&c.addHandler(L[b],this)&&(this.fieldHandlers_[b]=true);h.key=b;h.value=g;h.delta={};h.delta[b]=g}else if(!d&&k&&b in k&&(h={rollback:{key:b,value:k[b]}},delete k[b],!Object.keys(k).length))this.modified=null;if(!e&&h){var d=h.key,b=h.delta||{},m;if(h.rollback)m={},m[h.rollback.key]=h.rollback.value;j(this,b,m)&&(d=true);if(d)this.event_update(this,b),h.delta=b;m&&this.event_rollbackUpdate(this,m)}return h||false},update:function(a,b){if(a){var c,d={},e,f={},g,h;for(h in a)if(g=
this.set(h,a[h],b,true)){if(g.key)c=true,d[g.key]=g.value;if(g.rollback)e=true,f[g.rollback.key]=g.rollback.value}j(this,d,f)&&(c=true);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:false},reset:function(){this.update(g)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=u.PROCESSING){if(this.modified){var a=
this.modified;this.modified=null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(u.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.data[a].removeHandler(L[a],this);this.fieldHandlers_=b;this.__id__&&k(this,this.__id__,null);B.prototype.destroy.call(this);c.event_datasetChanged(c,{deleted:[this]});this.data=b;this.modified=null}})};k.namespace("basis.entity").extend({isEntity:function(a){return a&&a instanceof N},NumericId:d,NumberId:j,IntId:e,StringId:f,Index:h,CalculateField:v,
EntityType:E,Entity:N,BaseEntity:M,EntitySetType:o,EntitySet:C,ReadOnlyEntitySet:D,Collection:G,Grouping:J})})(basis);
