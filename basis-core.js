/*

 GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>

 GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>

 GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>

 GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>

 @author
 Vladimir Ratsev
 Roman Dvornov
*/
(function(){var T=document.getElementsByTagName("script"),i=T[T.length-1].src.replace(/[^/]+.js$/,"");!function(k){function G(g,a){for(var c in a)g[c]=a[c];return g}function i(g,a){for(var c in a)!1==c in g&&(g[c]=a[c]);return g}function x(g){return null==g||void 0==g}function n(g){return g}function z(g,a){for(var c=g.split("."),B=k,b,d,m;c.length;)if(b=c.shift(),d=(d?d+".":"")+b,B[b]||(B[b]=function(g,a){var c={},m="function"==typeof a?a:null,r=function(){if(m)return m.apply(this,arguments)};r.path=
g;r.names=function(g){return Object.slice(c,"string"==typeof g?g.qw():g)};r.extend=function(g){i(c,g);G(this,g);return this};r.setWrapper=function(a){"function"==typeof a&&(m&&"undefined"!=typeof console&&console.warn("Wrapper for "+g+" is already set. Probably mistake here."),m=a)};return r}(d,!c.length?a:null),m&&(m.namespaces_[d]=B[b])),B=B[b],!m)m=B,m.namespaces_||(m.namespaces_={});return J[g]=B}function v(g){return g.replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/i,"")}var p=k.document;G(Object,{extend:G,
complete:i,keys:function(g){var a=[],c;for(c in g)a.push(c);return a},values:function(g){var a=[],c;for(c in g)a.push(g[c]);return a},slice:function(g,a){var c={};if(!a)return G(c,g);for(var b=0,d;d=a[b++];)d in g&&(c[d]=g[d]);return c},splice:function(g,a){var c={};if(!a)return G(c,g);for(var b=0,d;d=a[b++];)d in g&&(c[d]=g[d],delete g[d]);return c},iterate:function(g,a,c){var b=[],d;for(d in g)b.push(a.call(c,d,g[d]));return b},coalesce:function(){for(var g=arguments,a=0;a<g.length;a++)if(null!=
g[a])return g[a]}});var j=function(){},h=function(){var g=1,a=[],c={},b={};return function(d,e){var m,u,f;if(!d||d===w)return w;"function"==typeof d?(f=d.basisGetterId_)?m=a[Math.abs(f)-1]:(m=function(g){return d(g)},m.base=d,m.__extend__=h,f=a.push(m),d.basisGetterId_=-f,m.basisGetterId_=f):(m=c[d])?f=m.basisGetterId_:(m=new Function("object","return object != null ? object."+d+" : object"),m.base=d,m.__extend__=h,f=a.push(m),m.basisGetterId_=f,c[d]=m);var t=null!=e&&typeof e;if(!t)return m;var O=
b[f],r;if("string"==t)r=t+e;else if("function"==t)r=e.basisModId_;else if("object"!=t)return m;if(r&&O&&O[r])return O[r];"function"==typeof m.base&&(m=m.base);switch(t){case "string":u=function(g){return e.format(m(g))};break;case "function":r||(r=t+g++,e.basisModId_=r);u=function(g){return e(m(g))};break;case "object":u=function(g){return e[m(g)]}}u.base=m.base||m;u.__extend__=h;r&&(O||(O={},b[f]=O),O[r]=u,u.mod=e,u.basisGetterId_=a.push(u));return u}}(),w=Function();w.__extend__=h;G(Function,{$undefined:function(g){return void 0==
g},$defined:function(g){return void 0!=g},$isNull:x,$isNotNull:function(g){return null!=g&&void 0!=g},$isSame:function(g){return g===this},$isNotSame:function(g){return g!==this},$self:n,$const:function(g){return function(){return g}},$false:function(){return!1},$true:function(){return!0},$null:function(){return null},$undef:j,getter:h,nullGetter:w,def:function(g,a,c){c=c||x;return function(b){b=g(b);return c(b)?a:b}},wrapper:function(g){return function(a){var c={};c[g]=a;return c}},lazyInit:function(g,
a){var c=0,b,d;return b=function(){c++||(b.inited=!0,b.data=d=g.apply(a||this,arguments));return d}},lazyInitAndRun:function(g,a,c){var b=0,d,e;return d=function(){b++||(d.inited=!0,d.data=e=g.call(c||this));a.apply(e,arguments);return e}},runOnce:function(g,a){var c=0;return function(){if(!c++)return g.apply(a||this,arguments)}}});i(Function.prototype,{bind:function(g){var a=this,c=Array.from(arguments,1);return c.length?function(){return a.apply(g,c.concat.apply(c,arguments))}:function(){return a.apply(g,
arguments)}},body:function(){return this.toString().replace(/^\s*\(?\s*function[^(]*\([^\)]*\)[^{]*\{|\}\s*\)?\s*$/g,"")}});i(Array,{isArray:function(g){return"[object Array]"===Object.prototype.toString.call(g)}});G(Array,{from:function(g,a){if(null!=g){var c=g.length;if("undefined"==typeof c)return[g];a||(a=0);if(0<c-a){for(var b=[],d=0,e=a;e<c;)b[d++]=g[e++];return b}}return[]},create:function(g,a,c){for(var b=[],d="function"==typeof a,e=0;e<g;e++)b[e]=d?a.call(c,e,b):a;return b}});i(Array.prototype,
{indexOf:function(g,a){a=parseInt(a)||0;if(0>a)return-1;for(;a<this.length;a++)if(this[a]===g)return a;return-1},lastIndexOf:function(a,c){for(var b=this.length,c=parseInt(c),c=isNaN(c)||c>=b?b-1:(c+b)%b;0<=c;c--)if(this[c]===a)return c;return-1},forEach:function(a,c){for(var b=0,d=this.length;b<d;b++)b in this&&a.call(c,this[b],b,this)},every:function(a,c){for(var b=0,d=this.length;b<d;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0},some:function(a,c){for(var b=0,d=this.length;b<d;b++)if(b in
this&&a.call(c,this[b],b,this))return!0;return!1},filter:function(a,c){for(var b=[],d=0,e=this.length;d<e;d++)d in this&&a.call(c,this[d],d,this)&&b.push(this[d]);return b},map:function(a,c){for(var b=[],d=0,e=this.length;d<e;d++)d in this&&(b[d]=a.call(c,this[d],d,this));return b},reduce:function(a,c){var b=this.length,d=arguments.length;if(0==b&&1==d)throw new TypeError;var e,f=0;1<d&&(e=c,f=1);for(d=0;d<b;d++)d in this&&(e=f++?a.call(null,e,this[d],d,this):this[d]);return e}});G(Array.prototype,
{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[0<=a?a:this.length+a]},search:function(a,c,b){Array.lastSearchIndex=-1;for(var c=Function.getter(c||n),b=parseInt(b)||0,d=this.length;b<d;b++)if(c(this[b])===a)return this[Array.lastSearchIndex=b]},lastSearch:function(a,c,b){Array.lastSearchIndex=-1;for(var c=Function.getter(c||n),d=this.length,b=isNaN(b)||null==b?d:parseInt(b),
d=b>d?d:b;0<d--;)if(c(this[d])===a)return this[Array.lastSearchIndex=d]},binarySearchPos:function(a,c,b,d,e,f){if(!this.length)return d?-1:0;var c=Function.getter(c||n),b=!!b,m,e=isNaN(e)?0:e,u=isNaN(f)?this.length-1:f;do if(f=e+u>>1,m=c(this[f]),b?a>m:a<m)u=f-1;else if(b?a<m:a>m)e=f+1;else return a==m?f:d?-1:0;while(e<=u);return d?-1:f+(m<a^b)},binarySearch:function(a,c){return this.binarySearchPos(a,c,!1,!0)},add:function(a){return-1==this.indexOf(a)&&!!this.push(a)},remove:function(a){a=this.indexOf(a);
return-1!=a&&!!this.splice(a,1)},has:function(a){return-1!=this.indexOf(a)},merge:function(a){return this.reduce(G,a||{})},sortAsObject:function(a,c,b){a=Function.getter(a);b=b?-1:1;return this.map(function(c,b){return{i:b,v:a(c)}}).sort(c||function(a,g){return b*(a.v>g.v||-(a.v<g.v)||(a.i>g.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){this!==a&&(this.length=0,this.push.apply(this,a));return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var l=
Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);2>a.length&&(a[1]=this.length);return l.apply(this,a)}}var q={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"},H=/([\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$])/g,o=/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,y={};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};i(String,{toLowerCase:function(a){return(""+
a).toLowerCase()},toUpperCase:function(a){return(""+a).toUpperCase()},trim:function(a){return(""+a).trim()},trimLeft:function(a){return(""+a).trimLeft()},trimRight:function(a){return(""+a).trimRight()},isEmpty:function(a){return null==a||""==""+a},isNotEmpty:function(a){return null!=a&&""!=""+a}});i(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});G(String.prototype,{toObject:function(a){try{return Function("return 0,"+
this)()}catch(c){if(a)throw c;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],c=this.length,b=0;b<c;b++)a[b]=this.charAt(b);return a},repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(H,"\\$1")},format:function(a){for(var c={},b=0;b<arguments.length;b++)c[b]=arguments[b];"object"==typeof a&&G(c,a);return this.replace(o,function(a,g,b,d,e){a=g in
c?c[g]:e?"":a;return b&&!isNaN(a)?(a=Number(a),"."==b?a.toFixed(d):a.lead(d)):a})},quote:function(a,c){var a=a||'"',c=c||q[a]||a,b=(1==a.length?a:"")+(1==c.length?c:"");return a+(b?this.replace(y[b]||(y[b]=RegExp("["+b.forRegExp()+"]","g"),"\\$&")):this)+c},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,c){return c.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+
a.toLowerCase()})}});String.format=String.prototype.format;11!="|||".split(/\|/).length+"|||".split(/(\|)/).length&&(String.prototype.split=function(a){if(""==a||a&&""==a.source)return this.toArray();var c=[],b=0,d;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));d=a.exec(this);)d[0]=this.substring(b,d.index),c.push.apply(c,d),b=a.lastIndex;else for(;-1!=(d=this.indexOf(a,b));)c.push(this.substring(b,d)),b=d+a.length;c.push(this.substr(b));return c});if("2"!="12".substr(-1)){var A=
String.prototype.substr;String.prototype.substr=function(a,c){return A.call(this,a<0?Math.max(0,this.length+a):a,c)}}G(Number.prototype,{fit:function(a,c){return!isNaN(a)&&this<a?Number(a):!isNaN(c)&&this>c?Number(c):this},between:function(a,c){return!isNaN(this)&&this>=a&&this<=c},quote:function(a,c){return(this+"").quote(a,c)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},
lead:function(a,c){return(this+"").replace(/\d+/,function(b){return(a=a-(b.length-1))>1?Array(a).join(c||0)+b:b})},group:function(a,c){return(this+"").replace(/\d+/,function(b){return b.replace(/\d/g,function(d,e){return!e+(b.length-e)%(a||3)?d:(c||" ")+d})})},format:function(a,c,b,d,e){a=this.toFixed(a);if(c||e)a=a.replace(/(\d+)(\.?)/,function(a,b,g){return(c?Number(b).group(3,c):b)+(g?e||g:"")});b&&(a=a.replace(/^-?/,"$&"+(b||"")));return a+(d||"")}});i(Date,{now:function(){return+new Date}});
1900>(new Date).getYear()&&G(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&a<100?Number(a)+1900:a)}});var J={};Function();var M=function(){var a=Array.from(k.document?p.getElementsByTagName("SCRIPT"):null),b={basis:v(a&&a.length?a.item(-1).src:module.filename)},d={},e;if(typeof require=="function"){var f=module.filename.replace(/[^\/\\]+$/,"");e=function(a){return function(){var c=module.constructor.prototype.load;module.constructor.prototype.load=
function(b){this.exports=z(a);c.apply(this,arguments)};var b=require(f+a.replace(/\./g,"/"));module.constructor.prototype.load=c;return b}()}}else{e=function(a,g){if(/[^a-z0-9\_\.]/i.test(a))throw"Namespace `"+a+"` contains wrong chars.";var f=a.replace(/\./g,"/")+".js",E=a.split(".")[0];E==a&&(b[E]=g||v(location?location.href:""));E=b[E];if(!J[a]){if(!/^https?:/.test(E))throw"Path `"+a+"` ("+E+") can't be resolved";if(d[a])throw"Recursive require for "+a;d[a]=true;c(basis.namespace(a),E+f)();e.sequence.push(f)}};
e.sequence=[]}return e}(),f={},e=function(a){if(a in f==false){var c="",b=new XMLHttpRequest;b.open("GET",a,false);b.setRequestHeader("If-Modified-Since",(new Date(0)).toGMTString());b.send("");b.status>=200&&b.status<400?c=b.responseText:typeof console!="undefined"&&console.warn("basis.resource: Unable to load "+a);f[a]=c}return f[a]},t=function(){if(typeof require=="function"){var a=require("path");return function(c){return a.resolve(__dirname,c)}}var c=p.createElement("A");return function(a){c.href=
a;return c.href}}(),b={},a=function(a){a=t(a);if(!b[a]){var c=[],d=function(){return e(a)};d.url=a;d.toString=d;d.update=function(b){b=""+b;if(b!=f[a]){f[a]=b;for(var d=0,e;e=c[d];d++)e.handler.call(e.context,b)}};d.reload=function(){var c=f[a];delete f[a];var b=e(a);if(b!=c){delete f[a];this.update(b)}};d.bindingBridge={attach:function(a,b,d){for(var a=0,g;g=c[a];a++)if(g.handler==b&&g.context==d)return false;c.push({handler:b,context:d});return true},detach:function(a,b){for(var d=0,g;g=c[d];d++)if(g.handler==
a&&g.context==b){c.splice(d,1);return true}return false},get:function(){return e(a)}};b[a]=d}return b[a]},c=function(c,b){var d=v(b);return function(){var f=e(b);if(typeof c.exports!="object")c.exports={};try{Function("exports, module, basis, global, __filename, __dirname, resource",f+"//@ sourceURL="+b).call(c,c.exports,c,basis,k,b,d,function(c){return a(d+c)})}catch(t){throw t;}return c}};(function(){function a(c){return typeof c=="function"&&!!c.basisClassId_}function c(a){for(var b=this;b&&b!==
a;)b=b.superClass_;return b===a}var b=Function(),d=1,e=1,f=Function(),m={},u=function(){for(var a in{toString:1})return;return true}();G(b,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:f,postInit:f,toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=j}},create:function(f){typeof f!="function"&&(f=b);var r=Function();r.prototype=f.prototype;for(var r=new r,I=e++,I={className:f.className+
"._Class"+I,basisClassId_:I,superClass_:f,extendConstructor_:!!f.extendConstructor_,isSubclassOf:c,subclass:function(){return b.create.apply(null,[F].concat(Array.from(arguments)))},extend:b.extend,__extend__:function(c){return c&&c!==m&&(typeof c=="object"||typeof c=="function"&&!a(c))?b.create.call(null,F,c):c},prototype:r},D=1,P;P=arguments[D];D++)I.extend(typeof P=="function"&&!a(P)?P(f.prototype):P);var K={},F=I.extendConstructor_?function(a,c){this.eventObjectId=d++;var b,D;for(D in a){b=this[D];
this[D]=b&&b.__extend__?b.__extend__(a[D]):a[D]}this.init(c||K);this.postInit()}:function(){this.eventObjectId=d++;this.init.apply(this,arguments);this.postInit()};r.constructor=F;for(var u in r)r[u]===m&&(r[u]=F);G(F,I);return F},extend:function(a){var c=this.prototype;if(a.prototype)a=a.prototype;for(var b in a){var D=a[b],d=c[b];b=="className"||b=="extendConstructor_"?this[b]=D:c[b]=d&&d.__extend__?d.__extend__(D):D}if(u&&a[b="toString"]!==Object.prototype[b])c[b]=a[b];return this}});var t=function(a,
c){return{__extend__:function(a){if(!a||a&&a.__extend__)return a;var b=Function();b.prototype=this;b=new b;c(b,a);return b}}.__extend__(a||{})},h=function(a){return t(a,G)};return z("basis.Class",b.create).extend({SELF:m,BaseClass:b,create:b.create,isClass:a,customExtendProperty:t,extensibleProperty:h,nestedExtendProperty:function(a){return t(a,function(a,c){for(var b in c){var d=a[b];a[b]=d&&d.__extend__?d.__extend__(c[b]):h(c[b])}})},oneFunctionProperty:function(a,c){var b=function(c){var r;if(c){if(c.__extend__)return c;
r={__extend__:b};for(var d in c)c[d]&&(r[d]=a)}return r};return b(c||{})}})})();var d=function(){var a=[];return{add:function(c){c!=null&&a.push(c)},remove:function(c){a.remove(c)}}}();z("basis").extend({namespace:z,require:M,resource:a,wrapScript:c,platformFeature:{},Cleaner:d});k.basis.locale={}}(this);(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){var k=global.document,i=basis.Cleaner,C=Function.getter;(function(){global.msSetImmediate&&global.msClearImmediate&&
(global.setImmediate=global.msSetImmediate,global.clearImmediate=global.msClearImmediate);if(!global.setImmediate){var i="setImmediate.basis",n=function(j){global.nativeSetTimeout_(function(){G(j)},0)},G=function(){var j={},h=1;global.setImmediate=function(){j[++h]={fn:arguments[0],args:Array.from(arguments,1)};n(h);return h};global.clearImmediate=function(h){delete j[h]};return function(h){var k=j[h];if(k)try{typeof k.fn=="function"?k.fn.apply(void 0,k.args):(global.execScript||function(h){global.eval.call(global,
h)})(""+k.fn)}finally{delete j[h]}}}();if(global.MessageChannel)n=function(j){var h=new global.MessageChannel;h.port1.onmessage=function(){G(j)};h.port2.postMessage("")};else{var v=global.postMessage&&!global.importScripts;if(v){var p=global.onmessage;global.onmessage=function(){v=false};global.postMessage("","*");global.onmessage=p}v?(p=function(j){if(j&&j.source==global)(j=(""+j.data).split(i)[1])&&G(j)},global.addEventListener?global.addEventListener("message",p,!0):global.attachEvent("onmessage",
p),n=function(j){postMessage(i+j,"*")}):k&&"onreadystatechange"in k.createElement("script")&&(n=function(j){var h=k.createElement("script");h.onreadystatechange=function(){G(j);h.onreadystatechange=null;h.parentNode.removeChild(h);h=null};k.documentElement.appendChild(h)})}}global.nativeSetTimeout_=global.setTimeout;global.nativeClearTimeout_=global.clearTimeout;global.setTimeout=function(j,h){return isNaN(h)||h<=0?i+global.setImmediate(j):global.nativeSetTimeout_(j,h)};global.clearTimeout=function(j){var h=
(""+j).split(i)[1];return h?global.clearImmediate(h):global.nativeClearTimeout_(j)}})();this.extend({TimeEventManager:function(){function k(){if(!q)if(j.length){var h=Date.now(),o=Math.max(j[0].eventTime,h);o<w&&(clearTimeout(l),l=setTimeout(z,(w=o)-h))}else l=clearTimeout(l),w=v}function n(q,o){var p=q.eventObjectId,l=h[o]&&h[o][p];l&&(j.remove(l),delete h[o][p],k())}function z(){var l=Date.now(),l=j.binarySearchPos(l+15,p);q=!0;j.splice(0,l).forEach(function(k){delete h[k.eventName][k.object.eventObjectId];
k.callback.call(k.object)});q=!1;w=v;k()}var v=2E12,p=C("eventTime"),j=[],h={},w=v,l=null,q=!1;i.add({destroy:function(){q=!0;clearTimeout(l);j.length=0;h=null}});return{add:function(q,o,l){var i=q.eventObjectId,w=h[o];w||(w=h[o]={});var v=w[i];if(v){if(isNaN(l))return n(q,o);if(v.eventTime==l)return;j.remove(v);v.eventTime=l}else{if(isNaN(l))return;v=w[i]={eventName:o,object:q,eventTime:l,callback:q[o]}}j.splice(j.binarySearchPos(l,p),0,v);k()},remove:n}}()})}.body()+"//@ sourceURL="+i+"src/basis/timer.js")).call(basis.namespace("basis.timer"),
basis.namespace("basis.timer"),basis.namespace("basis.timer").exports,this,i+"src/basis/timer.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function k(k){var p=n[k];p||(p=n[k]=function(){var j=this.handlers_,h,i;p.listen&&(i=this.listen[p.listenName])&&p.listen.call(this,i,arguments);if(j&&j.length)for(var j=x.call(j),l=j.length;0<l--;)h=j[l],(i=h.handler[k])&&"function"==typeof i&&
i.apply(h.thisObject,arguments),(i=h.handler["*"])&&"function"==typeof i&&i.call(h.thisObject,{sender:this,type:k,args:arguments})},z[k]&&C(p,z[k]));return p}var i=basis.Class,C=Object.extend,x=Array.prototype.slice,n={},z={},i=i(null,{className:this.name+".EventObject",handlers_:null,event_destroy:k("destroy","object"),listen:i.nestedExtendProperty(),extendConstructor_:!0,init:function(){this.handler&&(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||
this})},addHandler:function(k,i){var j=this.handlers_;j||(j=this.handlers_=[]);i||(i=this);for(var h=j.length,n;0<h--;)if(n=j[h],n.handler===k&&n.thisObject===i)return!1;return!!j.push({handler:k,thisObject:i})},removeHandler:function(k,i){var j=this.handlers_;if(j){i||(i=this);for(var h=j.length,n;0<h--;)if(n=j[h],n.handler===k&&n.thisObject===i)return!!j.splice(h,1);return!1}},destroy:function(){this.handlers_&&(n.destroy.call(this,this),this.handlers_=null)}});this.extend({LISTEN:{add:function(k,
i,j,h){j||(j=k);z[i]={listenName:k,listen:h||function(k,h){var i;(i=h[1])&&i.removeHandler(k,this);(i=this[j])&&i.addHandler(k,this)}};(k=n[i])&&C(k,z[i])}},create:k,events:n,EventObject:i})}.body()+"//@ sourceURL="+i+"src/basis/event.js")).call(basis.namespace("basis.event"),basis.namespace("basis.event"),basis.namespace("basis.event").exports,this,i+"src/basis/event.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",
function(){function k(k){for(var h=1E6,k=(""+k).split("."),i=0,j=0;4>i&&i<k.length;i++,h/=100)j+=k[i]*h;return j}function i(){for(var h=0;h<arguments.length;h++){var j=arguments[h].toLowerCase();if(j in C){if(C[j])return!0}else{var l=j.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(l){C[j]=!1;var n=l[1].toLowerCase(),p=k(l[3]),l=l[4]||"=";if(n=x[n])return C[j]=!p||"="==l&&n==p||"+"==l&&n>=p||"-"==l&&n<p}}}return!1}var C={},x={},n=global.navigator&&global.navigator.userAgent||"",z="unknown",v={MSIE:["Internet Explorer",
"msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},p;for(p in v)if(!("MSIE"==p&&global.opera)&&!("Safari"==p&&n.match(/chrome/i))&&!("AppleWebKit"==p&&n.match(/iphone/i))&&n.match(RegExp(p+".(\\d+(\\.\\d+)*)","i")))for(var j=v[p],h=global.opera&&
"function"==typeof global.opera.version?global.opera.version():RegExp.$1,w=k(h),z=j[0]+" "+h,h=0;h<j.length;h++)x[j[h].toLowerCase()]=w;basis.platformFeature.datauri=!1;n="undefined"!=typeof Image?new Image:{};n.onload=function(){basis.platformFeature.datauri=!0};n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";v={set:function(h,k,i,j){document.cookie=h+"="+(null==k?"":escape(k))+";path="+(j||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)+(i?";expires="+
(new Date(Date.now()+1E3*i)).toGMTString():"")},get:function(k){return(k=document.cookie.match(RegExp("(^|;)\\s*"+k+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(k[2])},remove:function(k,h){document.cookie=k+"=;expires="+(new Date(0)).toGMTString()+";path="+(h||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)}};if(i("IE7-"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(l){}this.toString=function(){return z};this.extend({testImage:n,prettyName:z,test:i,is:function(k){return i(k)},
cookies:v,Cookies:v})}.body()+"//@ sourceURL="+i+"src/basis/ua.js")).call(basis.namespace("basis.ua"),basis.namespace("basis.ua"),basis.namespace("basis.ua").exports,this,i+"src/basis/ua.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function k(a,c,b){if(null!=c)return a.insertBefore(J(c)?c:n(c),b||null)}function i(a,c){return a.outerHTML||v("",c?a:a.cloneNode(!0)).innerHTML}
function C(a){return J(a)||a&&a.nodeType?a:"string"==typeof a?h.getElementById(a):null}function x(a,c,b){var g,e=[],b="string"==typeof b?getter(b):b||Function.$true;c&26&&b(a)&&e.push(a);switch(c){case 1:case 2:for(g=a;(g=g[q])&&g!==a.document;)b(g)&&e.push(g);break;case 64:for(g=a[H];g;)b(g)&&e.push(g),g=g[o];break;case 4:case 8:a[H]&&(c=new M(a),c.nodes(b,e));break;case 128:c=new M(a,b);for(c.cursor_=a[o]||a[q];g=c.next();)e.push(g);break;case 256:for(g=a;g=g[o];)b(g)&&e.push(g);break;case 32:b(a[q])&&
e.push(a[q]);break;case 512:c=new M(a,b,M.BACKWARD);for(c.cursor_=a[y]||a[q];g=c.next();)e.push(g);break;case 1024:for(g=a;g=g[y];)b(g)&&e.push(g)}return e}function n(a){return h.createTextNode(null!=a?a:"")}function z(){for(var a=h.createDocumentFragment(),c=arguments.length,b=z.array=[],g=0;g<c;g++)b.push(k(a,arguments[g]));return a}function v(a,c){var d=void 0!=a&&"string"!=typeof a,g=(d?a.description:a)||"",f="div",s=g.match(/^([a-z0-9\_\-]+)(.*)$/i);s&&(f=s[1],g=s[2]);if(""!=g){for(var B=[],
E={},i;s=b.exec(g);){if(s[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+g+"\n\nProblem place:\n> "+g.substr(0,s.index)+"--\>"+g.substr(s.index)+"<--");i=s[1]||s[2]||s[3];s[1]?E.id=i:s[2]?B.push(i):"class"!=i&&(E[i]=s[4]?s[5]||s[6]||s[7]||"":i)}e&&E.name&&/^(input|textarea|select)$/i.test(f)&&(f="<"+f+" name="+E.name+">")}g=h.createElement(f);if(E){E.style&&t&&(g.style.cssText=E.style);for(var m in E)g.setAttribute(m,E[m],0)}B&&B.length&&(g.className=B.join(" "));
1<arguments.length&&k(g,z.apply(0,Array.from(arguments,1).flatten()));if(d&&(a.css&&basis.cssom&&basis.cssom.setStyle(g,a.css),basis.dom.event))for(var u in a)"function"==typeof a[u]?basis.dom.event.addHandler(g,u,a[u],g):a[u]instanceof basis.dom.event.Handler&&basis.dom.event.addHandler(g,u,a[u].handler,a[u].thisObject);return g}function p(a,c){return a[q]?a[q].replaceChild(c,a):a}function j(a){if(h.selection){var c=h.selection.createRange();0!=c.compareEndPoints("StartToEnd",c)&&c.collapse(a);return c.getBookmark().charCodeAt(2)-
2}}var h=global.document,w=basis.Class,l=h.createElement("div"),q="parentNode",H="firstChild",o="nextSibling",y="previousSibling",A;A="function"==typeof l.compareDocumentPosition?function(a,c){return a.compareDocumentPosition(c)}:function(a,c){return a==c?0:a.document!=c.document?33:a.sourceIndex>c.sourceIndex?2|8*c.contains(childA):4|16*a.contains(childB)};var J;"undefined"!=typeof Node?(J=function(a){return a instanceof Node},Node.prototype.contains||(Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&
16)})):J=function(a){return a&&a.ownerDocument===h};var M=w(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,c,b){this.setRoot(a);this.setDirection(b);if(typeof c=="function")this.filter=c},setDirection:function(a){Object.extend(this,a?{a:"lastChild",b:y,c:o,d:H}:{a:H,b:o,c:y,d:"lastChild"})},setRoot:function(a){this.root_=a||h;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},
nodes:function(a,b){var d;b||(b=[]);for(this.reset();d=this.next(a);)b.push(d);return b},next:function(a){var a=a||this.filter,b=this.cursor_||this.root_;do for(var d=b[this.a];!d;){if(b===this.root_)return this.cursor_=null;(d=b[this.b])||(b=b[q])}while(!a(b=d));return this.cursor_=b},prev:function(a){var a=a||this.filter,b=this.cursor_,d=this.c,g=this.d;do{var e=b?b[d]:this.root_[g];if(e){for(;e[g];)e=e[g];b=e}else b&&(b=b[q]);if(!b||b===this.root_){b=null;break}}while(!a(b));return this.cursor_=
b},destroy:function(){this.cursor_=this.root_=null}});M.BACKWARD=!0;var f="textContent innerText nodeValue".qw(),e=function(){var a=h.createElement("input");a.name="a";return!/name/.test(i(a))}(),t;l.setAttribute("style","color: red");t="red"!==l.style.color;var b=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;this.extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,
PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:M,outerHTML:i,textContent:function(a){for(var b=0,d;d=f[b++];)if(a[d]!=
null)return a[d];return x(a,4,function(a){return a.nodeType==3}).map(getter("nodeValue")).join("")},get:C,tag:function(a,b){a=C(a)||h;return b=="*"&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(b||"*"))},axis:x,findAncestor:function(a,b,d){for(;a&&a!==d;){if(b(a))return a;a=a.parentNode}},createElement:v,createText:n,createFragment:z,insert:function(a,b,d,g){a=C(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(d){case void 0:case "end":g=null;break;case "begin":g=
a[H];break;case "before":break;case "after":g=g[o];break;default:g=Number(d).between(0,a.childNodes.length)?a.childNodes[d]:null}d=!J(a);if(!b||!Array.isArray(b))d=d?b&&a.insertBefore(b,g):k(a,b,g);else if(d)for(var d=[],e=0,f=b.length;e<f;e++)d[e]=a.insertBefore(b[e],g);else{a.insertBefore(z.apply(0,b),g);d=z.array}return d},remove:function(a){return a[q]?a[q].removeChild(a):a},replace:p,swap:function(a,b){if(a===b||A(a,b)&25)return false;p(a,l);p(b,a);p(l,b);return true},clone:function(a,b){var d=
a.cloneNode(!b);d.attachEvent&&x(d,8).forEach(Event.clearHandlers);return d},clear:function(a){for(a=C(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,b,d){var g=[],d=Function.getter(d||Function.$self),e;for(e in b)for(var f=0;f<a.length;f++){var B=d(a[f]);g[f]=b[e](a[f],f,B)?v(e,B):a[f]}return g},setAttribute:function(a,b,d){d==null?a.removeAttribute(b):a.setAttribute(b,d)},parentOf:function(a,b){return a.contains(b)},isInside:function(a,b){return a==b||b.contains(a)},focus:function(a,
b){try{a=C(a);a.focus();b&&a.select&&a.select()}catch(d){}},setSelectionRange:function(a,b,d){arguments.length<3&&(d=b);if(a.setSelectionRange)a.setSelectionRange(b,d);else if(a.createTextRange){var e=a.createTextRange();e.collapse(true);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}},getSelectionStart:function(a){return typeof a.selectionStart!="undefined"?a.selectionStart:j(true)},getSelectionEnd:function(a){return typeof a.selectionEnd!="undefined"?a.selectionEnd:j(false)}})}.body()+
"//@ sourceURL="+i+"src/basis/dom.js")).call(basis.namespace("basis.dom"),basis.namespace("basis.dom"),basis.namespace("basis.dom").exports,this,i+"src/basis/dom.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function k(f){return f||global.event}function i(f){return"string"==typeof f?w.get(f):f}function C(f){f=k(f);f.stopPropagation?f.stopPropagation():f.cancelBubble=!0}function x(f){f=
k(f);f.preventDefault?f.preventDefault():f.returnValue=!1}function n(f,e){(e=i(e))?v(e,f,n):(x(f),C(f))}function z(f){var e=Array.from(y[f.type]);if(e)for(var t=e.length;0<t--;){var b=e[t];b.handler.call(b.thisObject,f)}}function v(f,e,t,b){f=i(f);if(!f)throw"basis.event.addHandler: can't attach event listener to undefined";if("function"!=typeof t)throw"basis.event.addHandler: handler is not a function";f[H]||(f[H]={});var a={handler:t,thisObject:b},c=f[H],d=c[e];if(d){for(f=0;c=d[f];f++)if(c.handler===
t&&c.thisObject===b)return;d.push(a)}else d=c[e]=[a],d.fireEvent=function(a){a=k(a);if(A&&a&&y[e]&&"undefined"==typeof a.returnValue){z(a);if(!0===a.cancelBubble)return;"undefined"==typeof a.returnValue&&(a.returnValue=!0)}for(var b=0,c;c=d[b++];)c.handler.call(c.thisObject,a)},f.addEventListener?f.addEventListener(e,d.fireEvent,!1):f.attachEvent("on"+e,d.fireEvent)}function p(f,e,t,b){var f=i(f),a=f[H];if(a&&(a=a[e]))for(var c=0,d;d=a[c];c++)if(d.handler===t&&d.thisObject===b){a.splice(c,1);a.length||
j(f,e);break}}function j(f,e){var f=i(f),t=f[H];if(t)if("string"!=typeof e)for(e in t)j(f,e);else{var b=t[e];b&&(f.removeEventListener?f.removeEventListener(e,b.fireEvent,!1):f.detachEvent("on"+e,b.fireEvent),delete t[e])}}var h=global.document,w=basis.dom,l=Function.$null,q=!!h.addEventListener,H="__basisEvents",o={mousewheel:["mousewheel","DOMMouseScroll"]},y={},A=!h.addEventListener,J=function(){function f(){if(!t++)for(var a=0;a<b.length;a++)b[a].callback.call(b[a].thisObject)}function e(){try{h.documentElement.doScroll("left"),
f()}catch(a){setTimeout(e,1)}}var t=!1,b=[];if("undefined"!=typeof window){if(q)v(h,"DOMContentLoaded",f);else{v(h,"readystatechange",f);try{null==window.frameElement&&h.documentElement.doScroll&&e()}catch(a){}}v(global,"load",f)}return function(a,d){t||b.push({callback:a,thisObject:d})}}(),M={};this.setWrapper(k);this.extend({W3CSUPPORT:q,KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,
INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(f){return o[f]||[f]},Handler:function(f,e){this.handler=f;this.thisObject=e},sender:function(f){f=k(f);return f.target||f.srcElement},cancelBubble:C,cancelDefault:x,kill:n,key:function(f){f=k(f);return f.keyCode||f.which||0},charCode:function(f){f=k(f);return f.charCode||f.keyCode||0},
mouseButton:function(f,e){f=k(f);return"number"==typeof f.which?f.which==e.VALUE:f.button&e.BIT},mouseX:function(f){f=k(f);return f.changedTouches?f.changedTouches[0].pageX:"pageX"in f?f.pageX:f.clientX+(h.documentElement.scrollLeft||h.body.scrollLeft)},mouseY:function(f){f=k(f);return f.changedTouches?f.changedTouches[0].pageY:"pageY"in f?f.pageY:f.clientY+(h.documentElement.scrollTop||h.body.scrollTop)},wheelDelta:function(f){f=k(f);return"wheelDelta"in f?f.wheelDelta/120:"DOMMouseScroll"==f.type?
-f.detail/3:0},addGlobalHandler:function(f,e,t){var b=y[f];if(b)for(f=b.length;0<f--;){var a=b[f];if(a.handler===e&&a.thisObject===t)return}else A?v(h,f,l):h.addEventListener(f,z,!0),b=y[f]=[];b.push({handler:e,thisObject:t})},removeGlobalHandler:function(f,e,t){var b=y[f];if(b)for(var a=0,c;c=b[a];a++)if(c.handler===e&&c.thisObject===t){b.splice(a,1);b.length||(delete y[f],A?p(h,f,l):h.removeEventListener(f,z,!0));break}},addHandler:v,addHandlers:function(f,e,t){var f=i(f),b;for(b in e)v(f,b,e[b],
t)},removeHandler:p,clearHandlers:j,fireEvent:function(f,e,t){f=i(f);(f=f[H])&&f[e]&&f[e].fireEvent(t)},onLoad:J,onUnload:function(f,e){v(global,"unload",f,e)},getEventInfo:function(f,e){e||(e="div");var t=e+"-"+f;if(M[t])return M[t];var b=!1,a=!1;if(!q){var c="on"+f,d=w.createElement(e);w.createElement("div",d)[c]=function(){a=!0};try{d.fireEvent(c),b=!0}catch(g){}}return M[t]={supported:b,bubble:a}}});basis.namespace("basis.dom").extend({ready:J})}.body()+"//@ sourceURL="+i+"src/basis/dom/event.js")).call(basis.namespace("basis.dom.event"),
basis.namespace("basis.dom.event"),basis.namespace("basis.dom.event").exports,this,i+"src/basis/dom/event.js",i+"src/basis/dom/",basis,function(k){return basis.resource(i+"src/basis/dom/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function k(e,f,b){for(var a=1,c;f;)f&1&&(c=H[a],b&a?(e.addHandler(c.handler,c.context),c.action(c.context.add,e)):(e.removeHandler(c.handler,c.context),c.action(c.context.remove,e))),f>>=1,a<<=1}function i(e){return Array.isArray(e)?
e.map(i):{data:e}}var C=basis.Class,x=Object.values,n=Function.$self,z=basis.event.EventObject,v=basis.event.LISTEN,p=basis.event.create,j=basis.event.events,h={},w=[],l={},q={PRIORITY:[],add:function(e,f){var b=e.toUpperCase(),a=e.toLowerCase();this[b]=a;l[a]=b;f=f?this.PRIORITY.indexOf(f):-1;-1==f?this.PRIORITY.push(a):this.PRIORITY.splice(f,0,a)},getList:function(){return Object.values(l)}};q.add("READY");q.add("DEPRECATED");q.add("UNDEFINED");q.add("ERROR");q.add("PROCESSING");var H={},o=1,y=
{NONE:0,ALL:0,add:function(e,f,b){H[o]={handler:f,action:b,context:{add:function(a,b){if(b){var d=y[e]+"_"+a.eventObjectId;b.subscribers_||(b.subscribers_={});if(!b.subscribers_[d]){var g=b.subscriberCount;b.subscribers_[d]=a;b.subscriberCount+=1;b.event_subscribersChanged(b,g)}}},remove:function(a,b){if(b){var d=y[e]+"_"+a.eventObjectId;if(b.subscribers_[d]){var g=b.subscriberCount;delete b.subscribers_[d];b.subscriberCount-=1;b.event_subscribersChanged(b,g)}}}}};y[e]=o;y.ALL|=o;o<<=1}};y.add("DELEGATE",
{delegateChanged:function(e,f){this.remove(e,f);this.add(e,e.delegate)}},function(e,f){e(f,f.delegate)});y.add("TARGET",{targetChanged:function(e,f){this.remove(e,f);this.add(e,e.target)}},function(e,f){e(f,f.target)});v.add("delegate","delegateChanged");v.add("target","targetChanged");var A=C(z,{state:q.READY,data:null,canHaveDelegate:!0,delegate:null,root:null,cascadeDestroy:!1,isTarget:!1,target:null,active:!1,subscribeTo:y.DELEGATE+y.TARGET,subscriberCount:0,subscribers_:null,event_update:p("update",
"object","delta"),event_stateChanged:p("stateChanged","object","oldState"),event_delegateChanged:p("delegateChanged","object","oldDelegate"),event_rootChanged:p("rootChanged","object","oldRoot"),event_targetChanged:p("targetChanged","object","oldTarget"),event_subscribersChanged:p("subscribersChanged","object"),event_activeChanged:p("activeChanged","object"),listen:{delegate:{update:function(e,f){this.data=e.data;this.event_update(this,f)},stateChanged:function(e,f){this.state=e.state;this.event_stateChanged(this,
f)},targetChanged:function(e,f){this.target=e.target;this.event_targetChanged(this,f)},rootChanged:function(e,f){this.data=e.data;this.root=e.root;this.event_rootChanged(this,f)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},init:function(e){z.prototype.init.call(this,e);if(e=this.delegate)this.delegate=null,this.data=e.data,this.state=e.state,this.setDelegate(e);else if(this.root=this,this.data||(this.data={}),this.isTarget)this.target=this;this.active&&k(this,this.subscribeTo,
y.ALL)},isConnected:function(e){if(e instanceof A){for(;e&&e!==this&&e!==e.delegate;)e=e.delegate;return e===this}return!1},getRootDelegate:function(){for(var e=this;e.delegate&&e.delegate!==e;)e=e.delegate;return e},setDelegate:function(e){if(this.canHaveDelegate&&e&&e instanceof A){if(e.delegate&&this.isConnected(e))return!1}else e=null;if(this.delegate!==e){var f=this.state,b=this.data,a=this.delegate,c=this.target,d=this.root,g={};if(e){this.delegate=e;this.root=e.root;this.data=e.data;this.state=
e.state;this.target=e.target;for(var k in e.data)!1===k in b&&(g[k]=void 0);for(k in b)b[k]!==e.data[k]&&(g[k]=b[k]);for(k in g){this.event_update(this,g);break}f!==this.state&&(""+f!=this.state||f.data!==this.state.data)&&this.event_stateChanged(this,f)}else for(k in this.target=this.delegate=null,this.root=this,this.data={},b)this.data[k]=b[k];this.root!==d&&this.event_rootChanged(this,d);this.target!==c&&this.event_targetChanged(this,c);this.event_delegateChanged(this,a);return!0}return!1},setState:function(e,
f){var b=this.target||this.getRootDelegate();if(b!==this)return b.setState(e,f);b=""+e;if(!l[b])throw Error("Wrong state value");if(this.state!=b||this.state.data!=f){var a=this.state;this.state=Object(b);this.state.data=f;this.event_stateChanged(this,a);return!0}return!1},deprecate:function(){this.state!=q.PROCESSING&&this.setState(q.DEPRECATED)},update:function(e){var f=this.target||this.getRootDelegate();if(f!==this)return f.update(e);if(e){var f={},b=0,a;for(a in e)this.data[a]!==e[a]&&(b++,f[a]=
this.data[a],this.data[a]=e[a]);if(b)return this.event_update(this,f),f}return!1},setActive:function(e){e=!!e;return this.active!=e?(this.active=e,this.event_activeChanged(this),k(this,this.subscribeTo,y.ALL*e),!0):!1},setSubscription:function(e){var e=e&y.ALL,f=this.subscribeTo^e;return f?(this.subscribeTo=e,this.active&&k(this,f,e),!0):!1},destroy:function(){this.active&&k(this,this.subscribeTo,0);this.delegate&&this.setDelegate();z.prototype.destroy.call(this);this.data=h;this.state=q.UNDEFINED;
this.target=this.root=null}}),J={destroy:function(){delete this.map[this.itemId]}},n=C(null,{itemClass:A,keyGetter:n,map_:null,extendConstructor_:!0,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(e){return this.get(this.keyGetter(e),e)},create:function(e){var f={};e instanceof A?f.delegate=e:f.data={id:e,title:e};return new this.itemClass(f)},get:function(e,f){var b=e instanceof A?e.eventObjectId:e,a=this.map_[b];!a&&f&&(a=this.map_[b]=this.create(e,f),a.addHandler(J,{map:this.map_,
itemId:b}));return a},destroy:function(){basis.Cleaner.remove(this);for(var e=x(this.map_),f=0,b;b=e[f++];)b.destroy()}}),M=C(A,{state:q.UNDEFINED,itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:p("datasetChanged","dataset","delta")&&function(e,f){var b,a=0,c=0,d;if(b=f.inserted)for(;d=b[a];)this.item_[d.eventObjectId]=d,a++;if(b=f.deleted)for(;d=b[c];)delete this.item_[d.eventObjectId],c++;this.itemCount+=a-c;this.cache_=null;j.datasetChanged.call(this,e,f)},init:function(e){A.prototype.init.call(this,
e);this.memberMap_={};this.item_={}},has:function(e){return!(!e||!this.item_[e.eventObjectId])},getItems:function(){this.cache_||(this.cache_=x(this.item_));return this.cache_},pick:function(){for(var e in this.item_)return this.item_[e];return null},top:function(e){var f=[];if(e)for(var b in this.item_)if(f.push(this.item_[b])>=e)break;return f},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();A.prototype.destroy.call(this);
this.cache_=w;this.itemCount=0;this.item_=this.memberMap_=null}}),f=C(M,{listen:{item:{destroy:function(e){this.remove([e])}}},init:function(e){M.prototype.init.call(this,e);if(e=this.items)this.items=null,this.set(e)},add:function(e){for(var f,b=this.memberMap_,a=[],c=this.listen.item,d=0;d<e.length;d++){var g=e[d];if(g instanceof A){var k=g.eventObjectId;b[k]||(b[k]=g,c&&g.addHandler(c,this),a.push(g))}}a.length&&this.event_datasetChanged(this,f={inserted:a});return f},remove:function(e){for(var f,
b=this.memberMap_,a=[],c=this.listen.item,d=0;d<e.length;d++){var g=e[d];if(g instanceof A){var k=g.eventObjectId;b[k]&&(c&&g.removeHandler(c,this),delete b[k],a.push(g))}}a.length&&this.event_datasetChanged(this,f={deleted:a});return f},set:function(e){if(!this.itemCount)return this.add(e);if(!e.length)return this.clear();for(var f=this.memberMap_,b={},a=[],c=[],d,g,k,i=this.listen.item,B=0;B<e.length;B++)d=e[B],d instanceof A&&(g=d.eventObjectId,b[g]=d,f[g]||(f[g]=d,i&&d.addHandler(i,this),c.push(d)));
for(g in f)b[g]||(d=f[g],i&&d.removeHandler(i,this),delete f[g],a.push(d));var E;var e={},h;c&&c.length&&(h=e.inserted=c);a&&a.length&&(h=e.deleted=a);h&&(E=e);(k=E)&&this.event_datasetChanged(this,k);return k},sync:function(e,k){if(e){f.setAccumulateState(!0);for(var b=this.memberMap_,a,c,d={},g=[],i,h=0;h<e.length;h++)a=e[h],a instanceof A&&(c=a.eventObjectId,d[c]=a,b[c]||g.push(a));for(c in this.item_)d[c]||this.item_[c].destroy();k&&g.length&&(i=this.add(g));f.setAccumulateState(!1);return i}},
clear:function(){var e,f=this.getItems(),b=this.listen.item;if(f.length){if(b)for(e=f.length;0<e--;)f[e].removeHandler(b,this);this.event_datasetChanged(this,e={deleted:f});this.memberMap_={}}return e}});f.setAccumulateState=function(){function e(a){var b=a.dataset;d.call(b,b,a)}function f(){var a=i;i={};for(var b in a)e(a[b])}function b(a,b){var c=a.eventObjectId,f=b.inserted,g=b.deleted,k=i[c];if(f&&g)return k&&(delete i[c],e(k)),d.call(a,a,b);if(k){var h=k[f?"inserted":"deleted"];if(h)return h.push.apply(h,
f||g);e(k)}i[c]=b;b.dataset=a}function a(){k=null;g&&(g=0,c.event_datasetChanged=d,f())}var c=M.prototype,d=c.event_datasetChanged,g=0,k,i={};return function(e){e?(0==g&&(c.event_datasetChanged=b,k||(k=setTimeout(a,0))),g++):(g-=0<g,0==g&&(c.event_datasetChanged=d,f()))}}();this.setWrapper(i);this.extend({STATE:q,SUBSCRIPTION:y,Object:A,DataObject:A,KeyObjectMap:n,AbstractDataset:M,Dataset:f})}.body()+"//@ sourceURL="+i+"src/basis/data.js")).call(basis.namespace("basis.data"),basis.namespace("basis.data"),
basis.namespace("basis.data").exports,this,i+"src/basis/data.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function k(a){return function(b){if(!b||!("click"==b.type&&3==b.which)){var c=p.sender(b),d,f;if(c){do if(d=c.getAttributeNode&&c.getAttributeNode(a))break;while(c=c.parentNode);if(c&&d){do if(f=c.basisObjectId)if((f=e[f])&&f.templateAction){c=d.nodeValue.qw();d=0;for(var g;g=
c[d++];)f.templateAction(g,p(b));break}while(c=c.parentNode)}}}}}function i(){this.instances_&&C.call(this)}function C(){var a=this.instances_,b=""+("function"==typeof this.source?this.source():this.source),b=this.isDecl?b.toObject():c(b),b=g(b),d=this.l10n_;if(d){this.l10n_=null;for(var f=0,e;e=d[f];f++)e.token.detach(e.handler,e)}this.createInstance=b.createInstance;this.getBinding=b.getBinding;this.instances_=b.map;var k=b.l10nProtoUpdate;if(a)for(var i in a)a[i].rebuild();if(b.l10n){this.l10n_=
d=[];var a=b.map,h;for(h in b.l10n)e={path:h,token:basis.l10n.getToken(h),handler:function(b){k(this.path,b);for(var c in a)a[c].set(this.path,b)}},e.token.attach(e.handler,e),d.push(e)}}function x(a){return function(){var b;var c=n.getElementById(a);if(c&&"SCRIPT"==c.tagName)switch(c.type){default:b=c.textContent||c.text}return b}}var n=global.document,z=basis.Class,v=basis.dom,p=basis.dom.event,j="undefined"!=typeof window&&1==v.createElement("","a","b").cloneNode(!0).childNodes.length,h=/((?:.|[\r\n])*?)(\{(?:l10n:([a-z\_][a-z0-9\-\_]*(?:\.[a-z\_][a-z0-9\-\_]*)*)\})?|<(\/|!--(\s*\{)?)?|$)/g,
w=/([a-z\_][a-z0-9\-\_]*)(\:|\{|\s*(\/?>)?)/ig,l=/([a-z\_][a-z0-9\-\_]*)(\:|\{|=|\s*)|(\/?>)/ig,q=/(.|[\r\n])*?--\>/g,H=/([a-z\_][a-z0-9\-\_]*(?:\:[a-z\_][a-z0-9\-\_]*)?)>/ig,o=/([a-z\_][a-z0-9\_]*)(\||\}\s*)/ig,y=/"((?:(\\")|[^"])*?)"\s*/g,A=/"/g,J=/\\"/g,M=/^event-(.+)+/,f={},e={seed:1},t={},b={svg:"http://www.w3.org/2000/svg"},a=function(a){var b=[],c=[],d={childs:b},f,e,g,k,r=!1,I=0,D,P={},K,F=h,i=0,j,a=a.trim();try{for(;i<a.length||F!=h;)if(k=F.lastIndex=i,j=F.exec(a),!j||j.index!==i){r&&(d=
c.pop());e&&d.childs.pop();if(e=d.childs.pop())3==e.type&&!e.refs?I-="len"in e?e.len:e.value.length:d.childs.push(e);r=!1;F=h}else{i=F.lastIndex;switch(F){case h:D=k+j[1].length;I!=D&&(f=I==k?j[1]:a.substring(I,D),(e=f.replace(/\s*(\r\n?|\n\r?)\s*/g,""))&&d.childs.push({type:3,len:f.length,value:e}));I=D;j[3]?d.childs.push({type:3,refs:["l10n:"+j[3]],value:"{l10n:"+j[3]+"}"}):"{"==j[2]?(g=i-1,d.childs.push(e={type:3}),F=o):j[4]?"/"==j[4]?(e=null,F=H):(d.childs.push(e={type:8}),j[5]?(g=i-j[5].length,
F=o):(g=i,F=q)):j[2]&&(r=!0,c.push(d),d.childs.push(e={type:1,attrs:[],childs:[]}),d=e,F=w);break;case H:j[1]!==(d.prefix?d.prefix+":":"")+d.name?d.childs.push({type:3,value:"</"+j[0]}):d=c.pop();F=h;break;case w:case l:if(":"==j[2]){if(e.prefix)throw"Invalid or unsupported syntax";e.prefix=j[1];break}j[1]&&(e.name=j[1],2==e.type&&d.attrs.push(e));if("{"==j[2]){F=o;break}if(j[3]){"/>"==j[3]&&(d=c.pop());r=!1;F=h;break}if("="==j[2]){F=y;break}e={type:2};F=l;break;case q:e.value=a.substring(g,i-3);
F=h;break;case o:K=j[1];if(P[K]){var s=P[K];s.refs.splice(s.refs.indexOf(K),1);s.refs.length||delete s.refs}3!=e.type&&(P[K]=e);e.refs?e.refs.push(j[1]):e.refs=[j[1]];"|"!=j[2]&&(3==e.type?(i-=j[2].length-1,e.value=a.substring(g,i),F=h):8==e.type?F=q:2==e.type&&"="==a[i]?(i++,F=y):(e={type:2},F=l));break;case y:e.value=j[1].replace(J,'"');e={type:2};F=l;break;default:throw"Parser bug";}F==h&&(I=i)}I!=i&&d.childs.push({type:3,value:a.substring(I,i)});b.length||b.push({type:3,value:""});!1=="element"in
P&&(b[0].refs?b[0].refs.push("element"):b[0].refs=["element"]);if(1<c.length)throw"No close tag for "+c.pop().name;b.templateDeclaration=!0}catch(n){console.warn(n,a)}return b},c=function(){function b(a,c){i[c]||("#"==c.charAt(0)?i[c]=String.fromCharCode("x"==c.charAt(1)||"X"==c.charAt(1)?parseInt(c.substr(2),16):c.substr(1)):(r.innerHTML=a,i[c]=r.firstChild?r.firstChild.nodeValue:""));return i[c]}function c(a){a=a.refs;return!a||!a.length?0:a}function d(a){for(var D=[],r=0,K,F;K=a[r];r++){var i=
c(K),h=i&&1==i.length?1:0;switch(K.type){case 1:F=h;for(var h=(K.prefix?K.prefix+":":"")+K.name,j=K.attrs,s=[],l=void 0,n=void 0,L=void 0,p=0,o=void 0;o=j[p];p++){l=0;if(o.value)if("class"==o.name){if(n=o.value.match(e)){for(var N=[],q={},t,l=[[]],O=0;t=n[O];O++)(L=t.match(f))?(t=q[L[2]],q[L[2]]||(t=q[L[2]]=[],l[0].push(L[2]),l.push(t)),t.push(L[1]||"")):N.push(t);o.value=N.join(" ");1==l.length&&(l=0)}}else if(n=o.value.split(g),1<n.length){L=[];N=[];q={};for(O=0;O<n.length;O++)O%2?(l=n[O],q[l]||
(q[l]=L.length,L.push(l)),N.push(q[l])):n[O]&&N.push(n[O].replace(k,b));l=[L,N]}else o.value=o.value.replace(k,b);s.push([2,l,c(o),(o.prefix?o.prefix+":":"")+o.name,o.value])}F=[1,F,i,h,s.length?s:0,d(K.childs)];break;case 3:F=[3,h,i,K.value.replace(k,b)];break;case 8:F=[8,h,i,K.value.replace(k,b)]}D.push(F)}return D.length?D:0}var e=/(\S+)/g,f=/^([a-z\_][a-z0-9\-\_]*)?\{([a-z\_][a-z0-9\-\_]*)\}$/i,g=/\{([a-z\_][a-z0-9\_]*|l10n:[a-z\_][a-z0-9\_]*(?:\.[a-z\_][a-z0-9\_]*)*)\}/i,k=/&([a-z]+|#[0-9]+|#x[0-9a-f]{1,4});?/gi,
i={},r=n.createElement("div");return function(b,c){b.templateDeclaration||(b=a(""+b,c));return d(b)}}(),d=function(){function a(b,c){for(var d=0,D;D=b[d];d++)-1==D.indexOf(":")&&f.push(D+":"+c)}function b(a){var c=e.length,c=d[c]||"r"+c;e.push(c+"="+a);return c}function c(d,r){for(var f,D,P,K,m,k,i=0,h=0,s;s=d[i];i++,h++,k=!1){i?d[i+1]?(j&&s[0]==d[i-1][0]&&3==s[0]&&h++,f=r+".childNodes["+h+"]"):f=r+".lastChild":f=r+".firstChild";if(K=s[2])k=!0,f=b(f),a(K,f),s[1]&&g.push([s[0],f,K[0]]);if(1==s[0]){m=
-1;k||(f=b(f),m=e.length);if(D=s[4])for(var l=0,n;n=D[l];l++){var L=n[3];if(K=n[2])k=!0,a(K,b(f+'.getAttributeNode("'+L+'")'));if(K=n[1]){n=[2,f];k=!0;for(var o=0,p;p=K[0][o];o++)p="class"==L?n.concat([p,L,K[o+1]]):n.concat([p,L,K[0],K[1]]),g.push(p)}}(P=s[5])&&c(P,f);!k&&m==e.length&&e.pop()}}}var d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".toArray(),e,f,g;return function(a,b){e=[];f=[];g=[];c(a,b);return{path:e,ref:f,binding:g}}}(),g=function(){function a(b,c){return function(){for(var a=
0,d;d=b[a];a++)this.tmpl.set(d,c[d](this))}}function b(c){var D={};return function(b){var d="bindingId"in b?b.bindingId:null,r=D[d];if(!r){var r=[],e={},f={},g={},m;for(m in c){var k=b[m],i=k&&k.getter;if(i&&(g[m]=i,r.push(m),k.events))for(var k=(""+k.events).qw(),i=0,h;h=k[i];i++)e[h]?e[h].push(m):(f||(f={}),e[h]=[m],f[h]=a(e[h],g))}r={names:r,events:e,sync:a(r,g),handler:f};d&&(D[d]=r)}return r}}function c(a,b){for(var d=[],r=a[5],e=a[4],f,g,m=0;m<r.length;m++)"string"==typeof r[m]?d.push('"'+r[m].replace(A,
'\\"')+'"'):(f=e[r[m]],g=f.indexOf(":"),-1==g?d.push(b?'"{'+f+'}"':"__"+f):d.push('__l10n["'+f.substr(g+1)+'"]'));1==d.length&&d.push('""');return d.join("+")}function f(a){for(var d={},r,e,g,m=[],k=[],i,h,u={},j=0,s;s=a[j];j++){g=s[1];n=s[2];r=d[n];e="_"+j;i="__"+n;var B=n.split(":");if("l10n"==B[0]&&B[1])(i=B[1],h||(h={}),d[i]||(d[i]=[],h[i]=[]),r=d[i],r.l10n=!0,3==s[0])?(r.push(g+'.nodeValue=__l10n["'+i+'"];'),h[i].push(g+".nodeValue=value;")):(h[i].push("bind_attr("+[g,'"'+l+'"',"{}",c(s,!0)]+
");"),m.push(e),r.push(e+"=bind_attr("+[g,'"'+l+'"',e,c(s)]+");"));else switch(d[n]||(r=d[n]=[],m.push(i)),s[0]){case 1:case 8:m.push(e+"="+g);u.bind_node=!0;r.push(e+"=bind_node("+[g,e]+",value);");break;case 3:m.push(e+"="+g);u.bind_nodeValue=!0;r.push(e+"=bind_nodeValue("+[g,e]+",value);");break;case 2:var l=s[3];if("class"==l){s=s[4];for(i=0;i<s.length;i++)m.push(e+'=""'),u.bind_attrClass=!0,r.push(e+"=bind_attrClass("+[g,e,"value",'"'+s[i]+'"']+");")}else u.bind_attr=!0,m.push(e+"="+c(s,!0)),
r.push(e+"=bind_attr("+[g,'"'+l+'"',e,c(s)]+");")}}k.push("function set(bindName,value){\nvalue=resolve(attaches,updateAttach,bindName,value);switch(bindName){");for(var n in d)k.push('case"'+n+'":\n'+(d[n].l10n?d[n].join("\n"):"if(__"+n+"!==value){__"+n+"=value;\n"+d[n].join("\n")+"}")+"break;");k.push("}}");for(var o in u)m.push(o+"=tools."+o);return{vars:m,l10n:h,getBinding:b(d),body:k.join("")}}var g=/\s+/,k="function"==typeof Node&&n instanceof Node,i=k?function(a,b,c){a=c instanceof Node?c:
a;a!==b&&b.parentNode.replaceChild(a,b);return a}:function(a,b,c){c=c&&"object"==typeof c?c:a;if(c!==b)try{b.parentNode.replaceChild(c,b)}catch(d){c=a,b!==c&&b.parentNode.replaceChild(c,b)}return c},h=function(a,b,c,d){c!==d&&(d?a.setAttribute(b,d):a.removeAttribute(b));return d},r={bind_nodeValue:k?function(a,b,c){var d=c instanceof Node?c:a;d!==b&&b.parentNode.replaceChild(d,b);d===a&&(d.nodeValue=c);return d}:function(a,b,c){b=i(a,b,c);b===a&&(b.nodeValue=c);return b},bind_node:i,bind_attr:h,bind_attrClass:global.DOMTokenList&&
n&&n.documentElement.classList instanceof global.DOMTokenList?function(a,b,c,d){c=c?d+c:"";c!=b&&(b&&a.classList.remove(b),c&&a.classList.add(c));return c}:function(a,b,c,d){c=c?d+c:"";c!=b&&(d=a.className.split(g),b&&d.remove(b),c&&d.push(c),a.className=d.join(" "));return c},resolve:function(a,b,c,d){var r=d&&d.bindingBridge,e=a[c];if(r||e)r?(d!==e&&(e&&e.bindingBridge.detach(e,b,c),r.attach(d,b,c),a[c]=d),d=r.get(d)):e&&(e.bindingBridge.detach(e,b,c),delete a[c]);return d}};return function(a){var b=
d(a,"_"),c=f(b.binding),g=N(a),a={},i;if(c.l10n){i={};var k=[],u;for(u in c.l10n)k.push('case"'+u+'":\n__l10n["'+u+'"]=value;'+c.l10n[u].join(";")+"break;");k=new Function("_","__l10n","bind_attr","var "+b.path+";return function(token, value){switch(token){"+k.join("")+"}}");k=k(g,i,h);for(u in c.l10n)k(u,basis.l10n.getToken(u).value)}b=new Function("gMap","tMap","build","tools","__l10n","return function createInstance_(obj,actionCallback,updateCallback){var _=build(),id=gMap.seed++,attaches={},resolve=tools.resolve,"+
b.path.concat(c.vars)+";\nif(obj&&a&&a.nodeType!=3)gMap[a.basisObjectId=id]=obj;\nfunction updateAttach(){set(String(this),attaches[this])};\n"+c.body+";return tMap[id]={"+[b.ref,"set:set,rebuild:function(){if(updateCallback)updateCallback.call(obj)},destroy:function(){for(var key in attaches)if(attaches[key])attaches[key].bindingBridge.detach(attaches[key],updateAttach,key);attaches=null;delete tMap[id];if(obj)delete gMap[id]}"]+"}}");b=b(e,a,function(){return g.cloneNode(!0)},r,i);return{createInstance:b,
getBinding:c.getBinding,l10nProtoUpdate:k,l10n:c.l10n,map:a}}}(),N=function(a){for(var c=n.createDocumentFragment(),d,e,g,i=0,h;h=a[i];i++)switch(h[0]){case 1:var s=h[3];d=s.split(/:/);g=1<d.length?n.createElementNS(b[d[0]],s):n.createElement(s);if(d=h[4])for(var r=0,I;I=d[r];r++){var D=I[3];g.setAttribute(D,I[4]);if(I=D.match(M)){I=I[1];if(!f[I]){f[I]=k(D);for(var D=0,P=p.browserEvents(I),K;K=P[D++];)p.addGlobalHandler(K,f[I])}p.W3CSUPPORT||(D=p.getEventInfo(I,s),D.supported&&!D.bubble&&g.attachEvent("on"+
I,function(a){return function(){p.fireEvent(n,a)}}(I)))}}(e=h[5])&&g.appendChild(N(e));c.appendChild(g);break;case 8:c.appendChild(n.createComment(h[3]));break;case 3:j&&i&&3==a[i-1][0]&&c.appendChild(n.createComment("")),c.appendChild(n.createTextNode(h[3]))}return c},s=z(null,{__extend__:function(a){return a instanceof s?a:new s(a)},init:function(a){this.setSource(a)},createInstance:function(a,b,c){C.call(this);return this.createInstance(a,b,c)},clearInstance:function(a){a.destroy()},getBinding:function(a){C.call(this);
return this.getBinding(a)},setSource:function(a){var b=this.source;if(b!=a){this.isDecl=!1;if("string"==typeof a){var c=a.match(/^([a-z]+):/);if(c){var d=c[1],a=a.substr(c[0].length);switch(d){case "file":a=basis.resource(a);break;case "id":a=x(a);case "tokens":this.isDecl=!0}}}if(b&&b.bindingBridge){if(c=b.url&&t[b.url])c.remove(this),c.length||delete t[b.url];this.source.bindingBridge.detach(b,i,this)}a&&a.bindingBridge&&(a.url&&(t[a.url]||(t[a.url]=[]),t[a.url].add(this)),a.bindingBridge.attach(a,
i,this));this.source=a;i.call(this)}}});this.extend({Template:s,tokenize:a,makeDeclaration:c,buildPathes:d,makeFunctions:g,buildHtml:N,filesMap:t,resolveObjectById:function(a){return e[a]}})}.body()+"//@ sourceURL="+i+"src/basis/template.js")).call(basis.namespace("basis.template"),basis.namespace("basis.template"),basis.namespace("basis.template").exports,this,i+"src/basis/template.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",
function(){var i=basis.dom,G=basis.template.Template,C=global.document.createElement("div");this.extend({Template:G,escape:function(x){return i.createElement("div",i.createText(x)).innerHTML},unescape:function(i){C.innerHTML=i;return C.firstChild.nodeValue},string2Html:function(x){C.innerHTML=x;return i.createFragment.apply(null,Array.from(C.childNodes))}})}.body()+"//@ sourceURL="+i+"src/basis/html.js")).call(basis.namespace("basis.html"),basis.namespace("basis.html"),basis.namespace("basis.html").exports,
this,i+"src/basis/html.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function i(a){return a.sortingValue||0}function G(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return+(a>b)||-(a<b)}function C(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return-(a>b)||+(a<b)}function x(a){return a.childNodes.sort(a.sortingDesc?C:G)}function n(a,b,c,d,e){if(b!==c){var f=a,g=[];d&&(a.contextSelection=
c,a.selected&&g.push(a));for(;f;){if((d=!f.selection||e&&f===a?f.firstChild:null)&&d.contextSelection!==b)throw"Try change wrong context selection";for(;!d;){if(f===a){g.length&&(b&&b.remove(g),c&&c.add(g));return}d=f.nextSibling;d||(f=f.parentNode)}f=d;f.selected&&g.push(f);f.contextSelection=c}}}function z(a,b){var c=b.length-1;a.childNodes=b;a.firstChild=b[0]||null;a.lastChild=b[c]||null;for(var d=c;c=b[d];d--)c.nextSibling=b[d+1]||null,c.previousSibling=b[d-1]||null,a.insertBefore(c,c.nextSibling)}
function v(a,b){var e;if("function"==typeof a.childFactory&&(e=a.childFactory(b),e instanceof a.childClass))return e;if(!e)throw d;throw c;}var p=this.path,j=basis.Class,h=basis.dom,w=basis.data,l=basis.event.create,q=basis.event.events,H=basis.event.LISTEN,o=w.SUBSCRIPTION,y=w.DataObject,A=w.AbstractDataset,J=w.Dataset,M=Function.getter,f=Function.nullGetter,e=Function.$undef,t=Object.complete,w=j.oneFunctionProperty,b=p+": Node can't be inserted at specified point in hierarchy",a=p+": Node was not found",
c=p+": Child node has wrong class",d=p+": Child node is null",g=p+": Operation is not allowed because node is under dataSource control",N=p+": Node can't has owner and parentNode",s={NONE:"none",PARENT:"parent",OWNER:"owner"};o.add("OWNER",{ownerChanged:function(a,b){this.remove(a,b);this.add(a,a.owner)}},function(a,b){a(b,b.owner)});o.add("DATASOURCE",{dataSourceChanged:function(a,b){this.remove(a,b);this.add(a,a.dataSource)}},function(a,b){a(b,b.dataSource)});var B=j.customExtendProperty({},function(a,
b){for(var c in b){var d=b[c];j.isClass(d)&&(d={instanceOf:d});if(d&&"object"==typeof d){var e=!1,f={instanceOf:d.instanceOf},g={key:c,config:f};typeof d.config&&(f.config=d.config);"function"==typeof d.existsIf&&(e=f.existsIf=d.existsIf);"function"==typeof d.delegate&&(e=f.delegate=d.delegate);"function"==typeof d.dataSource&&(e=f.dataSource=d.dataSource);if(e){var d=d.hook?R.__extend__(d.hook):R,m;for(m in d)if(d[m]===E){g.hook=d;break}}a[c]=g}else a[c]=null}}),E=function(){var a=this.owner,b=this.context.key,
c=this.context.config,d=!c.existsIf||c.existsIf(a),e=a.satellite[b];d?e?(c.delegate&&e.setDelegate(c.delegate(a)),c.dataSource&&e.setDataSource(c.dataSource(a))):(d=("function"==typeof c.config?c.config(a):c.config)||{},d.owner=a,c.delegate&&(d.delegate=c.delegate(a)),c.dataSource&&(d.dataSource=c.dataSource(a)),e=new c.instanceOf(d),a.satellite[b]=e,a.event_satelliteChanged(this,b,null),a.listen.satellite&&e.addHandler(a.listen.satellite,a)):e&&(delete a.satellite[b],a.event_satelliteChanged(a,b,
e),e.destroy())},R=w(E,{update:!0});H.add("owner","ownerChanged");H.add("dataSource","dataSourceChanged");var m=j(y,{event_update:function(a,b){y.prototype.event_update.call(this,a,b);var c=this.parentNode;c&&(c.matchFunction&&this.match(c.matchFunction),c.insertBefore(this,this.nextSibling))},event_childNodesModified:l("childNodesModified","node","delta")&&function(a,b){q.childNodesModified.call(this,a,b);var c=this.listen.childNode,d;if(c){if(d=b.inserted)for(var e=0,f;f=d[e];e++)f.addHandler(c,
this);if(d=b.deleted)for(e=0;f=d[e];e++)f.removeHandler(c,this)}},event_dataSourceChanged:l("dataSourceChanged","node","oldDataSource"),event_groupingChanged:l("groupingChanged","node","oldGroupingNode"),event_sortingChanged:l("sortingChanged","node","oldSorting","oldSortingDesc"),event_ownerChanged:l("ownerChanged","node","oldOwner"),event_satelliteChanged:l("satelliteChanged","node","key","oldSattelite"),subscribeTo:y.prototype.subscribeTo+o.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},
autoDelegate:s.NONE,nodeType:"DOMWrapperNode",childNodes:null,childClass:m,dataSource:null,dataSourceMap_:null,destroyDataSourceMember:!0,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,sorting:f,sortingDesc:!1,grouping:null,groupingClass:null,groupNode:null,satelliteConfig:B,satellite:null,owner:null,init:function(a){var b=this.dataSource,c=this.childNodes,d=this.grouping;b&&(this.dataSource=null);y.prototype.init.call(this,a);d&&(this.grouping=null,this.setGrouping(d));
if(this.childClass)this.childNodes=[],b?(this.dataSource=null,this.setDataSource(b)):c&&this.setChildNodes(c);else if(c&&(this.childNodes=null),b)this.dataSource=null;if(this.satellite){var a=this.listen.satellite,e;for(e in this.satellite)b=this.satellite[e],b.setOwner(this),this.event_satelliteChanged(this,e,null),a&&b.addHandler(a,this)}else this.satellite={};if(this.satelliteConfig!==B)for(e in this.satelliteConfig)if((a=this.satelliteConfig[e])&&"object"==typeof a)b={context:a,owner:this},a.hook&&
this.addHandler(a.hook,b),E.call(b);if(e=this.owner)this.owner=null,this.setOwner(e)},setSatellite:function(a,b){var c=this.satellite[a];!1==b instanceof y&&(b=null);if(c!=b&&!this.satelliteConfig[a]){var d=this.listen.satellite;c&&(c.setOwner(null),d&&c.removeHandler(d,this));if(this.satellite[a]=b)b.setOwner(this),d&&b.addHandler(d,this);this.event_satelliteChanged(this,a,c)}},appendChild:function(){},insertBefore:function(){},removeChild:function(){},replaceChild:function(){},clear:function(){},
setChildNodes:function(){},setGrouping:function(){},setSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||!1==a instanceof m)a=null;if(a&&this.parentNode)throw N;var b=this.owner;b!==a&&(this.owner=a,this.event_ownerChanged(this,b),this.autoDelegate==s.OWNER&&this.setDelegate(a))},destroy:function(){y.prototype.destroy.call(this);this.dataSource?this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);this.grouping&&(this.grouping.setOwner(),
this.grouping=null);this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var b=this.satellite[a];b.owner=null;b.destroy()}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=null}}),u=j(m,{autoDestroyIfEmpty:!1,nodes:null,first:null,last:null,init:function(a){this.nodes=[];m.prototype.init.call(this,a)},insert:function(a,b){var c=this.nodes,d=b?c.indexOf(b):-1;-1==d?(c.push(a),this.last=a):c.splice(d,0,a);
this.first=c[0];a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var b=this.nodes;b.remove(a)&&(this.first=b[0]||null,this.last=b[b.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]}));!this.first&&this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var a=this.nodes,b=a.length;0<b--;)a[b].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&
this.destroy()}},destroy:function(){m.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),S={childClass:m,childFactory:null,listen:{dataSource:{datasetChanged:function(a,b){var c={},d=[];if(b.deleted)if(c.deleted=d,this.childNodes.length==b.deleted.length){var d=Array.from(this.childNodes),e=this.dataSource;this.dataSource=null;this.clear(!0);this.dataSource=e;this.dataSourceMap_={}}else for(var e=0,f;f=b.deleted[e];e++){f=f.eventObjectId;var g=this.dataSourceMap_[f];delete this.dataSourceMap_[f];
g.canHaveDelegate=!0;this.removeChild(g);d.push(g)}if(b.inserted){c.inserted=[];for(e=0;f=b.inserted[e];e++)g=v(this,{cascadeDestroy:!1,delegate:f}),g.canHaveDelegate=!1,this.dataSourceMap_[f.eventObjectId]=g,c.inserted.push(g),this.firstChild&&this.insertBefore(g)}this.firstChild?this.event_childNodesModified(this,c):this.setChildNodes(c.inserted);if(this.destroyDataSourceMember&&d.length)for(e=0;f=d[e];e++)f.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},
insertBefore:function(c,d){if(!this.childClass)throw b;if(c.firstChild)for(var e=this;e=e.parentNode;)if(e===c)throw b;var m=c&&c instanceof this.childClass;if(this.dataSource&&(!m||this.dataSourceMap_[c.delegate.eventObjectId]!==c))throw g;m||(c=v(this,c instanceof y?{delegate:c}:c));if(c.owner)throw N;var m=c.parentNode===this,h=c.groupNode,u=this.grouping,j=this.sorting,l,o=this.childNodes,B,p=null,e=-1,E=!1,L,q;m&&(L=c.nextSibling,q=c.previousSibling);if(j!==f&&(d=null,l=this.sortingDesc,B=j(c)||
0,m))if(B===c.sortingValue)E=!0;else if((!L||(l?L.sortingValue<=B:L.sortingValue>=B))&&(!q||(l?q.sortingValue>=B:q.sortingValue<=B)))c.sortingValue=B,E=!0;if(u){p=u.getGroupNode(c,!0);u=p.nodes;if(h===p&&(E||m&&L===d))return c;j!==f?E?e=L&&L.groupNode===p?u.indexOf(L):u.length:(e=u.binarySearchPos(B,i,l),c.sortingValue=B):e=d&&d.groupNode===p?u.indexOf(d):u.length;if(e<u.length)d=u[e];else if(p.last)d=p.last.nextSibling;else{e=p;for(d=null;(e=e.nextSibling)&&!(d=e.first););}if(c===d||m&&L===d)return h!==
p&&(h&&h.remove(c),p.insert(c,d)),c;e=-1}else if(j!==f){if(E)return c;e=o.binarySearchPos(B,i,l);d=o[e];c.sortingValue=B;if(c===d||m&&L===d)return c}else{if(d&&d.parentNode!==this)throw a;if(m){if(L===d)return c;if(c===d)throw b;}}this.domVersion_=(this.domVersion_||0)+1;if(m){if(L?(L.previousSibling=q,c.nextSibling=null):this.lastChild=q,q?(q.nextSibling=L,c.previousSibling=null):this.firstChild=L,-1==e?o.remove(c):(l=o.indexOf(c),o.splice(l,1),e-=l<e),h)h.remove(c),h=null}else c.parentNode&&c.parentNode.removeChild(c);
h!=p&&p.insert(c,d);if(d){-1==e&&(e=o.indexOf(d));if(-1==e)throw a;c.nextSibling=d;o.splice(e,0,c)}else e=o.length,o.push(c),d={previousSibling:this.lastChild},this.lastChild=c;c.parentNode=this;c.previousSibling=d.previousSibling;0==e?this.firstChild=c:d.previousSibling.nextSibling=c;d.previousSibling=c;n(c,c.contextSelection,this.selection||this.contextSelection,!0);m||(c.match&&c.match(this.matchFunction),c.autoDelegate==s.PARENT&&c.setDelegate(this),this.dataSource||this.event_childNodesModified(this,
{inserted:[c]}));return c},removeChild:function(b){if(!b||b.parentNode!==this)throw a;if(!1==b instanceof this.childClass)throw c;if(this.dataSource&&this.dataSource.has(b.delegate))throw g;var d=this.childNodes.indexOf(b);if(-1==d)throw a;this.childNodes.splice(d,1);b.parentNode=null;b.nextSibling?b.nextSibling.previousSibling=b.previousSibling:this.lastChild=b.previousSibling;b.previousSibling?b.previousSibling.nextSibling=b.nextSibling:this.firstChild=b.nextSibling;b.nextSibling=null;b.previousSibling=
null;n(b,b.contextSelection,null,!0);b.groupNode&&b.groupNode.remove(b);this.dataSource||this.event_childNodesModified(this,{deleted:[b]});b.autoDelegate==s.PARENT&&b.setDelegate();return b},replaceChild:function(b,c){if(this.dataSource)throw g;if(null==c||c.parentNode!==this)throw a;this.insertBefore(b,c);return this.removeChild(c)},clear:function(a){if(this.dataSource&&this.dataSource.itemCount)throw g;if(this.firstChild){a&&n(this,this.selection||this.contextSelection,null,!1,!0);var b=this.childNodes;
this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:b});for(var c=b.length;0<c--;){var d=b[c];d.parentNode=null;d.groupNode=null;a?(d.nextSibling=null,d.previousSibling=null,d.autoDelegate==s.PARENT&&d.setDelegate()):d.destroy()}if(this.grouping){b=this.grouping.childNodes;for(c=b.length-1;a=b[c];c--)a.clear()}}},setChildNodes:function(a,b){this.dataSource||this.clear(b);if(a&&(!1=="length"in a&&(a=[a]),a.length)){var c=this.event_childNodesModified;
this.event_childNodesModified=e;for(var d=0,f=a.length;d<f;d++)this.insertBefore(a[d]);this.event_childNodesModified=c;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||!this.childClass||!1==a instanceof A)a=null;if(this.dataSource!==a){var b=this.dataSource,c=this.listen.dataSource;b&&(this.dataSource=this.dataSourceMap_=null);this.firstChild&&this.clear();if(this.dataSource=a)this.dataSourceMap_={},c&&a.itemCount&&c.datasetChanged&&c.datasetChanged.call(this,
a,{inserted:a.getItems()});this.event_dataSourceChanged(this,b)}},setGrouping:function(a){if("function"==typeof a||"string"==typeof a)a={groupGetter:a};!1==a instanceof Q&&(a=a&&"object"==typeof a?new this.groupingClass(a):null);if(this.grouping!==a){var b=this.grouping,c;if(this.grouping){if(!a&&(this.grouping=null,this.firstChild)){c=this.sorting!==f?x(this):this.childNodes;for(var d=c.length;0<d--;)c[d].groupNode=null;z(this,c)}b.setOwner()}if(a&&(this.grouping=a,a.setOwner(this),this.firstChild)){c=
this.sorting!==f?x(this):this.childNodes;for(d=0;a=c[d];d++)a.groupNode=this.grouping.getGroupNode(a,!0);for(d=0;a=c[d];d++)a.groupNode.nodes.push(a);c.length=0;for(d=this.grouping.nullGroup;d;d=d.nextSibling)a=d.nodes,d.first=a[0]||null,d.last=a[a.length-1]||null,c.push.apply(c,a),d.event_childNodesModified(d,{inserted:a});z(this,c)}this.event_groupingChanged(this,b)}},setSorting:function(a,b){a=M(a);b=!!b;if(this.sorting!==a||this.sortingDesc!=!!b){var c=this.sorting,d=this.sortingDesc;this.sorting=
a;this.sortingDesc=!!b;if(a!==f&&this.firstChild){var e=[],g;for(g=this.firstChild;g;g=g.nextSibling)g.sortingValue=a(g)||0;if(this.grouping)for(var m=this.grouping.nullGroup;m;m=m.nextSibling)g=m.nodes=x({childNodes:m.nodes,sortingDesc:this.sortingDesc}),m.first=g[0]||null,m.last=g[g.length-1]||null,e.push.apply(e,g);else e=x(this);z(this,e)}this.event_sortingChanged(this,c,d)}},setMatchFunction:function(a){if(this.matchFunction!=a){var b=this.matchFunction;this.matchFunction=a;for(var c=this.lastChild;c;c=
c.previousSibling)c.match(a);this.event_matchFunctionChanged(this,b)}}},p=j(m,S,{event_enable:l("enable","node"),event_disable:l("disable","node"),event_select:l("select","node"),event_unselect:l("unselect","node"),event_match:l("match","node"),event_unmatch:l("unmatch","node"),event_matchFunctionChanged:l("matchFunctionChanged","node","oldMatchFunction"),selectable:!0,selected:!1,selection:null,contextSelection:null,matchFunction:null,matched:!0,disabled:!1,init:function(a){this.selection&&!1==this.selection instanceof
A&&(this.selection=new O(this.selection));m.prototype.init.call(this,a);this.disabled&&this.event_disable(this);this.selected&&(this.selected=!1,this.select(!0))},setSelection:function(a){if(this.selection!==a)return n(this,this.selection||this.contextSelection,a||this.contextSelection,!1,!0),this.selection=a,!0},hasOwnSelection:function(){return!!this.selection},select:function(a){var b=this.selected,c=this.contextSelection;c?a?b?c.remove([this]):c.add([this]):this.selectable&&c.set([this]):!b&&
this.selectable&&(this.selected=!0,this.event_select(this));return this.selected!=b},unselect:function(){var a=this.selected;if(a){var b=this.contextSelection;b?b.remove([this]):(this.selected=!1,this.event_unselect(this))}return this.selected!=a},enable:function(){this.disabled&&(this.disabled=!1,this.event_enable(this))},disable:function(){this.disabled||(this.disabled=!0,this.event_disable(this))},isDisabled:function(){return this.disabled||!!h.findAncestor(this,M("disabled"))},match:function(a){"function"!=
typeof a&&(a=null);this.underMatch_&&!a&&this.underMatch_(this,!0);this.underMatch_=a;a=!a||a(this);this.matched!=a&&((this.matched=a)?this.event_match(this):this.event_unmatch(this))},destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),this.selection=null);this.unselect();m.prototype.destroy.call(this)}}),Q=j(m,S,{event_childNodesModified:function(a,b){q.childNodesModified.call(this,a,b);this.nullGroup.nextSibling=this.firstChild;var c;if(c=b.inserted){for(var d=0,e;e=c[d++];)e.groupId_=
e.delegate?e.delegate.eventObjectId:e.data.id,this.map_[e.groupId_]=e;if(this.dataSource&&this.nullGroup.first){c=this.owner;e=Array.from(this.nullGroup.nodes);for(d=e.length;0<d--;)c.insertBefore(e[d],e[d].nextSibling)}}},event_ownerChanged:function(a,b){b&&b.grouping===this&&b.setGrouping(null,!0);this.owner&&this.owner.grouping!==this&&this.owner.setGrouping(this);q.ownerChanged.call(this,a,b);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:!0,autoDestroyEmptyGroups:!0,
groupGetter:f,childClass:u,childFactory:function(a){return new this.childClass(t({autoDestroyIfEmpty:this.dataSource?!1:this.autoDestroyEmptyGroups},a))},init:function(a){this.map_={};this.nullGroup=new u;m.prototype.init.call(this,a)},getGroupNode:function(a,b){var c=this.groupGetter(a),d=c instanceof y,e=this.map_[d?c.eventObjectId:c];this.dataSource&&(b=!1);!e&&b&&(e=this.appendChild(d?c:{data:{id:c,title:c}}));return e||this.nullGroup},insertBefore:function(a,b){var a=S.insertBefore.call(this,
a,b),c=a.first;if(c){for(var d=c.parentNode,e=a.last,f,g,m,i=null,k=a;(k=k.nextSibling)&&!(i=k.first););m=i?i.previousSibling:d.lastChild;f=c.previousSibling;g=e.nextSibling;if(g!==i){var h=d.childNodes,k=a.nodes,j=k.length;f&&(f.nextSibling=g);g&&(g.previousSibling=f);m&&(m.nextSibling=c);i&&(i.previousSibling=e);c.previousSibling=m;e.nextSibling=i;var e=h.indexOf(c),s=i?h.indexOf(i):h.length;s>e&&(s-=j);h.splice(e,j);h.splice.apply(h,[s,0].concat(k));if(!m||!f)d.firstChild=h[0];if(!i||!g)d.lastChild=
h[h.length-1];if(c instanceof u)for(c=j;0<c--;)d.insertBefore(k[c],i)}}return a},removeChild:function(a){if(a=S.removeChild.call(this,a)){delete this.map_[a.groupId_];for(var b=0,c;c=a.nodes[b];b++)c.parentNode.insertBefore(c)}return a},clear:function(a){var b=[],c=this.getGroupNode,d=this.nullGroup;this.getGroupNode=function(){return d};for(var e=this.firstChild;e;e=e.nextSibling)b.push.apply(b,e.nodes);for(var e=0,f;f=b[e];e++)f.parentNode.insertBefore(f);this.getGroupNode=c;S.clear.call(this,a);
this.map_={}},destroy:function(){this.autoDestroyWithNoOwner=!1;m.prototype.destroy.call(this);this.nullGroup.destroy();this.map_=this.nullGroup=null}});m.prototype.groupingClass=Q;var l=j(A,{autoDestroy:!0,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,b){var c=this.memberMap_,d={},e,f=0,g=0,m=b.inserted,i=b.deleted;if(m&&m.length)for(d.inserted=m;e=m[f];)c[e.eventObjectId]=e,f++;if(i&&i.length)for(d.deleted=i;e=i[g];)delete c[e.eventObjectId],g++;(f||g)&&this.event_datasetChanged(this,
d)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:l("sourceNodeChanged")&&function(a,b){q.sourceNodeChanged.call(this,a,b);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:!1,init:function(a,b){A.prototype.init.call(this,b);a&&this.setSourceNode(a)},setSourceNode:function(a){!1==a instanceof m&&(a=null);if(a!==this.sourceNode){var b=this.sourceNode,c=this.listen.sourceNode;this.sourceNode=a;if(c){var d=c.childNodesModified;
b&&(b.removeHandler(c,this),d&&d.call(this,b,{deleted:b.childNodes}));a&&(a.addHandler(c,this),d&&d.call(this,a,{inserted:a.childNodes}))}this.event_sourceNodeChanged(this,b)}},destroy:function(){this.setSourceNode();A.prototype.destroy.call(this)}}),O=j(J,{multiple:!1,event_datasetChanged:function(a,b){J.prototype.event_datasetChanged.call(this,a,b);if(b.inserted)for(var c=0,d;d=b.inserted[c];c++)d.selected||(d.selected=!0,d.event_select(d));if(b.deleted)for(c=0;d=b.deleted[c];c++)d.selected&&(d.selected=
!1,d.event_unselect(d))},add:function(a){if(!this.multiple){if(this.itemCount)return this.set(a);a=[a[0]]}for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);return J.prototype.add.call(this,b)},set:function(a){for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);this.multiple||b.splice(1);return J.prototype.set.call(this,b)}});this.extend({DELEGATE:s,AbstractNode:m,Node:p,GroupingNode:Q,PartitionNode:u,ChildNodesDataset:l,Selection:O,nullSelection:new A})}.body()+
"//@ sourceURL="+i+"src/basis/dom/wrapper.js")).call(basis.namespace("basis.dom.wrapper"),basis.namespace("basis.dom.wrapper"),basis.namespace("basis.dom.wrapper").exports,this,i+"src/basis/dom/wrapper.js",i+"src/basis/dom/",basis,function(k){return basis.resource(i+"src/basis/dom/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function i(a,b){return x(b,!0).createRule(a)}function G(a,b){var c=a.match(/^([^{]+)\{(.*)\}\s*$/);if(c){for(var d=c[1].trim().split(/\s*,\s*/),
e=0;e<d.length;e++)this.addRule(d[e],c[2]||null,b++);return b-1}}function C(a,b){var c=q.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:b?"alternate ":"",url:a.quote('"')}));q.tag(null,"HEAD")[0].appendChild(c);c=c.sheet||c.styleSheet;try{c.cssRules||(c.cssRules=c.rules)}catch(d){}c.insertRule||(c.insertRule=G);c.deleteRule||(c.deleteRule=c.removeRule);return c}function x(b,c){b||(b="DefaultGenericStyleSheet");f[b]||c&&(f[b]=new a(C()));
return f[b]}function n(a,c,d,e){for(var e=e||{},c=c.qw(),f=0,g;g=c[f];f++)if("undefined"!=typeof b.style[g]){d&&(basis.platformFeature["css-"+a]=g);t[a]={key:g,getter:e[g]};break}}function z(a,b,c){var d;var f=b;d=(f=(d=t[f])?d.key:f.replace(/^-ms-/,"ms-").camelize())?{key:f,value:d&&d.getter?d.getter(c):c}:void 0;if(d){var g=d.key,i=!!A.test(c),f=a.style;if(i||f.getPropertyPriority&&f.getPropertyPriority(b)==J)if(c.replace(A,""),f.setProperty)i||f.removeProperty(g),f.setProperty(g,d.value,i?J:"");
else{a=g+": "+d.value+(i?" !"+J:"")+";";b=f[g]?g+"\\s*:\\s*"+f[g]+"(\\s*!"+J+")?\\s*;?":"^";try{f.cssText=f.cssText.replace(RegExp(b,"i"),a)}catch(k){}}else{if(e)try{a.style[d.key]=d.value}catch(h){}else a.style[d.key]=d.value;return a.style[d.key]}}}function v(a,b){for(var c in b)z(a,c,b[c]);return a}function p(a,b){return z(a,"display","string"==typeof b?b:b?"":"none")}function j(a,b){return z(a,"visibility",b?"":"hidden")}function h(a){return s[a]||(s[a]=RegExp("\\s*\\b"+a+"\\b"))}function w(a,
b){var c=(b?"g":"s")+a;return E[c]||(E[c]=RegExp((b?"":"\\s*")+"\\b"+a+"\\S*\\b"))}var l=global.document,q=basis.dom,H=basis.dom.event,o=basis.Class,y=global.DOMTokenList&&l&&l.documentElement.classList instanceof global.DOMTokenList,A=/\s*!important/i,J="important",M=1,f={},e=function(){var a=q.createElement();try{a.style.width="badvalue"}catch(b){return!0}return!1}(),t={},b=q.createElement("DIV");n("opacity","opacity MozOpacity KhtmlOpacity filter",!0,{fitler:function(a){return"alpha(opacity:"+
parseInt(a*100)+")"}});n("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",!0);n("float","cssFloat styleFloat");var a=o(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[]},createRule:function(a){var b=this.styleSheet,e=this.rules.length;b.insertRule(a+"{}",e);a=Array.from(b.cssRules,e);a=a[1]?new d(a,this):new c(a[0],this);this.rules.push.apply(this.rules,a.rules||[a]);return a},deleteRule:function(a){if(a instanceof d)a.rules.forEach(this.deleteRule,
this);else{var b=this.rules.indexOf(a);-1!=b&&(this.rules.splice(b,1),this.styleSheet.deleteRule(b))}a.owner=null;a.destroy()},destroy:function(){this.rules.forEach(function(a){a.destroy()});this.rules=this.styleSheet=null}}),c=o(null,{rule:null,selector:"",init:function(a,b){this.owner=b;this.rule=a;this.selector=a.selectorText},setProperty:function(a,b){z(this.rule,a,b)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){this.owner&&
this.owner.deleteRule(this);this.rule=this.owner=null}}),d=o(null,{rules:null,init:function(a,b){this.owner=b;this.rules=a.map(function(){return new c(rule,this)},this)},createRule:function(a){a=this.owner.createRule(a);this.rules.push(a);a.owner=this;return a},deleteRule:function(a){var b=this.rules.indexOf(a);-1!=b&&(this.rules.splice(b,1),this.owner.deleteRule(a))},destroy:function(){this.owner&&this.owner.deleteRule(this);this.rules=this.owner=null}});["setProperty","setStyle","clear"].forEach(function(a){d.prototype[a]=
function(){for(var b,c=0;b=this.rules[c];c++)b[a].apply(b,arguments)}});var g={};["em","ex","px","%"].forEach(function(a){g["%"==a?"percent":a]=function(b){return 0==b||isNaN(b)?"0":b+a}});var N,s={},B=o(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,b,c){c=c||"";"undefined"!=typeof a&&this.remove(c+a);"undefined"!=typeof b&&this.add(c+b)},bool:function(a,b){b?this.add(a):this.remove(a)},
clear:function(){this.element.className=""},contains:function(a){return!!this.element.className.match(h(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(h(a))||(this.element.className+=" "+a)},remove:function(a){var b=this.element.className,a=b.replace(h(a),"");a!=b&&(this.element.className=a)},toggle:function(a){var b=this.contains(a);b?this.remove(a):this.add(a);return!b}}),E={},R=o(null,{delim:"-",init:function(a,b){this.classList=b;this.prefix=
a+this.delim},add:function(a){this.classList.add(this.prefix+a)},remove:function(a){this.classList.remove(this.prefix+a)},items:function(){var a=this.classList.toString();if(a)return a.toString().match(w(this.prefix,!0))},set:function(a){var b=this.items(),a="undefined"!=typeof a?this.prefix+a:"",c=this.classList;if(b)if(1==b.length){if(b[0]===a)return;c.remove(b[0])}else this.clear();a&&c.add(a)},clear:function(){this.items().forEach(this.classList.remove,this.classList)}});y?(o=B.prototype,Object.extend(global.DOMTokenList.prototype,
{set:o.set,replace:o.replace,bool:o.bool,clear:function(){for(var a=this.length;0<a--;)this.remove(this[a])},setPrefixToken:o.setPrefixToken}),N=function(a){return("string"==typeof a?q.get(a):a).classList}):N=function(a){return new B("string"==typeof a?q.get(a):a)};H.onLoad(function(){N(l.body).bool("opacity-not-support",!basis.platformFeature["css-opacity"])});this.extend({setStyleProperty:z,setStyle:v,classList:function(a,b){return b?new R(b,N(a)):N(a)},uniqueRule:function(a){var b="genericRule-"+
M++;a&&N(a).add(b);a=i("."+b);a.token=b;return a},createRule:i,getStyleSheet:x,addStyleSheet:C,StyleSheet:a,Rule:c,RuleSet:d}).extend(g);basis.namespace("basis.dom").extend({setStyleProperty:z,setStyle:v,display:p,show:function(a){return p(a,1)},hide:function(a){return p(a)},visibility:j,visible:function(a){return j(a,1)},invisible:function(a){return j(a)}})}.body()+"//@ sourceURL="+i+"src/basis/cssom.js")).call(basis.namespace("basis.cssom"),basis.namespace("basis.cssom"),basis.namespace("basis.cssom").exports,
this,i+"src/basis/cssom.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function i(b,a){var c={},d;b&&b.length&&(d=c.inserted=b);a&&a.length&&(d=c.deleted=a);if(d)return c}function G(b,a){if(!b.length)return 0;var c,d=a.object.eventObjectId,e=a.value||0,f,i,h=0,k=b.length-1;do if(c=h+k>>1,i=b[c],f=i.value,f===e)if(i=i.object.eventObjectId,d<i)k=c-1;else if(d>i)h=c+1;else return d==
i?c:0;else if(e<f)k=c-1;else if(e>f)h=c+1;else return e==f?c:0;while(h<=k);return c+(f<e)}function C(b,a){return+(b.value>a.value)||-(b.value<a.value)||b.object.eventObjectId-a.object.eventObjectId}var x=basis.Class,n=x.oneFunctionProperty,z=Object.extend,v=Object.values,p=Function.$self,j=Function.$true,h=Function.$false,w=basis.event.create,l=basis.data.SUBSCRIPTION,q=basis.data.DataObject,H=basis.data.KeyObjectMap,o=basis.data.AbstractDataset,y=basis.data.Dataset;l.add("SOURCE",{sourceChanged:function(b,
a){this.remove(b,a);this.add(b,b.source)},sourcesChanged:function(b,a){var c;if(c=a.inserted)for(var d=c.length;0<d--;)this.add(b,c[d]);if(c=a.deleted)for(d=c.length;0<d--;)this.remove(b,c[d])}},function(b,a){for(var c=a.sources||[a.source],d=0,e;e=c[d++];)b(a,e)});l.add("MINUEND",{operandsChanged:function(b,a){this.minuend!==a&&(this.remove(b,a),this.add(b,b.minuend))}},function(b,a){b(a,a.minuend)});l.add("SUBTRAHEND",{operandsChanged:function(b,a,c){this.subtrahend!==c&&(this.remove(b,c),this.add(b,
b.subtrahend))}},function(b,a){b(a,a.subtrahend)});var A=x(o,{subscribeTo:l.SOURCE,event_sourcesChanged:w("sourcesChanged","dataset","delta"),sources:null,rule:function(b){return 0<b},listen:{source:{datasetChanged:function(b,a){var c=this.memberMap_,d={},e,f;if(a.inserted)for(var i=0;e=a.inserted[i];i++)f=e.eventObjectId,c[f]?c[f].count++:c[f]={count:1,object:e},d[f]=c[f];if(a.deleted)for(i=0;e=a.deleted[i];i++)f=e.eventObjectId,d[f]=c[f],c[f].count--;this.applyRule(d)},destroy:function(b){this.removeSource(b)}}},
init:function(b){o.prototype.init.call(this,b);b=this.sources;this.sources=[];b&&b.forEach(this.addSource,this)},setRule:function(b){"function"!=typeof b&&(b=A.UNION);this.rule!==b&&(this.rule=b,this.applyRule())},applyRule:function(b){var a=this.memberMap_,c=this.rule,d=this.sources.length,e=[],f=[],h,j,l;b||(b=a);for(var n in b)h=a[n],j=d&&h.count&&c(h.count,d),j!=!!this.item_[n]&&(j?e:f).push(h.object),0==h.count&&delete a[n];(l=i(e,f))&&this.event_datasetChanged(this,l);return l},addSource:function(b){if(b instanceof
o&&this.sources.add(b)){this.listen.source&&b.addHandler(this.listen.source,this);var a=this.memberMap_,c;for(c in b.item_)a[c]?a[c].count++:a[c]={count:1,object:b.item_[c]};this.applyRule();this.event_sourcesChanged(this,{inserted:[b]});return!0}},removeSource:function(b){if(this.sources.remove(b)){this.listen.source&&b.removeHandler(this.listen.source,this);var a=this.memberMap_,c;for(c in b.item_)a[c].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[b]});return!0}},setSources:function(b){for(var a=
Array.from(this.sources),c=0,d;d=b[c];c++)d instanceof o&&(a.remove(d)||this.addSource(d));a.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){o.prototype.destroy.call(this);this.sources=null}});A.UNION=A.prototype.rule;A.INTERSECTION=function(b,a){return b==a};A.DIFFERENCE=function(b){return 1==b};A.MORE_THAN_ONE_INCLUDE=function(b,a){return 1==a||1<b};A.AT_LEAST_ONE_EXCLUDE=function(b,a){return 1==a||b<a};var J=function(b){return!this.has(b)},
M=x(o,{subscribeTo:l.MINUEND+l.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:w("operandsChanged","dataset","oldMinuend","oldSubtrahend"),listen:{minuend:{datasetChanged:function(b,a){if(this.subtrahend){var c=i(a.inserted&&a.inserted.filter(J,this.subtrahend),a.deleted&&a.deleted.filter(this.has,this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(b,a){if(this.minuend){var c=i(a.deleted&&a.deleted.filter(J,
this),a.inserted&&a.inserted.filter(this.has,this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(b){o.prototype.init.call(this,b);var b=this.minuend,a=this.subtrahend;this.subtrahend=this.minuend=null;(b||a)&&this.setOperands(b,a)},setOperands:function(b,a){var c,d=!1;!1==b instanceof o&&(b=null);!1==a instanceof o&&(a=null);var e=this.minuend,f=this.subtrahend;if(e!==b){d=!0;this.minuend=b;var h=this.listen.minuend;h&&(e&&e.removeHandler(h,
this),b&&b.addHandler(h,this))}if(f!==a&&(d=!0,this.subtrahend=a,h=this.listen.subtrahend))f&&f.removeHandler(h,this),a&&a.addHandler(h,this);if(!d)return!1;this.event_operandsChanged(this,e,f);if(!b||!a)this.itemCount&&this.event_datasetChanged(this,c={deleted:this.getItems()});else{var d=[],e=[],j;for(j in this.item_)(!b.item_[j]||a.item_[j])&&d.push(this.item_[j]);for(j in b.item_)!this.item_[j]&&!a.item_[j]&&e.push(b.item_[j]);(c=i(e,d))&&this.event_datasetChanged(this,c)}return c},setMinuend:function(b){return this.setOperands(b,
this.subtrahend)},setSubtrahend:function(b){return this.setOperands(this.minuend,b)},clear:function(){this.setOperands()}}),f={subscribeTo:l.SOURCE,source:null,sourceMap_:null,event_sourceChanged:w("sourceChanged","dataset","oldSource"),listen:{source:{destroy:function(){this.setSource()}}},init:function(b){this.sourceMap_={};var a=this.source;a&&(this.source=null);o.prototype.init.call(this,b);a&&this.setSource(a)},setSource:function(b){!1==b instanceof o&&(b=null);if(this.source!==b){var a=this.source,
c=this.listen.source;this.source=b;if(c){var d=c.datasetChanged;a&&(a.removeHandler(c,this),d&&d.call(this,a,{deleted:a.getItems()}));b&&(b.addHandler(c,this),d&&d.call(this,b,{inserted:b.getItems()}))}this.event_sourceChanged(this,a)}},clear:function(){this.setSource()},destroy:function(){o.prototype.destroy.call(this);this.sourceMap_=null}},e=x(o,f,{map:p,reduce:h,rule:Function.getter(j),ruleEvents:n(function(b){var a=this.map?this.map(b):object;if(!1==a instanceof q||this.reduce(a))a=null;var c=
this.sourceMap_[b.eventObjectId],d=c.member;if(d!==a){var e=this.memberMap_,f,h,j;c.member=a;d&&(c=d.eventObjectId,this.removeMemberRef&&this.removeMemberRef(d,b),0==--e[c]&&(delete e[c],j=[d]));a&&(d=a.eventObjectId,this.addMemberRef&&this.addMemberRef(a,b),e[d]?e[d]++:(e[d]=1,h=[a]));(f=i(h,j))&&this.event_datasetChanged(this,f)}},{update:!0}),addMemberRef:null,removeMemberRef:null,listen:{source:{datasetChanged:function(b,a){var c=this.sourceMap_,d=this.memberMap_,e=[],f=[],h,j,l,n=this.ruleEvents;
y.setAccumulateState(!0);if(a.inserted)for(var m=0;h=a.inserted[m];m++){l=this.map?this.map(h):h;if(!1==l instanceof q||this.reduce(l))l=null;n&&h.addHandler(n,this);c[h.eventObjectId]={sourceObject:h,member:l};l&&(j=l.eventObjectId,d[j]?d[j]++:(d[j]=1,e.push(l)),this.addMemberRef&&this.addMemberRef(l,h))}if(a.deleted)for(m=0;h=a.deleted[m];m++)j=h.eventObjectId,l=c[j].member,n&&h.removeHandler(n,this),delete c[j],l&&(j=l.eventObjectId,0==--d[j]&&(delete d[j],f.push(l)),this.removeMemberRef&&this.removeMemberRef(l,
h));y.setAccumulateState(!1);(a=i(e,f))&&this.event_datasetChanged(this,a)}}},setMap:function(b){"function"!=typeof b&&(b=p);if(this.map!==b)return this.map=b,this.applyRule()},setReduce:function(b){"function"!=typeof b&&(b=h);if(this.reduce!==b)return this.reduce=b,this.applyRule()},setRule:function(b){"function"!=typeof b&&(b=j);if(this.rule!==b)return this.rule=b,this.applyRule()},applyRule:function(){var b=this.sourceMap_,a=this.memberMap_,c,d,e,f,h,j=[],l=[],n,m;for(m in b){h=b[m];f=h.sourceObject;
c=h.member;d=this.map?this.map(f):f;if(!1==d instanceof q||this.reduce(d))d=null;if(c!=d&&(h.member=d,c&&(e=c.eventObjectId,this.removeMemberRef&&this.removeMemberRef(c,f),a[e]--),d))c=d.eventObjectId,this.addMemberRef&&this.addMemberRef(d,f),c in a?a[c]++:(a[c]=1,j.push(d))}for(e in this.item_)0==a[e]&&(delete a[e],l.push(this.item_[e]));(n=i(j,l))&&this.event_datasetChanged(this,n);return n}}),l=x(e,{reduce:function(b){return!this.rule(b)}}),t=x(e,{subsetClass:o,keyMap:null,map:function(b){return this.keyMap.resolve(b)},
setRule:function(b){"function"!=typeof b&&(b=j);if(this.rule!==b)return this.rule=b,this.keyMap.keyGetter=b,this.applyRule()},addMemberRef:function(b,a){b.event_datasetChanged(b,{inserted:[a]})},removeMemberRef:function(b,a){b.event_datasetChanged(b,{deleted:[a]})},init:function(b){if(!this.keyMap||!1==this.keyMap instanceof H)this.keyMap=new H(z({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));e.prototype.init.call(this,b)},getSubset:function(b,a){return this.keyMap.get(b,a)},destroy:function(){e.prototype.destroy.call(this);
this.keyMap.destroy();this.keyMap=null}}),w=x(o,f,{rule:Function.getter(j),ruleEvents:n(function(b){var a=this.sourceMap_[b.eventObjectId],b=this.rule(b),c=this.index_;b!==a.value&&(c.splice(G(c,a),1),a.value=b,c.splice(G(c,a),0,a),this.applyRule())},{update:!0}),index_:null,orderDesc:!1,offset:0,limit:10,listen:{source:{datasetChanged:function(b,a){var c=this.sourceMap_,d=this.index_,e=this.ruleEvents,f=!1,i=!1,h,k=a.inserted,j=a.deleted;if(j){j.length>d.length-j.length&&(f=!0,i=j.length!=d.length,
d.length=0);for(var m=0,l;l=j[m];m++)f||(h=c[l.eventObjectId],d.splice(G(d,h),1)),delete c[l.eventObjectId],e&&l.removeHandler(e,this);if(i)for(var n in c)h=c[n],d.splice(G(d,h),0,h)}if(k){i=!d.length;for(m=0;l=k[m];m++)h={object:l,value:this.rule(l)},c[l.eventObjectId]=h,i?d.push(h):d.splice(G(d,h),0,h),e&&l.addHandler(e,this);i&&d.sort(C)}this.applyRule()}}},event_rangeChanged:w("rangeChanged","dataset","oldOffset","oldLimit"),init:function(b){this.index_=[];f.init.call(this,b)},setRange:function(b,
a){var c=this.offset,d=this.limit;if(c!=b||d!=a)this.offset=b,this.limit=a,this.applyRule(),this.event_rangeChanged(this,c,d)},setOffset:function(b){return this.setRange(b,this.limit)},setLimit:function(b){return this.setRange(this.offset,b)},applyRule:function(){var b=this.offset,a=b+this.limit;this.orderDesc&&(b=this.index_.length-a,a=b+this.limit);for(var c=Object.slice(this.item_),b=this.index_.slice(Math.max(0,b),Math.max(0,a)),a=[],d,e=0,f;f=b[e];e++){var h=f.object.eventObjectId;c[h]?delete c[h]:
a.push(f.object)}(d=i(a,v(c)))&&this.event_datasetChanged(this,d);return d},destroy:function(){f.destroy.call(this);this.index_=null}}),x=x(o,f,{subsetClass:o,rule:Function.getter(h),ruleEvents:n(function(b){var a=this.sourceMap_,c=this.memberMap_,d=b.eventObjectId,e=a[d].list,a=a[d].list={},d=this.rule(b),f,h=[],j=[],l;if(Array.isArray(d))for(var n=0;n<d.length;n++)if(l=this.keyMap.resolve(d[n]))m=l.eventObjectId,a[m]=l,e[m]||(l.event_datasetChanged(l,{inserted:[b]}),c[m]?c[m]++:(h.push(l),c[m]=
1));for(var m in e)a[m]||(l=e[m],l.event_datasetChanged(l,{deleted:[b]}),--c[m]||(delete c[m],j.push(l)));(f=i(h,j))&&this.event_datasetChanged(this,f)},{update:!0}),keyMap:null,map:p,listen:{source:{datasetChanged:function(b,a){var c=this.sourceMap_,d=this.memberMap_,e=this.ruleEvents,f,h,j,l=[],n=[];y.setAccumulateState(!0);if(f=a.inserted)for(var m=0,o;o=f[m];m++){var p=this.rule(o),q={object:o,list:{}};c[o.eventObjectId]=q;if(Array.isArray(p))for(var t=0;t<p.length;t++)if((h=this.keyMap.get(p[t],
!0))&&!h.has(o))j=h.eventObjectId,q.list[j]=h,h.event_datasetChanged(h,{inserted:[o]}),d[j]?d[j]++:(l.push(h),d[j]=1);e&&o.addHandler(e,this)}if(f=a.deleted)for(m=0;o=f[m];m++){h=o.eventObjectId;p=c[h].list;delete c[h];for(j in p)h=p[j],h.event_datasetChanged(h,{deleted:[o]}),--d[j]||(delete d[j],n.push(h));e&&o.removeHandler(e,this)}y.setAccumulateState(!1);(a=i(l,n))&&this.event_datasetChanged(this,a)}}},init:function(b){if(!this.keyMap||!1==this.keyMap instanceof H)this.keyMap=new H(z({keyGetter:this.map,
itemClass:this.subsetClass},this.keyMap));f.init.call(this,b)},getSubset:function(b,a){return this.keyMap.get(b,a)},destroy:function(){f.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});this.extend({Merge:A,Subtract:M,MapReduce:e,Subset:l,Split:t,Slice:w,Cloud:x})}.body()+"//@ sourceURL="+i+"src/basis/data/dataset.js")).call(basis.namespace("basis.data.dataset"),basis.namespace("basis.data.dataset"),basis.namespace("basis.data.dataset").exports,this,i+"src/basis/data/dataset.js",i+"src/basis/data/",
basis,function(k){return basis.resource(i+"src/basis/data/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){function i(b){a[b]=a[b]||0;return b+a[b]++}function G(){var a=Array.from(arguments),b=a.pop();"function"!=typeof b&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+
(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=!0;return b}function C(){return G.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;0<b--;){if(null==arguments[b])return null;a.push(arguments[b])}return a.join("-")}))}var x=basis.Class,n=basis.Cleaner,z=Object.extend,v=Function.$self,p=Function.getter,j=basis.event.EventObject,h=basis.event.create,w=basis.data,l=w.Dataset,q=w.dataset.Subset,
H=w.dataset.Split,o=w.DataObject,y=w.STATE,A={},J={string:1,number:1},M=[],f=function(a){return isNaN(a)?null:Number(a)},e=function(a){return isNaN(a)?null:Number(a)},t=function(a){return isNaN(a)?null:parseInt(a)},b=function(a){return null==a?null:""+a},a={},c=basis.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+
c;return e};n.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=b,!0},remove:function(a,b){if(this.index[a]===b)return delete this.index[a],!0},destroy:function(){this.index=null}}),w=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},d=function(a,b){return function(c){this.name||(this.name=i(b));a.prototype.init.call(this,c)}},g=function(a){return function(b,
c){l.setAccumulateState(!0);b=(b||[]).map(this.wrapper);l.setAccumulateState(!1);return a.prototype.sync.call(this,b,c)}},N=x(l,{wrapper:Function.$self,init:d(l,"EntitySet"),sync:g(l),set:w(l,"set"),add:w(l,"add"),remove:w(l,"remove"),destroy:function(){l.prototype.destroy.call(this);delete this.wrapper}}),s=x(N,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),B=x(q,{init:d(q,"EntityCollection"),sync:g(q)});B.sourceHandler=q.sourceHandler;var E=x(H,{subsetClass:s,
init:d(H,"EntityGrouping"),sync:g(H),getSubset:function(a,b){var c=H.prototype.getSubset.call(this,a,b);c&&(c.wrapper=this.wrapper);return c}}),R=function(a){if(this instanceof R){a||(a=v);var b=new m({entitySetClass:{name:"Set of {"+((a.entityType||a).name||"UnknownWrapper")+"}",wrapper:a}}),a=function(a,c){return null!=a?(c instanceof N||(c=b.createEntitySet()),c.set(a instanceof l?a.getItems():Array.from(a)),c):null};a.entitySetType=b;return a}},m=x(null,{entitySetClass:N,extendConstructor_:!0,
createEntitySet:function(){return new this.entitySetClass}}),u=function(a){if(this instanceof u){var b=function(a,b){if(null!=a){if(a===b||a.entityType===c)return a;var g,i=c.idField;if(J[typeof a]){if(!i)return;g=a;a={};a[i]=g}else if(c.compositeKey)g=c.compositeKey(a,a);else if(i)g=a[i];else if(f&&(b=c.singleton,!b))return c.singleton=new e(a);null!=g&&d&&(b=d.get(g,c.entityClass));b&&b.entityType===c?b.update(a):b=new e(a);return b}return c.singleton},c=new O(a||{},b),d=c.index__,e=c.entityClass,
f=c.isSingleton;z(b,{toString:function(){return this.typeName+"()"},entityType:c,type:b,typeName:c.name,index:d,reader:function(a){return c.reader(a)},get:function(a){return c.get(a)},addField:function(a,b){c.addField(a,b)},all:c.all,createCollection:function(a,d,e){var f=c.collection_[a];return!f&&d?c.collection_[a]=new B({wrapper:b,source:e||c.all,rule:d}):f},getCollection:function(a){return c.collection_[a]},createGrouping:function(a,d,e){var f=c.grouping_[a];return!f&&d?c.grouping_[a]=new E({wrapper:b,
source:e||c.all,rule:d}):f},getGrouping:function(a){return c.grouping_[a]},getSlot:function(a,b){return c.getSlot(a,b)}});return b}},S=p("singleton"),Q={};x(o,{});var O=x(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:!1,index__:null,slot_:null,init:function(a,b){this.name=a.name||i(this.name);this.index__=a.index;this.idFields={};M.push(this);this.isSingleton=a.isSingleton;this.wrapper=b;this.all=new s(Object.extend(a.all||{},{wrapper:b}));this.slot_={};a.extensible&&(this.extensible=
!0);this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(a.fields,this.addField,this);a.constrains&&a.constrains.forEach(function(a){this.addCalcField(null,a)},this);this.isSingleton&&(this.get=S);a.aliases&&Object.iterate(a.aliases,this.addAlias,this);this.collection_={};if(a.collections)for(var c in a.collections)this.collection_[c]=new B({name:c,wrapper:b,source:this.all,rule:a.collections[c]||Function.$true});this.grouping_={};if(a.groupings)for(c in a.groupings)this.grouping_[c]=
new E({name:c,wrapper:b,source:this.all,rule:a.groupings[c]||Function.$true});this.entityClass=I(this,this.all,this.index__,this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:b,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(J[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||null==a)return null;for(var c in a){var d=c in this.aliases?this.aliases[c]:"";d&&d in this.fields&&(b[d]=this.fields[d].reader?this.fields[d].reader(a[c]):
a[c])}return b},addAlias:function(a,b){b in this.fields&&!1==a in this.aliases&&(this.aliases[a]=b)},addField:function(a,d){if(!this.all.itemCount){this.aliases[a]=a;"function"==typeof d&&(d={type:d});"type"in d&&"function"!=typeof d.type&&(d.type=v);var g=d.type||v;[f,e,t,b].has(g)&&(d.id=!0);d.id&&((this.index__||(this.index__=new c(String)),this.idFields[a]=!0,this.idField||this.compositeKey)?(this.idField=null,this.compositeKey=C.apply(null,Object.keys(this.idFields))):this.idField=a);d.calc?
this.addCalcField(a,d.calc,void 0):this.fields[a]=g;this.defaults[a]="defValue"in d?d.defValue:g();this.getters["get_"+a]=function(){return this.data[a]};Q[a]||(Q[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){this.calcs||(this.calcs=[]);for(var d={args:b.args||[],wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=
g;break}if(f>e)return;this.idField&&a==this.idField&&(this.compositeKey=b);this.fields[a]=function(a,b){return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(null!=a)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&null!=a){if(J[typeof a])return a;if(a&&a.entityType===this)return a.__id__;a instanceof o&&(a=a.data);return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);
if(null!=b){var c=this.slot_[b];c||(J[typeof a]&&(c={},this.idField&&!this.compositeKey&&(c[this.idField]=a),a=c),c=this.slot_[b]=new o({delegate:this.get(b),data:a}));return c}}}),r=x(o,{init:j.prototype.init,event_rollbackUpdate:h("rollbackUpdate")}),I=function(a,b,c,d,e,f,g){function i(b,c,d){var e=!1,f=a.calcs,g=b.__id__,j=b.data;try{if(f)for(var l=0,m;m=f[l++];){var n=m.key;if(n){var o=j[n];j[n]=m.wrapper(c,j,j[n]);j[n]!==o&&(c[n]=o,e=!0)}else m.wrapper(c,j)}a.compositeKey?b.__id__=a.compositeKey(c,
j,b.__id__):k&&k in c&&(b.__id__=j[k]);b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(p){b.__id__=g;for(var q in c)b.data[q]=c[q];if(d)for(q in d)b.modified||(b.modified=d);e=!1}b.__id__!==g&&h(b,g,b.__id__);return e}function h(a,b,e){null!=b&&(c.remove(b,a),d[b]&&d[b].setDelegate());null!=e&&(c.add(e,a),d[e]&&d[e].setDelegate(a))}var k=a.idField;return x(r,g,{canHaveDelegate:!1,modified:null,isTarget:!0,extendConstructor_:!1,init:function(a){r.prototype.init.call(this);this.fieldHandlers_={};
this.data={};this.root=this;this.target=this;var c,d={},g;for(g in e)g in a?(d[g]=f[g],c=e[g](a[g])):c=f[g],c&&c!==this&&c instanceof j&&c.addHandler(Q[g],this)&&(this.fieldHandlers_[g]=!0),this.data[g]=c;i(this,d);b.event_datasetChanged(b,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,f){var g=e[b];if(!g){if(!a.extensible)return;g=v}var h,l=this.modified,c=g(c,this.data[b]),
g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{h={};if(b!=k)if(d)(l||(this.modified=l={}),!1===b in l)?(h.rollback={key:b,value:void 0},l[b]=g):l[b]===c&&(h.rollback={key:b,value:c},delete l[b],Object.keys(l).length||(this.modified=null));else if(l&&b in l)if(l[b]!==c){h.rollback={key:b,value:l[b]};l[b]=c;break a}else return!1;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(Q[b],this),this.fieldHandlers_[b]=!1);c&&c!==this&&c instanceof j&&c.addHandler(Q[b],
this)&&(this.fieldHandlers_[b]=!0);h.key=b;h.value=g;h.delta={};h.delta[b]=g}else!d&&l&&b in l&&(h={rollback:{key:b,value:l[b]}},delete l[b],Object.keys(l).length||(this.modified=null));if(!f&&h){var d=h.key,b=h.delta||{},m;h.rollback&&(m={},m[h.rollback.key]=h.rollback.value);i(this,b,m)&&(d=!0);d&&(this.event_update(this,b),h.delta=b);m&&this.event_rollbackUpdate(this,m)}return h||!1},update:function(a,b){if(a){var c,d={},e,f={},g,h;for(h in a)if(g=this.set(h,a[h],b,!0))if(g.key&&(c=!0,d[g.key]=
g.value),g.rollback)e=!0,f[g.rollback.key]=g.rollback.value;i(this,d,f)&&(c=!0);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:!1},reset:function(){this.update(f)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=y.PROCESSING){if(this.modified){var a=this.modified;this.modified=
null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(y.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.fieldHandlers_[a]&&this.data[a].removeHandler(Q[a],this);this.fieldHandlers_=A;null!=this.__id__&&h(this,this.__id__,null);o.prototype.destroy.call(this);b.event_datasetChanged(b,{deleted:[this]});this.data=A;this.modified=null}})};this.extend({isEntity:function(a){return a&&a instanceof I},NumericId:f,NumberId:e,IntId:t,StringId:b,Index:c,CalculateField:G,EntityType:u,
Entity:I,BaseEntity:r,EntitySetType:R,EntitySet:N,ReadOnlyEntitySet:s,Collection:B,Grouping:E})}.body()+"//@ sourceURL="+i+"src/basis/entity.js")).call(basis.namespace("basis.entity"),basis.namespace("basis.entity"),basis.namespace("basis.entity").exports,this,i+"src/basis/entity.js",i+"src/basis/",basis,function(k){return basis.resource(i+"src/basis/"+k)});(new Function("module, exports, global, __filename, __dirname, basis, resource",function(){}.body()+"//@ sourceURL="+i+"src/package/core.js")).call(basis.namespace("package.core"),
basis.namespace("package.core"),basis.namespace("package.core").exports,this,i+"src/package/core.js",i+"src/package/",basis,function(k){return basis.resource(i+"src/package/"+k)})})();
