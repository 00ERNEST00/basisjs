/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(l){function m(a,b){for(var c in b)a[c]=b[c];return a}function s(a,b){for(var c in b)c in a==false&&(a[c]=b[c]);return a}function z(a){return a==null||a==void 0}function t(a){return a}function A(a){var b={};a.names=function(a){return Object.slice(b,typeof a=="string"?a.qw():a)};a.extend=function(a){s(b,a);m(this,a);return this};return a}function w(a,b){for(var c=a.split("."),d=l,g,h,k;c.length;)if(g=c.shift(),h=(h?h+".":"")+g,d[g]||(d[g]=A((!c.length?b:null)||function(){},h),k&&(k.namespaces_[h]=
d[g])),d=d[g],!k&&(k=d,!k.namespaces_))k.namespaces_={};return o[a]=d}m(Object,{extend:m,complete:s,keys:function(a){var b=[],c;for(c in a)b.push(c);return b},values:function(a){var b=[],c;for(c in a)b.push(a[c]);return b},slice:function(a,b){var c={};if(!b)return m(c,a);for(var d=0,g;g=b[d++];)g in a&&(c[g]=a[g]);return c},splice:function(a,b){var c={};if(!b)return m(c,a);for(var d=0,g;g=b[d++];)g in a&&(c[g]=a[g],delete a[g]);return c},iterate:function(a,b,c){var d=[],g;for(g in a)d.push(b.call(c,
g,a[g]));return d},coalesce:function(){for(var a=arguments,b=0;b<a.length;b++)if(a[b]!=null)return a[b]}});var n=function(){},r=function(){var a=1,b={},c={};a++;return function(d,g){var h,k;if(!g){if(d.getter)return d.getter;if(typeof d=="function")return d}if(typeof d!="function")c[d]?h=c[d]:(h=new Function("object","return object != null ? object."+d+" : object"),h.path=d,h.getterIdx_=a++,c[d]=h);else if(h=d,!h.getterIdx_)h.getterIdx_=a++;k=h.getterIdx_;var e=b[k];if(e)if(typeof g=="undefined"){if(e.nmg)return e.nmg}else for(k=
0;k<e.length;k++){if(e[k].modificator===g)return e[k].getter}else e=b[k]=[];var j=true;switch(g&&typeof g){case "string":k=function(a){return g.format(h(a))};break;case "function":k=function(a){return g(h(a))};break;case "object":j=false;k=function(a){return g[h(a)]};break;default:k=h.path?h:function(a){return h(a)}}if(j&&(e.push({getter:k,modificator:g}),typeof g=="undefined"))e.nmg=k;return k.getter=k}}();m(Function,{$undefined:function(a){return a==void 0},$defined:function(a){return a!=void 0},
$isNull:z,$isNotNull:function(a){return a!=null&&a!=void 0},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:t,$const:function(a){return function(){return a}},$false:function(){return false},$true:function(){return true},$null:function(){return null},$undef:n,getter:r,def:function(a,b,c){c=c||z;return function(d){d=a(d);return c(d)?b:d}},wrapper:function(a){return function(b){var c={};c[a]=b;return c}},lazyInit:function(a,b){var c=0,d;return function(){c++||(d=a.apply(b||
this,arguments));return d}},lazyInitAndRun:function(a,b,c){var d=0,g;return function(){d++||(g=a.call(c||this));b.apply(g,arguments);return g}},runOnce:function(a,b){var c=0;return function(){if(!c++)return a.apply(b||this,arguments)}}});s(Function.prototype,{bind:function(a){var b=this,c=Array.from(arguments,1);return c.length?function(){return b.apply(a,c.concat.apply(c,arguments))}:function(){return b.apply(a,arguments)}}});s(Array,{isArray:function(a){return Object.prototype.toString.call(a)===
"[object Array]"}});m(Array,{from:function(a,b){if(a!=null){var c=a.length;if(typeof c=="undefined")return[a];b||(b=0);if(c-b>0){for(var d=[],g=0,h=b;h<c;)d[g++]=a[h++];return d}}return[]},create:function(a,b,c){for(var d=[],g=typeof b=="function",h=0;h<a;h++)d[h]=g?b.call(c,h,d):b;return d}});s(Array.prototype,{indexOf:function(a,b){b=parseInt(b)||0;if(b<0)return-1;for(;b<this.length;b++)if(this[b]===a)return b;return-1},lastIndexOf:function(a,b){for(var c=this.length,b=parseInt(b),b=isNaN(b)||b>=
c?c-1:(b+c)%c;b>=0;b--)if(this[b]===a)return b;return-1},forEach:function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)},every:function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&!a.call(b,this[c],c,this))return false;return true},some:function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&a.call(b,this[c],c,this))return true;return false},filter:function(a,b){for(var c=[],d=0,g=this.length;d<g;d++)d in this&&a.call(b,this[d],d,this)&&c.push(this[d]);
return c},map:function(a,b){for(var c=[],d=0,g=this.length;d<g;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c},reduce:function(a,b){var c=this.length,d=arguments.length;if(c==0&&d==1)throw new TypeError;var g,h=0;d>1&&(g=b,h=1);for(d=0;d<c;d++)d in this&&(g=h++?a.call(null,g,this[d],d,this):this[d]);return g}});m(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[a>=
0?a:this.length+a]},search:function(a,b,c){Array.lastSearchIndex=-1;for(var b=Function.getter(b||t),c=parseInt(c)||0,d=this.length;c<d;c++)if(b(this[c])===a)return this[Array.lastSearchIndex=c]},lastSearch:function(a,b,c){Array.lastSearchIndex=-1;for(var b=Function.getter(b||t),d=this.length,c=isNaN(c)||c==null?d:parseInt(c),d=c>d?d:c;d-- >0;)if(b(this[d])===a)return this[Array.lastSearchIndex=d]},binarySearchPos:function(a,b,c,d,g,h){if(!this.length)return d?-1:0;var b=Function.getter(b||t),c=!!c,
k,g=isNaN(g)?0:g,e=isNaN(h)?this.length-1:h;do if(h=g+e>>1,k=b(this[h]),c?a>k:a<k)e=h-1;else if(c?a<k:a>k)g=h+1;else return a==k?h:d?-1:0;while(g<=e);return d?-1:h+(k<a^c)},binarySearch:function(a,b){return this.binarySearchPos(a,b,false,true)},add:function(a){return this.indexOf(a)==-1&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return a!=-1&&!!this.splice(a,1)},has:function(a){return this.indexOf(a)!=-1},merge:function(a){return this.reduce(m,a||{})},sortAsObject:function(a,b,c){a=Function.getter(a);
c=c?-1:1;return this.map(function(b,c){return{i:c,v:a(b)}}).sort(b||function(a,b){return c*(a.v>b.v||-(a.v<b.v)||(a.i>b.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){if(this!==a)this.length=0,this.push.apply(this,a);return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var v=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);if(a.length<2)a[1]=this.length;return v.apply(this,a)}}var i={"<":">","[":"]","(":")",
"{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};s(String,{toLowerCase:function(a){return String(a).toLowerCase()},toUpperCase:function(a){return String(a).toUpperCase()},trim:function(a){return String(a).trim()},trimLeft:function(a){return String(a).trimLeft()},trimRight:function(a){return String(a).trimRight()},isEmpty:function(a){return a==
null||String(a)==""},isNotEmpty:function(a){return a!=null&&String(a)!=""}});s(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});m(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(b){if(a)throw b;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],b=this.length,c=0;c<b;c++)a[c]=this.charAt(c);return a},
repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(a){for(var b={},c=0;c<arguments.length;c++)b[c]=arguments[c];typeof a=="object"&&m(b,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(a,c,h,k,e){a=c in b?b[c]:e?"":a;return h&&!isNaN(a)?(a=Number(a),h=="."?a.toFixed(k):a.lead(k)):a})},quote:function(a,
b){var a=a||'"',b=b||i[a]||a,c=(a.length==1?a:"")+(b.length==1?b:"");return a+(c?this.replace(RegExp("["+c.forRegExp()+"]","g"),"\\$&"):this)+b},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=
11)String.prototype.split=function(a){if(a==""||a&&a.source=="")return this.toArray();var b=[],c=0,d;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));d=a.exec(this);)d[0]=this.substring(c,d.index),b.push.apply(b,d),c=a.lastIndex;else for(;(d=this.indexOf(a,c))!=-1;)b.push(this.substring(c,d)),c=d+a.length;b.push(this.substr(c));return b};if("12".substr(-1)!="2"){var q=String.prototype.substr;String.prototype.substr=function(a,b){return q.call(this,a<0?Math.max(0,
this.length+a):a,b)}}m(Number.prototype,{fit:function(a,b){return!isNaN(a)&&this<a?Number(a):!isNaN(b)&&this>b?Number(b):this},between:function(a,b){return!isNaN(this)&&this>=a&&this<=b},quote:function(a,b){return(this+"").quote(a,b)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},lead:function(a,b){return(this+"").replace(/\d+/,function(c){return(a-=c.length-1)>1?Array(a).join(b||
0)+c:c})},group:function(a,b){return(this+"").replace(/\d+/,function(c){return c.replace(/\d/g,function(d,g){return!g+(c.length-g)%(a||3)?d:(b||" ")+d})})},format:function(a,b,c,d,g){a=this.toFixed(a);if(b||g)a=a.replace(/(\d+)(\.?)/,function(a,c,d){return(b?Number(c).group(3,b):c)+(d?g||d:"")});c&&(a=a.replace(/^-?/,"$&"+(c||"")));return a+(d||"")}});s(Date,{now:function(){return+new Date}});(new Date).getYear()<1900&&m(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&
a<100?Number(a)+1900:a)}});var o={},y=function(){function a(a,b){for(var c=o[a],j=b?b.split(/\./):[];c&&j.length;)c=c[j.shift()];return c}var b=l.document?l.document.getElementsByTagName("SCRIPT"):null,c=(b?b[b.length-1].src:module.filename).replace(/[^\/]+$/,""),d={},g;typeof require=="function"?g=function(a){return require(requirePath+a.replace(/\./g,"/"))}:(g=function(b,e){var f=b.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],j=b.substr(f.length?f.length+1:0),D=a(f,j),B=/^basis\./.test(f)?
c:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!o[f]||!D)if(/^https?:/.test(B))if(d[b])throw"Attempt to load namespace, probably cycle require";else{d[b]=1;var B=B+(e||"")+b.replace(/\./g,"/")+".js",F=new XMLHttpRequest;F.open("POST",B,false);F.send(null);if(F.status==200){try{(new Function(F.responseText)).call(l)}catch(i){throw i;}g.sequence.push(b.replace(/\./g,"/")+".js")}else if(F.status==404&&j)y(f);else throw"!";}else throw"Path `"+b+"` can't be resolved";return D||
a(f,j)},g.sequence=[]);return g}(),u=function(){function a(a){return typeof a=="function"&&a.basisClass_}var b=Function(),c=1,d={},g=function(){for(var a in{toString:1})return;return true}();m(b,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=n}},create:function(g){typeof g!="function"&&(g=b);var j=Function();j.prototype=
g.prototype;for(var j=new j,h={className:g.className+"._SubClass_",basisClass_:true,superClass_:g,extendConstructor_:!!g.extendConstructor_,__extend__:function(x){return x&&(typeof x=="object"||typeof x=="function"&&!a(x))&&x!==d?b.create.call(null,i,x):x},extend:b.extend,subclass:function(){return b.create.apply(null,[i].concat(Array.from(arguments)))},prototype:j},e=arguments,k=1;k<e.length;k++)h.extend(typeof e[k]=="function"&&!a(e[k])?e[k](g.prototype):e[k]);var f={},i=h.extendConstructor_?function(a,
b){this.eventObjectId=c++;var x,j;for(j in a)x=this[j],this[j]=x&&x.__extend__?x.__extend__(a[j]):a[j];this.init(b||f)}:function(){this.eventObjectId=c++;this.init.apply(this,arguments)};j.constructor=i;for(var x in j)j[x]===d&&(j[x]=i);m(i,h);return i},extend:function(a){var b=this.prototype;if(a.prototype)a=a.prototype;for(var c in a){var d=a[c],h=b[c];c=="className"||c=="extendConstructor_"?this[c]=d:b[c]=h&&h.__extend__?h.__extend__(d):d}if(g&&a[c="toString"]!==Object.prototype[c])b[c]=a[c];return this}});
var h=function(a,b){return{__extend__:function(a){var c=Function();c.prototype=this;c=new c;b(c,a);return c}}.__extend__(a)},e=function(a){return h(a,m)};return w("basis.Class",b.create).extend({SELF:d,BaseClass:b,create:b.create,isClass:a,CustomExtendProperty:h,ExtensibleProperty:e,NestedExtProperty:function(a){return h(a,function(a,b){for(var c in b){var d=a[c];a[c]=d&&d.__extend__?d.__extend__(b[c]):e(b[c])}})}})}(),p=function(){function a(a){var d=c[a];d||(d=c[a]=function(){var c=this.handlers_,
j,d;if(c&&c.length)for(var c=b.call(c),g=c.length;g-- >0;)j=c[g],d=j.handler[a],typeof d=="function"&&d.apply(j.thisObject,arguments)});return d}var b=Array.prototype.slice,c={},d,g=u(null,{handlers_:null,event_destroy:d=a("destroy","object"),listen:u.NestedExtProperty(),extendConstructor_:true,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(a,b){var c=this.handlers_;if(!c)c=this.handlers_=
[];b||(b=this);for(var j=c.length,d;j-- >0;)if(d=c[j],d.handler===a&&d.thisObject===b)return false;return!!c.push({handler:a,thisObject:b||this})},removeHandler:function(a,b){var c=this.handlers_;if(c){b||(b=this);for(var d=c.length,g;d-- >0;)if(g=c[d],g.handler===a&&g.thisObject===b)return!!c.splice(d,1);return false}},destroy:function(){if(this.handlers_)d.call(this,this),this.handlers_=null}});g.createEvent=a;g.event=c;return g}(),e=function(){var a=[];return{add:function(b){b!=null&&a.push(b)},
remove:function(b){a.remove(b)}}}();(function(){function a(a){if(b){if(a.source!=l||a.data!=c)return;basis.dom.event.kill(a)}d.length&&(a=d.shift(),delete g[a.key],a.fn())}var b=typeof addEventListener=="function"&&typeof postMessage=="function",c="zeroTimeoutMessage",d=[],g={},e=1;b&&l.addEventListener("message",a,true);var k=setTimeout;l.setTimeout=function(j,f){var B;f?B=k.call(l,j,f):(B={key:"z"+e++,fn:typeof j=="function"?j:new Function(j)},g[B.key]=B,d.push(B),b?postMessage(c,"*"):B.timer=k.call(l,
a,0),B=B.key);return B};var f=clearTimeout;l.clearTimeout=function(a){if(/z\d+/.test(a)){var b=g[a];b&&(clearTimeout(b.timer),d.remove(b),delete g[a])}else return f.call(l,a)}})();var f=function(){function a(){if(!D)if(h.length){var a=Date.now(),b=Math.max(h[0].eventTime,a);b<E&&(clearTimeout(j),j=setTimeout(c,(E=b)-a))}else j=clearTimeout(j),E=d}function b(b,c){var d=b.eventObjectId,j=f[c]&&f[c][d];j&&(h.remove(j),delete f[c][d],a())}function c(){var b=Date.now(),b=h.binarySearchPos(b+15,g);D=true;
h.splice(0,b).forEach(function(a){delete f[a.eventName][a.object.eventObjectId];a.callback.call(a.object)});D=false;E=d;a()}var d=2E12,g=r("eventTime"),h=[],f={},E=d,j=null,D=false;e.add({destroy:function(){D=true;clearTimeout(j);h.length=0;f=null}});return{add:function(c,d,j){var e=c.eventObjectId,x=f[d];x||(x=f[d]={});var C=x[e];if(C){if(isNaN(j))return b(c,d);if(C.eventTime==j)return;h.remove(C);C.eventTime=j}else{if(isNaN(j))return;C=x[e]={eventName:d,object:c,eventTime:j,callback:c[d]}}h.splice(h.binarySearchPos(j,
g),0,C);a()},remove:b}}();w("basis").extend({namespace:w,platformFeature:{},EventObject:p,TimeEventManager:f,Cleaner:e,require:y});l.basis.locale={}})(this);
(function(l,m){function s(i){for(var e=1E6,i=String(i).split("."),f=0,a=0;f<4&&f<i.length;f++,e/=100)a+=i[f]*e;return a}function z(){for(var i=0;i<arguments.length;i++){var e=arguments[i].toLowerCase();if(e in A){if(A[e])return true}else{var f=e.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(f){A[e]=false;var a=f[1].toLowerCase(),b=s(f[3]),f=f[4]||"=";if(a=w[a])return A[e]=!b||f=="="&&a==b||f=="+"&&a>=b||f=="-"&&a<b}}}return false}var t="basis.ua",A={},w={},n=m.navigator&&m.navigator.userAgent,r="unknown",
v={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},i;for(i in v)if(!(i=="MSIE"&&m.opera)&&!(i=="Safari"&&n.match(/chrome/i))&&!(i=="AppleWebKit"&&n.match(/iphone/i))&&n.match(RegExp(i+".(\\d+(\\.\\d+)*)","i")))for(var q=
v[i],o=m.opera&&typeof m.opera.version=="function"?m.opera.version():RegExp.$1,y=s(o),r=q[0]+" "+o,o=0;o<q.length;o++)w[q[o].toLowerCase()]=y;l.platformFeature.datauri=false;n=typeof Image!="undefined"?new Image:{};n.onload=function(){l.platformFeature.datauri=true};n.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";if(z("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(u){}t=l.namespace(t);t.toString=function(){return r};return t.extend({testImage:n,
prettyName:r,test:z,is:function(i){return z(i)},Cookies:{set:function(i,e,f,a){document.cookie=i+"="+(e==null?"":escape(e))+";path="+(a||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)+(f?";expires="+(new Date(Date.now()+f*1E3)).toGMTString():"")},get:function(i){return(i=document.cookie.match(RegExp("(^|;)\\s*"+i+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(i[2])},remove:function(i,e){document.cookie=i+"=;expires="+(new Date(0)).toGMTString()+";path="+(e||(location.pathname.indexOf("/")==
0?"":"/")+location.pathname)}}})})(basis,this);
(function(l,m){function s(a,b,d){if(b!=null)return a.insertBefore(c(b)?b:w(b),d||null)}function z(a){return r("",a.cloneNode(true)).innerHTML}function t(a){return c(a)||a&&a.nodeType?a:typeof a=="string"?o.getElementById(a):null}function A(b,c,g){var h,k=[],g=typeof g=="string"?getter(g):g||Function.$true;c&26&&g(b)&&k.push(b);switch(c){case 1:case 2:for(h=b;(h=h[p])&&h!==b.document;)g(h)&&k.push(h);break;case 64:for(h=b[e];h;)g(h)&&k.push(h),h=h[f];break;case 4:case 8:b[e]&&(c=new d(b),c.nodes(g,
k));break;case 128:c=new d(b,g);for(c.cursor_=b[f]||b[p];h=c.next();)k.push(h);break;case 256:for(h=b;h=h[f];)g(h)&&k.push(h);break;case 32:g(b[p])&&k.push(b[p]);break;case 512:c=new d(b,g,d.BACKWARD);for(c.cursor_=b[a]||b[p];h=c.next();)k.push(h);break;case 1024:for(h=b;h=h[a];)g(h)&&k.push(h)}return k}function w(a){return o.createTextNode(a!=null?a:"")}function n(){for(var a=o.createDocumentFragment(),b=arguments.length,c=n.array=[],d=0;d<b;d++)c.push(s(a,arguments[d]));return a}function r(a,b){var c=
a!=void 0&&typeof a!="string",d=(c?a.description:a)||"",g="div",e=d.match(/^([a-z0-9\_\-]+)(.*)$/i);e&&(g=e[1],d=e[2]);if(d!=""){for(var x=[],C={},L;e=E.exec(d);){if(e[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+d+"\n\nProblem place:\n> "+d.substr(0,e.index)+"--\>"+d.substr(e.index)+"<--");L=e[1]||e[2]||e[3];e[1]?C.id=L:e[2]?x.push(L):L!="class"&&(C[L]=e[4]?q(e[5],e[6],e[7]):L)}h&&C.name&&/^(input|textarea|select)$/i.test(g)&&(g="<"+g+" name="+C.name+">")}d=
o.createElement(g);if(C){if(C.style&&k)d.style.cssText=C.style;for(var f in C)d.setAttribute(f,C[f],0)}if(x&&x.length)d.className=x.join(" ");arguments.length>1&&s(d,n.apply(0,Array.from(arguments,1).flatten()));if(c&&(a.css&&l.cssom&&l.cssom.setStyle(d,a.css),l.dom.event))for(var K in a)typeof a[K]=="function"?l.dom.event.addHandler(d,K,a[K],d):a[K]instanceof l.dom.event.Handler&&l.dom.event.addHandler(d,K,a[K].handler,a[K].thisObject);return d}function v(a,b){return a[p]?a[p].replaceChild(b,a):
a}function i(a){if(o.selection){var b=o.selection.createRange();b.compareEndPoints("StartToEnd",b)!=0&&b.collapse(a);return b.getBookmark().charCodeAt(2)-2}}var q=Object.coalesce,o=m.document,y=l.Class,u=o.createElement("div"),p="parentNode",e="firstChild",f="nextSibling",a="previousSibling",b;b=typeof u.compareDocumentPosition=="function"?function(a,b){return a.compareDocumentPosition(b)}:function(a,b){return a==b?0:a.document!=b.document?33:a.sourceIndex>b.sourceIndex?2|8*b.contains(childA):4|16*
a.contains(childB)};var c;if(typeof Node!="undefined"){if(c=function(a){return a instanceof Node},!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else c=function(a){return a&&a.ownerDocument===o};var d=y(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,b,c){this.setRoot(a);this.setDirection(c);if(typeof b=="function")this.filter=b},setDirection:function(b){Object.extend(this,b?{a:"lastChild",b:a,c:f,d:e}:{a:e,b:f,c:a,d:"lastChild"})},
setRoot:function(a){this.root_=a||o;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,b){var c;b||(b=[]);for(this.reset();c=this.next(a);)b.push(c);return b},next:function(a){var a=a||this.filter,b=this.cursor_||this.root_;do for(var c=b[this.a];!c;){if(b===this.root_)return this.cursor_=null;(c=b[this.b])||(b=b[p])}while(!a(b=c));return this.cursor_=b},prev:function(a){var a=a||
this.filter,b=this.cursor_,c=this.c,d=this.d;do{var g=b?b[c]:this.root_[d];if(g){for(;g[d];)g=g[d];b=g}else b&&(b=b[p]);if(!b||b===this.root_){b=null;break}}while(!a(b));return this.cursor_=b},destroy:function(){this.cursor_=this.root_=null}});d.BACKWARD=true;var g="textContent innerText nodeValue".qw(),h=function(){var a=o.createElement("input");a.name="a";return!/name/.test(z(a))}(),k;u.setAttribute("style","color: red");k=u.style.color!=="red";var E=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return l.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:d,outerHTML:z,textContent:function(a){for(var b=0,c;c=g[b++];)if(a[c]!=null)return a[c];return A(a,4,function(a){return a.nodeType==3}).map(getter("nodeValue")).join("")},get:t,tag:function(a,b){a=t(a)||o;return b=="*"&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(b||"*"))},axis:A,findAncestor:function(a,b,c){for(;a&&a!==c;){if(b(a))return a;a=a.parentNode}},createElement:r,createText:w,createFragment:n,insert:function(a,
b,d,g){a=t(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(d){case void 0:case "end":g=null;break;case "begin":g=a[e];break;case "before":break;case "after":g=g[f];break;default:g=Number(d).between(0,a.childNodes.length)?a.childNodes[d]:null}d=!c(a);if(!b||!Array.isArray(b))d=d?b&&a.insertBefore(b,g):s(a,b,g);else if(d)for(var d=[],h=0,k=b.length;h<k;h++)d[h]=a.insertBefore(b[h],g);else a.insertBefore(n.apply(0,b),g),d=n.array;return d},remove:function(a){return a[p]?
a[p].removeChild(a):a},replace:v,swap:function(a,c){if(a===c||b(a,c)&25)return false;v(a,u);v(c,a);v(u,c);return true},clone:function(a,b){var c=a.cloneNode(!b);c.attachEvent&&A(c,8).forEach(Event.clearHandlers);return c},clear:function(a){for(a=t(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,b,c){var d=[],c=Function.getter(c||Function.$self),g;for(g in b)for(var h=0;h<a.length;h++){var x=c(a[h]);d[h]=b[g](a[h],h,x)?r(g,x):a[h]}return d},setAttribute:function(a,b,c){c==null?
a.removeAttribute(b):a.setAttribute(b,c)},parentOf:function(a,b){return a.contains(b)},isInside:function(a,b){return a==b||b.contains(a)},focus:function(a,b){try{a=t(a),a.focus(),b&&a.select&&a.select()}catch(c){}},setSelectionRange:function(a,b,c){arguments.length<3&&(c=b);if(a.setSelectionRange)a.setSelectionRange(b,c);else if(a.createTextRange){var d=a.createTextRange();d.collapse(true);d.moveStart("character",b);d.moveEnd("character",c-b);d.select()}},getSelectionStart:function(a){return typeof a.selectionStart!=
"undefined"?a.selectionStart:i(true)},getSelectionEnd:function(a){return typeof a.selectionEnd!="undefined"?a.selectionEnd:i(false)}})})(basis,this);
(function(l,m){function s(a){return a||m.event}function z(a){return typeof a=="string"?q.get(a):a}function t(a){a=s(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=true}function A(a){a=s(a);a.preventDefault?a.preventDefault():a.returnValue=false}function w(a){var b=Array.from(p[a.type]);if(b)for(var c=b.length;c-- >0;){var d=b[c];d.handler.call(d.thisObject,a)}}function n(a,b,c,d){a=z(a);if(!a)throw Error("Event.addHandler: can't attach event listener to undefined");if(typeof c!="function")throw Error("Event.addHandler: handler must be a function");
a[y]||(a[y]={});var g={handler:c,thisObject:d},h=a[y],f=h[b];if(f){for(a=0;b=f[a];a++)if(b.handler===c&&b.thisObject===d)return;f.push(g)}else f=h[b]=[g],f.fireEvent=function(a){a=s(a);if(e&&a&&typeof a.returnValue=="undefined"){w(a);if(a.cancelBubble===true)return;if(typeof a.returnValue=="undefined")a.returnValue=true}for(var b=0,c;c=f[b++];)c.handler.call(c.thisObject,a)},a.addEventListener?a.addEventListener(b,f.fireEvent,false):a.attachEvent("on"+b,f.fireEvent)}function r(a,b,c,d){var a=z(a),
g=a[y];if(g&&(g=g[b]))for(var h=0,e;e=g[h];h++)if(e.handler===c&&e.thisObject===d){g.splice(h,1);g.length||v(a,b);break}}function v(a,b){var a=z(a),c=a[y];if(c)if(typeof b!="string")for(b in c)v(a,b);else{var d=c[b];d&&(a.removeEventListener?a.removeEventListener(b,d.fireEvent,false):a.detachEvent("on"+b,d.fireEvent),delete c[b])}}var i=m.document,q=l.dom,o=Function.$null,y="__basisEvents",u={mousewheel:["mousewheel","DOMMouseScroll"]},p={},e=!i.addEventListener,f=function(){function a(){b++||setTimeout(function(){for(var a=
0;a<c.length;a++)c[a].callback.call(c[a].thisObject)},10)}var b=false,c=[];if(l.ua.is("ie7-"))(function(){var b="_"+Date.now();i.write('<script id="'+b+'" defer src="//:"><\/script>');z(b).onreadystatechange=function(){this.readyState=="complete"&&(q.remove(this),a())}})();else if(l.ua.is("safari525-"))var d=setInterval(function(){/loaded|complete/.test(i.readyState)&&(clearInterval(d),a())},15);else n(i,"DOMContentLoaded",a,false);n(i,"load",a,false);n(m,"load",a,false);return function(a,d){b||c.push({callback:a,
thisObject:d})}}();return l.namespace("basis.dom.event",s).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return u[a]||[a]},Handler:function(a,b){this.handler=a;this.thisObject=b},sender:function(a){a=s(a);return a.target||a.srcElement},cancelBubble:t,
cancelDefault:A,kill:function(a,b){(b=z(b))?n(b,a,Event.kill):(A(a),t(a))},key:function(a){a=s(a);return a.keyCode||a.which||0},charCode:function(a){a=s(a);return a.charCode||a.keyCode||0},mouseButton:function(a,b){a=s(a);return typeof a.which=="number"?a.which==b.VALUE:a.button&b.BIT},mouseX:function(a){a=s(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+(i.documentElement.scrollLeft||i.body.scrollLeft)},mouseY:function(a){a=s(a);return a.changedTouches?a.changedTouches[0].pageY:
"pageY"in a?a.pageY:a.clientY+(i.documentElement.scrollTop||i.body.scrollTop)},wheelDelta:function(a){a=s(a);return"wheelDelta"in a?a.wheelDelta/120:a.type=="DOMMouseScroll"?-a.detail/3:0},addGlobalHandler:function(a,b,c){var d=p[a];if(d)for(a=d.length;a-- >0;){var g=d[a];if(g.handler===b&&g.thisObject===c)return}else i.addEventListener?i.addEventListener(a,w,true):n(i,a,o),d=p[a]=[];d.push({handler:b,thisObject:c})},removeGlobalHandler:function(a,b,c){var d=p[a];if(d)for(var g=0,h;h=d[g];g++)if(h.handler===
b&&h.thisObject===c){d.splice(g,1);d.length||(delete p[a],i.removeEventListener?i.removeEventListener(a,w,true):r(i,a,o));break}},addHandler:n,addHandlers:function(a,b,c){var a=z(a),d;for(d in b)n(a,d,b[d],c)},removeHandler:r,clearHandlers:v,fireEvent:function(a,b){var a=z(a),c=a[y];c&&c[b]&&c[b].fireEvent()},onLoad:f,onUnload:function(a,b){n(m,"unload",a,b)}})})(basis,this);
(function(){function l(a,b,c){for(var d=1,g;b;)b&1&&(g=o[d],c&d?(a.addHandler(g.handler,g.context),g.action(g.context.add,a)):(a.removeHandler(g.handler,g.context),g.action(g.context.remove,a))),b>>=1,d<<=1}function m(a){return Array.isArray(a)?a.map(m):{data:a}}var s=basis.Class,z=basis.EventObject,t=Object.values,A=Function.$self,w=z.createEvent,n=z.event,r={},v=[],i={},q={PRIORITY:[],values_:{},add:function(a,b){var c=a.toUpperCase(),d=a.toLowerCase();this[c]=d;i[d]=true;b&&(b=this.indexOf(b),
b==-1?this.PRIORITY.push(d):this.PRIORITY.splice(b,0,d))}};q.add("READY");q.add("DEPRECATED");q.add("UNDEFINED");q.add("ERROR");q.add("PROCESSING");var o={},y=1,u={NONE:0,MASK:0,add:function(a,b,c){o[y]={handler:b,action:c,context:{add:function(b,c){if(c){var h=u[a]+"_"+b.eventObjectId;if(!c.subscribers_)c.subscribers_={};if(!c.subscribers_[h]){var e=c.subscriberCount;c.subscribers_[h]=b;c.subscriberCount+=1;c.event_subscribersChanged(c,e)}}},remove:function(b,c){if(c){var h=u[a]+"_"+b.eventObjectId;
if(c.subscribers_[h]){var e=c.subscriberCount;delete c.subscribers_[h];c.subscriberCount-=1;c.event_subscribersChanged(c,e)}}}}};u[a]=y;u.MASK|=y;y<<=1}};u.add("DELEGATE",{delegateChanged:function(a,b){this.remove(a,b);this.add(a,a.delegate)}},function(a,b){a(b,b.delegate)});u.add("TARGET",{targetChanged:function(a,b){this.remove(a,b);this.add(a,a.target)}},function(a,b){a(b,b.target)});var p=s(z,{state:q.READY,data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,
target:null,active:false,subscribeTo:u.DELEGATE+u.TARGET,subscriberCount:0,subscribers_:null,event_update:w("update","object","delta"),event_stateChanged:w("stateChanged","object","oldState"),event_delegateChanged:w("delegateChanged","object","oldDelegate"),event_rootChanged:w("rootChanged","object","oldRoot"),event_targetChanged:w("targetChanged","object","oldTarget")&&function(a,b){var c=this.listen.target;c&&(b&&b.removeHandler(c,this),this.target&&this.target.addHandler(c,this));n.targetChanged.call(this,
a,b)},event_subscribersChanged:w("subscribersChanged","object"),event_activeChanged:w("activeChanged","object"),listen:{delegate:{update:function(a,b){this.data=a.data;this.event_update(this,b)},stateChanged:function(a,b){this.state=a.state;this.event_stateChanged(this,b)},targetChanged:function(a,b){this.target=a.target;this.event_targetChanged(this,b)},rootChanged:function(a,b){this.data=a.data;this.event_rootChanged(this,b)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},
init:function(a){z.prototype.init.call(this,a);if(a=this.delegate)this.delegate=null,this.data=a.data,this.state=a.state,this.setDelegate(a);else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&l(this,this.subscribeTo,u.MASK)},isConnected:function(a){if(a instanceof p){for(;a&&a!==this&&a!==a.delegate;)a=a.delegate;return a===this}return false},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&
a&&a instanceof p){if(a.delegate&&this.isConnected(a))return false}else a=null;if(this.delegate!==a){var b=this.state,c=this.data,d=this.delegate,g=this.target,h=this.root,e={},f=this.listen.delegate;d&&f&&d.removeHandler(f,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;f&&a.addHandler(f,this);for(var j in a.data)j in c===false&&(e[j]=void 0);for(j in c)c[j]!==a.data[j]&&(e[j]=c[j])}else for(j in this.target=this.delegate=null,this.root=this,
this.data={},c)this.data[j]=c[j];this.event_delegateChanged(this,d);this.root!==h&&this.event_rootChanged(this,h);this.target!==g&&this.event_targetChanged(this,g);if(a){for(j in e){this.event_update(this,e);break}b!==this.state&&(String(b)!=this.state||b.data!==this.state.data)&&this.event_stateChanged(this,b)}return true}return false},setState:function(a,b){var c=this.target||this.getRootDelegate();if(c!==this)return c.setState(a,b);c=String(a);if(!i[c])throw Error("Wrong state value");if(this.state!=
c||this.state.data!=b){var d=this.state;this.state=Object(c);this.state.data=b;this.event_stateChanged(this,d);return true}return false},deprecate:function(){this.state!=q.PROCESSING&&this.setState(q.DEPRECATED)},update:function(a){var b=this.target||this.getRootDelegate();if(b!==this)return b.update(a);if(a){var b={},c=0,d;for(d in a)this.data[d]!==a[d]&&(c++,b[d]=this.data[d],this.data[d]=a[d]);if(c)return this.event_update(this,b),b}return false},setActive:function(a){a=!!a;return this.active!=
a?(this.active=a,this.event_activeChanged(this),l(this,this.subscribeTo,u.MASK*a),true):false},setSubscription:function(a){a&=u.MASK;var b=this.subscribeTo^a;return b?(this.subscribeTo=a,this.active&&l(this,b,a),true):false},destroy:function(){this.active&&l(this,this.subscribeTo,0);this.delegate&&this.setDelegate();z.prototype.destroy.call(this);this.data=r;this.state=q.UNDEFINED;this.target=this.root=null}}),A=s(null,{itemClass:p,keyGetter:A,map_:null,extendConstructor_:true,init:function(){this.map_=
{};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var b={};a instanceof p?b.delegate=a:b.data={id:a,title:a};return new this.itemClass(b)},get:function(a,b){var c=a instanceof p?a.eventObjectId:a,d=this.map_[c];!d&&b&&(d=this.map_[c]=this.create(a,b),d.addHandler({destroy:function(){delete this.map_[c]}},this));return d},destroy:function(){basis.Cleaner.remove(this);for(var a=t(this.map_),b=0,c;c=a[b++];)c.destroy()}}),e=s(p,{state:q.UNDEFINED,
itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:w("datasetChanged","dataset","delta")&&function(a,b){var c,d=0,g=0,e;if(c=b.inserted)for(;e=c[d];)this.item_[e.eventObjectId]=e,d++;if(c=b.deleted)for(;e=c[g];)delete this.item_[e.eventObjectId],g++;this.itemCount+=d-g;this.cache_=null;n.datasetChanged.call(this,a,b)},init:function(a){p.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!(!a||!this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=
t(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var b=[];if(a)for(var c in this.item_)if(b.push(this.item_[c])>=a)break;return b},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();p.prototype.destroy.call(this);this.cache_=v;this.itemCount=0;this.item_=this.memberMap_=null}}),f=s(e,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&
this.remove([a])}}},init:function(a){e.prototype.init.call(this,a);if(a=this.items)this.set(a),this.items=null},add:function(a){for(var b,c=this.memberMap_,d=[],g=this.listen.item,e=0;e<a.length;e++){var f=a[e];if(f instanceof p){var i=f.eventObjectId;c[i]||(c[i]=f,g&&f.addHandler(g,this),d.push(f))}}d.length&&this.event_datasetChanged(this,b={inserted:d});return b},remove:function(a){for(var b,c=this.memberMap_,d=[],g=this.listen.item,e=0;e<a.length;e++){var f=a[e];if(f instanceof p){var i=f.eventObjectId;
c[i]&&(g&&f.removeHandler(g,this),delete c[i],d.push(f))}}d.length&&this.event_datasetChanged(this,b={deleted:d});return b},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var b=this.memberMap_,c={},d=[],g=[],e,f,i,j=this.listen.item,l=0;l<a.length;l++)if(e=a[l],e instanceof p)f=e.eventObjectId,c[f]=e,b[f]||(b[f]=e,j&&e.addHandler(j,this),g.push(e));for(f in b)c[f]||(e=b[f],j&&e.removeHandler(j,this),delete b[f],d.push(e));var o;var a={},m;if(g&&g.length)m=
a.inserted=g;if(d&&d.length)m=a.deleted=d;m&&(o=a);(i=o)&&this.event_datasetChanged(this,i);return i},sync:function(a,b){if(a){f.setAccumulateState(true);for(var c=this.memberMap_,d,g,e={},k=[],i,j=0;j<a.length;j++)if(d=a[j],d instanceof p)g=d.eventObjectId,e[g]=d,c[g]||k.push(d);for(g in this.item_)e[g]||this.item_[g].destroy();b&&k.length&&(i=this.add(k));f.setAccumulateState(false);return i}},clear:function(){var a,b=this.getItems(),c=this.listen.item;if(b.length){if(c)for(a=b.length;a-- >0;)b[a].removeHandler(c,
this);this.event_datasetChanged(this,a={deleted:b});this.memberMap_={}}return a}});f.setAccumulateState=function(){function a(a){var b=a.dataset;g.call(b,b,a)}function b(b,c){var d=b.eventObjectId,e=c.inserted,f=c.deleted,h=i[d];if(e&&f)return h&&(delete i[d],a(h)),g.call(b,b,c);if(h){var x=h[e?"inserted":"deleted"];if(x)return x.push.apply(x,e||f);else a(h)}i[d]=c;c.dataset=b}function c(){f=1;setAccumulateState(false)}var d=e.prototype,g=d.event_datasetChanged,f=0,k,i={};return function(e){if(e){if(f==
0)d.event_datasetChanged=b,k=setTimeout(c,0);f++}else if(f-=f>0,f==0)clearTimeout(k),d.event_datasetChanged=g,e=i,i={},t(e).forEach(a)}}();basis.namespace("basis.data",m).extend({STATE:q,SUBSCRIPTION:u,Object:p,DataObject:p,KeyObjectMap:A,AbstractDataset:e,Dataset:f})})(basis,this);
(function(l,m){function s(a,c,d,g){for(var c=c.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i),f=p(),k,i=0;i<c.length;i++)i%2?(k=c[i].split(/\|/),a.getters[k[0]]=d+"childNodes["+g+"]",k=k.length>1?k[1]:k[0]):k=c[i].length?c[i]:null,k!=null&&(u&&(f.lastChild&&f.appendChild(n.createComment("")),g++),f.appendChild(e(k)),g++);return f}function z(a){return function(c){if(!c||!(c.type=="click"&&c.which==3)){var d=l.dom.event.sender(c),e,f;do if(e=d.getAttributeNode&&d.getAttributeNode(a))break;while(d=d.parentNode);
if(d&&e){do if(f=d.basisObjectId)if((f=q[f])&&f.templateAction){d=e.nodeValue.qw();e=0;for(var k;k=d[e++];)f.templateAction(k,l.dom.event(c));break}while(d=d.parentNode)}}}}function t(a,c,d){c=c.trim();if(!c)return"";for(var e="",f;f=y.exec(c);){var k=f[2],o=f[4]||f[5]||k;f[3]&&(a.getters[f[3]]=d+'.getAttributeNode("'+k+'")');if(f=k.match(/^event-([a-z]+)/i)){var j=f[1];if(!i[j]){i[j]=true;f=0;for(var j=l.dom.event.browserEvents(j),m;m=j[f++];)l.dom.event.addGlobalHandler(m,z(k))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(a,b){var a=l.dom.event(a),c=this,d;do if(d=c.basisObjectId)if((d=q[d])&&d.templateAction){for(var c=b.qw(),x=0,C;C=c[x++];)d.templateAction(C,l.dom.event(a));break}while(c=c.parentNode)}}e+=k=="class"?o.trim().replace(/^(.)|\s+/g,".$1"):"["+k+(o?"="+o.quote('"'):"")+"]"}return e}function A(a,c){if(!a.stack)a.stack=[];if(!a.source)a.source=a.str;c||(c=".");for(var d=p(),e,f=0,k,i=a.stack;k=o.exec(a.str);){e=RegExp.leftContext;a.str=a.str.substr(e.length+k[0].length);if(e.length)d.appendChild(s(a,
e,c,f)),f=d.childNodes.length;if(k[5])if(k[5]==i[i.length-1])return i.pop(),d;else throw"Wrong end tag";if(k[6])k[7]&&(a.getters[k[7]]=c+"childNodes["+f+"]"),d.appendChild(n.createComment(k[6]));else{e=k[1];var j=k[2],l=!!k[4],m=c+"childNodes["+f+"]";k=r.createElement(e+t(a,k[3],m));j&&(a.getters[j]=m);l||(i.push(e),k.appendChild(A(a,m+".")));d.appendChild(k)}f++}a.str.length&&d.appendChild(s(a,a.str,c,f));if(i.length)throw"No end tag for "+i.reverse();return d}function w(a){if(!this.proto){a=this.source;
if(typeof a=="function")this.source=a=a();for(var a=a.trim(),a={str:a,getters:{element:".childNodes[0]"}},c=A(a),a=Object.iterate(a.getters,function(a,b){for(var d=a.split(/\|/).map(String.format,"obj_.{0}"),e=b.split(/(\.?childNodes\[(\d+)\])/),f=c,g=0;g<e.length;g+=3){var h=e[g+2];if(!h)break;e[g+2]="";f=f.childNodes[h];f.previousSibling?f.nextSibling||(e[g+1]=".lastChild"):e[g+1]=".firstChild"}return{name:d[0],alias:d.join("="),path:"dom_"+e.join("")}}).sortAsObject("path"),d=0;d<a.length;d++)for(var e=
RegExp("^"+a[d].path.forRegExp()),f=d+1,i;i=a[f++];)i.path=i.path.replace(e,a[d].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(a,b){obj_=a||{};dom_=proto_.cloneNode(true);_code_();if(b&&obj_.element){var c=obj_.element.basisObjectId=map_.seed++;map_[c]=b}return obj_}.toString().replace("_code_()",a.map(String.format,"{alias}={path};\n").join(""))))(c,q);this.clearInstance=(new Function("map_","var obj_; return "+function(a){obj_=a;(a=obj_.element&&obj_.element.basisObjectId)&&
delete map_[a];_code_()}.toString().replace("_code_()",a.map(String.format,"{alias}=null;\n").join(""))))(q)}}var n=m.document,r=l.dom,v=l.Class,i={},q={seed:1},o=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<\!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,y=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;r.createFragment();var u=r.createElement("","a","b").cloneNode(true).childNodes.length==1,p=r.createFragment,
e=r.createText,f=v(null,{__extend__:function(a){return a instanceof f?a:new f(a)},init:function(a){this.source=a},createInstance:function(a,c){w.call(this);return this.createInstance(a,c)},clearInstance:function(){w.call(this)}}),a=n.createElement("DIV");return l.namespace("basis.html").extend({Template:f,escape:function(a){return r.createElement("DIV",r.createText(a)).innerHTML},unescape:function(b){a.innerHTML=b;return a.firstChild.nodeValue},string2Html:function(b){a.innerHTML=b;return r.createFragment.apply(null,
Array.from(a.childNodes))}})})(basis,this);
(function(l){function m(a){return a.sortingValue||0}function s(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return+(a>b)||-(a<b)}function z(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return-(a>b)||+(a<b)}function t(a){return a.childNodes.sort(a.localSortingDesc?z:s)}function A(a,b){var c=b.length-1;a.childNodes=b;a.firstChild=b[0]||null;a.lastChild=b[c]||null;for(var d=c;c=b[d];d--)c.nextSibling=b[d+1]||null,c.previousSibling=b[d-1]||null,a.insertBefore(c,c.nextSibling)}function w(a,b){var c=a.childFactory||
a.document&&a.document.childFactory,d,b=Object.extend({document:a.document,contextSelection:a.selection||a.contextSelection},b);if(c&&(d=c.call(a,b),d instanceof a.childClass))return d;if(!d)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(a.childClass&&a.childClass.className)+" but "+(d&&d.constructor&&d.constructor.className)+")";}function n(){return l.ui.apply(this,arguments)}var r=l.Class,v=l.dom,i=l.data,q=i.SUBSCRIPTION,o=i.DataObject,
y=i.AbstractDataset,u=i.Dataset,p=v.AXIS_DESCENDANT,e=v.AXIS_DESCENDANT_OR_SELF,f=Function.getter,a=Object.complete,b=v.axis,i=l.EventObject.createEvent,c=l.EventObject.event,d={NONE:"none",PARENT:"parent",OWNER:"owner"};q.add("DATASOURCE",{dataSourceChanged:function(a,b){this.remove(a,b);this.add(a,a.dataSource)}},function(a,b){a(b,b.dataSource)});var g=r.ExtensibleProperty(),h={ownerChanged:function(){},destroy:function(a){v.replace(a.element,this)}},k=function(){var a=this.key,b=this.config,c=
this.owner,d=typeof b.existsIf!="function"||b.existsIf(c),e=c.satellite[a];if(d){var d="delegate"in b,f="dataSource"in b,g=typeof b.delegate=="function"?b.delegate(c):null,G=typeof b.dataSource=="function"?b.dataSource(c):null;if(e)d&&e.setDelegate(g),f&&e.setDataSource(G);else{var i=c.tmpl[b.replace||a],e={owner:c};if(d)e.delegate=g;if(f)e.dataSource=G;b.config&&Object.complete(e,typeof b.config=="function"?b.config(c):b.config);e=new b.instanceOf(e);c.satellite[a]=e;i&&e instanceof l.ui.Node&&e.element&&
(v.replace(i,e.element),e.addHandler(h,i))}}else if(e)e.destroy(),e.owner=null,delete c.satellite[a]},E=r.CustomExtendProperty({update:true},function(a,b){for(var c in b)a[c]=b[c]?k:null}),j=r(o,{event_update:function(a,b){o.prototype.event_update.call(this,a,b);var c=this.parentNode;c&&(c.matchFunction&&(this.match(),this.match(c.matchFunction)),c.insertBefore(this,this.nextSibling))},event_childNodesModified:i("childNodesModified","node","delta"),event_dataSourceChanged:i("dataSourceChanged","node",
"oldDataSource"),event_localGroupingChanged:i("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:i("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:i("ownerChanged","node","oldOwner"),event_satellitesChanged:i("satellitesChanged","node","delta"),subscribeTo:o.prototype.subscribeTo+q.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegate:d.NONE,nodeType:"DOMWrapperNode",canHaveChildren:false,childNodes:null,dataSource:null,
colMap_:null,destroyDataSourceMember:true,document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:false,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:g,satellite:null,owner:null,init:function(a){var b=this.dataSource,c=this.childNodes,d=this.localGrouping;if(b)this.dataSource=null;o.prototype.init.call(this,a);if(d)this.localGrouping=null,this.setLocalGrouping(d);if(this.canHaveChildren)this.childNodes=
[],b?(this.dataSource=null,this.setDataSource(b)):c&&this.setChildNodes(c);else{if(c)this.childNodes=null;if(b)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==g)for(var e in this.satelliteConfig)if(a=this.satelliteConfig[e],r.isClass(a)&&(a={instanceOf:a}),typeof a=="object"){b={key:e,owner:this,config:a};a=a.hook?E.__extend__(a.hook):E;for(e in a)if(a[e]===k){this.addHandler(a,b);break}k.call(b)}if(e=this.owner)this.owner=null,this.setOwner(e)},appendChild:function(){},
insertBefore:function(){},removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||a instanceof j==false)a=null;if(this.owner!==a){var b=this.owner,c=this.listen.owner;this.owner=a;c&&(b&&b.removeHandler(c,this),a&&a.addHandler(c,this));this.event_ownerChanged(this,b);this.autoDelegate==d.OWNER&&
this.setDelagate(a)}},destroy:function(){o.prototype.destroy.call(this);this.dataSource?this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping)this.localGrouping.destroy(),this.localGrouping=null;this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var b=this.satellite[a];b.destroy();b.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=
this.document=null}}),D=r(j,{autoDestroyIfEmpty:false,nodes:null,first:null,last:null,init:function(a){this.nodes=[];j.prototype.init.call(this,a)},insert:function(a,b){var c=this.nodes,d=b?c.indexOf(b):-1;d==-1?(c.push(a),this.last=a):c.splice(d,0,a);this.first=c[0];a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var b=this.nodes;if(b.remove(a))this.first=b[0]||null,this.last=b[b.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]});
!this.first&&this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var a=this.nodes,b=a.length;b-- >0;)a[b].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){j.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),B={canHaveChildren:true,childClass:j,childFactory:null,listen:{dataSource:{datasetChanged:function(a,b){var c={},d=[];if(b.deleted)if(c.deleted=
d,this.childNodes.length==b.deleted.length){d.push.apply(d,this.childNodes);var e=this.dataSource;this.dataSource=null;this.clear(true);this.dataSource=e;this.colMap_={}}else for(var e=0,f;f=b.deleted[e];e++){f=f.eventObjectId;var g=this.colMap_[f];delete this.colMap_[f];g.canHaveDelegate=true;this.removeChild(g);d.push(g)}if(b.inserted){c.inserted=[];for(e=0;f=b.inserted[e];e++)g=w(this,{cascadeDestroy:false,delegate:f}),g.canHaveDelegate=false,this.colMap_[f.eventObjectId]=g,c.inserted.push(g),
this.firstChild&&this.insertBefore(g)}this.firstChild?this.event_childNodesModified(this,c):this.setChildNodes(c.inserted);if(this.destroyDataSourceMember&&d.length)for(e=0;f=d[e];e++)f.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},insertBefore:function(a,c){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(a.firstChild){var e=this;do if(e==a)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";
while(e=e.parentNode)}if(this.dataSource&&!this.dataSource.has(a.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";a instanceof this.childClass==false&&(a=w(this,a instanceof o?{delegate:a}:a));var f=a.parentNode===this,g=a.groupNode,h=this.localGrouping,i=this.localSorting,G,k=this.childNodes,j,l,n=null,e=-1,q=false,I;if(f)I=a.nextSibling,l=a.previousSibling;if(i&&(c=null,G=this.localSortingDesc,j=i(a)||0,f))if(j===a.sortingValue)q=true;else if((!I||
(G?I.sortingValue<=j:I.sortingValue>=j))&&(!l||(G?l.sortingValue>=j:l.sortingValue<=j)))a.sortingValue=j,q=true;if(h){n=h.getGroupNode(a);l=n.nodes;if(g===n&&(q||f&&I===c))return a;i?q?e=I&&I.groupNode===n?l.indexOf(I):l.length:(e=l.binarySearchPos(j,m,G),a.sortingValue=j):e=c&&c.groupNode===n?l.indexOf(c):l.length;if(e<l.length)c=l[e];else if(n.last)c=n.last.nextSibling;else{e=n;for(c=null;e=e.nextSibling;)if(c=e.first)break}if(a===c||f&&a.nextSibling===c)return g!==n&&(g&&g.remove(a),n.insert(a)),
a;e=-1}else if(i){if(q)return a;e=k.binarySearchPos(j,m,G);c=k[e];a.sortingValue=j;if(a===c||f&&I===c)return a}else{if(c&&c.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(f){if(I===c)return a;if(a===c)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}f?(a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.previousSibling=
null,a.nextSibling=null,e==-1?k.remove(a):(G=k.indexOf(a),k.splice(G,1),G<e&&e--),g&&(g.remove(a),g=null)):a.parentNode&&a.parentNode.removeChild(a);g!=n&&n.insert(a,c);if(c){e==-1&&(e=k.indexOf(c));if(e==-1)throw"basis.dom.wrapper: Node was not found";a.nextSibling=c;k.splice(e,0,a)}else e=k.length,k.push(a),c={previousSibling:this.lastChild},this.lastChild=a;a.parentNode=this;a.previousSibling=c.previousSibling;e==0?this.firstChild=a:c.previousSibling.nextSibling=a;c.previousSibling=a;var r=false,
t=false,s=this.selection||this.contextSelection;if(!a.document&&a.document!==this.document)r=this.document,a.document=this.document;if(!a.contextSelection&&a.contextSelection!==s)a.contextSelection=s,t=!a.selection,a.selected&&s.add([a]);a.firstChild&&(r||t)&&b(a,p).forEach(function(a){if(r&&!a.document)a.document=r;if(t&&!a.contextSelection)a.selected&&a.unselect(),a.contextSelection=s});f||(a.match&&a.match(this.matchFunction),a.autoDelegate==d.PARENT&&a.setDelegate(this),this.dataSource||this.event_childNodesModified(this,
{inserted:[a]}));return a},removeChild:function(a){if(a==null||a.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(a instanceof this.childClass==false)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(a))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(a),1);a.parentNode=null;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=
a.previousSibling;a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling;a.nextSibling=null;a.previousSibling=null;a.document===this.document&&b(a,e).forEach(function(a){if(a.document==this.document)a.document=null},this);if(a.contextSelection){for(var c=a.contextSelection,f=a,g=[];f;){if(f.contextSelection===c)f.selected&&g.push(f),f.contextSelection=null;if(!f.selection&&f.firstChild)f=f.firstChild;else if(f.nextSibling)f=f.nextSibling;else for(;f=f.parentNode;)if(f.nextSibling){f=
f.nextSibling;break}}c.remove(g)}a.groupNode&&a.groupNode.remove(a);this.dataSource||this.event_childNodesModified(this,{deleted:[a]});a.autoDelegate==d.PARENT&&a.setDelegate();return a},replaceChild:function(a,b){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(b==null||b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(a,b);return this.removeChild(b)},clear:function(a){if(this.dataSource)this.setDataSource();
else if(this.firstChild){var c=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:c});for(var e=c.length;e-- >0;){var f=c[e];f.parentNode=null;f.groupNode=null;a?((f.selection||f.document)&&b(f,v.AXIS_DESCENDANT_OR_SELF).forEach(function(a){if(this.selection&&a.selection===this.selection)a.selected&&a.selection.remove([a]),a.selection=null;if(a.document===this.document)a.document=null},this),f.nextSibling=null,f.previousSibling=null,
f.autoDelegate==d.PARENT&&f.setDelegate()):f.destroy()}if(this.localGrouping){a=this.localGrouping.childNodes;for(e=a.length-1;c=a[e];e--)c.clear()}}},setChildNodes:function(a,b){this.dataSource||this.clear(!!b);if(a&&("length"in a==false&&(a=[a]),a.length)){var c=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var d=0,e=a.length;d<e;d++)this.insertBefore(a[d]);this.event_childNodesModified=c;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||
!this.canHaveChildren||a instanceof y==false)a=null;if(this.dataSource!==a){var b=this.dataSource,c=this.listen.dataSource;this.dataSource=a;if(b)this.colMap_=null,c&&b.removeHandler(c,this),b.itemCount&&this.clear();if(a)this.colMap_={},c&&(a.addHandler(c,this),a.itemCount&&c.datasetChanged&&c.datasetChanged.call(this,a,{inserted:a.getItems()}));this.event_dataSourceChanged(this,b)}},setLocalGrouping:function(a){if(typeof a=="function"||typeof a=="string")a={groupGetter:f(a)};a instanceof H==false&&
(a=a!=null&&typeof a=="object"?new this.localGroupingClass(Object.complete({},a)):null);if(this.localGrouping!==a){var b=this.localGrouping,c;if(this.localGrouping){if(!a&&(this.localGrouping=null,this.firstChild)){c=this.localSorting?t(this):this.childNodes;for(var d=c.length;d-- >0;)c[d].groupNode=null;A(this,c)}b.setOwner()}if(a&&(this.localGrouping=a,a.setOwner(this),this.firstChild)){c=this.localSorting?t(this):this.childNodes;for(d=0;a=c[d];d++)a.groupNode=this.localGrouping.getGroupNode(a);
for(d=0;a=c[d];d++)a.groupNode.nodes.push(a);c.length=0;for(d=this.localGrouping.nullGroup;d;d=d.nextSibling)a=d.nodes,d.first=a[0]||null,d.last=a[a.length-1]||null,c.push.apply(c,a),d.event_childNodesModified(d,{inserted:a});A(this,c)}this.event_localGroupingChanged(this,b)}},setLocalSorting:function(a,b){a&&(a=f(a));if(this.localSorting!=a||this.localSortingDesc!=!!b){var c=this.localSorting,d=this.localSortingDesc;this.localSortingDesc=!!b;this.localSorting=a||null;if(a&&this.firstChild){var e=
[],g;for(g=this.firstChild;g;g=g.nextSibling)g.sortingValue=a(g)||0;if(this.localGrouping)for(var h=this.localGrouping.nullGroup;h;h=h.nextSibling)g=h.nodes=t({childNodes:h.nodes,localSortingDesc:this.localSortingDesc}),h.first=g[0]||null,h.last=g[g.length-1]||null,e.push.apply(e,g);else e=t(this);A(this,e)}this.event_localSortingChanged(this,c,d)}},setMatchFunction:function(a){if(this.matchFunction!=a){var b=this.matchFunction;this.matchFunction=a;for(var c=this.lastChild;c;c=c.previousSibling)c.match(a);
this.event_matchFunctionChanged(this,b)}}},q=r(j,{event_enable:i("enable","node"),event_disable:i("disable","node"),event_select:i("select","node"),event_unselect:i("unselect","node"),event_match:i("match","node"),event_unmatch:i("unmatch","node"),event_matchFunctionChanged:i("matchFunctionChanged","node","oldMatchFunction"),selectable:true,selected:false,selection:null,contextSelection:null,matchFunction:null,matched:true,disabled:false,init:function(a){if(this.selection&&this.selection instanceof
y==false)this.selection=new J(this.selection);j.prototype.init.call(this,a);this.disabled&&this.event_disable(this);if(this.selected)this.selected=false,this.select(true)},setSelection:function(a){if(this.selection==a)return false;var c=this.selection;b(this,p,function(b){if(b.contextSelection==c)b.selected&&c&&c.remove([b]),b.contextSelection=a});this.selection=a;return true},hasOwnSelection:function(){return!!this.selection},select:function(a){var b=this.selected,c=this.contextSelection;if(c)a?
b?c.remove([this]):c.add([this]):this.selectable&&c.set([this]);else if(!b&&this.selectable&&!this.isDisabled())this.selected=true,this.event_select(this);return this.selected!=b},unselect:function(){var a=this.selected;if(a){var b=this.contextSelection;b?b.remove([this]):(this.selected=false,this.event_unselect(this))}return this.selected!=a},enable:function(){if(this.disabled)this.disabled=false,this.event_enable(this)},disable:function(){if(!this.disabled)this.disabled=true,this.event_disable(this)},
isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!v.findAncestor(this,f("disabled"))},match:function(a){if(typeof a!="function")if(this.matched){if(this.underMatch_)this.underMatch_(this,true),this.underMatch_=null}else this.matched=true,this.event_match(this);else if(a(this)){if(this.underMatch_=a,!this.matched)this.matched=true,this.event_match(this)}else if(this.underMatch_=null,this.matched)this.matched=false,this.event_unmatch(this)},setMatchFunction:function(){},
destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),delete this.selection);this.unselect();j.prototype.destroy.call(this)}}),F=r(q,B,{}),H=r(j,B,{event_childNodesModified:function(a,b){c.childNodesModified.call(this,a,b);this.nullGroup.nextSibling=this.firstChild;if(b.inserted&&this.dataSource&&this.nullGroup.first)for(var d=this.owner,e=Array.from(this.nullGroup.nodes),f=e.length;f-- >0;)d.insertBefore(e[f],e[f].nextSibling)},event_ownerChanged:function(a,b){b&&b.localGrouping===
this&&b.setLocalGrouping(null,true);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);c.ownerChanged.call(this,a,b);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:true,autoDestroyEmptyGroups:true,titleGetter:f("data.title"),groupGetter:Function.$undef,childClass:D,childFactory:function(b){return new this.childClass(a(b,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups}))},init:function(a){this.map_=
{};this.nullGroup=new D({autoDestroyIfEmpty:false});j.prototype.init.call(this,a)},getGroupNode:function(a){var a=this.groupGetter(a),b=a instanceof o,c=this.map_[b?a.eventObjectId:a];!c&&!this.dataSource&&(c=this.appendChild(b?{delegate:a}:{data:{id:a,title:a}}));return c||this.nullGroup},insertBefore:function(a,b){a=B.insertBefore.call(this,a,b);if("groupId_"in a==false)a.groupId_=a.delegate?a.delegate.eventObjectId:a.data.id,this.map_[a.groupId_]=a;if(a.first){var c=this.owner,d=c.childNodes,e=
a.first,f=a.last,g,h,i;for(g=a;g=g.previousSibling;)if(i=g.last)break;if(!i)i=this.nullGroup.last;for(g=a;g=g.nextSibling;)if(h=g.first)break;if(e.previousSibling!==i||f.nextSibling!==h){if(e.previousSibling)e.previousSibling.nextSibling=f.nextSibling;if(f.nextSibling)f.nextSibling.previousSibling=e.previousSibling;g=d.splice(d.indexOf(e),a.nodes.length);var k=d.indexOf(h);g.unshift(k!=-1?k:d.length,0);d.splice.apply(d,g);e.previousSibling=i;f.nextSibling=h;if(i)i.nextSibling=e;if(h)h.previousSibling=
f;c.firstChild=d[0];c.lastChild=d[d.length-1]}}return a},removeChild:function(a){B.removeChild.call(this,a);delete this.map_[a.groupId_];return a},clear:function(){B.clear.call(this);this.map_={}},destroy:function(){this.setOwner();j.prototype.destroy.call(this);this.map_=null}});j.prototype.localGroupingClass=H;var i=r(y,{autoDestroy:true,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,b){var c=this.memberMap_,d={},e=0,f=0,g=b.inserted,h=b.deleted;if(g&&g.length)for(d.inserted=
g;a=g[e];)c[a.eventObjectId]=a,e++;if(h&&h.length)for(d.deleted=h;a=h[f];)delete c[a.eventObjectId],f++;(e||f)&&this.event_datasetChanged(this,d)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:i("sourceNodeChanged")&&function(a,b){c.sourceNodeChanged.call(this,a,b);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:false,init:function(a,b){y.prototype.init.call(this,b);a&&this.setSourceNode(a)},setSourceNode:function(a){a instanceof
j==false&&(a=null);if(a!==this.sourceNode){var b=this.sourceNode,c=this.listen.sourceNode;this.sourceNode=a;if(c){var d=c.childNodesModified;b&&(b.removeHandler(c,this),d&&d.call(this,b,{deleted:b.childNodes}));a&&(a.addHandler(c,this),d&&d.call(this,a,{inserted:a.childNodes}))}this.event_sourceNodeChanged(this,b)}},destroy:function(){this.setSourceNode();y.prototype.destroy.call(this)}}),J=r(u,{multiple:false,event_datasetChanged:function(a,b){u.prototype.event_datasetChanged.call(this,a,b);if(b.inserted)for(var c=
0,d;d=b.inserted[c];c++)if(!d.selected)d.selected=true,d.event_select();if(b.deleted)for(c=0;d=b.deleted[c];c++)if(d.selected)d.selected=false,d.event_unselect()},add:function(a){if(!this.multiple)if(this.itemCount)return this.set(a);else a.splice(1);for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);return u.prototype.add.call(this,b)},set:function(a){for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);this.multiple||a.splice(1);return u.prototype.set.call(this,
b)}});l.namespace("basis.dom.wrapper",n).extend({DELEGATE:d,AbstractNode:j,InteractiveNode:q,Node:F,GroupingNode:H,PartitionNode:D,simpleTemplate:n,ChildNodesDataset:i,Selection:J})})(basis);
(function(l,m){function s(a,b){return A(b,true).getRule(a,true)}function z(a,b){var c=a.match(/^([^{]+)\{(.*)\}\s*$/);if(c){for(var d=c[1].trim().split(/\s*,\s*/),e=0;e<d.length;e++)this.addRule(d[e],c[2]||null,b++);return b-1}}function t(a,b){var c=p.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:b?"alternate ":"",url:a.quote('"')}));p.tag(null,"HEAD")[0].appendChild(c);c=c.sheet||c.styleSheet;try{if(!c.cssRules)c.cssRules=c.rules}catch(d){}if(!c.insertRule)c.insertRule=
z;if(!c.deleteRule)c.deleteRule=c.removeRule;return c}function A(a,b){a||(a="DefaultGenericStyleSheet");d[a]||b&&(d[a]=new k(t()));return d[a]}function w(a,b,c,d){for(var d=d||{},b=b.qw(),e=0,f;f=b[e];e++)if(typeof h.style[f]!="undefined"){c&&(l.platformFeature["css-"+a]=f);g[a]={key:f,getter:d[f]};break}}function n(a,b){var c=g[a];if(a=c?c.key:a.replace(/^-ms-/,"ms-").camelize())return{key:a,value:c&&c.getter?c.getter(b):b}}function r(a,b,c){if(typeof a.setProperty=="function")return a.setProperty(b,
c);if(b=n(b,c))return a.style[b.key]=b.value}function v(a,b){for(var c in b)r(a,c,b[c]);return a}function i(a,b){return r(a,"display",typeof b=="string"?b:b?"":"none")}function q(a,b){return r(a,"visibility",b?"":"hidden")}function o(a){return F[a]||(F[a]=RegExp("\\s*\\b"+a+"\\b"))}function y(a,b){var c=(b?"g":"s")+a;return J[c]||(J[c]=RegExp((b?"":"\\s*")+"\\b"+a+".*\\b"))}var u=m.document,p=l.dom,e=l.dom.event,f=l.Class,a=/\s*!important/i,b=String("important"),c=1,d={},g={},h=p.createElement("DIV");
w("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(a){return"alpha(opacity:"+parseInt(a*100)+")"}});w("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);w("float","cssFloat styleFloat");var k=f(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[];this.map_={}},getRule:function(a,b){if(!this.map_[a]&&b){for(var c=this.styleSheet,d=this.rules.length,e=c.insertRule(a+"{}",d),f=d;f<=e;f++)this.rules.push(new E(c.cssRules[f]));this.map_[a]=
d!=e?new j(this.rules.splice(d)):this.rules[d]}return this.map_[a]},deleteRule:function(a){var b=this.map_[a];if(b){for(var b=b.rules||[b],c=0;c<b.length;c++){var d=this.rules.indexOf(b[c]);this.stylesheet.deleteRule(d);this.rules.splice(d,1)}delete this.map_[a]}},destroy:function(){delete this.rules}}),E=f(null,{rule:null,selector:"",init:function(a){if(a)this.rule=a,this.selector=a.selectorText},setProperty:function(c,d){var e,f=!!a.test(d),g=this.rule.style;if(f||g.getPropertyPriority&&g.getPropertyPriority(c)==
b){if(d=d.replace(a,""),e=n(c,d)){var h=e.key;g.setProperty?(f||g.removeProperty(h),g.setProperty(h,e.value,f?b:"")):g.cssText=g.cssText.replace(RegExp(g[h]?h+"\\s*:\\s*"+g[h]+"(\\s*!"+b+")?\\s*;?":"^","i"),h+": "+e.value+(f?" !"+b:"")+";")}}else r(this.rule,c,d)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),j=f(null,{rules:null,init:function(a){this.rules=a},destroy:function(){delete this.rules}});
["setProperty","setStyle","clear"].forEach(function(a){j.prototype[a]=function(){for(var b,c=0;b=this.rules[c];c++)b[a].apply(b,arguments)}});var D={};["em","ex","px","%"].forEach(function(a){D[a=="%"?"percent":a]=function(b){return b==0||isNaN(b)?"0":b+a}});var B,F={},H=f(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,b,c){c=c||"";typeof a!="undefined"&&this.remove(c+a);typeof b!=
"undefined"&&this.add(c+b)},bool:function(a,b){b?this.add(a):this.remove(a)},clear:function(){this.element.className=""},contains:function(a){return!!this.element.className.match(o(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(o(a))||(this.element.className+=" "+a)},remove:function(a){var b=this.element.className,a=b.replace(o(a),"");if(a!=b)this.element.className=a},toggle:function(a){var b=this.contains(a);b?this.remove(a):this.add(a);
return!b}}),J={},x=f(null,{delim:"-",init:function(a,b){this.classList=b;this.prefix=a+this.delim},add:function(a){this.classList.add(this.prefix+a)},remove:function(a){this.classList.remove(this.prefix+a)},items:function(){var a=this.classList.toString();if(a)return a.toString().match(y(this.prefix,true))},set:function(a){var b=this.items(),a=typeof a!="undefined"?this.prefix+a:"",c=this.classList;if(b)if(b.length==1){if(b[0]===a)return;c.remove(b[0])}else this.clear();a&&c.add(a)},clear:function(){this.items().forEach(this.classList.remove,
this.classList)}});m.DOMTokenList&&u.documentElement.classList?(f=H.prototype,Object.extend(m.DOMTokenList.prototype,{set:f.set,replace:f.replace,bool:f.bool,clear:function(){for(var a=this.length;a-- >0;)this.remove(this[a])},setPrefixToken:f.setPrefixToken}),B=function(a){return(typeof a=="string"?p.get(a):a).classList}):B=function(a){return new H(typeof a=="string"?p.get(a):a)};e.onLoad(function(){B(u.body).bool("opacity-not-support",!l.platformFeature["css-opacity"])});p.extend({setStyleProperty:r,
setStyle:v,display:i,show:function(a){return i(a,1)},hide:function(a){return i(a)},visibility:q,visible:function(a){return q(a,1)},invisible:function(a){return q(a)}});return l.namespace("basis.cssom").extend({setStyleProperty:r,setStyle:v,classList:function(a,b){return b?new x(b,B(a)):B(a)},uniqueRule:function(a){var b="genericRule-"+c++;a&&B(a).add(b);a=s("."+b);a.token=b;return a},cssRule:s,getStyleSheet:A,addStyleSheet:t,CssStyleSheetWrapper:k,CssRuleWrapper:E,CssRuleWrapperSet:j}).extend(D)})(basis,
this);
(function(){function l(e,f){var a={},b;if(e&&e.length)b=a.inserted=e;if(f&&f.length)b=a.deleted=f;if(b)return a}var m=basis.Class,s=Object.extend,z=Function.$self,t=Function.$true,A=Function.$false,w=basis.EventObject.createEvent,n=basis.data.SUBSCRIPTION,r=basis.data.DataObject,v=basis.data.KeyObjectMap,i=basis.data.AbstractDataset,q=basis.data.Dataset;n.add("SOURCE",{sourceChanged:function(e,f){this.remove(e,f);this.add(e,e.source)},sourcesChanged:function(e,f){var a;if(a=f.inserted)for(var b=a.length;b-- >
0;)this.add(e,a[b]);if(a=f.deleted)for(b=a.length;b-- >0;)this.remove(e,a[b])}},function(e,f){for(var a=f.sources||[f.source],b=0,c;c=a[b++];)e(f,c)});n.add("MINUEND",{operandsChanged:function(e,f){this.minuend!==f&&(this.remove(e,f),this.add(e,e.minuend))}},function(e,f){e(f,f.minuend)});n.add("SUBTRAHEND",{operandsChanged:function(e,f,a){this.subtrahend!==a&&(this.remove(e,a),this.add(e,e.subtrahend))}},function(e,f){e(f,f.subtrahend)});var o=m(i,{subscribeTo:n.SOURCE,event_sourcesChanged:w("sourcesChanged",
"dataset","delta"),sources:null,rule:function(e){return e>0},listen:{source:{datasetChanged:function(e,f){var a=this.memberMap_,b={},c,d;if(f.inserted)for(var g=0;c=f.inserted[g];g++)d=c.eventObjectId,a[d]?a[d].count++:a[d]={count:1,object:c},b[d]=a[d];if(f.deleted)for(g=0;c=f.deleted[g];g++)d=c.eventObjectId,b[d]=a[d],a[d].count--;this.applyRule(b)},destroy:function(e){this.removeSource(e)}}},init:function(e){i.prototype.init.call(this,e);e=this.sources;this.sources=[];e&&e.forEach(this.addSource,
this)},setRule:function(e){if(typeof e!="function")e=o.UNION;if(this.rule!==e)this.rule=e,this.applyRule()},applyRule:function(e){var f=this.memberMap_,a=this.rule,b=this.sources.length,c=[],d=[],g,h,i;e||(e=f);for(var m in e)g=f[m],h=b&&g.count&&a(g.count,b),h!=!!this.item_[m]&&(h?c:d).push(g.object),g.count==0&&delete f[m];(i=l(c,d))&&this.event_datasetChanged(this,i)},addSource:function(e){if(e instanceof i&&this.sources.add(e)){this.listen.source&&e.addHandler(this.listen.source,this);var f=this.memberMap_,
a;for(a in e.item_)f[a]?f[a].count++:f[a]={count:1,object:e.item_[a]};this.applyRule();this.event_sourcesChanged(this,{inserted:[e]});return true}},removeSource:function(e){if(this.sources.remove(e)){this.listen.source&&e.removeHandler(this.listen.source,this);var f=this.memberMap_,a;for(a in e.item_)f[a].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[e]});return true}},setSources:function(e){for(var f=Array.from(this.sources),a=0,b;b=e[a];a++)b instanceof i&&(f.remove(b)||this.addSource(b));
f.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){i.prototype.destroy.call(this);this.sources=null}});o.UNION=o.prototype.rule;o.INTERSECTION=function(e,f){return e==f};o.DIFFERENCE=function(e){return e==1};o.MORE_THAN_ONE_INCLUDE=function(e,f){return f==1||e>1};o.AT_LEAST_ONE_EXCLUDE=function(e,f){return f==1||e<f};var y=function(e){return!this.has(e)},u=m(i,{subscribeTo:n.MINUEND+n.SUBTRAHEND,minuend:null,subtrahend:null,
event_operandsChanged:w("operandsChanged","dataset","oldMinuend","oldSubtrahend"),listen:{minuend:{datasetChanged:function(e,f){if(this.subtrahend){var a=l(f.inserted&&f.inserted.filter(y,this.subtrahend),f.deleted&&f.deleted.filter(this.has,this));a&&this.event_datasetChanged(this,a)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(e,f){if(this.minuend){var a=l(f.deleted&&f.deleted.filter(y,this),f.inserted&&f.inserted.filter(this.has,this));a&&this.event_datasetChanged(this,
a)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(e){i.prototype.init.call(this,e);var e=this.minuend,f=this.subtrahend;this.subtrahend=this.minuend=null;(e||f)&&this.setOperands(e,f)},setOperands:function(e,f){var a,b=false;e instanceof i==false&&(e=null);f instanceof i==false&&(f=null);var c=this.minuend,d=this.subtrahend;if(c!==e){b=true;this.minuend=e;var g=this.listen.minuend;g&&(c&&c.removeHandler(g,this),e&&e.addHandler(g,this))}if(d!==f&&(b=true,this.subtrahend=
f,g=this.listen.subtrahend))d&&d.removeHandler(g,this),f&&f.addHandler(g,this);if(!b)return false;this.event_operandsChanged(this,c,d);if(!e||!f)this.itemCount&&this.event_datasetChanged(this,a={deleted:this.getItems()});else{var b=[],c=[],h;for(h in this.item_)(!e.item_[h]||f.item_[h])&&b.push(this.item_[h]);for(h in e.item_)!this.item_[h]&&!f.item_[h]&&c.push(e.item_[h]);(a=l(c,b))&&this.event_datasetChanged(this,a)}return a},clear:function(){this.setOperands()}}),p=m(i,{subscribeTo:n.SOURCE,source:null,
event_sourceChanged:w("sourceChanged","dataset","oldSource"),map:z,reduce:A,rule:A,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:{update:function(e){var f=this.map?this.map(e):e;if(f instanceof r==false||this.reduce(f))f=null;var a=this.sourceMap_[e.eventObjectId],b=a.member;if(b!=f){var c=this.memberMap_,d,g,h;a.member=f;if(b)a=b.eventObjectId,this.removeMemberRef&&this.removeMemberRef(b,e),--c[a]==0&&(delete c[a],h=[b]);if(f)b=f.eventObjectId,this.addMemberRef&&this.addMemberRef(f,
e),c[b]?c[b]++:(c[b]=1,g=[f]);(d=l(g,h))&&this.event_datasetChanged(this,d)}}},source:{datasetChanged:function(e,f){var a=this.sourceMap_,b=this.memberMap_,c=[],d=[],g,h,i,m=this.listen.sourceObject;q.setAccumulateState(true);if(f.inserted)for(var j=0;g=f.inserted[j];j++){i=this.map?this.map(g):g;if(i instanceof r==false||this.reduce(i))i=null;m&&g.addHandler(m,this);a[g.eventObjectId]={sourceObject:g,member:i};if(i)h=i.eventObjectId,b[h]?b[h]++:(b[h]=1,c.push(i)),this.addMemberRef&&this.addMemberRef(i,
g)}if(f.deleted)for(j=0;g=f.deleted[j];j++)if(h=g.eventObjectId,i=a[h].member,m&&g.removeHandler(m,this),delete a[h],i)h=i.eventObjectId,--b[h]==0&&(delete b[h],d.push(i)),this.removeMemberRef&&this.removeMemberRef(i,g);q.setAccumulateState(false);(f=l(c,d))&&this.event_datasetChanged(this,f)},destroy:function(){this.setSource()}}},init:function(e){i.prototype.init.call(this,e);this.sourceMap_={};if(e=this.source)this.source=null,this.setSource(e)},setRule:function(e){typeof e!="function"&&(e=t);
if(this.rule!==e)return this.rule=e,this.applyRule()},setMap:function(e){typeof e!="function"&&(e=z);if(this.map!==e)return this.map=e,this.applyRule()},setSource:function(e){e instanceof i==false&&(e=null);if(this.source!==e){var f=this.source,a=this.listen.source;this.source=e;if(a){var b=a.datasetChanged;f&&(f.removeHandler(a,this),b&&b.call(this,f,{deleted:f.getItems()}));e&&(e.addHandler(a,this),b&&b.call(this,e,{inserted:e.getItems()}))}this.event_sourceChanged(this,f)}},applyRule:function(){var e=
this.sourceMap_,f=this.memberMap_,a,b,c,d,g,h=[],i=[],m,j;for(j in e){g=e[j];d=g.sourceObject;a=g.member;b=this.map?this.map(d):d;if(b instanceof r==false||this.reduce(b))b=null;if(a!=b){g.member=b;if(a)c=a.eventObjectId,this.removeMemberRef&&this.removeMemberRef(a,d),f[c]--;if(b)a=b.eventObjectId,this.addMemberRef&&this.addMemberRef(b,d),a in f?f[a]++:(f[a]=1,h.push(b))}}for(c in this.item_)f[c]==0&&(delete f[c],i.push(this.item_[c]));(m=l(h,i))&&this.event_datasetChanged(this,m);return m},clear:function(){this.setSource()},
destroy:function(){i.prototype.destroy.call(this);this.sourceMap_=null}}),A=m(p,{reduce:function(e){return!this.rule(e)},rule:t}),m=m(p,{map:function(e){return this.keyMap.resolve(e)},rule:t,subsetClass:i,keyMap:null,addMemberRef:function(e,f){e.event_datasetChanged(e,{inserted:[f]})},removeMemberRef:function(e,f){e.event_datasetChanged(e,{deleted:[f]})},init:function(e){if(!this.keyMap||this.keyMap instanceof v==false)this.keyMap=new v(s({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));
p.prototype.init.call(this,e)},getSubset:function(e,f){return this.keyMap.get(e,f)},destroy:function(){p.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});basis.namespace("basis.data.dataset").extend({Merge:o,Subtract:u,MapReduce:p,Subset:A,Split:m})})(basis,this);
(function(l){function m(a){h[a]=h[a]||0;return a+h[a]++}function s(){var a=Array.from(arguments),b=a.pop();typeof b!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=
true;return b}function z(){return s.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;b-- >0;){if(arguments[b]==null)return null;a.push(arguments[b])}return a.join("-")}))}var t=l.Class,A=l.Cleaner,w=Object.extend,n=Function.$self,r=Function.getter,v=l.data,i=l.EventObject,q=v.Dataset,o=v.dataset.Subset,y=v.dataset.Split,u=v.DataObject,p=v.STATE,e={},f={string:1,number:1},a=[],b=function(a){return isNaN(a)?null:Number(a)},c=function(a){return isNaN(a)?null:Number(a)},
d=function(a){return isNaN(a)?null:parseInt(a)},g=function(a){return a==null?null:String(a)},h={},k=l.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+c;return e};A.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=
b,true},remove:function(a,b){if(this.index[a]===b)return delete this.index[a],true},destroy:function(){this.index=null}}),v=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},E=function(a,b){return function(c){if(!this.name)this.name=m(b);a.prototype.init.call(this,c)}},j=function(a){return function(b,c){q.setAccumulateState(true);b=(b||[]).map(this.wrapper);q.setAccumulateState(false);return a.prototype.sync.call(this,b,c)}},D=t(q,{wrapper:Function.$self,init:E(q,
"EntitySet"),sync:j(q),set:v(q,"set"),add:v(q,"add"),remove:v(q,"remove"),destroy:function(){q.prototype.destroy.call(this);delete this.wrapper}}),B=t(D,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),F=t(o,{init:E(o,"EntityCollection"),sync:j(o)});F.sourceHandler=o.sourceHandler;var H=t(y,{subsetClass:B,init:E(y,"EntityGrouping"),sync:j(y),getSubset:function(a,b){var c=y.prototype.getSubset.call(this,a,b);if(c)c.wrapper=this.wrapper;return c}}),J=function(a){if(this instanceof
J){var b=new x(a||n);return function(a,c){return a!=null?(c instanceof D||(c=b.createEntitySet()),c.set(a instanceof q?a.getItems():Array.from(a)),c):null}}};J.className="basis.entity.EntitySetWrapper";var x=t(null,{init:function(a){this.wrapper=a},createEntitySet:function(){return new D({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),C=function(a){if(this instanceof C){var b=function(a,b){if(a!=null){if(a===b||a.entityType===c)return a;var h,
i=c.idField;if(f[typeof a]){if(!i)return;h=a;a={};a[i]=h}else if(c.compositeKey)h=c.compositeKey(a,a);else if(i)h=a[i];else if(g&&(b=c.singleton,!b))return c.singleton=new e(a);h!=null&&d&&(b=d.get(h,c.entityClass));b&&b.entityType===c?b.update(a):b=new e(a);return b}else return c.singleton},c=new K(a||{},b),d=c.index__,e=c.entityClass,g=c.isSingleton;w(b,{toString:function(){return this.typeName+"()"},entityType:c,type:b,typeName:c.name,index:d,reader:function(a){return c.reader(a)},get:function(a){return c.get(a)},
addField:function(a,b){c.addField(a,b)},all:c.all,createCollection:function(a,d,e){var f=c.collection_[a];return!f&&d?c.collection_[a]=new F({wrapper:b,source:e||c.all,rule:d}):f},getCollection:function(a){return c.collection_[a]},createGrouping:function(a,d,e){var f=c.grouping_[a];return!f&&d?c.grouping_[a]=new H({wrapper:b,source:e||c.all,rule:d}):f},getGrouping:function(a){return c.grouping_[a]},getSlot:function(a,b){return c.getSlot(a,b)}});return b}};C.className="basis.entity.EntityTypeWrapper";
var L=r("singleton"),M={};t(u,{});var K=t(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(b,c){this.name=b.name||m(this.name);this.index__=b.index;this.idFields={};a.push(this);this.isSingleton=b.isSingleton;this.wrapper=c;this.all=new B(Object.extend(b.all||{},{wrapper:c}));this.slot_={};if(b.extensible)this.extensible=true;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(b.fields,this.addField,this);b.constrains&&
b.constrains.forEach(function(a){this.addCalcField(null,a)},this);if(this.isSingleton)this.get=L;b.aliases&&Object.iterate(b.aliases,this.addAlias,this);this.collection_={};if(b.collections)for(var d in b.collections)this.collection_[d]=new F({name:d,wrapper:c,source:this.all,rule:b.collections[d]||Function.$true});this.grouping_={};if(b.groupings)for(d in b.groupings)this.grouping_[d]=new H({name:d,wrapper:c,source:this.all,rule:b.groupings[d]||Function.$true});this.entityClass=O(this,this.all,this.index__,
this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:c,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(f[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||a==null)return null;for(var c in a){var d=c in this.aliases?this.aliases[c]:"";d&&d in this.fields&&(b[d]=this.fields[d].reader?this.fields[d].reader(a[c]):a[c])}return b},addAlias:function(a,b){b in this.fields&&a in this.aliases==false&&(this.aliases[a]=b)},addField:function(a,
e){if(!this.all.itemCount){this.aliases[a]=a;typeof e=="function"&&(e={type:e});if("type"in e&&typeof e.type!="function")e.type=n;var f=e.type||n;if([b,c,d,g].has(f))e.id=true;if(e.id){if(!this.index__)this.index__=new k(String);this.idFields[a]=true;this.idField||this.compositeKey?(this.idField=null,this.compositeKey=z.apply(null,Object.keys(this.idFields))):this.idField=a}e.calc?this.addCalcField(a,e.calc,void 0):this.fields[a]=f;this.defaults[a]="defValue"in e?e.defValue:f();this.getters["get_"+
a]=function(){return this.data[a]};M[a]||(M[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){if(!this.calcs)this.calcs=[];for(var d={args:b.args,wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=g;break}if(f>e)return;if(this.idField&&a==this.idField)this.compositeKey=b;this.fields[a]=
function(a,b){typeof console!="undefined"&&console.log("Calculate fields are readonly");return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(a!=null)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&a!=null){if(f[typeof a])return a;if(a&&a.entityType===this)return a.__id__;if(a instanceof u)a=a.data;return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);if(b!=
null){var c=this.slot_[b];c||(f[typeof a]&&(c={},this.idField&&!this.compositeKey&&(c[this.idField]=a),a=c),c=this.slot_[b]=new u({delegate:this.get(b),data:a}));return c}}}),N=t(u,{init:i.prototype.init,event_rollbackUpdate:i.createEvent("rollbackUpdate")}),O=function(a,b,c,d,f,g,h){function k(b,c,d){var e=false,f=a.calcs,g=b.__id__,h=b.data;try{if(f)for(var i=0,m;m=f[i++];){var n=m.key;if(n){var o=h[n];h[n]=m.wrapper(c,h,h[n]);h[n]!==o&&(c[n]=o,e=true)}else m.wrapper(c,h)}if(a.compositeKey)b.__id__=
a.compositeKey(c,h,b.__id__);else if(l&&l in c)b.__id__=h[l];b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(q){b.__id__=g;for(var p in c)b.data[p]=c[p];if(d)for(p in d)if(!b.modified)b.modified=d;e=false}b.__id__!==g&&j(b,g,b.__id__);return e}function j(a,b,e){b!=null&&(c.remove(b,a),d[b]&&d[b].setDelegate());e!=null&&(c.add(e,a),d[e]&&d[e].setDelegate(a))}var l=a.idField;return t(N,h,{canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(a){N.prototype.init.call(this);
this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var c,d={},e;for(e in f)e in a?(d[e]=g[e],c=f[e](a[e])):c=g[e],c&&c!==this&&c instanceof i&&c.addHandler(M[e],this)&&(this.fieldHandlers_[e]=true),this.data[e]=c;k(this,d);b.event_datasetChanged(b,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,e){var g=f[b];if(!g){if(!a.extensible)return;g=n}var h,j=this.modified,
c=g(c,this.data[b]),g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{h={};if(b!=l)if(d){if(!j)this.modified=j={};if(b in j===false)h.rollback={key:b,value:void 0},j[b]=g;else if(j[b]===c&&(h.rollback={key:b,value:c},delete j[b],!Object.keys(j).length))this.modified=null}else if(j&&b in j)if(j[b]!==c){h.rollback={key:b,value:j[b]};j[b]=c;break a}else return false;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(M[b],this),this.fieldHandlers_[b]=false);
c&&c!==this&&c instanceof i&&c.addHandler(M[b],this)&&(this.fieldHandlers_[b]=true);h.key=b;h.value=g;h.delta={};h.delta[b]=g}else if(!d&&j&&b in j&&(h={rollback:{key:b,value:j[b]}},delete j[b],!Object.keys(j).length))this.modified=null;if(!e&&h){var d=h.key,b=h.delta||{},m;if(h.rollback)m={},m[h.rollback.key]=h.rollback.value;k(this,b,m)&&(d=true);if(d)this.event_update(this,b),h.delta=b;m&&this.event_rollbackUpdate(this,m)}return h||false},update:function(a,b){if(a){var c,d={},e,f={},g,h;for(h in a)if(g=
this.set(h,a[h],b,true)){if(g.key)c=true,d[g.key]=g.value;if(g.rollback)e=true,f[g.rollback.key]=g.rollback.value}k(this,d,f)&&(c=true);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:false},reset:function(){this.update(g)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=p.PROCESSING){if(this.modified){var a=
this.modified;this.modified=null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(p.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.data[a].removeHandler(M[a],this);this.fieldHandlers_=e;this.__id__&&j(this,this.__id__,null);u.prototype.destroy.call(this);b.event_datasetChanged(b,{deleted:[this]});this.data=e;this.modified=null}})};l.namespace("basis.entity").extend({isEntity:function(a){return a&&a instanceof O},NumericId:b,NumberId:c,IntId:d,StringId:g,Index:k,CalculateField:s,
EntityType:C,Entity:O,BaseEntity:N,EntitySetType:J,EntitySet:D,ReadOnlyEntitySet:B,Collection:F,Grouping:H})})(basis);
