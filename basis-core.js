/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(l){function s(a,c){for(var b in c)a[b]=c[b];return a}function m(a,c){for(var b in c)!1==b in a&&(a[b]=c[b]);return a}function A(a){return null==a||void 0==a}function v(a){return a}function B(a){var c={};a.names=function(a){return Object.slice(c,"string"==typeof a?a.qw():a)};a.extend=function(a){m(c,a);s(this,a);return this};return a}function x(a,c){for(var b=a.split("."),d=l,e,f,g;b.length;)if(e=b.shift(),f=(f?f+".":"")+e,d[e]||(d[e]=B((!b.length?c:null)||function(){},f),g&&(g.namespaces_[f]=
d[e])),d=d[e],!g&&(g=d,!g.namespaces_))g.namespaces_={};return k[a]=d}s(Object,{extend:s,complete:m,keys:function(a){var c=[],b;for(b in a)c.push(b);return c},values:function(a){var c=[],b;for(b in a)c.push(a[b]);return c},slice:function(a,c){var b={};if(!c)return s(b,a);for(var d=0,e;e=c[d++];)e in a&&(b[e]=a[e]);return b},splice:function(a,c){var b={};if(!c)return s(b,a);for(var d=0,e;e=c[d++];)e in a&&(b[e]=a[e],delete a[e]);return b},iterate:function(a,c,b){var d=[],e;for(e in a)d.push(c.call(b,
e,a[e]));return d},coalesce:function(){for(var a=arguments,c=0;c<a.length;c++)if(null!=a[c])return a[c]}});var r=function(){},q=function(){var a=1,c={},b={};a++;return function(d,e){var f,g;if(!e){if(d.getter)return d.getter;if("function"==typeof d)return d}if("function"!=typeof d)b[d]?f=b[d]:(f=new Function("object","return object != null ? object."+d+" : object"),f.path=d,f.getterIdx_=a++,b[d]=f);else if(f=d,!f.getterIdx_)f.getterIdx_=a++;g=f.getterIdx_;var h=c[g];if(h)if("undefined"==typeof e){if(h.nmg)return h.nmg}else for(g=
0;g<h.length;g++){if(h[g].modificator===e)return h[g].getter}else h=c[g]=[];var i=!0;switch(e&&typeof e){case "string":g=function(a){return e.format(f(a))};break;case "function":g=function(a){return e(f(a))};break;case "object":i=!1;g=function(a){return e[f(a)]};break;default:g=f.path?f:function(a){return f(a)}}if(i&&(h.push({getter:g,modificator:e}),"undefined"==typeof e))h.nmg=g;return g.getter=g}}();s(Function,{$undefined:function(a){return void 0==a},$defined:function(a){return void 0!=a},$isNull:A,
$isNotNull:function(a){return null!=a&&void 0!=a},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:v,$const:function(a){return function(){return a}},$false:function(){return!1},$true:function(){return!0},$null:function(){return null},$undef:r,getter:q,def:function(a,c,b){b=b||A;return function(d){d=a(d);return b(d)?c:d}},wrapper:function(a){return function(c){var b={};b[a]=c;return b}},lazyInit:function(a,c){var b=0,d;return function(){b++||(d=a.apply(c||this,arguments));
return d}},lazyInitAndRun:function(a,c,b){var d=0,e;return function(){d++||(e=a.call(b||this));c.apply(e,arguments);return e}},runOnce:function(a,c){var b=0;return function(){if(!b++)return a.apply(c||this,arguments)}}});m(Function.prototype,{bind:function(a){var c=this,b=Array.from(arguments,1);return b.length?function(){return c.apply(a,b.concat.apply(b,arguments))}:function(){return c.apply(a,arguments)}}});m(Array,{isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)}});
s(Array,{from:function(a,c){if(null!=a){var b=a.length;if("undefined"==typeof b)return[a];c||(c=0);if(0<b-c){for(var d=[],e=0,f=c;f<b;)d[e++]=a[f++];return d}}return[]},create:function(a,c,b){for(var d=[],e="function"==typeof c,f=0;f<a;f++)d[f]=e?c.call(b,f,d):c;return d}});m(Array.prototype,{indexOf:function(a,c){c=parseInt(c)||0;if(0>c)return-1;for(;c<this.length;c++)if(this[c]===a)return c;return-1},lastIndexOf:function(a,c){for(var b=this.length,c=parseInt(c),c=isNaN(c)||c>=b?b-1:(c+b)%b;0<=c;c--)if(this[c]===
a)return c;return-1},forEach:function(a,c){for(var b=0,d=this.length;b<d;b++)b in this&&a.call(c,this[b],b,this)},every:function(a,c){for(var b=0,d=this.length;b<d;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0},some:function(a,c){for(var b=0,d=this.length;b<d;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1},filter:function(a,c){for(var b=[],d=0,e=this.length;d<e;d++)d in this&&a.call(c,this[d],d,this)&&b.push(this[d]);return b},map:function(a,c){for(var b=[],d=0,e=this.length;d<
e;d++)d in this&&(b[d]=a.call(c,this[d],d,this));return b},reduce:function(a,c){var b=this.length,d=arguments.length;if(0==b&&1==d)throw new TypeError;var e,f=0;1<d&&(e=c,f=1);for(d=0;d<b;d++)d in this&&(e=f++?a.call(null,e,this[d],d,this):this[d]);return e}});s(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[0<=a?a:this.length+a]},search:function(a,c,b){Array.lastSearchIndex=
-1;for(var c=Function.getter(c||v),b=parseInt(b)||0,d=this.length;b<d;b++)if(c(this[b])===a)return this[Array.lastSearchIndex=b]},lastSearch:function(a,c,b){Array.lastSearchIndex=-1;for(var c=Function.getter(c||v),d=this.length,b=isNaN(b)||null==b?d:parseInt(b),d=b>d?d:b;0<d--;)if(c(this[d])===a)return this[Array.lastSearchIndex=d]},binarySearchPos:function(a,c,b,d,e,f){if(!this.length)return d?-1:0;var c=Function.getter(c||v),b=!!b,g,e=isNaN(e)?0:e,h=isNaN(f)?this.length-1:f;do if(f=e+h>>1,g=c(this[f]),
b?a>g:a<g)h=f-1;else if(b?a<g:a>g)e=f+1;else return a==g?f:d?-1:0;while(e<=h);return d?-1:f+(g<a^b)},binarySearch:function(a,c){return this.binarySearchPos(a,c,!1,!0)},add:function(a){return-1==this.indexOf(a)&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return-1!=a&&!!this.splice(a,1)},has:function(a){return-1!=this.indexOf(a)},merge:function(a){return this.reduce(s,a||{})},sortAsObject:function(a,c,b){a=Function.getter(a);b=b?-1:1;return this.map(function(c,b){return{i:b,v:a(c)}}).sort(c||
function(a,c){return b*(a.v>c.v||-(a.v<c.v)||(a.i>c.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){if(this!==a)this.length=0,this.push.apply(this,a);return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var t=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);if(2>a.length)a[1]=this.length;return t.apply(this,a)}}var j={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",
nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};m(String,{toLowerCase:function(a){return(""+a).toLowerCase()},toUpperCase:function(a){return(""+a).toUpperCase()},trim:function(a){return(""+a).trim()},trimLeft:function(a){return(""+a).trimLeft()},trimRight:function(a){return(""+a).trimRight()},isEmpty:function(a){return null==a||""==""+a},isNotEmpty:function(a){return null!=a&&""!=""+a}});m(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,
"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});s(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(c){if(a)throw c;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],c=this.length,b=0;b<c;b++)a[b]=this.charAt(b);return a},repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,
"\\$&")},format:function(a){for(var c={},b=0;b<arguments.length;b++)c[b]=arguments[b];"object"==typeof a&&s(c,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(a,b,f,g,h){a=b in c?c[b]:h?"":a;return f&&!isNaN(a)?(a=Number(a),"."==f?a.toFixed(g):a.lead(g)):a})},quote:function(a,c){var a=a||'"',c=c||j[a]||a,b=(1==a.length?a:"")+(1==c.length?c:"");return a+(b?this.replace(RegExp("["+b.forRegExp()+"]","g"),"\\$&"):this)+c},capitalize:function(){return this.charAt(0).toUpperCase()+
this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,c){return c.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});String.format=String.prototype.format;if(11!="|||".split(/\|/).length+"|||".split(/(\|)/).length)String.prototype.split=function(a){if(""==a||a&&""==a.source)return this.toArray();var c=[],b=0,d;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));d=a.exec(this);)d[0]=
this.substring(b,d.index),c.push.apply(c,d),b=a.lastIndex;else for(;-1!=(d=this.indexOf(a,b));)c.push(this.substring(b,d)),b=d+a.length;c.push(this.substr(b));return c};if("2"!="12".substr(-1)){var o=String.prototype.substr;String.prototype.substr=function(a,c){return o.call(this,0>a?Math.max(0,this.length+a):a,c)}}s(Number.prototype,{fit:function(a,c){return!isNaN(a)&&this<a?Number(a):!isNaN(c)&&this>c?Number(c):this},between:function(a,c){return!isNaN(this)&&this>=a&&this<=c},quote:function(a,c){return(this+
"").quote(a,c)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return 0>this?-1:+(0<this)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},lead:function(a,c){return(this+"").replace(/\d+/,function(b){return 1<(a-=b.length-1)?Array(a).join(c||0)+b:b})},group:function(a,c){return(this+"").replace(/\d+/,function(b){return b.replace(/\d/g,function(d,e){return!e+(b.length-e)%(a||3)?d:(c||" ")+d})})},format:function(a,c,b,d,e){a=this.toFixed(a);if(c||e)a=
a.replace(/(\d+)(\.?)/,function(a,b,d){return(c?Number(b).group(3,c):b)+(d?e||d:"")});b&&(a=a.replace(/^-?/,"$&"+(b||"")));return a+(d||"")}});m(Date,{now:function(){return+new Date}});1900>(new Date).getYear()&&s(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&100>a?Number(a)+1900:a)}});var k={},y=function(){function a(a,c){for(var b=k[a],d=c?c.split(/\./):[];b&&d.length;)b=b[d.shift()];return b}var c=l.document?l.document.getElementsByTagName("SCRIPT"):
null,b=(c?c[c.length-1].src:module.filename).replace(/[^\/]+$/,""),d={},e;"function"==typeof require?e=function(a){return require(requirePath+a.replace(/\./g,"/"))}:(e=function(c,g){var h=c.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],i=c.substr(h.length?h.length+1:0),w=a(h,i),G=/^basis\./.test(h)?b:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!k[h]||!w)if(/^https?:/.test(G)){if(d[c])throw"Attempt to load namespace, probably cycle require";d[c]=1;var G=G+
(g||"")+c.replace(/\./g,"/")+".js",D=new XMLHttpRequest;D.open("POST",G,!1);D.send(null);if(200==D.status){try{(new Function(D.responseText)).call(l)}catch(H){throw H;}e.sequence.push(c.replace(/\./g,"/")+".js")}else if(404==D.status&&i)y(h);else throw"!";}else throw"Path `"+c+"` can't be resolved";return w||a(h,i)},e.sequence=[]);return e}(),p=function(){function a(a){return"function"==typeof a&&a.basisClass_}var c=Function(),b=1,d={},e=function(){for(var a in{toString:1})return;return!0}();s(c,
{className:"basis.Class",extendConstructor_:!1,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=r}},create:function(e){"function"!=typeof e&&(e=c);var i=Function();i.prototype=e.prototype;for(var i=new i,f={className:e.className+"._SubClass_",basisClass_:!0,superClass_:e,extendConstructor_:!!e.extendConstructor_,__extend__:function(z){return z&&("object"==typeof z||
"function"==typeof z&&!a(z))&&z!==d?c.create.call(null,n,z):z},extend:c.extend,subclass:function(){return c.create.apply(null,[n].concat(Array.from(arguments)))},prototype:i},g=arguments,D=1;D<g.length;D++)f.extend("function"==typeof g[D]&&!a(g[D])?g[D](e.prototype):g[D]);var l={},n=f.extendConstructor_?function(a,c){this.eventObjectId=b++;var z,d;for(d in a)z=this[d],this[d]=z&&z.__extend__?z.__extend__(a[d]):a[d];this.init(c||l)}:function(){this.eventObjectId=b++;this.init.apply(this,arguments)};
i.constructor=n;for(var z in i)i[z]===d&&(i[z]=n);s(n,f);return n},extend:function(a){var c=this.prototype;if(a.prototype)a=a.prototype;for(var b in a){var d=a[b],f=c[b];"className"==b||"extendConstructor_"==b?this[b]=d:c[b]=f&&f.__extend__?f.__extend__(d):d}if(e&&a[b="toString"]!==Object.prototype[b])c[b]=a[b];return this}});var f=function(a,c){return{__extend__:function(a){var b=Function();b.prototype=this;b=new b;c(b,a);return b}}.__extend__(a)},g=function(a){return f(a,s)};return x("basis.Class",
c.create).extend({SELF:d,BaseClass:c,create:c.create,isClass:a,CustomExtendProperty:f,ExtensibleProperty:g,NestedExtProperty:function(a){return f(a,function(a,c){for(var b in c){var d=a[b];a[b]=d&&d.__extend__?d.__extend__(c[b]):g(c[b])}})}})}(),n=function(){function a(a){var d=b[a];d||(d=b[a]=function(){var b=this.handlers_,d,e;if(b&&b.length)for(var b=c.call(b),g=b.length;0<g--;)d=b[g],e=d.handler[a],"function"==typeof e&&e.apply(d.thisObject,arguments)});return d}var c=Array.prototype.slice,b=
{},d,e=p(null,{handlers_:null,event_destroy:d=a("destroy","object"),listen:p.NestedExtProperty(),extendConstructor_:!0,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(a,c){var b=this.handlers_;if(!b)b=this.handlers_=[];c||(c=this);for(var d=b.length,e;0<d--;)if(e=b[d],e.handler===a&&e.thisObject===c)return!1;return!!b.push({handler:a,thisObject:c||this})},removeHandler:function(a,c){var b=
this.handlers_;if(b){c||(c=this);for(var d=b.length,e;0<d--;)if(e=b[d],e.handler===a&&e.thisObject===c)return!!b.splice(d,1);return!1}},destroy:function(){if(this.handlers_)d.call(this,this),this.handlers_=null}});e.createEvent=a;e.event=b;return e}(),C=function(){var a=[];return{add:function(c){null!=c&&a.push(c)},remove:function(c){a.remove(c)}}}();(function(){function a(a){if(c){if(a.source!=l||a.data!=b)return;basis.dom.event.kill(a)}d.length&&(a=d.shift(),delete e[a.key],a.fn())}var c="function"==
typeof addEventListener&&"function"==typeof postMessage,b="zeroTimeoutMessage",d=[],e={},f=1;c&&l.addEventListener("message",a,!0);var g=setTimeout;l.setTimeout=function(i,w){var h;w?h=g.call(l,i,w):(h={key:"z"+f++,fn:"function"==typeof i?i:new Function(i)},e[h.key]=h,d.push(h),c?postMessage(b,"*"):h.timer=g.call(l,a,0),h=h.key);return h};var h=clearTimeout;l.clearTimeout=function(a){if(/z\d+/.test(a)){var c=e[a];c&&(clearTimeout(c.timer),d.remove(c),delete e[a])}else return h.call(l,a)}})();var u=
function(){function a(){if(!w)if(f.length){var a=Date.now(),c=Math.max(f[0].eventTime,a);c<h&&(clearTimeout(i),i=setTimeout(b,(h=c)-a))}else i=clearTimeout(i),h=d}function c(c,b){var d=c.eventObjectId,i=g[b]&&g[b][d];i&&(f.remove(i),delete g[b][d],a())}function b(){var c=Date.now(),c=f.binarySearchPos(c+15,e);w=!0;f.splice(0,c).forEach(function(a){delete g[a.eventName][a.object.eventObjectId];a.callback.call(a.object)});w=!1;h=d;a()}var d=2E12,e=q("eventTime"),f=[],g={},h=d,i=null,w=!1;C.add({destroy:function(){w=
!0;clearTimeout(i);f.length=0;g=null}});return{add:function(b,d,i){var w=b.eventObjectId,z=g[d];z||(z=g[d]={});var E=z[w];if(E){if(isNaN(i))return c(b,d);if(E.eventTime==i)return;f.remove(E);E.eventTime=i}else{if(isNaN(i))return;E=z[w]={eventName:d,object:b,eventTime:i,callback:b[d]}}f.splice(f.binarySearchPos(i,e),0,E);a()},remove:c}}();x("basis").extend({namespace:x,platformFeature:{},EventObject:n,TimeEventManager:u,Cleaner:C,require:y});l.basis.locale={}})(this);
(function(l,s){function m(l){for(var j=1E6,l=(""+l).split("."),k=0,a=0;4>k&&k<l.length;k++,j/=100)a+=l[k]*j;return a}function A(){for(var l=0;l<arguments.length;l++){var j=arguments[l].toLowerCase();if(j in B){if(B[j])return!0}else{var k=j.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(k){B[j]=!1;var a=k[1].toLowerCase(),c=m(k[3]),k=k[4]||"=";if(a=x[a])return B[j]=!c||"="==k&&a==c||"+"==k&&a>=c||"-"==k&&a<c}}}return!1}var v="basis.ua",B={},x={},r=s.navigator&&s.navigator.userAgent,q="unknown",t={MSIE:["Internet Explorer",
"msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},j;for(j in t)if(!("MSIE"==j&&s.opera)&&!("Safari"==j&&r.match(/chrome/i))&&!("AppleWebKit"==j&&r.match(/iphone/i))&&r.match(RegExp(j+".(\\d+(\\.\\d+)*)","i")))for(var o=t[j],k=s.opera&&"function"==
typeof s.opera.version?s.opera.version():RegExp.$1,y=m(k),q=o[0]+" "+k,k=0;k<o.length;k++)x[o[k].toLowerCase()]=y;l.platformFeature.datauri=!1;r="undefined"!=typeof Image?new Image:{};r.onload=function(){l.platformFeature.datauri=!0};r.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";if(A("IE7-"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(p){}v=l.namespace(v);v.toString=function(){return q};return v.extend({testImage:r,prettyName:q,test:A,
is:function(l){return A(l)},Cookies:{set:function(l,j,k,a){document.cookie=l+"="+(null==j?"":escape(j))+";path="+(a||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)+(k?";expires="+(new Date(Date.now()+1E3*k)).toGMTString():"")},get:function(l){return(l=document.cookie.match(RegExp("(^|;)\\s*"+l+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(l[2])},remove:function(l,j){document.cookie=l+"=;expires="+(new Date(0)).toGMTString()+";path="+(j||(0==location.pathname.indexOf("/")?"":"/")+location.pathname)}}})})(basis,
this);
(function(l,s){function m(a,c,d){if(null!=c)return a.insertBefore(b(c)?c:x(c),d||null)}function A(a){return q("",a.cloneNode(!0)).innerHTML}function v(a){return b(a)||a&&a.nodeType?a:"string"==typeof a?k.getElementById(a):null}function B(c,b,e){var f,g=[],e="string"==typeof e?getter(e):e||Function.$true;b&26&&e(c)&&g.push(c);switch(b){case 1:case 2:for(f=c;(f=f[n])&&f!==c.document;)e(f)&&g.push(f);break;case 64:for(f=c[C];f;)e(f)&&g.push(f),f=f[u];break;case 4:case 8:c[C]&&(b=new d(c),b.nodes(e,g));
break;case 128:b=new d(c,e);for(b.cursor_=c[u]||c[n];f=b.next();)g.push(f);break;case 256:for(f=c;f=f[u];)e(f)&&g.push(f);break;case 32:e(c[n])&&g.push(c[n]);break;case 512:b=new d(c,e,d.BACKWARD);for(b.cursor_=c[a]||c[n];f=b.next();)g.push(f);break;case 1024:for(f=c;f=f[a];)e(f)&&g.push(f)}return g}function x(a){return k.createTextNode(null!=a?a:"")}function r(){for(var a=k.createDocumentFragment(),c=arguments.length,b=r.array=[],d=0;d<c;d++)b.push(m(a,arguments[d]));return a}function q(a,c){var b=
void 0!=a&&"string"!=typeof a,d=(b?a.description:a)||"",e="div",j=d.match(/^([a-z0-9\_\-]+)(.*)$/i);j&&(e=j[1],d=j[2]);if(""!=d){for(var z=[],E={},M;j=h.exec(d);){if(j[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+d+"\n\nProblem place:\n> "+d.substr(0,j.index)+"--\>"+d.substr(j.index)+"<--");M=j[1]||j[2]||j[3];j[1]?E.id=M:j[2]?z.push(M):"class"!=M&&(E[M]=j[4]?o(j[5],j[6],j[7]):M)}f&&E.name&&/^(input|textarea|select)$/i.test(e)&&(e="<"+e+" name="+E.name+">")}d=
k.createElement(e);if(E){if(E.style&&g)d.style.cssText=E.style;for(var J in E)d.setAttribute(J,E[J],0)}if(z&&z.length)d.className=z.join(" ");1<arguments.length&&m(d,r.apply(0,Array.from(arguments,1).flatten()));if(b&&(a.css&&l.cssom&&l.cssom.setStyle(d,a.css),l.dom.event))for(var K in a)"function"==typeof a[K]?l.dom.event.addHandler(d,K,a[K],d):a[K]instanceof l.dom.event.Handler&&l.dom.event.addHandler(d,K,a[K].handler,a[K].thisObject);return d}function t(a,c){return a[n]?a[n].replaceChild(c,a):
a}function j(a){if(k.selection){var c=k.selection.createRange();0!=c.compareEndPoints("StartToEnd",c)&&c.collapse(a);return c.getBookmark().charCodeAt(2)-2}}var o=Object.coalesce,k=s.document,y=l.Class,p=k.createElement("div"),n="parentNode",C="firstChild",u="nextSibling",a="previousSibling",c;c="function"==typeof p.compareDocumentPosition?function(a,c){return a.compareDocumentPosition(c)}:function(a,c){return a==c?0:a.document!=c.document?33:a.sourceIndex>c.sourceIndex?2|8*c.contains(childA):4|16*
a.contains(childB)};var b;if("undefined"!=typeof Node){if(b=function(a){return a instanceof Node},!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else b=function(a){return a&&a.ownerDocument===k};var d=y(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,c,b){this.setRoot(a);this.setDirection(b);if("function"==typeof c)this.filter=c},setDirection:function(c){Object.extend(this,c?{a:"lastChild",b:a,c:u,d:C}:{a:C,b:u,c:a,d:"lastChild"})},
setRoot:function(a){this.root_=a||k;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,c){var b;c||(c=[]);for(this.reset();b=this.next(a);)c.push(b);return c},next:function(a){var a=a||this.filter,c=this.cursor_||this.root_;do for(var b=c[this.a];!b;){if(c===this.root_)return this.cursor_=null;(b=c[this.b])||(c=c[n])}while(!a(c=b));return this.cursor_=c},prev:function(a){var a=a||
this.filter,c=this.cursor_,b=this.c,d=this.d;do{var e=c?c[b]:this.root_[d];if(e){for(;e[d];)e=e[d];c=e}else c&&(c=c[n]);if(!c||c===this.root_){c=null;break}}while(!a(c));return this.cursor_=c},destroy:function(){this.cursor_=this.root_=null}});d.BACKWARD=!0;var e="textContent innerText nodeValue".qw(),f=function(){var a=k.createElement("input");a.name="a";return!/name/.test(A(a))}(),g;p.setAttribute("style","color: red");g="red"!==p.style.color;var h=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return l.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:d,outerHTML:A,textContent:function(a){for(var c=0,b;b=e[c++];)if(null!=a[b])return a[b];return B(a,4,function(a){return 3==a.nodeType}).map(getter("nodeValue")).join("")},get:v,tag:function(a,c){a=v(a)||k;return"*"==c&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(c||"*"))},axis:B,findAncestor:function(a,c,b){for(;a&&a!==b;){if(c(a))return a;a=a.parentNode}},createElement:q,createText:x,createFragment:r,insert:function(a,
c,d,e){a=v(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(d){case void 0:case "end":e=null;break;case "begin":e=a[C];break;case "before":break;case "after":e=e[u];break;default:e=Number(d).between(0,a.childNodes.length)?a.childNodes[d]:null}d=!b(a);if(!c||!Array.isArray(c))d=d?c&&a.insertBefore(c,e):m(a,c,e);else if(d)for(var d=[],f=0,g=c.length;f<g;f++)d[f]=a.insertBefore(c[f],e);else a.insertBefore(r.apply(0,c),e),d=r.array;return d},remove:function(a){return a[n]?
a[n].removeChild(a):a},replace:t,swap:function(a,b){if(a===b||c(a,b)&25)return!1;t(a,p);t(b,a);t(p,b);return!0},clone:function(a,c){var b=a.cloneNode(!c);b.attachEvent&&B(b,8).forEach(Event.clearHandlers);return b},clear:function(a){for(a=v(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,c,b){var d=[],b=Function.getter(b||Function.$self),e;for(e in c)for(var f=0;f<a.length;f++){var z=b(a[f]);d[f]=c[e](a[f],f,z)?q(e,z):a[f]}return d},setAttribute:function(a,c,b){null==b?a.removeAttribute(c):
a.setAttribute(c,b)},parentOf:function(a,c){return a.contains(c)},isInside:function(a,c){return a==c||c.contains(a)},focus:function(a,c){try{a=v(a),a.focus(),c&&a.select&&a.select()}catch(b){}},setSelectionRange:function(a,c,b){3>arguments.length&&(b=c);if(a.setSelectionRange)a.setSelectionRange(c,b);else if(a.createTextRange){var d=a.createTextRange();d.collapse(!0);d.moveStart("character",c);d.moveEnd("character",b-c);d.select()}},getSelectionStart:function(a){return"undefined"!=typeof a.selectionStart?
a.selectionStart:j(!0)},getSelectionEnd:function(a){return"undefined"!=typeof a.selectionEnd?a.selectionEnd:j(!1)}})})(basis,this);
(function(l,s){function m(a){return a||s.event}function A(a){return"string"==typeof a?o.get(a):a}function v(a){a=m(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function B(a){a=m(a);a.preventDefault?a.preventDefault():a.returnValue=!1}function x(a){var c=Array.from(n[a.type]);if(c)for(var b=c.length;0<b--;){var d=c[b];d.handler.call(d.thisObject,a)}}function r(a,c,b,d){a=A(a);if(!a)throw Error("Event.addHandler: can't attach event listener to undefined");if("function"!=typeof b)throw Error("Event.addHandler: handler must be a function");
a[y]||(a[y]={});var e={handler:b,thisObject:d},f=a[y],g=f[c];if(g){for(a=0;c=g[a];a++)if(c.handler===b&&c.thisObject===d)return;g.push(e)}else g=f[c]=[e],g.fireEvent=function(a){a=m(a);if(C&&a&&"undefined"==typeof a.returnValue){x(a);if(!0===a.cancelBubble)return;if("undefined"==typeof a.returnValue)a.returnValue=!0}for(var c=0,b;b=g[c++];)b.handler.call(b.thisObject,a)},a.addEventListener?a.addEventListener(c,g.fireEvent,!1):a.attachEvent("on"+c,g.fireEvent)}function q(a,c,b,d){var a=A(a),e=a[y];
if(e&&(e=e[c]))for(var f=0,g;g=e[f];f++)if(g.handler===b&&g.thisObject===d){e.splice(f,1);e.length||t(a,c);break}}function t(a,c){var a=A(a),b=a[y];if(b)if("string"!=typeof c)for(c in b)t(a,c);else{var d=b[c];d&&(a.removeEventListener?a.removeEventListener(c,d.fireEvent,!1):a.detachEvent("on"+c,d.fireEvent),delete b[c])}}var j=s.document,o=l.dom,k=Function.$null,y="__basisEvents",p={mousewheel:["mousewheel","DOMMouseScroll"]},n={},C=!j.addEventListener,u=function(){function a(){c++||setTimeout(function(){for(var a=
0;a<b.length;a++)b[a].callback.call(b[a].thisObject)},10)}var c=!1,b=[];if(l.ua.is("ie7-"))(function(){var c="_"+Date.now();j.write('<script id="'+c+'" defer src="//:"><\/script>');A(c).onreadystatechange=function(){"complete"==this.readyState&&(o.remove(this),a())}})();else if(l.ua.is("safari525-"))var d=setInterval(function(){/loaded|complete/.test(j.readyState)&&(clearInterval(d),a())},15);else r(j,"DOMContentLoaded",a,!1);r(j,"load",a,!1);r(s,"load",a,!1);return function(a,d){c||b.push({callback:a,
thisObject:d})}}();return l.namespace("basis.dom.event",m).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return p[a]||[a]},Handler:function(a,c){this.handler=a;this.thisObject=c},sender:function(a){a=m(a);return a.target||a.srcElement},cancelBubble:v,
cancelDefault:B,kill:function(a,c){(c=A(c))?r(c,a,Event.kill):(B(a),v(a))},key:function(a){a=m(a);return a.keyCode||a.which||0},charCode:function(a){a=m(a);return a.charCode||a.keyCode||0},mouseButton:function(a,c){a=m(a);return"number"==typeof a.which?a.which==c.VALUE:a.button&c.BIT},mouseX:function(a){a=m(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+(j.documentElement.scrollLeft||j.body.scrollLeft)},mouseY:function(a){a=m(a);return a.changedTouches?a.changedTouches[0].pageY:
"pageY"in a?a.pageY:a.clientY+(j.documentElement.scrollTop||j.body.scrollTop)},wheelDelta:function(a){a=m(a);return"wheelDelta"in a?a.wheelDelta/120:"DOMMouseScroll"==a.type?-a.detail/3:0},addGlobalHandler:function(a,c,b){var d=n[a];if(d)for(a=d.length;0<a--;){var e=d[a];if(e.handler===c&&e.thisObject===b)return}else j.addEventListener?j.addEventListener(a,x,!0):r(j,a,k),d=n[a]=[];d.push({handler:c,thisObject:b})},removeGlobalHandler:function(a,c,b){var d=n[a];if(d)for(var e=0,f;f=d[e];e++)if(f.handler===
c&&f.thisObject===b){d.splice(e,1);d.length||(delete n[a],j.removeEventListener?j.removeEventListener(a,x,!0):q(j,a,k));break}},addHandler:r,addHandlers:function(a,c,b){var a=A(a),d;for(d in c)r(a,d,c[d],b)},removeHandler:q,clearHandlers:t,fireEvent:function(a,c){var a=A(a),b=a[y];b&&b[c]&&b[c].fireEvent()},onLoad:u,onUnload:function(a,c){r(s,"unload",a,c)}})})(basis,this);
(function(){function l(a,c,b){for(var d=1,e;c;)c&1&&(e=k[d],b&d?(a.addHandler(e.handler,e.context),e.action(e.context.add,a)):(a.removeHandler(e.handler,e.context),e.action(e.context.remove,a))),c>>=1,d<<=1}function s(a){return Array.isArray(a)?a.map(s):{data:a}}var m=basis.Class,A=basis.EventObject,v=Object.values,B=Function.$self,x=A.createEvent,r=A.event,q={},t=[],j={},o={PRIORITY:[],values_:{},add:function(a,c){var b=a.toUpperCase(),d=a.toLowerCase();this[b]=d;j[d]=!0;c&&(c=this.indexOf(c),-1==
c?this.PRIORITY.push(d):this.PRIORITY.splice(c,0,d))}};o.add("READY");o.add("DEPRECATED");o.add("UNDEFINED");o.add("ERROR");o.add("PROCESSING");var k={},y=1,p={NONE:0,MASK:0,add:function(a,c,b){k[y]={handler:c,action:b,context:{add:function(c,b){if(b){var f=p[a]+"_"+c.eventObjectId;if(!b.subscribers_)b.subscribers_={};if(!b.subscribers_[f]){var g=b.subscriberCount;b.subscribers_[f]=c;b.subscriberCount+=1;b.event_subscribersChanged(b,g)}}},remove:function(c,b){if(b){var f=p[a]+"_"+c.eventObjectId;
if(b.subscribers_[f]){var g=b.subscriberCount;delete b.subscribers_[f];b.subscriberCount-=1;b.event_subscribersChanged(b,g)}}}}};p[a]=y;p.MASK|=y;y<<=1}};p.add("DELEGATE",{delegateChanged:function(a,c){this.remove(a,c);this.add(a,a.delegate)}},function(a,c){a(c,c.delegate)});p.add("TARGET",{targetChanged:function(a,c){this.remove(a,c);this.add(a,a.target)}},function(a,c){a(c,c.target)});var n=m(A,{state:o.READY,data:null,canHaveDelegate:!0,delegate:null,root:null,cascadeDestroy:!1,isTarget:!1,target:null,
active:!1,subscribeTo:p.DELEGATE+p.TARGET,subscriberCount:0,subscribers_:null,event_update:x("update","object","delta"),event_stateChanged:x("stateChanged","object","oldState"),event_delegateChanged:x("delegateChanged","object","oldDelegate"),event_rootChanged:x("rootChanged","object","oldRoot"),event_targetChanged:x("targetChanged","object","oldTarget")&&function(a,c){var b=this.listen.target;b&&(c&&c.removeHandler(b,this),this.target&&this.target.addHandler(b,this));r.targetChanged.call(this,a,
c)},event_subscribersChanged:x("subscribersChanged","object"),event_activeChanged:x("activeChanged","object"),listen:{delegate:{update:function(a,c){this.data=a.data;this.event_update(this,c)},stateChanged:function(a,c){this.state=a.state;this.event_stateChanged(this,c)},targetChanged:function(a,c){this.target=a.target;this.event_targetChanged(this,c)},rootChanged:function(a,c){this.data=a.data;this.event_rootChanged(this,c)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},
init:function(a){A.prototype.init.call(this,a);if(a=this.delegate)this.delegate=null,this.data=a.data,this.state=a.state,this.setDelegate(a);else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&l(this,this.subscribeTo,p.MASK)},isConnected:function(a){if(a instanceof n){for(;a&&a!==this&&a!==a.delegate;)a=a.delegate;return a===this}return!1},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&
a&&a instanceof n){if(a.delegate&&this.isConnected(a))return!1}else a=null;if(this.delegate!==a){var c=this.state,b=this.data,d=this.delegate,e=this.target,f=this.root,g={},h=this.listen.delegate;d&&h&&d.removeHandler(h,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;h&&a.addHandler(h,this);for(var i in a.data)!1===i in b&&(g[i]=void 0);for(i in b)b[i]!==a.data[i]&&(g[i]=b[i])}else for(i in this.target=this.delegate=null,this.root=this,this.data=
{},b)this.data[i]=b[i];this.event_delegateChanged(this,d);this.root!==f&&this.event_rootChanged(this,f);this.target!==e&&this.event_targetChanged(this,e);if(a){for(i in g){this.event_update(this,g);break}c!==this.state&&(""+c!=this.state||c.data!==this.state.data)&&this.event_stateChanged(this,c)}return!0}return!1},setState:function(a,c){var b=this.target||this.getRootDelegate();if(b!==this)return b.setState(a,c);b=""+a;if(!j[b])throw Error("Wrong state value");if(this.state!=b||this.state.data!=
c){var d=this.state;this.state=Object(b);this.state.data=c;this.event_stateChanged(this,d);return!0}return!1},deprecate:function(){this.state!=o.PROCESSING&&this.setState(o.DEPRECATED)},update:function(a){var c=this.target||this.getRootDelegate();if(c!==this)return c.update(a);if(a){var c={},b=0,d;for(d in a)this.data[d]!==a[d]&&(b++,c[d]=this.data[d],this.data[d]=a[d]);if(b)return this.event_update(this,c),c}return!1},setActive:function(a){a=!!a;return this.active!=a?(this.active=a,this.event_activeChanged(this),
l(this,this.subscribeTo,p.MASK*a),!0):!1},setSubscription:function(a){var a=a&p.MASK,c=this.subscribeTo^a;return c?(this.subscribeTo=a,this.active&&l(this,c,a),!0):!1},destroy:function(){this.active&&l(this,this.subscribeTo,0);this.delegate&&this.setDelegate();A.prototype.destroy.call(this);this.data=q;this.state=o.UNDEFINED;this.target=this.root=null}}),B=m(null,{itemClass:n,keyGetter:B,map_:null,extendConstructor_:!0,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),
a)},create:function(a){var c={};a instanceof n?c.delegate=a:c.data={id:a,title:a};return new this.itemClass(c)},get:function(a,c){var b=a instanceof n?a.eventObjectId:a,d=this.map_[b];!d&&c&&(d=this.map_[b]=this.create(a,c),d.addHandler({destroy:function(){delete this.map_[b]}},this));return d},destroy:function(){basis.Cleaner.remove(this);for(var a=v(this.map_),c=0,b;b=a[c++];)b.destroy()}}),C=m(n,{state:o.UNDEFINED,itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:x("datasetChanged",
"dataset","delta")&&function(a,c){var b,d=0,e=0,f;if(b=c.inserted)for(;f=b[d];)this.item_[f.eventObjectId]=f,d++;if(b=c.deleted)for(;f=b[e];)delete this.item_[f.eventObjectId],e++;this.itemCount+=d-e;this.cache_=null;r.datasetChanged.call(this,a,c)},init:function(a){n.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!(!a||!this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=v(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];
return null},top:function(a){var c=[];if(a)for(var b in this.item_)if(c.push(this.item_[b])>=a)break;return c},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();n.prototype.destroy.call(this);this.cache_=t;this.itemCount=0;this.item_=this.memberMap_=null}}),u=m(C,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&this.remove([a])}}},init:function(a){C.prototype.init.call(this,a);if(a=this.items)this.set(a),
this.items=null},add:function(a){for(var c,b=this.memberMap_,d=[],e=this.listen.item,f=0;f<a.length;f++){var g=a[f];if(g instanceof n){var h=g.eventObjectId;b[h]||(b[h]=g,e&&g.addHandler(e,this),d.push(g))}}d.length&&this.event_datasetChanged(this,c={inserted:d});return c},remove:function(a){for(var c,b=this.memberMap_,d=[],e=this.listen.item,f=0;f<a.length;f++){var g=a[f];if(g instanceof n){var h=g.eventObjectId;b[h]&&(e&&g.removeHandler(e,this),delete b[h],d.push(g))}}d.length&&this.event_datasetChanged(this,
c={deleted:d});return c},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var c=this.memberMap_,b={},d=[],e=[],f,g,h,i=this.listen.item,j=0;j<a.length;j++)if(f=a[j],f instanceof n)g=f.eventObjectId,b[g]=f,c[g]||(c[g]=f,i&&f.addHandler(i,this),e.push(f));for(g in c)b[g]||(f=c[g],i&&f.removeHandler(i,this),delete c[g],d.push(f));var l;var a={},k;if(e&&e.length)k=a.inserted=e;if(d&&d.length)k=a.deleted=d;k&&(l=a);(h=l)&&this.event_datasetChanged(this,h);return h},
sync:function(a,c){if(a){u.setAccumulateState(!0);for(var b=this.memberMap_,d,e,f={},g=[],h,i=0;i<a.length;i++)if(d=a[i],d instanceof n)e=d.eventObjectId,f[e]=d,b[e]||g.push(d);for(e in this.item_)f[e]||this.item_[e].destroy();c&&g.length&&(h=this.add(g));u.setAccumulateState(!1);return h}},clear:function(){var a,c=this.getItems(),b=this.listen.item;if(c.length){if(b)for(a=c.length;0<a--;)c[a].removeHandler(b,this);this.event_datasetChanged(this,a={deleted:c});this.memberMap_={}}return a}});u.setAccumulateState=
function(){function a(a){var c=a.dataset;e.call(c,c,a)}function c(c,b){var d=c.eventObjectId,f=b.inserted,g=b.deleted,j=h[d];if(f&&g)return j&&(delete h[d],a(j)),e.call(c,c,b);if(j){var z=j[f?"inserted":"deleted"];if(z)return z.push.apply(z,f||g);a(j)}h[d]=b;b.dataset=c}function b(){f=1;setAccumulateState(!1)}var d=C.prototype,e=d.event_datasetChanged,f=0,g,h={};return function(i){if(i){if(0==f)d.event_datasetChanged=c,g=setTimeout(b,0);f++}else if(f-=0<f,0==f)clearTimeout(g),d.event_datasetChanged=
e,i=h,h={},v(i).forEach(a)}}();basis.namespace("basis.data",s).extend({STATE:o,SUBSCRIPTION:p,Object:n,DataObject:n,KeyObjectMap:B,AbstractDataset:C,Dataset:u})})(basis,this);
(function(l,s){function m(a,b,d,e){for(var b=b.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i),f=n(),g,h=0;h<b.length;h++)h%2?(g=b[h].split(/\|/),a.getters[g[0]]=d+"childNodes["+e+"]",g=1<g.length?g[1]:g[0]):g=b[h].length?b[h]:null,null!=g&&(p&&(f.lastChild&&f.appendChild(r.createComment("")),e++),f.appendChild(C(g)),e++);return f}function A(a){return function(b){if(!b||!("click"==b.type&&3==b.which)){var d=l.dom.event.sender(b),e,f;do if(e=d.getAttributeNode&&d.getAttributeNode(a))break;while(d=d.parentNode);
if(d&&e){do if(f=d.basisObjectId)if((f=o[f])&&f.templateAction){d=e.nodeValue.qw();e=0;for(var g;g=d[e++];)f.templateAction(g,l.dom.event(b));break}while(d=d.parentNode)}}}}function v(a,b,d){b=b.trim();if(!b)return"";for(var e="",f;f=y.exec(b);){var g=f[2],h=f[4]||f[5]||g;f[3]&&(a.getters[f[3]]=d+'.getAttributeNode("'+g+'")');if(f=g.match(/^event-([a-z]+)/i)){var i=f[1];if(!j[i]){j[i]=!0;f=0;for(var i=l.dom.event.browserEvents(i),k;k=i[f++];)l.dom.event.addGlobalHandler(k,A(g))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(a,c){var a=l.dom.event(a),b=this,d;do if(d=b.basisObjectId)if((d=o[d])&&d.templateAction){for(var b=c.qw(),z=0,e;e=b[z++];)d.templateAction(e,l.dom.event(a));break}while(b=b.parentNode)}}e+="class"==g?h.trim().replace(/^(.)|\s+/g,".$1"):"["+g+(h?"="+h.quote('"'):"")+"]"}return e}function B(a,b){if(!a.stack)a.stack=[];if(!a.source)a.source=a.str;b||(b=".");for(var d=n(),e,f=0,g,h=a.stack;g=k.exec(a.str);){e=RegExp.leftContext;a.str=a.str.substr(e.length+g[0].length);if(e.length)d.appendChild(m(a,
e,b,f)),f=d.childNodes.length;if(g[5]){if(g[5]==h[h.length-1])return h.pop(),d;throw"Wrong end tag";}if(g[6])g[7]&&(a.getters[g[7]]=b+"childNodes["+f+"]"),d.appendChild(r.createComment(g[6]));else{e=g[1];var i=g[2],j=!!g[4],l=b+"childNodes["+f+"]";g=q.createElement(e+v(a,g[3],l));i&&(a.getters[i]=l);j||(h.push(e),g.appendChild(B(a,l+".")));d.appendChild(g)}f++}a.str.length&&d.appendChild(m(a,a.str,b,f));if(h.length)throw"No end tag for "+h.reverse();return d}function x(a){if(!this.proto){a=this.source;
if("function"==typeof a)this.source=a=a();for(var a=a.trim(),a={str:a,getters:{element:".childNodes[0]"}},b=B(a),a=Object.iterate(a.getters,function(a,c){for(var d=a.split(/\|/).map(String.format,"obj_.{0}"),e=c.split(/(\.?childNodes\[(\d+)\])/),f=b,g=0;g<e.length;g+=3){var j=e[g+2];if(!j)break;e[g+2]="";f=f.childNodes[j];f.previousSibling?f.nextSibling||(e[g+1]=".lastChild"):e[g+1]=".firstChild"}return{name:d[0],alias:d.join("="),path:"dom_"+e.join("")}}).sortAsObject("path"),d=0;d<a.length;d++)for(var e=
RegExp("^"+a[d].path.forRegExp()),f=d+1,g;g=a[f++];)g.path=g.path.replace(e,a[d].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(a,c){obj_=a||{};dom_=proto_.cloneNode(!0);_code_();if(c&&obj_.element){var b=obj_.element.basisObjectId=map_.seed++;map_[b]=c}return obj_}.toString().replace("_code_()",a.map(String.format,"{alias}={path};\n").join(""))))(b,o);this.clearInstance=(new Function("map_","var obj_; return "+function(a){obj_=a;(a=obj_.element&&obj_.element.basisObjectId)&&
delete map_[a];_code_()}.toString().replace("_code_()",a.map(String.format,"{alias}=null;\n").join(""))))(o)}}var r=s.document,q=l.dom,t=l.Class,j={},o={seed:1},k=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<\!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,y=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;q.createFragment();var p=1==q.createElement("","a","b").cloneNode(!0).childNodes.length,n=q.createFragment,C=
q.createText,u=t(null,{__extend__:function(a){return a instanceof u?a:new u(a)},init:function(a){this.source=a},createInstance:function(a,b){x.call(this);return this.createInstance(a,b)},clearInstance:function(){x.call(this)}}),a=r.createElement("DIV");return l.namespace("basis.html").extend({Template:u,escape:function(a){return q.createElement("DIV",q.createText(a)).innerHTML},unescape:function(c){a.innerHTML=c;return a.firstChild.nodeValue},string2Html:function(c){a.innerHTML=c;return q.createFragment.apply(null,
Array.from(a.childNodes))}})})(basis,this);
(function(l){function s(a){return a.sortingValue||0}function m(a,c){a=a.sortingValue||0;c=c.sortingValue||0;return+(a>c)||-(a<c)}function A(a,c){a=a.sortingValue||0;c=c.sortingValue||0;return-(a>c)||+(a<c)}function v(a){return a.childNodes.sort(a.localSortingDesc?A:m)}function B(a,c){var b=c.length-1;a.childNodes=c;a.firstChild=c[0]||null;a.lastChild=c[b]||null;for(var d=b;b=c[d];d--)b.nextSibling=c[d+1]||null,b.previousSibling=c[d-1]||null,a.insertBefore(b,b.nextSibling)}function x(a,c){var b=a.childFactory||
a.document&&a.document.childFactory,d,c=Object.extend({document:a.document,contextSelection:a.selection||a.contextSelection},c);if(b&&(d=b.call(a,c),d instanceof a.childClass))return d;if(!d)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(a.childClass&&a.childClass.className)+" but "+(d&&d.constructor&&d.constructor.className)+")";}function r(){return l.ui.apply(this,arguments)}var q=l.Class,t=l.dom,j=l.data,o=j.SUBSCRIPTION,k=j.DataObject,
y=j.AbstractDataset,p=j.Dataset,n=t.AXIS_DESCENDANT,C=t.AXIS_DESCENDANT_OR_SELF,u=Function.getter,a=Object.complete,c=t.axis,j=l.EventObject.createEvent,b=l.EventObject.event,d={NONE:"none",PARENT:"parent",OWNER:"owner"};o.add("DATASOURCE",{dataSourceChanged:function(a,c){this.remove(a,c);this.add(a,a.dataSource)}},function(a,c){a(c,c.dataSource)});var e=q.ExtensibleProperty(),f={ownerChanged:function(){},destroy:function(a){t.replace(a.element,this)}},g=function(){var a=this.key,c=this.config,b=
this.owner,d="function"!=typeof c.existsIf||c.existsIf(b),e=b.satellite[a];if(d){var d="delegate"in c,g="dataSource"in c,h="function"==typeof c.delegate?c.delegate(b):null,F="function"==typeof c.dataSource?c.dataSource(b):null;if(e)d&&e.setDelegate(h),g&&e.setDataSource(F);else{var i=b.tmpl[c.replace||a],e={owner:b};if(d)e.delegate=h;if(g)e.dataSource=F;c.config&&Object.complete(e,"function"==typeof c.config?c.config(b):c.config);e=new c.instanceOf(e);b.satellite[a]=e;i&&e instanceof l.ui.Node&&e.element&&
(t.replace(i,e.element),e.addHandler(f,i))}}else if(e)e.destroy(),e.owner=null,delete b.satellite[a]},h=q.CustomExtendProperty({update:!0},function(a,c){for(var b in c)a[b]=c[b]?g:null}),i=q(k,{event_update:function(a,c){k.prototype.event_update.call(this,a,c);var b=this.parentNode;b&&(b.matchFunction&&(this.match(),this.match(b.matchFunction)),b.insertBefore(this,this.nextSibling))},event_childNodesModified:j("childNodesModified","node","delta"),event_dataSourceChanged:j("dataSourceChanged","node",
"oldDataSource"),event_localGroupingChanged:j("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:j("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:j("ownerChanged","node","oldOwner"),event_satellitesChanged:j("satellitesChanged","node","delta"),subscribeTo:k.prototype.subscribeTo+o.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegate:d.NONE,nodeType:"DOMWrapperNode",canHaveChildren:!1,childNodes:null,dataSource:null,
colMap_:null,destroyDataSourceMember:!0,document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:!1,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:e,satellite:null,owner:null,init:function(a){var c=this.dataSource,b=this.childNodes,d=this.localGrouping;if(c)this.dataSource=null;k.prototype.init.call(this,a);if(d)this.localGrouping=null,this.setLocalGrouping(d);if(this.canHaveChildren)this.childNodes=
[],c?(this.dataSource=null,this.setDataSource(c)):b&&this.setChildNodes(b);else{if(b)this.childNodes=null;if(c)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==e)for(var f in this.satelliteConfig)if(a=this.satelliteConfig[f],q.isClass(a)&&(a={instanceOf:a}),"object"==typeof a){c={key:f,owner:this,config:a};a=a.hook?h.__extend__(a.hook):h;for(f in a)if(a[f]===g){this.addHandler(a,c);break}g.call(c)}if(f=this.owner)this.owner=null,this.setOwner(f)},appendChild:function(){},
insertBefore:function(){},removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return 0<this.childNodes.length},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||!1==a instanceof i)a=null;if(this.owner!==a){var c=this.owner,b=this.listen.owner;this.owner=a;b&&(c&&c.removeHandler(b,this),a&&a.addHandler(b,this));this.event_ownerChanged(this,c);this.autoDelegate==d.OWNER&&
this.setDelagate(a)}},destroy:function(){k.prototype.destroy.call(this);this.dataSource?this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping)this.localGrouping.destroy(),this.localGrouping=null;this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var c=this.satellite[a];c.destroy();c.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=
this.document=null}}),w=q(i,{autoDestroyIfEmpty:!1,nodes:null,first:null,last:null,init:function(a){this.nodes=[];i.prototype.init.call(this,a)},insert:function(a,c){var b=this.nodes,d=c?b.indexOf(c):-1;-1==d?(b.push(a),this.last=a):b.splice(d,0,a);this.first=b[0];a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var c=this.nodes;if(c.remove(a))this.first=c[0]||null,this.last=c[c.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]});
!this.first&&this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var a=this.nodes,c=a.length;0<c--;)a[c].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){i.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),G={canHaveChildren:!0,childClass:i,childFactory:null,listen:{dataSource:{datasetChanged:function(a,c){var b={},d=[];if(c.deleted)if(b.deleted=
d,this.childNodes.length==c.deleted.length){d.push.apply(d,this.childNodes);var e=this.dataSource;this.dataSource=null;this.clear(!0);this.dataSource=e;this.colMap_={}}else for(var e=0,f;f=c.deleted[e];e++){f=f.eventObjectId;var g=this.colMap_[f];delete this.colMap_[f];g.canHaveDelegate=!0;this.removeChild(g);d.push(g)}if(c.inserted){b.inserted=[];for(e=0;f=c.inserted[e];e++)g=x(this,{cascadeDestroy:!1,delegate:f}),g.canHaveDelegate=!1,this.colMap_[f.eventObjectId]=g,b.inserted.push(g),this.firstChild&&
this.insertBefore(g)}this.firstChild?this.event_childNodesModified(this,b):this.setChildNodes(b.inserted);if(this.destroyDataSourceMember&&d.length)for(e=0;f=d[e];e++)f.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},insertBefore:function(a,b){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(a.firstChild){var e=this;do if(e==a)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";
while(e=e.parentNode)}if(this.dataSource&&!this.dataSource.has(a.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";!1==a instanceof this.childClass&&(a=x(this,a instanceof k?{delegate:a}:a));var f=a.parentNode===this,g=a.groupNode,h=this.localGrouping,i=this.localSorting,F,j=this.childNodes,l,w,m=null,e=-1,o=!1,I;if(f)I=a.nextSibling,w=a.previousSibling;if(i&&(b=null,F=this.localSortingDesc,l=i(a)||0,f))if(l===a.sortingValue)o=!0;else if((!I||(F?
I.sortingValue<=l:I.sortingValue>=l))&&(!w||(F?w.sortingValue>=l:w.sortingValue<=l)))a.sortingValue=l,o=!0;if(h){m=h.getGroupNode(a);w=m.nodes;if(g===m&&(o||f&&I===b))return a;i?o?e=I&&I.groupNode===m?w.indexOf(I):w.length:(e=w.binarySearchPos(l,s,F),a.sortingValue=l):e=b&&b.groupNode===m?w.indexOf(b):w.length;if(e<w.length)b=w[e];else if(m.last)b=m.last.nextSibling;else{e=m;for(b=null;(e=e.nextSibling)&&!(b=e.first););}if(a===b||f&&a.nextSibling===b)return g!==m&&(g&&g.remove(a),m.insert(a)),a;e=
-1}else if(i){if(o)return a;e=j.binarySearchPos(l,s,F);b=j[e];a.sortingValue=l;if(a===b||f&&I===b)return a}else{if(b&&b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(f){if(I===b)return a;if(a===b)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}f?(a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.previousSibling=
null,a.nextSibling=null,-1==e?j.remove(a):(F=j.indexOf(a),j.splice(F,1),F<e&&e--),g&&(g.remove(a),g=null)):a.parentNode&&a.parentNode.removeChild(a);g!=m&&m.insert(a,b);if(b){-1==e&&(e=j.indexOf(b));if(-1==e)throw"basis.dom.wrapper: Node was not found";a.nextSibling=b;j.splice(e,0,a)}else e=j.length,j.push(a),b={previousSibling:this.lastChild},this.lastChild=a;a.parentNode=this;a.previousSibling=b.previousSibling;0==e?this.firstChild=a:b.previousSibling.nextSibling=a;b.previousSibling=a;var q=!1,
p=!1,r=this.selection||this.contextSelection;if(!a.document&&a.document!==this.document)q=this.document,a.document=this.document;if(!a.contextSelection&&a.contextSelection!==r)a.contextSelection=r,p=!a.selection,a.selected&&r.add([a]);a.firstChild&&(q||p)&&c(a,n).forEach(function(a){if(q&&!a.document)a.document=q;if(p&&!a.contextSelection)a.selected&&a.unselect(),a.contextSelection=r});f||(a.match&&a.match(this.matchFunction),a.autoDelegate==d.PARENT&&a.setDelegate(this),this.dataSource||this.event_childNodesModified(this,
{inserted:[a]}));return a},removeChild:function(a){if(null==a||a.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(!1==a instanceof this.childClass)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(a))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(a),1);a.parentNode=null;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling;
a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling;a.nextSibling=null;a.previousSibling=null;a.document===this.document&&c(a,C).forEach(function(a){if(a.document==this.document)a.document=null},this);if(a.contextSelection){for(var b=a.contextSelection,e=a,f=[];e;){if(e.contextSelection===b)e.selected&&f.push(e),e.contextSelection=null;if(!e.selection&&e.firstChild)e=e.firstChild;else if(e.nextSibling)e=e.nextSibling;else for(;e=e.parentNode;)if(e.nextSibling){e=
e.nextSibling;break}}b.remove(f)}a.groupNode&&a.groupNode.remove(a);this.dataSource||this.event_childNodesModified(this,{deleted:[a]});a.autoDelegate==d.PARENT&&a.setDelegate();return a},replaceChild:function(a,c){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(null==c||c.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(a,c);return this.removeChild(c)},clear:function(a){if(this.dataSource)this.setDataSource();
else if(this.firstChild){var b=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:b});for(var e=b.length;0<e--;){var f=b[e];f.parentNode=null;f.groupNode=null;a?((f.selection||f.document)&&c(f,t.AXIS_DESCENDANT_OR_SELF).forEach(function(a){if(this.selection&&a.selection===this.selection)a.selected&&a.selection.remove([a]),a.selection=null;if(a.document===this.document)a.document=null},this),f.nextSibling=null,f.previousSibling=null,f.autoDelegate==
d.PARENT&&f.setDelegate()):f.destroy()}if(this.localGrouping){a=this.localGrouping.childNodes;for(e=a.length-1;b=a[e];e--)b.clear()}}},setChildNodes:function(a,c){this.dataSource||this.clear(!!c);if(a&&(!1=="length"in a&&(a=[a]),a.length)){var b=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var d=0,e=a.length;d<e;d++)this.insertBefore(a[d]);this.event_childNodesModified=b;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||
!this.canHaveChildren||!1==a instanceof y)a=null;if(this.dataSource!==a){var c=this.dataSource,b=this.listen.dataSource;this.dataSource=a;if(c)this.colMap_=null,b&&c.removeHandler(b,this),c.itemCount&&this.clear();if(a)this.colMap_={},b&&(a.addHandler(b,this),a.itemCount&&b.datasetChanged&&b.datasetChanged.call(this,a,{inserted:a.getItems()}));this.event_dataSourceChanged(this,c)}},setLocalGrouping:function(a){if("function"==typeof a||"string"==typeof a)a={groupGetter:u(a)};!1==a instanceof H&&(a=
null!=a&&"object"==typeof a?new this.localGroupingClass(Object.complete({},a)):null);if(this.localGrouping!==a){var c=this.localGrouping,b;if(this.localGrouping){if(!a&&(this.localGrouping=null,this.firstChild)){b=this.localSorting?v(this):this.childNodes;for(var d=b.length;0<d--;)b[d].groupNode=null;B(this,b)}c.setOwner()}if(a&&(this.localGrouping=a,a.setOwner(this),this.firstChild)){b=this.localSorting?v(this):this.childNodes;for(d=0;a=b[d];d++)a.groupNode=this.localGrouping.getGroupNode(a);for(d=
0;a=b[d];d++)a.groupNode.nodes.push(a);b.length=0;for(d=this.localGrouping.nullGroup;d;d=d.nextSibling)a=d.nodes,d.first=a[0]||null,d.last=a[a.length-1]||null,b.push.apply(b,a),d.event_childNodesModified(d,{inserted:a});B(this,b)}this.event_localGroupingChanged(this,c)}},setLocalSorting:function(a,c){a&&(a=u(a));if(this.localSorting!=a||this.localSortingDesc!=!!c){var b=this.localSorting,d=this.localSortingDesc;this.localSortingDesc=!!c;this.localSorting=a||null;if(a&&this.firstChild){var e=[],f;
for(f=this.firstChild;f;f=f.nextSibling)f.sortingValue=a(f)||0;if(this.localGrouping)for(var g=this.localGrouping.nullGroup;g;g=g.nextSibling)f=g.nodes=v({childNodes:g.nodes,localSortingDesc:this.localSortingDesc}),g.first=f[0]||null,g.last=f[f.length-1]||null,e.push.apply(e,f);else e=v(this);B(this,e)}this.event_localSortingChanged(this,b,d)}},setMatchFunction:function(a){if(this.matchFunction!=a){var c=this.matchFunction;this.matchFunction=a;for(var b=this.lastChild;b;b=b.previousSibling)b.match(a);
this.event_matchFunctionChanged(this,c)}}},o=q(i,{event_enable:j("enable","node"),event_disable:j("disable","node"),event_select:j("select","node"),event_unselect:j("unselect","node"),event_match:j("match","node"),event_unmatch:j("unmatch","node"),event_matchFunctionChanged:j("matchFunctionChanged","node","oldMatchFunction"),selectable:!0,selected:!1,selection:null,contextSelection:null,matchFunction:null,matched:!0,disabled:!1,init:function(a){if(this.selection&&!1==this.selection instanceof y)this.selection=
new L(this.selection);i.prototype.init.call(this,a);this.disabled&&this.event_disable(this);if(this.selected)this.selected=!1,this.select(!0)},setSelection:function(a){if(this.selection==a)return!1;var b=this.selection;c(this,n,function(c){if(c.contextSelection==b)c.selected&&b&&b.remove([c]),c.contextSelection=a});this.selection=a;return!0},hasOwnSelection:function(){return!!this.selection},select:function(a){var c=this.selected,b=this.contextSelection;if(b)a?c?b.remove([this]):b.add([this]):this.selectable&&
b.set([this]);else if(!c&&this.selectable&&!this.isDisabled())this.selected=!0,this.event_select(this);return this.selected!=c},unselect:function(){var a=this.selected;if(a){var c=this.contextSelection;c?c.remove([this]):(this.selected=!1,this.event_unselect(this))}return this.selected!=a},enable:function(){if(this.disabled)this.disabled=!1,this.event_enable(this)},disable:function(){if(!this.disabled)this.disabled=!0,this.event_disable(this)},isDisabled:function(){return this.disabled||this.document&&
this.document.disabled||!!t.findAncestor(this,u("disabled"))},match:function(a){if("function"!=typeof a)if(this.matched){if(this.underMatch_)this.underMatch_(this,!0),this.underMatch_=null}else this.matched=!0,this.event_match(this);else if(a(this)){if(this.underMatch_=a,!this.matched)this.matched=!0,this.event_match(this)}else if(this.underMatch_=null,this.matched)this.matched=!1,this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),
delete this.selection);this.unselect();i.prototype.destroy.call(this)}}),D=q(o,G,{}),H=q(i,G,{event_childNodesModified:function(a,c){b.childNodesModified.call(this,a,c);this.nullGroup.nextSibling=this.firstChild;if(c.inserted&&this.dataSource&&this.nullGroup.first)for(var d=this.owner,e=Array.from(this.nullGroup.nodes),f=e.length;0<f--;)d.insertBefore(e[f],e[f].nextSibling)},event_ownerChanged:function(a,c){c&&c.localGrouping===this&&c.setLocalGrouping(null,!0);this.owner&&this.owner.localGrouping!==
this&&this.owner.setLocalGrouping(this);b.ownerChanged.call(this,a,c);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:!0,autoDestroyEmptyGroups:!0,titleGetter:u("data.title"),groupGetter:Function.$undef,childClass:w,childFactory:function(c){return new this.childClass(a(c,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?!1:this.autoDestroyEmptyGroups}))},init:function(a){this.map_={};this.nullGroup=new w({autoDestroyIfEmpty:!1});i.prototype.init.call(this,
a)},getGroupNode:function(a){var a=this.groupGetter(a),c=a instanceof k,b=this.map_[c?a.eventObjectId:a];!b&&!this.dataSource&&(b=this.appendChild(c?{delegate:a}:{data:{id:a,title:a}}));return b||this.nullGroup},insertBefore:function(a,c){a=G.insertBefore.call(this,a,c);if(!1=="groupId_"in a)a.groupId_=a.delegate?a.delegate.eventObjectId:a.data.id,this.map_[a.groupId_]=a;if(a.first){var b=this.owner,d=b.childNodes,e=a.first,f=a.last,g,F,h;for(g=a;(g=g.previousSibling)&&!(h=g.last););if(!h)h=this.nullGroup.last;
for(g=a;(g=g.nextSibling)&&!(F=g.first););if(e.previousSibling!==h||f.nextSibling!==F){if(e.previousSibling)e.previousSibling.nextSibling=f.nextSibling;if(f.nextSibling)f.nextSibling.previousSibling=e.previousSibling;g=d.splice(d.indexOf(e),a.nodes.length);var i=d.indexOf(F);g.unshift(-1!=i?i:d.length,0);d.splice.apply(d,g);e.previousSibling=h;f.nextSibling=F;if(h)h.nextSibling=e;if(F)F.previousSibling=f;b.firstChild=d[0];b.lastChild=d[d.length-1]}}return a},removeChild:function(a){G.removeChild.call(this,
a);delete this.map_[a.groupId_];return a},clear:function(){G.clear.call(this);this.map_={}},destroy:function(){this.setOwner();i.prototype.destroy.call(this);this.map_=null}});i.prototype.localGroupingClass=H;var j=q(y,{autoDestroy:!0,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,c){var b=this.memberMap_,d={},e=0,f=0,g=c.inserted,h=c.deleted;if(g&&g.length)for(d.inserted=g;a=g[e];)b[a.eventObjectId]=a,e++;if(h&&h.length)for(d.deleted=h;a=h[f];)delete b[a.eventObjectId],f++;(e||
f)&&this.event_datasetChanged(this,d)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:j("sourceNodeChanged")&&function(a,c){b.sourceNodeChanged.call(this,a,c);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:!1,init:function(a,c){y.prototype.init.call(this,c);a&&this.setSourceNode(a)},setSourceNode:function(a){!1==a instanceof i&&(a=null);if(a!==this.sourceNode){var c=this.sourceNode,b=this.listen.sourceNode;this.sourceNode=
a;if(b){var d=b.childNodesModified;c&&(c.removeHandler(b,this),d&&d.call(this,c,{deleted:c.childNodes}));a&&(a.addHandler(b,this),d&&d.call(this,a,{inserted:a.childNodes}))}this.event_sourceNodeChanged(this,c)}},destroy:function(){this.setSourceNode();y.prototype.destroy.call(this)}}),L=q(p,{multiple:!1,event_datasetChanged:function(a,c){p.prototype.event_datasetChanged.call(this,a,c);if(c.inserted)for(var b=0,d;d=c.inserted[b];b++)if(!d.selected)d.selected=!0,d.event_select();if(c.deleted)for(b=
0;d=c.deleted[b];b++)if(d.selected)d.selected=!1,d.event_unselect()},add:function(a){if(!this.multiple){if(this.itemCount)return this.set(a);a.splice(1)}for(var c=[],b=0,d;d=a[b];b++)d.contextSelection==this&&d.selectable&&c.push(d);return p.prototype.add.call(this,c)},set:function(a){for(var c=[],b=0,d;d=a[b];b++)d.contextSelection==this&&d.selectable&&c.push(d);this.multiple||a.splice(1);return p.prototype.set.call(this,c)}});l.namespace("basis.dom.wrapper",r).extend({DELEGATE:d,AbstractNode:i,
InteractiveNode:o,Node:D,GroupingNode:H,PartitionNode:w,simpleTemplate:r,ChildNodesDataset:j,Selection:L})})(basis);
(function(l,s){function m(a,c){return B(c,!0).getRule(a,!0)}function A(a,c){var b=a.match(/^([^{]+)\{(.*)\}\s*$/);if(b){for(var d=b[1].trim().split(/\s*,\s*/),e=0;e<d.length;e++)this.addRule(d[e],b[2]||null,c++);return c-1}}function v(a,c){var b=n.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:c?"alternate ":"",url:a.quote('"')}));n.tag(null,"HEAD")[0].appendChild(b);b=b.sheet||b.styleSheet;try{if(!b.cssRules)b.cssRules=b.rules}catch(d){}if(!b.insertRule)b.insertRule=
A;if(!b.deleteRule)b.deleteRule=b.removeRule;return b}function B(a,c){a||(a="DefaultGenericStyleSheet");b[a]||c&&(b[a]=new f(v()));return b[a]}function x(a,c,b,f){for(var f=f||{},c=c.qw(),g=0,h;h=c[g];g++)if("undefined"!=typeof e.style[h]){b&&(l.platformFeature["css-"+a]=h);d[a]={key:h,getter:f[h]};break}}function r(a,c){var b=d[a];if(a=b?b.key:a.replace(/^-ms-/,"ms-").camelize())return{key:a,value:b&&b.getter?b.getter(c):c}}function q(a,c,b){if("function"==typeof a.setProperty)return a.setProperty(c,
b);if(c=r(c,b))return a.style[c.key]=c.value}function t(a,c){for(var b in c)q(a,b,c[b]);return a}function j(a,c){return q(a,"display","string"==typeof c?c:c?"":"none")}function o(a,c){return q(a,"visibility",c?"":"hidden")}function k(a){return G[a]||(G[a]=RegExp("\\s*\\b"+a+"\\b"))}function y(a,c){var b=(c?"g":"s")+a;return H[b]||(H[b]=RegExp((c?"":"\\s*")+"\\b"+a+".*\\b"))}var p=s.document,n=l.dom,C=l.dom.event,u=l.Class,a=/\s*!important/i,c=1,b={},d={},e=n.createElement("DIV");x("opacity","opacity MozOpacity KhtmlOpacity filter",
!0,{fitler:function(a){return"alpha(opacity:"+parseInt(100*a)+")"}});x("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",!0);x("float","cssFloat styleFloat");var f=u(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[];this.map_={}},getRule:function(a,c){if(!this.map_[a]&&c){for(var b=this.styleSheet,d=this.rules.length,e=b.insertRule(a+"{}",d),f=d;f<=e;f++)this.rules.push(new g(b.cssRules[f]));this.map_[a]=d!=e?new h(this.rules.splice(d)):this.rules[d]}return this.map_[a]},
deleteRule:function(a){var c=this.map_[a];if(c){for(var c=c.rules||[c],b=0;b<c.length;b++){var d=this.rules.indexOf(c[b]);this.stylesheet.deleteRule(d);this.rules.splice(d,1)}delete this.map_[a]}},destroy:function(){delete this.rules}}),g=u(null,{rule:null,selector:"",init:function(a){if(a)this.rule=a,this.selector=a.selectorText},setProperty:function(c,b){var d,e=!!a.test(b),f=this.rule.style;if(e||f.getPropertyPriority&&"important"==f.getPropertyPriority(c)){if(b=b.replace(a,""),d=r(c,b)){var g=
d.key;f.setProperty?(e||f.removeProperty(g),f.setProperty(g,d.value,e?"important":"")):f.cssText=f.cssText.replace(RegExp(f[g]?g+"\\s*:\\s*"+f[g]+"(\\s*!important)?\\s*;?":"^","i"),g+": "+d.value+(e?" !important":"")+";")}}else q(this.rule,c,b)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),h=u(null,{rules:null,init:function(a){this.rules=a},destroy:function(){delete this.rules}});["setProperty","setStyle",
"clear"].forEach(function(a){h.prototype[a]=function(){for(var c,b=0;c=this.rules[b];b++)c[a].apply(c,arguments)}});var i={};["em","ex","px","%"].forEach(function(a){i["%"==a?"percent":a]=function(c){return 0==c||isNaN(c)?"0":c+a}});var w,G={},D=u(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,c,b){b=b||"";"undefined"!=typeof a&&this.remove(b+a);"undefined"!=typeof c&&this.add(b+
c)},bool:function(a,c){c?this.add(a):this.remove(a)},clear:function(){this.element.className=""},contains:function(a){return!!this.element.className.match(k(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(k(a))||(this.element.className+=" "+a)},remove:function(a){var c=this.element.className,a=c.replace(k(a),"");if(a!=c)this.element.className=a},toggle:function(a){var c=this.contains(a);c?this.remove(a):this.add(a);return!c}}),H={},L=u(null,
{delim:"-",init:function(a,c){this.classList=c;this.prefix=a+this.delim},add:function(a){this.classList.add(this.prefix+a)},remove:function(a){this.classList.remove(this.prefix+a)},items:function(){var a=this.classList.toString();if(a)return a.toString().match(y(this.prefix,!0))},set:function(a){var c=this.items(),a="undefined"!=typeof a?this.prefix+a:"",b=this.classList;if(c)if(1==c.length){if(c[0]===a)return;b.remove(c[0])}else this.clear();a&&b.add(a)},clear:function(){this.items().forEach(this.classList.remove,
this.classList)}});s.DOMTokenList&&p.documentElement.classList?(u=D.prototype,Object.extend(s.DOMTokenList.prototype,{set:u.set,replace:u.replace,bool:u.bool,clear:function(){for(var a=this.length;0<a--;)this.remove(this[a])},setPrefixToken:u.setPrefixToken}),w=function(a){return("string"==typeof a?n.get(a):a).classList}):w=function(a){return new D("string"==typeof a?n.get(a):a)};C.onLoad(function(){w(p.body).bool("opacity-not-support",!l.platformFeature["css-opacity"])});n.extend({setStyleProperty:q,
setStyle:t,display:j,show:function(a){return j(a,1)},hide:function(a){return j(a)},visibility:o,visible:function(a){return o(a,1)},invisible:function(a){return o(a)}});return l.namespace("basis.cssom").extend({setStyleProperty:q,setStyle:t,classList:function(a,c){return c?new L(c,w(a)):w(a)},uniqueRule:function(a){var b="genericRule-"+c++;a&&w(a).add(b);a=m("."+b);a.token=b;return a},cssRule:m,getStyleSheet:B,addStyleSheet:v,CssStyleSheetWrapper:f,CssRuleWrapper:g,CssRuleWrapperSet:h}).extend(i)})(basis,
this);
(function(){function l(a,b){var d={},e;if(a&&a.length)e=d.inserted=a;if(b&&b.length)e=d.deleted=b;if(e)return d}function s(a,b){if(!a.length)return 0;var d,e,f,g=0,h=a.length-1;do if(d=g+h>>1,f=a[d].value||0,f===e?(f=a[d].object.eventObjectId,e=b.object.eventObjectId):e=b.value||0,e<f)h=d-1;else if(e>f)g=d+1;else return e==f?d:0;while(g<=h);return d+(f<e)}var m=basis.Class,A=Object.extend,v=Object.values,B=Function.$self,x=Function.$true,r=Function.$false,q=basis.EventObject.createEvent,t=basis.data.SUBSCRIPTION,j=
basis.data.DataObject,o=basis.data.KeyObjectMap,k=basis.data.AbstractDataset,y=basis.data.Dataset;t.add("SOURCE",{sourceChanged:function(a,b){this.remove(a,b);this.add(a,a.source)},sourcesChanged:function(a,b){var d;if(d=b.inserted)for(var e=d.length;0<e--;)this.add(a,d[e]);if(d=b.deleted)for(e=d.length;0<e--;)this.remove(a,d[e])}},function(a,b){for(var d=b.sources||[b.source],e=0,f;f=d[e++];)a(b,f)});t.add("MINUEND",{operandsChanged:function(a,b){this.minuend!==b&&(this.remove(a,b),this.add(a,a.minuend))}},
function(a,b){a(b,b.minuend)});t.add("SUBTRAHEND",{operandsChanged:function(a,b,d){this.subtrahend!==d&&(this.remove(a,d),this.add(a,a.subtrahend))}},function(a,b){a(b,b.subtrahend)});var p=m(k,{subscribeTo:t.SOURCE,event_sourcesChanged:q("sourcesChanged","dataset","delta"),sources:null,rule:function(a){return 0<a},listen:{source:{datasetChanged:function(a,b){var d=this.memberMap_,e={},f,g;if(b.inserted)for(var h=0;f=b.inserted[h];h++)g=f.eventObjectId,d[g]?d[g].count++:d[g]={count:1,object:f},e[g]=
d[g];if(b.deleted)for(h=0;f=b.deleted[h];h++)g=f.eventObjectId,e[g]=d[g],d[g].count--;this.applyRule(e)},destroy:function(a){this.removeSource(a)}}},init:function(a){k.prototype.init.call(this,a);a=this.sources;this.sources=[];a&&a.forEach(this.addSource,this)},setRule:function(a){if("function"!=typeof a)a=p.UNION;if(this.rule!==a)this.rule=a,this.applyRule()},applyRule:function(a){var b=this.memberMap_,d=this.rule,e=this.sources.length,f=[],g=[],h,i,j;a||(a=b);for(var k in a)h=b[k],i=e&&h.count&&
d(h.count,e),i!=!!this.item_[k]&&(i?f:g).push(h.object),0==h.count&&delete b[k];(j=l(f,g))&&this.event_datasetChanged(this,j)},addSource:function(a){if(a instanceof k&&this.sources.add(a)){this.listen.source&&a.addHandler(this.listen.source,this);var b=this.memberMap_,d;for(d in a.item_)b[d]?b[d].count++:b[d]={count:1,object:a.item_[d]};this.applyRule();this.event_sourcesChanged(this,{inserted:[a]});return!0}},removeSource:function(a){if(this.sources.remove(a)){this.listen.source&&a.removeHandler(this.listen.source,
this);var b=this.memberMap_,d;for(d in a.item_)b[d].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[a]});return!0}},setSources:function(a){for(var b=Array.from(this.sources),d=0,e;e=a[d];d++)e instanceof k&&(b.remove(e)||this.addSource(e));b.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){k.prototype.destroy.call(this);this.sources=null}});p.UNION=p.prototype.rule;p.INTERSECTION=function(a,b){return a==
b};p.DIFFERENCE=function(a){return 1==a};p.MORE_THAN_ONE_INCLUDE=function(a,b){return 1==b||1<a};p.AT_LEAST_ONE_EXCLUDE=function(a,b){return 1==b||a<b};var n=function(a){return!this.has(a)},C=m(k,{subscribeTo:t.MINUEND+t.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:q("operandsChanged","dataset","oldMinuend","oldSubtrahend"),listen:{minuend:{datasetChanged:function(a,b){if(this.subtrahend){var d=l(b.inserted&&b.inserted.filter(n,this.subtrahend),b.deleted&&b.deleted.filter(this.has,
this));d&&this.event_datasetChanged(this,d)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(a,b){if(this.minuend){var d=l(b.deleted&&b.deleted.filter(n,this),b.inserted&&b.inserted.filter(this.has,this));d&&this.event_datasetChanged(this,d)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(a){k.prototype.init.call(this,a);var a=this.minuend,b=this.subtrahend;this.subtrahend=this.minuend=null;(a||b)&&this.setOperands(a,b)},setOperands:function(a,
b){var d,e=!1;!1==a instanceof k&&(a=null);!1==b instanceof k&&(b=null);var f=this.minuend,g=this.subtrahend;if(f!==a){e=!0;this.minuend=a;var h=this.listen.minuend;h&&(f&&f.removeHandler(h,this),a&&a.addHandler(h,this))}if(g!==b&&(e=!0,this.subtrahend=b,h=this.listen.subtrahend))g&&g.removeHandler(h,this),b&&b.addHandler(h,this);if(!e)return!1;this.event_operandsChanged(this,f,g);if(!a||!b)this.itemCount&&this.event_datasetChanged(this,d={deleted:this.getItems()});else{var e=[],f=[],i;for(i in this.item_)(!a.item_[i]||
b.item_[i])&&e.push(this.item_[i]);for(i in a.item_)!this.item_[i]&&!b.item_[i]&&f.push(a.item_[i]);(d=l(f,e))&&this.event_datasetChanged(this,d)}return d},clear:function(){this.setOperands()}}),u={subscribeTo:t.SOURCE,source:null,event_sourceChanged:q("sourceChanged","dataset","oldSource"),init:function(a){k.prototype.init.call(this,a);if(a=this.source)this.source=null,this.setSource(a)},setSource:function(a){!1==a instanceof k&&(a=null);if(this.source!==a){var b=this.source,d=this.listen.source;
this.source=a;if(d){var e=d.datasetChanged;b&&(b.removeHandler(d,this),e&&e.call(this,b,{deleted:b.getItems()}));a&&(a.addHandler(d,this),e&&e.call(this,a,{inserted:a.getItems()}))}this.event_sourceChanged(this,b)}},clear:function(){this.setSource()}},a=m(k,u,{map:B,reduce:r,rule:r,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:{update:function(a){var b=this.map?this.map(a):a;if(!1==b instanceof j||this.reduce(b))b=null;var d=this.sourceMap_[a.eventObjectId],e=d.member;
if(e!=b){var f=this.memberMap_,g,h,i;d.member=b;if(e)d=e.eventObjectId,this.removeMemberRef&&this.removeMemberRef(e,a),0==--f[d]&&(delete f[d],i=[e]);if(b)e=b.eventObjectId,this.addMemberRef&&this.addMemberRef(b,a),f[e]?f[e]++:(f[e]=1,h=[b]);(g=l(h,i))&&this.event_datasetChanged(this,g)}}},source:{datasetChanged:function(a,b){var d=this.sourceMap_,e=this.memberMap_,f=[],g=[],h,i,k,m=this.listen.sourceObject;y.setAccumulateState(!0);if(b.inserted)for(var n=0;h=b.inserted[n];n++){k=this.map?this.map(h):
h;if(!1==k instanceof j||this.reduce(k))k=null;m&&h.addHandler(m,this);d[h.eventObjectId]={sourceObject:h,member:k};if(k)i=k.eventObjectId,e[i]?e[i]++:(e[i]=1,f.push(k)),this.addMemberRef&&this.addMemberRef(k,h)}if(b.deleted)for(n=0;h=b.deleted[n];n++)if(i=h.eventObjectId,k=d[i].member,m&&h.removeHandler(m,this),delete d[i],k)i=k.eventObjectId,0==--e[i]&&(delete e[i],g.push(k)),this.removeMemberRef&&this.removeMemberRef(k,h);y.setAccumulateState(!1);(b=l(f,g))&&this.event_datasetChanged(this,b)},
destroy:function(){this.setSource()}}},init:function(a){this.sourceMap_={};u.init.call(this,a)},setRule:function(a){"function"!=typeof a&&(a=x);if(this.rule!==a)return this.rule=a,this.applyRule()},setMap:function(a){"function"!=typeof a&&(a=B);if(this.map!==a)return this.map=a,this.applyRule()},applyRule:function(){var a=this.sourceMap_,b=this.memberMap_,d,e,f,g,h,i=[],k=[],m,n;for(n in a){h=a[n];g=h.sourceObject;d=h.member;e=this.map?this.map(g):g;if(!1==e instanceof j||this.reduce(e))e=null;if(d!=
e){h.member=e;if(d)f=d.eventObjectId,this.removeMemberRef&&this.removeMemberRef(d,g),b[f]--;if(e)d=e.eventObjectId,this.addMemberRef&&this.addMemberRef(e,g),d in b?b[d]++:(b[d]=1,i.push(e))}}for(f in this.item_)0==b[f]&&(delete b[f],k.push(this.item_[f]));(m=l(i,k))&&this.event_datasetChanged(this,m);return m},destroy:function(){k.prototype.destroy.call(this);this.sourceMap_=null}}),r=m(a,{reduce:function(a){return!this.rule(a)},rule:x}),q=m(a,{map:function(a){return this.keyMap.resolve(a)},rule:x,
subsetClass:k,keyMap:null,addMemberRef:function(a,b){a.event_datasetChanged(a,{inserted:[b]})},removeMemberRef:function(a,b){a.event_datasetChanged(a,{deleted:[b]})},init:function(c){if(!this.keyMap||!1==this.keyMap instanceof o)this.keyMap=new o(A({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));a.prototype.init.call(this,c)},getSubset:function(a,b){return this.keyMap.get(a,b)},destroy:function(){a.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}}),m=m(k,u,{rule:x,
index_:null,offset:0,limit:10,listen:{sourceObject:{update:function(a){var b=this.sourceMap_[a.eventObjectId],a=this.rule(a);if(a!==b.value)this.index_.splice(s(this.index_,b),1),b.value=a,this.index_.splice(s(this.index_,b),0,b),this.rebuild()}},source:{datasetChanged:function(a,b){var d=this.listen.sourceObject,e=this.index_,f=this.sourceMap_,g;if(g=b.inserted)for(var h=0,i;i=g[h];h++){var j={object:i,value:this.rule(i)};e.splice(s(e,j),0,j);f[i.eventObjectId]=j;d&&i.addHandler(d,this)}if(g=b.deleted)for(h=
0;i=g[h];h++)j=f[i.eventObjectId],e.splice(s(e,j),1),d&&i.removeHandler(d,this);this.rebuild()}}},init:function(a){this.index_=[];this.sourceMap_={};u.init.call(this,a)},setRange:function(a,b){this.offset=a;this.limit=b;this.rebuild()},rebuild:function(){for(var a=Object.slice(this.item_),b=this.index_.slice(this.offset,this.offset+this.limit),d=[],e,f=0,g;g=b[f];f++){var h=g.object.eventObjectId;a[h]?delete a[h]:d.push(g.object)}(e=l(d,v(a)))&&this.event_datasetChanged(this,e)}});basis.namespace("basis.data.dataset").extend({Merge:p,
Subtract:C,MapReduce:a,Subset:r,Split:q,Slice:m})})(basis,this);
(function(l){function s(a){f[a]=f[a]||0;return a+f[a]++}function m(){var a=Array.from(arguments),b=a.pop();"function"!=typeof b&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=
!0;return b}function A(){return m.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;0<b--;){if(null==arguments[b])return null;a.push(arguments[b])}return a.join("-")}))}var v=l.Class,B=l.Cleaner,x=Object.extend,r=Function.$self,q=Function.getter,t=l.data,j=l.EventObject,o=t.Dataset,k=t.dataset.Subset,y=t.dataset.Split,p=t.DataObject,n=t.STATE,C={},u={string:1,number:1},a=[],c=function(a){return isNaN(a)?null:Number(a)},b=function(a){return isNaN(a)?null:Number(a)},
d=function(a){return isNaN(a)?null:parseInt(a)},e=function(a){return null==a?null:""+a},f={},g=l.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+c;return e};B.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=
b,!0},remove:function(a,b){if(this.index[a]===b)return delete this.index[a],!0},destroy:function(){this.index=null}}),t=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},h=function(a,b){return function(c){if(!this.name)this.name=s(b);a.prototype.init.call(this,c)}},i=function(a){return function(b,c){o.setAccumulateState(!0);b=(b||[]).map(this.wrapper);o.setAccumulateState(!1);return a.prototype.sync.call(this,b,c)}},w=v(o,{wrapper:Function.$self,init:h(o,"EntitySet"),
sync:i(o),set:t(o,"set"),add:t(o,"add"),remove:t(o,"remove"),destroy:function(){o.prototype.destroy.call(this);delete this.wrapper}}),G=v(w,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),D=v(k,{init:h(k,"EntityCollection"),sync:i(k)});D.sourceHandler=k.sourceHandler;var H=v(y,{subsetClass:G,init:h(y,"EntityGrouping"),sync:i(y),getSubset:function(a,b){var c=y.prototype.getSubset.call(this,a,b);if(c)c.wrapper=this.wrapper;return c}}),L=function(a){if(this instanceof
L){var b=new z(a||r);return function(a,c){return null!=a?(c instanceof w||(c=b.createEntitySet()),c.set(a instanceof o?a.getItems():Array.from(a)),c):null}}};L.className="basis.entity.EntitySetWrapper";var z=v(null,{init:function(a){this.wrapper=a},createEntitySet:function(){return new w({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),E=function(a){if(this instanceof E){var b=function(a,b){if(null!=a){if(a===b||a.entityType===c)return a;var g,
h=c.idField;if(u[typeof a]){if(!h)return;g=a;a={};a[h]=g}else if(c.compositeKey)g=c.compositeKey(a,a);else if(h)g=a[h];else if(f&&(b=c.singleton,!b))return c.singleton=new e(a);null!=g&&d&&(b=d.get(g,c.entityClass));b&&b.entityType===c?b.update(a):b=new e(a);return b}return c.singleton},c=new K(a||{},b),d=c.index__,e=c.entityClass,f=c.isSingleton;x(b,{toString:function(){return this.typeName+"()"},entityType:c,type:b,typeName:c.name,index:d,reader:function(a){return c.reader(a)},get:function(a){return c.get(a)},
addField:function(a,b){c.addField(a,b)},all:c.all,createCollection:function(a,d,e){var f=c.collection_[a];return!f&&d?c.collection_[a]=new D({wrapper:b,source:e||c.all,rule:d}):f},getCollection:function(a){return c.collection_[a]},createGrouping:function(a,d,e){var f=c.grouping_[a];return!f&&d?c.grouping_[a]=new H({wrapper:b,source:e||c.all,rule:d}):f},getGrouping:function(a){return c.grouping_[a]},getSlot:function(a,b){return c.getSlot(a,b)}});return b}};E.className="basis.entity.EntityTypeWrapper";
var M=q("singleton"),J={};v(p,{});var K=v(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:!1,index__:null,slot_:null,init:function(b,c){this.name=b.name||s(this.name);this.index__=b.index;this.idFields={};a.push(this);this.isSingleton=b.isSingleton;this.wrapper=c;this.all=new G(Object.extend(b.all||{},{wrapper:c}));this.slot_={};if(b.extensible)this.extensible=!0;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(b.fields,this.addField,this);b.constrains&&
b.constrains.forEach(function(a){this.addCalcField(null,a)},this);if(this.isSingleton)this.get=M;b.aliases&&Object.iterate(b.aliases,this.addAlias,this);this.collection_={};if(b.collections)for(var d in b.collections)this.collection_[d]=new D({name:d,wrapper:c,source:this.all,rule:b.collections[d]||Function.$true});this.grouping_={};if(b.groupings)for(d in b.groupings)this.grouping_[d]=new H({name:d,wrapper:c,source:this.all,rule:b.groupings[d]||Function.$true});this.entityClass=O(this,this.all,this.index__,
this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:c,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(u[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||null==a)return null;for(var c in a){var d=c in this.aliases?this.aliases[c]:"";d&&d in this.fields&&(b[d]=this.fields[d].reader?this.fields[d].reader(a[c]):a[c])}return b},addAlias:function(a,b){b in this.fields&&!1==a in this.aliases&&(this.aliases[a]=b)},addField:function(a,
f){if(!this.all.itemCount){this.aliases[a]=a;"function"==typeof f&&(f={type:f});if("type"in f&&"function"!=typeof f.type)f.type=r;var h=f.type||r;if([c,b,d,e].has(h))f.id=!0;if(f.id){if(!this.index__)this.index__=new g(String);this.idFields[a]=!0;this.idField||this.compositeKey?(this.idField=null,this.compositeKey=A.apply(null,Object.keys(this.idFields))):this.idField=a}f.calc?this.addCalcField(a,f.calc,void 0):this.fields[a]=h;this.defaults[a]="defValue"in f?f.defValue:h();this.getters["get_"+a]=
function(){return this.data[a]};J[a]||(J[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){if(!this.calcs)this.calcs=[];for(var d={args:b.args,wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=g;break}if(f>e)return;if(this.idField&&a==this.idField)this.compositeKey=b;this.fields[a]=function(a,
b){"undefined"!=typeof console&&console.log("Calculate fields are readonly");return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(null!=a)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&null!=a){if(u[typeof a])return a;if(a&&a.entityType===this)return a.__id__;if(a instanceof p)a=a.data;return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);if(null!=b){var c=
this.slot_[b];c||(u[typeof a]&&(c={},this.idField&&!this.compositeKey&&(c[this.idField]=a),a=c),c=this.slot_[b]=new p({delegate:this.get(b),data:a}));return c}}}),N=v(p,{init:j.prototype.init,event_rollbackUpdate:j.createEvent("rollbackUpdate")}),O=function(a,b,c,d,e,f,g){function h(b,c,d){var e=!1,f=a.calcs,g=b.__id__,j=b.data;try{if(f)for(var k=0,m;m=f[k++];){var n=m.key;if(n){var o=j[n];j[n]=m.wrapper(c,j,j[n]);j[n]!==o&&(c[n]=o,e=!0)}else m.wrapper(c,j)}if(a.compositeKey)b.__id__=a.compositeKey(c,
j,b.__id__);else if(l&&l in c)b.__id__=j[l];b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(q){b.__id__=g;for(var p in c)b.data[p]=c[p];if(d)for(p in d)if(!b.modified)b.modified=d;e=!1}b.__id__!==g&&i(b,g,b.__id__);return e}function i(a,b,e){null!=b&&(c.remove(b,a),d[b]&&d[b].setDelegate());null!=e&&(c.add(e,a),d[e]&&d[e].setDelegate(a))}var l=a.idField;return v(N,g,{canHaveDelegate:!1,modified:null,isTarget:!0,extendConstructor_:!1,init:function(a){N.prototype.init.call(this);this.fieldHandlers_=
{};this.data={};this.root=this;this.target=this;var c,d={},g;for(g in e)g in a?(d[g]=f[g],c=e[g](a[g])):c=f[g],c&&c!==this&&c instanceof j&&c.addHandler(J[g],this)&&(this.fieldHandlers_[g]=!0),this.data[g]=c;h(this,d);b.event_datasetChanged(b,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,f){var g=e[b];if(!g){if(!a.extensible)return;g=r}var i,k=this.modified,c=g(c,this.data[b]),
g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{i={};if(b!=l)if(d){if(!k)this.modified=k={};if(!1===b in k)i.rollback={key:b,value:void 0},k[b]=g;else if(k[b]===c&&(i.rollback={key:b,value:c},delete k[b],!Object.keys(k).length))this.modified=null}else if(k&&b in k)if(k[b]!==c){i.rollback={key:b,value:k[b]};k[b]=c;break a}else return!1;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(J[b],this),this.fieldHandlers_[b]=!1);c&&c!==this&&c instanceof j&&
c.addHandler(J[b],this)&&(this.fieldHandlers_[b]=!0);i.key=b;i.value=g;i.delta={};i.delta[b]=g}else if(!d&&k&&b in k&&(i={rollback:{key:b,value:k[b]}},delete k[b],!Object.keys(k).length))this.modified=null;if(!f&&i){var d=i.key,b=i.delta||{},m;if(i.rollback)m={},m[i.rollback.key]=i.rollback.value;h(this,b,m)&&(d=!0);if(d)this.event_update(this,b),i.delta=b;m&&this.event_rollbackUpdate(this,m)}return i||!1},update:function(a,b){if(a){var c,d={},e,f={},g,i;for(i in a)if(g=this.set(i,a[i],b,!0)){if(g.key)c=
!0,d[g.key]=g.value;if(g.rollback)e=!0,f[g.rollback.key]=g.rollback.value}h(this,d,f)&&(c=!0);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:!1},reset:function(){this.update(f)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=n.PROCESSING){if(this.modified){var a=this.modified;
this.modified=null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(n.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.data[a].removeHandler(J[a],this);this.fieldHandlers_=C;this.__id__&&i(this,this.__id__,null);p.prototype.destroy.call(this);b.event_datasetChanged(b,{deleted:[this]});this.data=C;this.modified=null}})};l.namespace("basis.entity").extend({isEntity:function(a){return a&&a instanceof O},NumericId:c,NumberId:b,IntId:d,StringId:e,Index:g,CalculateField:m,
EntityType:E,Entity:O,BaseEntity:N,EntitySetType:L,EntitySet:w,ReadOnlyEntitySet:G,Collection:D,Grouping:H})})(basis);
