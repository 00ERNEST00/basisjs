/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(h){function p(a,b){for(var c in b)a[c]=b[c];return a}function u(a,b){for(var c in b)c in a==!1&&(a[c]=b[c]);return a}function v(a){return a==null||a==void 0}function t(a){return a}function B(a){var b={};a.names=function(a){return Object.slice(b,typeof a=="string"?a.qw():a)};a.extend=function(a){u(b,a);p(this,a);return this};return a}function C(a,b){for(var c=a.split("."),e=h,f,g,d;c.length;)if(f=c.shift(),g=(g?g+".":"")+f,e[f]||(e[f]=B((!c.length?b:null)||function(){},g),d&&(d.namespaces_[g]=
e[f])),e=e[f],!d&&(d=e,!d.namespaces_))d.namespaces_={};return q[a]=e}p(Object,{extend:p,complete:u,keys:function(a){var b=[],c;for(c in a)b.push(c);return b},values:function(a){var b=[],c;for(c in a)b.push(a[c]);return b},slice:function(a,b){var c={};if(!b)return p(c,a);for(var e=0,f;f=b[e++];)f in a&&(c[f]=a[f]);return c},splice:function(a,b){var c={};if(!b)return p(c,a);for(var e=0,f;f=b[e++];)f in a&&(c[f]=a[f],delete a[f]);return c},iterate:function(a,b,c){var e=[],f;for(f in a)e.push(b.call(c,
f,a[f]));return e},coalesce:function(){for(var a=arguments,b=0;b<a.length;b++)if(a[b]!=null)return a[b]}});var j=function(){},k=function(){var a=1,b={},c={};a++;return function(e,f){var g,d;if(!f){if(e.getter)return e.getter;if(typeof e=="function")return e}if(typeof e!="function")c[e]?g=c[e]:(g=new Function("object","return object != null ? object."+e+" : object"),g.path=e,g.getterIdx_=a++,c[e]=g);else if(g=e,!g.getterIdx_)g.getterIdx_=a++;d=g.getterIdx_;var i=b[d];if(i)if(typeof f=="undefined"){if(i.nmg)return i.nmg}else for(d=
0;d<i.length;d++){if(i[d].modificator===f)return i[d].getter}else i=b[d]=[];var l=!0;switch(f&&typeof f){case "string":d=function(a){return f.format(g(a))};break;case "function":d=function(a){return f(g(a))};break;case "object":l=!1;d=function(a){return f[g(a)]};break;default:d=g.path?g:function(a){return g(a)}}if(l&&(i.push({getter:d,modificator:f}),typeof f=="undefined"))i.nmg=d;return d.getter=d}}();p(Function,{$undefined:function(a){return a==void 0},$defined:function(a){return a!=void 0},$isNull:v,
$isNotNull:function(a){return a!=null&&a!=void 0},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:t,$const:function(a){return function(){return a}},$false:function(){return!1},$true:function(){return!0},$null:function(){return null},$undef:j,getter:k,def:function(a,b,c){c=c||v;return function(e){e=a(e);return c(e)?b:e}},wrapper:function(a){return function(b){var c={};c[a]=b;return c}},lazyInit:function(a,b){var c=0,e;return function(){c++||(e=a.apply(b||this,arguments));
return e}},lazyInitAndRun:function(a,b,c){var e=0,f;return function(){e++||(f=a.call(c||this));b.apply(f,arguments);return f}},runOnce:function(a,b){var c=0;return function(){if(!c++)return a.apply(b||this,arguments)}}});u(Function.prototype,{bind:function(a){var b=this,c=Array.from(arguments,1);return c.length?function(){return b.apply(a,c.concat.apply(c,arguments))}:function(){return b.apply(a,arguments)}}});u(Array,{isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"}});
p(Array,{from:function(a,b){if(a!=null){var c=a.length;if(typeof c=="undefined")return[a];b||(b=0);if(c-b>0){for(var e=[],f=0,g=b;g<c;)e[f++]=a[g++];return e}}return[]},create:function(a,b,c){for(var e=[],f=typeof b=="function",g=0;g<a;g++)e[g]=f?b.call(c,g,e):b;return e}});u(Array.prototype,{indexOf:function(a,b){b=parseInt(b)||0;if(b<0)return-1;for(;b<this.length;b++)if(this[b]===a)return b;return-1},lastIndexOf:function(a,b){for(var c=this.length,b=parseInt(b),b=isNaN(b)||b>=c?c-1:(b+c)%c;b>=0;b--)if(this[b]===
a)return b;return-1},forEach:function(a,b){for(var c=0,e=this.length;c<e;c++)c in this&&a.call(b,this[c],c,this)},every:function(a,b){for(var c=0,e=this.length;c<e;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0},some:function(a,b){for(var c=0,e=this.length;c<e;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1},filter:function(a,b){for(var c=[],e=0,f=this.length;e<f;e++)e in this&&a.call(b,this[e],e,this)&&c.push(this[e]);return c},map:function(a,b){for(var c=[],e=0,f=this.length;e<
f;e++)e in this&&(c[e]=a.call(b,this[e],e,this));return c},reduce:function(a,b){var c=this.length,e=arguments.length;if(c==0&&e==1)throw new TypeError;var f,g=0;e>1&&(f=b,g=1);for(e=0;e<c;e++)e in this&&(f=g++?a.call(null,f,this[e],e,this):this[e]);return f}});p(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[a>=0?a:this.length+a]},search:function(a,b,c){Array.lastSearchIndex=
-1;for(var b=Function.getter(b||t),c=parseInt(c)||0,e=this.length;c<e;c++)if(b(this[c])===a)return this[Array.lastSearchIndex=c]},lastSearch:function(a,b,c){Array.lastSearchIndex=-1;for(var b=Function.getter(b||t),e=this.length,c=isNaN(c)||c==null?e:parseInt(c),e=c>e?e:c;e-- >0;)if(b(this[e])===a)return this[Array.lastSearchIndex=e]},binarySearchPos:function(a,b,c,e,f,g){if(!this.length)return e?-1:0;var b=Function.getter(b||t),c=!!c,d,f=isNaN(f)?0:f,i=isNaN(g)?this.length-1:g;do if(g=f+i>>1,d=b(this[g]),
c?a>d:a<d)i=g-1;else if(c?a<d:a>d)f=g+1;else return a==d?g:e?-1:0;while(f<=i);return e?-1:g+(d<a^c)},binarySearch:function(a,b){return this.binarySearchPos(a,b,!1,!0)},add:function(a){return this.indexOf(a)==-1&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return a!=-1&&!!this.splice(a,1)},has:function(a){return this.indexOf(a)!=-1},merge:function(a){return this.reduce(p,a||{})},sortAsObject:function(a,b,c){a=Function.getter(a);c=c?-1:1;return this.map(function(b,c){return{i:c,v:a(b)}}).sort(b||
function(a,b){return c*(a.v>b.v||-(a.v<b.v)||(a.i>b.i?1:-1))}).map(function(a){return this[a.i]},this)},set:function(a){if(this!==a)this.length=0,this.push.apply(this,a);return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var n=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);if(a.length<2)a[1]=this.length;return n.apply(this,a)}}var r={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",
nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};u(String,{toLowerCase:function(a){return String(a).toLowerCase()},toUpperCase:function(a){return String(a).toUpperCase()},trim:function(a){return String(a).trim()},trimLeft:function(a){return String(a).trimLeft()},trimRight:function(a){return String(a).trimRight()},isEmpty:function(a){return a==null||String(a)==""},isNotEmpty:function(a){return a!=null&&String(a)!=""}});
u(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});p(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(b){if(a)throw b;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){for(var a=[],b=this.length,c=0;c<b;c++)a[c]=this.charAt(c);return a},repeat:function(a){return Array(parseInt(a)+1||0).join(this)},qw:function(){var a=
this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(a){for(var b={},c=0;c<arguments.length;c++)b[c]=arguments[c];typeof a=="object"&&p(b,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(a,c,g,d,i){a=c in b?b[c]:i?"":a;return g&&!isNaN(a)?(a=Number(a),g=="."?a.toFixed(d):a.lead(d)):a})},quote:function(a,b){var a=a||'"',b=b||r[a]||a,c=(a.length==1?a:"")+(b.length==1?b:"");return a+
(c?this.replace(RegExp("["+c.forRegExp()+"]","g"),"\\$&"):this)+b},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=11)String.prototype.split=function(a){if(a==""||a&&a.source=="")return this.toArray();
var b=[],c=0,e;if(a instanceof RegExp)for(a.global||(a=RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));e=a.exec(this);)e[0]=this.substring(c,e.index),b.push.apply(b,e),c=a.lastIndex;else for(;(e=this.indexOf(a,c))!=-1;)b.push(this.substring(c,e)),c=e+a.length;b.push(this.substr(c));return b};if("12".substr(-1)!="2"){var w=String.prototype.substr;String.prototype.substr=function(a,b){return w.call(this,a<0?Math.max(0,this.length+a):a,b)}}p(Number.prototype,{fit:function(a,b){return!isNaN(a)&&this<a?
Number(a):!isNaN(b)&&this>b?Number(b):this},between:function(a,b){return!isNaN(this)&&this>=a&&this<=b},quote:function(a,b){return(this+"").quote(a,b)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(a){return!a||isNaN(a)?0:Math.floor(this/a)*a},lead:function(a,b){return(this+"").replace(/\d+/,function(c){return(a-=c.length-1)>1?Array(a).join(b||0)+c:c})},group:function(a,b){return(this+"").replace(/\d+/,function(c){return c.replace(/\d/g,
function(e,f){return!f+(c.length-f)%(a||3)?e:(b||" ")+e})})},format:function(a,b,c,e,f){a=this.toFixed(a);if(b||f)a=a.replace(/(\d+)(\.?)/,function(a,d,i){return(b?Number(d).group(3,b):d)+(i?f||i:"")});c&&(a=a.replace(/^-?/,"$&"+(c||"")));return a+(e||"")}});u(Date,{now:function(){return+new Date}});(new Date).getYear()<1900&&p(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&a<100?Number(a)+1900:a)}});var q={},z=function(){function a(a,
b){for(var d=q[a],i=b?b.split(/\./):[];d&&i.length;)d=d[i.shift()];return d}var b=h.document?h.document.getElementsByTagName("SCRIPT"):null,c=(b?b[b.length-1].src:module.filename).replace(/[^\/]+$/,""),e={};return typeof require=="function"?function(a){return require(requirePath+a.replace(/\./g,"/"))}:function(b,g){var d=b.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],i=b.substr(d.length?d.length+1:0),l=a(d,i),m=/^basis\./.test(d)?c:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,
"");if(!q[d]||!l)if(/^https?:/.test(m))if(e[b])throw"Attempt to load namespace, probably cycle require";else{e[b]=1;var x=new XMLHttpRequest;x.open("POST",m+(g||"")+b.replace(/\./g,"/")+".js",!1);x.send(null);if(x.status==200)try{(new Function(x.responseText)).call(h)}catch(H){throw H;}else if(x.status==404&&i)z(d);else throw"!";}else throw"Path `"+b+"` can't be resolved";return l||a(d,i)}}(),y=function(){function a(a){return typeof a=="function"&&a.basisClass_}var b=Function(),c=1;p(b,{className:"basis.Class",
extendConstructor_:!1,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var a in this)this[a]=null;this.destroy=j}},create:function(e){typeof e!="function"&&(e=b);var d=Function();d.prototype=e.prototype;for(var d={className:e.className+"._SubClass_",basisClass_:!0,superClass_:e,extendConstructor_:!!e.extendConstructor_,__extend__:function(d){return d&&(typeof d=="object"||typeof d=="function"&&!a(d))?b.create.call(null,
x,d):d},extend:b.extend,subclass:function(){return b.create.apply(null,[x].concat(Array.from(arguments)))},prototype:new d},i=arguments,l=1;l<i.length;l++)d.extend(typeof i[l]=="function"&&!a(i[l])?i[l](e.prototype):i[l]);var m={},x=d.extendConstructor_?function(a,d){this.eventObjectId=c++;var l,b;for(b in a)l=this[b],this[b]=l&&l.__extend__?l.__extend__(a[b]):a[b];this.init(d||m)}:function(){this.eventObjectId=c++;this.init.apply(this,arguments)};d.prototype.constructor=x;p(x,d);return x},extend:function(a){var d=
this.prototype;if(a.prototype)a=a.prototype;var b=Object.keys(a);a.toString!==Object.prototype.toString&&b.add("toString");for(var l=b.length;l-- >0;){var m=b[l],c=a[m],e=d[m];m=="className"||m=="extendConstructor_"?this[m]=c:d[m]=e&&e.__extend__?e.__extend__(c):c}return this}});var e=function(a,d){return{__extend__:function(a){var l=Function();l.prototype=this;l=new l;d(l,a);return l}}.__extend__(a)},f=function(a){return e(a,p)};return C("basis.Class",b.create).extend({BaseClass:b,create:b.create,
isClass:a,CustomExtendProperty:e,ExtensibleProperty:f,NestedExtProperty:function(a){return e(a,function(a,b){for(var l in b){var m=a[l];a[l]=m&&m.__extend__?m.__extend__(b[l]):f(b[l])}})}})}(),s=function(){function a(a){var d=c[a];d||(d=c[a]=function(){var d=this.handlers_,l,m;if(d&&d.length)for(var d=b.call(d),c=d.length;c-- >0;)l=d[c],m=l.handler[a],typeof m=="function"&&m.apply(l.thisObject,arguments)});return d}var b=Array.prototype.slice,c={},e,f=y(null,{handlers_:null,event_destroy:e=a("destroy",
"object"),listen:y.NestedExtProperty(),extendConstructor_:!0,init:function(){if(this.handler)(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(a,d){var b=this.handlers_;if(!b)b=this.handlers_=[];d||(d=this);for(var l=b.length,m;l-- >0;)if(m=b[l],m.handler===a&&m.thisObject===d)return!1;return!!b.push({handler:a,thisObject:d||this})},removeHandler:function(a,d){var b=this.handlers_;if(b){d||(d=this);for(var l=b.length,m;l-- >
0;)if(m=b[l],m.handler===a&&m.thisObject===d)return!!b.splice(l,1);return!1}},destroy:function(){if(this.handlers_)e.call(this,this),this.handlers_=null}});f.createEvent=a;f.event=c;return f}(),o=function(){var a=[];return{add:function(b){b!=null&&a.push(b)},remove:function(b){a.remove(b)}}}();(function(){function a(a){if(b){if(a.source!=h||a.data!=c)return;basis.dom.event.kill(a)}e.length&&(a=e.shift(),delete f[a.key],a.fn())}var b=typeof addEventListener=="function"&&typeof postMessage=="function",
c="zeroTimeoutMessage",e=[],f={},g=1;b&&h.addEventListener("message",a,!0);var d=setTimeout;h.setTimeout=function(l,m){var i;m?i=d.call(h,l,m):(i={key:"z"+g++,fn:typeof l=="function"?l:new Function(l)},f[i.key]=i,e.push(i),b?postMessage(c,"*"):i.timer=d.call(h,a,0),i=i.key);return i};var i=clearTimeout;h.clearTimeout=function(a){if(/z\d+/.test(a)){var d=f[a];d&&(clearTimeout(d.timer),e.remove(d),delete f[a])}else return i.call(h,a)}})();var E=function(){function a(){if(!m)if(g.length){var a=Date.now(),
d=Math.max(g[0].eventTime,a);d<i&&(clearTimeout(l),l=setTimeout(c,(i=d)-a))}else l=clearTimeout(l),i=e}function b(l,b){var i=l.eventObjectId,m=d[b]&&d[b][i];m&&(g.remove(m),delete d[b][i],a())}function c(){var l=Date.now(),l=g.binarySearchPos(l+15,f);m=!0;g.splice(0,l).forEach(function(a){delete d[a.eventName][a.object.eventObjectId];a.callback.call(a.object)});m=!1;i=e;a()}var e=2E12,f=k("eventTime"),g=[],d={},i=e,l=null,m=!1;o.add({destroy:function(){m=!0;clearTimeout(l);g.length=0;d=null}});return{add:function(l,
i,m){var c=l.eventObjectId,e=d[i];e||(e=d[i]={});var G=e[c];if(G){if(isNaN(m))return b(l,i);if(G.eventTime==m)return;g.remove(G);G.eventTime=m}else{if(isNaN(m))return;G=e[c]={eventName:i,object:l,eventTime:m,callback:l[i]}}g.splice(g.binarySearchPos(m,f),0,G);a()},remove:b}}();C("basis").extend({namespace:C,platformFeature:{},EventObject:s,TimeEventManager:E,Cleaner:o,require:z});h.basis.locale={}})(this);
(function(h,p){function u(h){for(var o=1E6,h=String(h).split("."),j=0,a=0;j<4&&j<h.length;j++,o/=100)a+=h[j]*o;return a}function v(){for(var h=0;h<arguments.length;h++){var j=arguments[h].toLowerCase();if(j in B){if(B[j])return!0}else{var k=j.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(k){B[j]=!1;var a=k[1].toLowerCase(),b=u(k[3]),k=k[4]||"=";if(a=C[a])return B[j]=!b||k=="="&&a==b||k=="+"&&a>=b||k=="-"&&a<b}}}return!1}var t="basis.ua",B={},C={},j=p.navigator&&p.navigator.userAgent,k="unknown",n={MSIE:["Internet Explorer",
"msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]},r;for(r in n)if(!(r=="MSIE"&&p.opera)&&!(r=="Safari"&&j.match(/chrome/i))&&!(r=="AppleWebKit"&&j.match(/iphone/i))&&j.match(RegExp(r+".(\\d+(\\.\\d+)*)","i")))for(var w=n[r],q=p.opera&&typeof p.opera.version==
"function"?p.opera.version():RegExp.$1,z=u(q),k=w[0]+" "+q,q=0;q<w.length;q++)C[w[q].toLowerCase()]=z;h.platformFeature.datauri=!1;j=typeof Image!="undefined"?new Image:{};j.onload=function(){h.platformFeature.datauri=!0};j.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";if(v("IE7-"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(y){}t=h.namespace(t);t.toString=function(){return k};return t.extend({testImage:j,prettyName:k,test:v,is:function(h){return v(h)},
Cookies:{set:function(h,j,k,a){document.cookie=h+"="+(j==null?"":escape(j))+";path="+(a||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)+(k?";expires="+(new Date(Date.now()+k*1E3)).toGMTString():"")},get:function(h){return(h=document.cookie.match(RegExp("(^|;)\\s*"+h+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(h[2])},remove:function(h,j){document.cookie=h+"=;expires="+(new Date(0)).toGMTString()+";path="+(j||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)}}})})(basis,this);
(function(h,p){function u(a,d,b){if(d!=null)return a.insertBefore(c(d)?d:C(d),b||null)}function v(a){return k("",a.cloneNode(!0)).innerHTML}function t(a){return c(a)||a&&a.nodeType?a:typeof a=="string"?q.getElementById(a):null}function B(d,b,i){var c,F=[],i=typeof i=="string"?getter(i):i||Function.$true;b&26&&i(d)&&F.push(d);switch(b){case 1:case 2:for(c=d;(c=c[s])&&c!==d.document;)i(c)&&F.push(c);break;case 64:for(c=d[o];c;)i(c)&&F.push(c),c=c[E];break;case 4:case 8:d[o]&&(b=new e(d),b.nodes(i,F));
break;case 128:b=new e(d,i);for(b.cursor_=d[E]||d[s];c=b.next();)F.push(c);break;case 256:for(c=d;c=c[E];)i(c)&&F.push(c);break;case 32:i(d[s])&&F.push(d[s]);break;case 512:b=new e(d,i,e.BACKWARD);for(b.cursor_=d[a]||d[s];c=b.next();)F.push(c);break;case 1024:for(c=d;c=c[a];)i(c)&&F.push(c)}return F}function C(a){return q.createTextNode(a!=null?a:"")}function j(){for(var a=q.createDocumentFragment(),d=arguments.length,b=j.array=[],i=0;i<d;i++)b.push(u(a,arguments[i]));return a}function k(a,b){var c=
a!=void 0&&typeof a!="string",e=(c?a.description:a)||"",F="div",D=e.match(/^([a-z0-9\_\-]+)(.*)$/i);D&&(F=D[1],e=D[2]);if(e!=""){for(var f=[],G={},k;D=i.exec(e);){if(D[8])throw Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+e+"\n\nProblem place:\n> "+e.substr(0,D.index)+"--\>"+e.substr(D.index)+"<--");k=D[1]||D[2]||D[3];D[1]?G.id=k:D[2]?f.push(k):k!="class"&&(G[k]=D[4]?w(D[5],D[6],D[7]):k)}g&&G.name&&/^(input|textarea|select)$/i.test(F)&&(F="<"+F+" name="+G.name+">")}e=
q.createElement(F);if(G){if(G.style&&d)e.style.cssText=G.style;for(var p in G)e.setAttribute(p,G[p],0)}if(f&&f.length)e.className=f.join(" ");arguments.length>1&&u(e,j.apply(0,Array.from(arguments,1).flatten()));if(c&&(a.css&&h.cssom&&h.cssom.setStyle(e,a.css),h.dom.event))for(var o in a)typeof a[o]=="function"?h.dom.event.addHandler(e,o,a[o],e):a[o]instanceof Event.Handler&&h.dom.event.addHandler(e,o,a[o].handler,a[o].thisObject);return e}function n(a,d){return a[s]?a[s].replaceChild(d,a):a}function r(a){if(q.selection){var d=
q.selection.createRange();d.compareEndPoints("StartToEnd",d)!=0&&d.collapse(a);return d.getBookmark().charCodeAt(2)-2}}var w=Object.coalesce,q=p.document,z=h.Class,y=q.createElement("div"),s="parentNode",o="firstChild",E="nextSibling",a="previousSibling",b;b=typeof y.compareDocumentPosition=="function"?function(a,d){return a.compareDocumentPosition(d)}:function(a,d){return a==d?0:a.document!=d.document?33:a.sourceIndex>d.sourceIndex?2|8*d.contains(childA):4|16*a.contains(childB)};var c;if(typeof Node!=
"undefined"){if(c=function(a){return a instanceof Node},!Node.prototype.contains)Node.prototype.contains=function(a){return!!(this.compareDocumentPosition(a)&16)}}else c=function(a){return a&&a.ownerDocument===q};var e=z(null,{root_:null,cursor_:null,filter:Function.$true,init:function(a,d,b){this.setRoot(a);this.setDirection(b);if(typeof d=="function")this.filter=d},setDirection:function(d){Object.extend(this,d?{a:"lastChild",b:a,c:E,d:o}:{a:o,b:E,c:a,d:"lastChild"})},setRoot:function(a){this.root_=
a||q;this.reset()},reset:function(){this.cursor_=null},first:function(a){this.reset();return this.next(a)},last:function(a){this.reset();return this.prev(a)},nodes:function(a,d){var b;d||(d=[]);for(this.reset();b=this.next(a);)d.push(b);return d},next:function(a){var a=a||this.filter,d=this.cursor_||this.root_;do for(var b=d[this.a];!b;){if(d===this.root_)return this.cursor_=null;(b=d[this.b])||(d=d[s])}while(!a(d=b));return this.cursor_=d},prev:function(a){var a=a||this.filter,d=this.cursor_,b=this.c,
i=this.d;do{var c=d?d[b]:this.root_[i];if(c){for(;c[i];)c=c[i];d=c}else d&&(d=d[s]);if(!d||d===this.root_){d=null;break}}while(!a(d));return this.cursor_=d},destroy:function(){this.cursor_=this.root_=null}});e.BACKWARD=!0;var f="textContent innerText nodeValue".qw(),g=function(){var a=q.createElement("input");a.name="a";return!/name/.test(v(a))}(),d;y.setAttribute("style","color: red");d=y.style.color!=="red";var i=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return h.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:e,outerHTML:v,textContent:function(a){for(var d=0,b;b=f[d++];)if(a[b]!=null)return a[b];return B(a,4,function(a){return a.nodeType==3}).map(getter("nodeValue")).join("")},get:t,tag:function(a,d){a=t(a)||q;return d=="*"&&a.all?Array.from(a.all):Array.from(a.getElementsByTagName(d||"*"))},axis:B,findAncestor:function(a,d,b){for(;a&&a!==b;){if(d(a))return a;a=a.parentNode}},createElement:k,createText:C,createFragment:j,insert:function(a,
d,b,i){a=t(a);if(!a)throw Error("basis.dom.insert: destination node can't be null");switch(b){case void 0:case "end":i=null;break;case "begin":i=a[o];break;case "before":break;case "after":i=i[E];break;default:i=Number(b).between(0,a.childNodes.length)?a.childNodes[b]:null}b=!c(a);if(!d||!Array.isArray(d))b=b?d&&a.insertBefore(d,i):u(a,d,i);else if(b)for(var b=[],e=0,D=d.length;e<D;e++)b[e]=a.insertBefore(d[e],i);else a.insertBefore(j.apply(0,d),i),b=j.array;return b},remove:function(a){return a[s]?
a[s].removeChild(a):a},replace:n,swap:function(a,d){if(a===d||b(a,d)&25)return!1;n(a,y);n(d,a);n(y,d);return!0},clone:function(a,d){var b=a.cloneNode(!d);b.attachEvent&&B(b,8).forEach(Event.clearHandlers);return b},clear:function(a){for(a=t(a);a.lastChild;)a.removeChild(a.lastChild);return a},wrap:function(a,d,b){var i=[],b=Function.getter(b||Function.$self),c;for(c in d)for(var e=0;e<a.length;e++){var f=b(a[e]);i[e]=d[c](a[e],e,f)?k(c,f):a[e]}return i},setAttribute:function(a,d,b){b==null?a.removeAttribute(d):
a.setAttribute(d,b)},parentOf:function(a,d){return a.contains(d)},isInside:function(a,d){return a==d||d.contains(a)},focus:function(a,d){try{a=t(a),a.focus(),d&&a.select&&a.select()}catch(b){}},setSelectionRange:function(a,d,b){arguments.length<3&&(b=d);if(a.setSelectionRange)a.setSelectionRange(d,b);else if(a.createTextRange){var i=a.createTextRange();i.collapse(!0);i.moveStart("character",d);i.moveEnd("character",b-d);i.select()}},getSelectionStart:function(a){return typeof a.selectionStart!="undefined"?
a.selectionStart:r(!0)},getSelectionEnd:function(a){return typeof a.selectionEnd!="undefined"?a.selectionEnd:r(!1)}})})(basis,this);
(function(h,p){function u(a){return a||p.event}function v(a){return typeof a=="string"?w.get(a):a}function t(a){a=u(a);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function B(a){a=u(a);a.preventDefault?a.preventDefault():a.returnValue=!1}function C(a){var b=Array.from(s[a.type]);if(b)for(var c=b.length;c-- >0;){var e=b[c];e.handler.call(e.thisObject,a)}}function j(a,b,c,e){a=v(a);if(!a)throw Error("Event.addHandler: can't attach event listener to undefined");if(typeof c!="function")throw Error("Event.addHandler: handler must be a function");
a[z]||(a[z]={});var f={handler:c,thisObject:e},g=a[z],d=g[b];if(d){for(a=0;b=d[a];a++)if(b.handler===c&&b.thisObject===e)return;d.push(f)}else d=g[b]=[f],d.fireEvent=function(a){a=u(a);if(o&&a&&typeof a.returnValue=="undefined"){C(a);if(a.cancelBubble===!0)return;if(typeof a.returnValue=="undefined")a.returnValue=!0}for(var b=0,c;c=d[b++];)c.handler.call(c.thisObject,a)},a.addEventListener?a.addEventListener(b,d.fireEvent,!1):a.attachEvent("on"+b,d.fireEvent)}function k(a,b,c,e){var a=v(a),f=a[z];
if(f&&(f=f[b]))for(var g=0,d;d=f[g];g++)if(d.handler===c&&d.thisObject===e){f.splice(g,1);f.length||n(a,b);break}}function n(a,b){var a=v(a),c=a[z];if(c)if(typeof b!="string")for(b in c)n(a,b);else{var e=c[b];e&&(a.removeEventListener?a.removeEventListener(b,e.fireEvent,!1):a.detachEvent("on"+b,e.fireEvent),delete c[b])}}var r=p.document,w=h.dom,q=Function.$null,z="__basisEvents",y={mousewheel:["mousewheel","DOMMouseScroll"]},s={},o=!r.addEventListener,E=function(){function a(){b++||setTimeout(function(){for(var a=
0;a<c.length;a++)c[a].callback.call(c[a].thisObject)},10)}var b=!1,c=[];if(h.ua.is("ie7-"))(function(){var b="_"+Date.now();r.write('<script id="'+b+'" defer src="//:"><\/script>');v(b).onreadystatechange=function(){this.readyState=="complete"&&(w.remove(this),a())}})();else if(h.ua.is("safari525-"))var e=setInterval(function(){/loaded|complete/.test(r.readyState)&&(clearInterval(e),a())},15);else j(r,"DOMContentLoaded",a,!1);j(r,"load",a,!1);j(p,"load",a,!1);return function(a,e){b||c.push({callback:a,
thisObject:e})}}();return h.namespace("basis.dom.event",u).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return y[a]||[a]},Handler:function(a,b){this.handler=a;this.thisObject=b},sender:function(a){a=u(a);return a.target||a.srcElement},cancelBubble:t,
cancelDefault:B,kill:function(a,b){(b=v(b))?j(b,a,Event.kill):(B(a),t(a))},key:function(a){a=u(a);return a.keyCode||a.which||0},charCode:function(a){a=u(a);return a.charCode||a.keyCode||0},mouseButton:function(a,b){a=u(a);return typeof a.which=="number"?a.which==b.VALUE:a.button&b.BIT},mouseX:function(a){a=u(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+(r.documentElement.scrollLeft||r.body.scrollLeft)},mouseY:function(a){a=u(a);return a.changedTouches?a.changedTouches[0].pageY:
"pageY"in a?a.pageY:a.clientY+(r.documentElement.scrollTop||r.body.scrollTop)},wheelDelta:function(a){a=u(a);return"wheelDelta"in a?a.wheelDelta/120:a.type=="DOMMouseScroll"?-a.detail/3:0},addGlobalHandler:function(a,b,c){var e=s[a];if(e)for(a=e.length;a-- >0;){var f=e[a];if(f.handler===b&&f.thisObject===c)return}else r.addEventListener?r.addEventListener(a,C,!0):j(r,a,q),e=s[a]=[];e.push({handler:b,thisObject:c})},removeGlobalHandler:function(a,b,c){var e=s[a];if(e)for(var f=0,g;g=e[f];f++)if(g.handler===
b&&g.thisObject===c){e.splice(f,1);e.length||(delete s[a],r.removeEventListener?r.removeEventListener(a,C,!0):k(r,a,q));break}},addHandler:j,addHandlers:function(a,b,c){var a=v(a),e;for(e in b)j(a,e,b[e],c)},removeHandler:k,clearHandlers:n,fireEvent:function(a,b){var a=v(a),c=a[z];c&&c[b]&&c[b].fireEvent()},onLoad:E,onUnload:function(a,b){j(p,"unload",a,b)}})})(basis,this);
(function(h,p){function u(a,d){return B(d,!0).getRule(a,!0)}function v(a,d){var b=a.match(/^([^{]+)\{(.*)\}\s*$/);if(b){for(var i=b[1].trim().split(/\s*,\s*/),c=0;c<i.length;c++)this.addRule(i[c],b[2]||null,d++);return d-1}}function t(a,d){var b=y.createElement(!a?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:d?"alternate ":"",url:a.quote('"')}));y.tag(null,"HEAD")[0].appendChild(b);b=b.sheet||b.styleSheet;try{if(!b.cssRules)b.cssRules=b.rules}catch(i){}if(!b.insertRule)b.insertRule=
v;if(!b.deleteRule)b.deleteRule=b.removeRule;return b}function B(a,d){a||(a="DefaultGenericStyleSheet");c[a]||d&&(c[a]=new g(t()));return c[a]}function C(a,d,b,i){for(var i=i||{},d=d.qw(),c=0,l;l=d[c];c++)if(typeof f.style[l]!="undefined"){b&&(h.platformFeature["css-"+a]=l);e[a]={key:l,getter:i[l]};break}}function j(a,d){var b=e[a];if(a=b?b.key:a.replace(/^-ms-/,"ms-").camelize())return{key:a,value:b&&b.getter?b.getter(d):d}}function k(a,d,b){if(typeof a.setProperty=="function")return a.setProperty(d,
b);if(d=j(d,b))return a.style[d.key]=d.value}function n(a,d){for(var b in d)k(a,b,d[b]);return a}function r(a,d){return k(a,"display",typeof d=="string"?d:d?"":"none")}function w(a,d){return k(a,"visibility",d?"":"hidden")}function q(a){return x[a]||(x[a]=RegExp("\\s*\\b"+a+"\\b"))}var z=p.document,y=h.dom,s=h.dom.event,o=h.Class,E=/\s*!important/i,a=String("important"),b=1,c={},e={},f=y.createElement("DIV");C("opacity","opacity MozOpacity KhtmlOpacity filter",!0,{fitler:function(a){return"alpha(opacity:"+
parseInt(a*100)+")"}});C("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",!0);C("float","cssFloat styleFloat");var g=o(null,{styleSheet:null,rules:null,init:function(a){this.styleSheet=a;this.rules=[];this.map_={}},getRule:function(a,b){if(!this.map_[a]&&b){for(var c=this.styleSheet,e=this.rules.length,l=c.insertRule(a+"{}",e),m=e;m<=l;m++)this.rules.push(new d(c.cssRules[m]));this.map_[a]=e!=l?new i(this.rules.splice(e)):this.rules[e]}return this.map_[a]},deleteRule:function(a){var d=
this.map_[a];if(d){for(var d=d.rules||[d],b=0;b<d.length;b++){var i=this.rules.indexOf(d[b]);this.stylesheet.deleteRule(i);this.rules.splice(i,1)}delete this.map_[a]}},destroy:function(){delete this.rules}}),d=o(null,{rule:null,selector:"",init:function(a){if(a)this.rule=a,this.selector=a.selectorText},setProperty:function(d,b){var i,c=!!E.test(b),e=this.rule.style;if(c||e.getPropertyPriority&&e.getPropertyPriority(d)==a){if(b=b.replace(E,""),i=j(d,b)){var l=i.key;e.setProperty?(c||e.removeProperty(l),
e.setProperty(l,i.value,c?a:"")):e.cssText=e.cssText.replace(RegExp(e[l]?l+"\\s*:\\s*"+e[l]+"(\\s*!"+a+")?\\s*;?":"^","i"),l+": "+i.value+(c?" !"+a:"")+";")}}else k(this.rule,d,b)},setStyle:function(a){Object.iterate(a,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),i=o(null,{rules:null,init:function(a){this.rules=a},destroy:function(){delete this.rules}});["setProperty","setStyle","clear"].forEach(function(a){i.prototype[a]=function(){for(var d,
b=0;d=this.rules[b];b++)d[a].apply(d,arguments)}});var l={};["em","ex","px","%"].forEach(function(a){l[a=="%"?"percent":a]=function(d){return d==0||isNaN(d)?"0":d+a}});var m,x={},H=o(null,{init:function(a){this.element=a},toString:function(){return this.element.className},set:function(a){this.clear();a.qw().forEach(this.add,this)},replace:function(a,d,b){b=b||"";typeof a!="undefined"&&this.remove(b+a);typeof d!="undefined"&&this.add(b+d)},bool:function(a,d){d?this.add(a):this.remove(a)},clear:function(){this.element.className=
""},contains:function(a){return!!this.element.className.match(q(a))},item:function(a){return this.element.className.qw()[a]},add:function(a){this.element.className.match(q(a))||(this.element.className+=" "+a)},remove:function(a){var d=this.element.className,a=d.replace(q(a),"");if(a!=d)this.element.className=a},toggle:function(a){var d=this.contains(a);d?this.remove(a):this.add(a);return!d}});p.DOMTokenList&&z.documentElement.classList?(o=H.prototype,Object.extend(p.DOMTokenList.prototype,{set:o.set,
replace:o.replace,bool:o.bool,clear:function(){for(var a=this.length;a-- >0;)this.remove(this[a])}}),m=function(a){return(typeof a=="string"?y.get(a):a).classList}):m=function(a){return new H(typeof a=="string"?y.get(a):a)};s.onLoad(function(){m(z.body).bool("opacity-not-support",!h.platformFeature["css-opacity"])});y.extend({setStyleProperty:k,setStyle:n,display:r,show:function(a){return r(a,1)},hide:function(a){return r(a)},visibility:w,visible:function(a){return w(a,1)},invisible:function(a){return w(a)}});
return h.namespace("basis.cssom").extend({setStyleProperty:k,setStyle:n,classList:m,uniqueRule:function(a){var d="genericRule-"+b++;a&&m(a).add(d);a=u("."+d);a.token=d;return a},cssRule:u,getStyleSheet:B,addStyleSheet:t,CssStyleSheetWrapper:g,CssRuleWrapper:d,CssRuleWrapperSet:i}).extend(l)})(basis,this);
(function(h,p){function u(a,c,e,f){for(var c=c.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i),g=s(),d,i=0;i<c.length;i++)i%2?(d=c[i].split(/\|/),a.getters[d[0]]=e+"childNodes["+f+"]",d=d.length>1?d[1]:d[0]):d=c[i].length?c[i]:null,d!=null&&(y&&(g.lastChild&&g.appendChild(j.createComment("")),f++),g.appendChild(o(d)),f++);return g}function v(a){return function(c){if(!c||!(c.type=="click"&&c.which==3)){var e=h.dom.event.sender(c),f,g;do if(f=e.getAttributeNode&&e.getAttributeNode(a))break;while(e=e.parentNode);
if(e&&f){do if(g=e.basisObjectId)if((g=w[g])&&g.templateAction){e=f.nodeValue.qw();f=0;for(var d;d=e[f++];)g.templateAction(d,h.dom.event(c));break}while(e=e.parentNode)}}}}function t(a,c,e){c=c.trim();if(!c)return"";for(var f="",g;g=z.exec(c);){var d=g[2],i=g[4]||g[5]||d;g[3]&&(a.getters[g[3]]=e+'.getAttributeNode("'+d+'")');if(g=d.match(/^event-([a-z]+)/i)){var l=g[1];if(!r[l]){r[l]=!0;g=0;for(var l=h.dom.event.browserEvents(l),m;m=l[g++];)h.dom.event.addGlobalHandler(m,v(d))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(a,d){var a=h.dom.event(a),b=this,i;do if(i=b.basisObjectId)if((i=w[i])&&i.templateAction){for(var b=d.qw(),c=0,e;e=b[c++];)i.templateAction(e,h.dom.event(a));break}while(b=b.parentNode)}}f+=d=="class"?i.trim().replace(/^(.)|\s+/g,".$1"):"["+d+(i?"="+i.quote('"'):"")+"]"}return f}function B(a,c){if(!a.stack)a.stack=[];if(!a.source)a.source=a.str;c||(c=".");for(var e=s(),f,g=0,d,i=a.stack;d=q.exec(a.str);){f=RegExp.leftContext;a.str=a.str.substr(f.length+d[0].length);if(f.length)e.appendChild(u(a,
f,c,g)),g=e.childNodes.length;if(d[5])if(d[5]==i[i.length-1])return i.pop(),e;else throw"Wrong end tag";if(d[6])d[7]&&(a.getters[d[7]]=c+"childNodes["+g+"]"),e.appendChild(j.createComment(d[6]));else{f=d[1];var l=d[2],m=!!d[4],x=c+"childNodes["+g+"]";d=k.createElement(f+t(a,d[3],x));l&&(a.getters[l]=x);m||(i.push(f),d.appendChild(B(a,x+".")));e.appendChild(d)}g++}a.str.length&&e.appendChild(u(a,a.str,c,g));if(i.length)throw"No end tag for "+i.reverse();return e}function C(a){if(!this.proto){a=this.source;
if(typeof a=="function")this.source=a=a();for(var a=a.trim(),a={str:a,getters:{element:".childNodes[0]"}},c=B(a),a=Object.iterate(a.getters,function(a,d){for(var b=a.split(/\|/).map(String.format,"obj_.{0}"),e=d.split(/(\.?childNodes\[(\d+)\])/),f=c,g=0;g<e.length;g+=3){var h=e[g+2];if(!h)break;e[g+2]="";f=f.childNodes[h];f.previousSibling?f.nextSibling||(e[g+1]=".lastChild"):e[g+1]=".firstChild"}return{name:b[0],alias:b.join("="),path:"dom_"+e.join("")}}).sortAsObject("path"),e=0;e<a.length;e++)for(var f=
RegExp("^"+a[e].path.forRegExp()),g=e+1,d;d=a[g++];)d.path=d.path.replace(f,a[e].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(a,d){obj_=a||{};dom_=proto_.cloneNode(!0);_code_();if(d&&obj_.element){var b=obj_.element.basisObjectId=map_.seed++;map_[b]=d}return obj_}.toString().replace("_code_()",a.map(String.format,"{alias}={path};\n").join(""))))(c,w);this.clearInstance=(new Function("map_","var obj_; return "+function(a){obj_=a;(a=obj_.element&&obj_.element.basisObjectId)&&
delete map_[a];_code_()}.toString().replace("_code_()",a.map(String.format,"{alias}=null;\n").join(""))))(w)}}var j=p.document,k=h.dom,n=h.Class,r={},w={seed:1},q=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<\!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,z=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;k.createFragment();var y=k.createElement("","a","b").cloneNode(!0).childNodes.length==1,s=k.createFragment,o=
k.createText,E=n(null,{__extend__:function(a){return a instanceof E?a:new E(a)},init:function(a){this.source=a},createInstance:function(a,c){C.call(this);return this.createInstance(a,c)},clearInstance:function(){C.call(this)}}),a=j.createElement("DIV");return h.namespace("basis.html").extend({Template:E,escape:function(a){return k.createElement("DIV",k.createText(a)).innerHTML},unescape:function(b){a.innerHTML=b;return a.firstChild.nodeValue},string2Html:function(b){a.innerHTML=b;return k.createFragment.apply(null,
Array.from(a.childNodes))}})})(basis,this);
(function(){function h(a,b,c){for(var e=1,f;b;)b&1&&(f=z[e],c&e?(a.addHandler(f.handler,f.context),f.action(f.context.add,a)):(a.removeHandler(f.handler,f.context),f.action(f.context.remove,a))),b>>=1,e<<=1}function p(a,b){var c={},e;if(a&&a.length)e=c.inserted=a;if(b&&b.length)e=c.deleted=b;if(e)return c}function u(a){return Array.isArray(a)?a.map(u):{data:a}}var v=basis.Class,t=basis.EventObject,B=Object.values,C=Function.$self,j=Function.$true,k=Function.$false,n=t.createEvent,r=t.event,w={},q=
[],z={},y=1,s={NONE:0,MASK:0,regType:function(a,b,c){z[y]={handler:b,action:c,context:{add:function(b,c){if(c){var i=s[a]+"_"+b.eventObjectId;if(!c.subscribers_)c.subscribers_={};if(!c.subscribers_[i]){var e=c.subscriberCount;c.subscribers_[i]=b;c.subscriberCount+=1;c.event_subscribersChanged(c,e)}}},remove:function(b,c){if(c){var i=s[a]+"_"+b.eventObjectId;if(c.subscribers_[i]){var e=c.subscriberCount;delete c.subscribers_[i];c.subscriberCount-=1;c.event_subscribersChanged(c,e)}}}}};s[a]=y;s.MASK|=
y;y<<=1}};s.regType("DELEGATE",{delegateChanged:function(a,b){this.remove(a,b);this.add(a,a.delegate)}},function(a,b){a(b,b.delegate)});s.regType("TARGET",{targetChanged:function(a,b){this.remove(a,b);this.add(a,a.target)}},function(a,b){a(b,b.target)});s.regType("SOURCE",{sourceChanged:function(a,b){this.remove(a,b);this.add(a,a.source)},sourcesChanged:function(a,b){var c;if(c=b.inserted)for(var e=c.length;e-- >0;)this.add(a,c[e]);if(c=b.deleted)for(e=c.length;e-- >0;)this.remove(a,c[e])}},function(a,
b){for(var c=b.sources||[b.source],e=0,f;f=c[e++];)a(b,f)});var o=v(t,{state:"ready",data:null,canHaveDelegate:!0,delegate:null,root:null,cascadeDestroy:!1,isTarget:!1,target:null,active:!1,subscribeTo:s.DELEGATE+s.TARGET,subscriberCount:0,subscribers_:null,event_update:n("update","object","delta"),event_stateChanged:n("stateChanged","object","oldState"),event_delegateChanged:n("delegateChanged","object","oldDelegate"),event_rootChanged:n("rootChanged","object","oldRoot"),event_targetChanged:n("targetChanged",
"object","oldTarget")&&function(a,b){var c=this.listen.target;c&&(b&&b.removeHandler(c,this),this.target&&this.target.addHandler(c,this));r.targetChanged.call(this,a,b)},event_subscribersChanged:n("subscribersChanged","object"),event_activeChanged:n("activeChanged","object"),listen:{delegate:{update:function(a,b){this.data=a.data;this.event_update(this,b)},stateChanged:function(a,b){this.state=a.state;this.event_stateChanged(this,b)},targetChanged:function(a,b){this.target=a.target;this.event_targetChanged(this,
b)},rootChanged:function(a,b){this.data=a.data;this.event_rootChanged(this,b)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},init:function(a){t.prototype.init.call(this,a);if(a=this.delegate)this.delegate=null,this.data=a.data,this.state=a.state,this.setDelegate(a);else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&h(this,this.subscribeTo,s.MASK)},isConnected:function(a){if(a instanceof o){for(;a&&a!==this&&a!==a.delegate;)a=
a.delegate;return a===this}return!1},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&a&&a instanceof o){if(a.delegate&&this.isConnected(a))return!1}else a=null;if(this.delegate!==a){var b=this.state,c=this.data,e=this.delegate,f=this.target,g=this.root,h={};e&&e.removeHandler(this.listen.delegate,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;a.addHandler(this.listen.delegate,
this);for(var j in a.data)j in c===!1&&(h[j]=void 0);for(j in c)c[j]!==a.data[j]&&(h[j]=c[j])}else for(j in this.target=this.delegate=null,this.root=this,this.data={},c)this.data[j]=c[j];this.event_delegateChanged(this,e);this.root!==g&&this.event_rootChanged(this,g);this.target!==f&&this.event_targetChanged(this,f);if(a){for(j in h){this.event_update(this,h);break}b!==this.state&&(String(b)!=this.state||b.data!==this.state.data)&&this.event_stateChanged(this,b)}return!0}return!1},setState:function(a,
b){var c=this.target||this.getRootDelegate();if(c!==this)return c.setState(a,b);return this.state!=String(a)||this.state.data!=b?(c=this.state,this.state=Object(String(a)),this.state.data=b,this.event_stateChanged(this,c),!0):!1},deprecate:function(){this.state!="processing"&&this.setState("deprecated")},update:function(a){var b=this.target||this.getRootDelegate();if(b!==this)return b.update(a);if(a){var b={},c=0,e;for(e in a)this.data[e]!==a[e]&&(c++,b[e]=this.data[e],this.data[e]=a[e]);if(c)return this.event_update(this,
b),b}return!1},setActive:function(a){a=!!a;return this.active!=a?(this.active=a,this.event_activeChanged(this),h(this,this.subscribeTo,s.MASK*a),!0):!1},setSubscription:function(a){a&=s.MASK;var b=this.subscribeTo^a;return b?(this.subscribeTo=a,this.active&&h(this,b,a),!0):!1},destroy:function(){this.active&&h(this,this.subscribeTo,0);this.delegate&&this.setDelegate();t.prototype.destroy.call(this);this.data=w;this.state="undefined";this.target=this.root=null}}),E=v(null,{itemClass:o,keyGetter:C,
map_:null,extendConstructor_:!0,init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var b={};a instanceof o?b.delegate=a:b.data={id:a,title:a};return new this.itemClass(b)},get:function(a,b){var c=a instanceof o?a.eventObjectId:a,e=this.map_[c];!e&&b&&(e=this.map_[c]=this.create(a,b),e.addHandler({destroy:function(){delete this.map_[c]}},this));return e},destroy:function(){basis.Cleaner.remove(this);for(var a=B(this.map_),
b=0,c;c=a[b++];)c.destroy()}}),a=v(o,{state:"undefined",itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:n("datasetChanged","dataset","delta")&&function(a,b){var c,e=0,f=0,g;if(c=b.inserted)for(;g=c[e];)this.item_[g.eventObjectId]=g,e++;if(c=b.deleted)for(;g=c[f];)delete this.item_[g.eventObjectId],f++;this.itemCount+=e-f;this.cache_=null;r.datasetChanged.call(this,a,b)},init:function(a){o.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!(!a||
!this.item_[a.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=B(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var b=[];if(a)for(var c in this.item_)if(b.push(this.item_[c])>=a)break;return b},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();o.prototype.destroy.call(this);this.cache_=q;this.itemCount=0;this.item_=this.memberMap_=null}}),
b=v(a,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&this.remove([a])}}},init:function(b){a.prototype.init.call(this,b);if(b=this.items)this.set(b),this.items=null},add:function(a){for(var b,c=this.memberMap_,e=[],f=0;f<a.length;f++){var g=a[f];if(g instanceof o){var h=g.eventObjectId;c[h]||(c[h]=g,g.addHandler(this.listen.item,this),e.push(g))}}e.length&&this.event_datasetChanged(this,b={inserted:e});return b},remove:function(a){for(var b,c=this.memberMap_,e=[],f=0;f<a.length;f++){var g=
a[f];if(g instanceof o){var h=g.eventObjectId;c[h]&&(g.removeHandler(this.listen.item,this),delete c[h],e.push(g))}}e.length&&this.event_datasetChanged(this,b={deleted:e});return b},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var b=this.memberMap_,c={},e=[],f=[],g,h,j,k=0;k<a.length;k++)if(g=a[k],g instanceof o)h=g.eventObjectId,c[h]=g,b[h]||(b[h]=g,g.addHandler(this.listen.item,this),f.push(g));for(h in b)c[h]||(g=b[h],g.removeHandler(this.listen.item,
this),delete b[h],e.push(g));(j=p(f,e))&&this.event_datasetChanged(this,j);return j},sync:function(a,c){if(a){b.setAccumulateState(!0);for(var e=this.memberMap_,f,g,h={},j=[],k,p=0;p<a.length;p++)if(f=a[p],f instanceof o)g=f.eventObjectId,h[g]=f,e[g]||j.push(f);for(g in this.item_)h[g]||this.item_[g].destroy();c&&j.length&&(k=this.add(j));b.setAccumulateState(!1);return k}},clear:function(){var a,b=this.getItems();if(b.length){for(a=b.length;a-- >0;)b[a].removeHandler(this.listen.item,this);this.event_datasetChanged(this,
a={deleted:b});this.memberMap_={}}return a}});b.setAccumulateState=function(){function b(a){var d=a.dataset;g.call(d,d,a)}function c(a,e){var i=a.eventObjectId,f=e.inserted,l=e.deleted,h=k[i];if(f&&l)return h&&(delete k[i],b(h)),g.call(a,a,e);if(h){var m=h[f?"inserted":"deleted"];if(m)return m.push.apply(m,f||l);else b(h)}k[i]=e;e.dataset=a}function e(){h=1;setAccumulateState(!1)}var f=a.prototype,g=f.event_datasetChanged,h=0,j,k={};return function(a){if(a){if(h==0)f.event_datasetChanged=c,j=setTimeout(e,
0);h++}else if(h-=h>0,h==0)clearTimeout(j),f.event_datasetChanged=g,a=k,k={},B(a).forEach(b)}}();var c=v(a,{subscribeTo:s.SOURCE,event_sourcesChanged:n("sourcesChanged","dataset","delta"),sources:null,rule:function(a){return a>0},listen:{source:{datasetChanged:function(a,b){var c=this.memberMap_,e={},f,g;if(b.inserted)for(var h=0;f=b.inserted[h];h++)g=f.eventObjectId,c[g]?c[g].count++:c[g]={count:1,object:f},e[g]=c[g];if(b.deleted)for(h=0;f=b.deleted[h];h++)g=f.eventObjectId,e[g]=c[g],c[g].count--;
this.applyRule(e)},destroy:function(a){this.removeSource(a)}}},init:function(b){a.prototype.init.call(this,b);b=this.sources;this.sources=[];b&&b.forEach(this.addSource,this)},setRule:function(a){if(typeof a!="function")a=c.UNION;if(this.rule!==a)this.rule=a,this.applyRule()},applyRule:function(a){var b=this.memberMap_,c=this.rule,e=this.sources.length,f=[],g=[],h,j,k;a||(a=b);for(var o in a)h=b[o],j=e&&h.count&&c(h.count,e),j!=!!this.item_[o]&&(j?f:g).push(h.object),h.count==0&&delete b[o];(k=p(f,
g))&&this.event_datasetChanged(this,k)},addSource:function(b){if(b instanceof a&&this.sources.add(b)){b.addHandler(this.listen.source,this);var c=this.memberMap_,e;for(e in b.item_)c[e]?c[e].count++:c[e]={count:1,object:b.item_[e]};this.applyRule();this.event_sourcesChanged(this,{inserted:[b]});return!0}},removeSource:function(a){if(this.sources.remove(a)){a.removeHandler(this.listen.source,this);var b=this.memberMap_,c;for(c in a.item_)b[c].count--;this.applyRule();this.event_sourcesChanged(this,
{deleted:[a]});return!0}},setSources:function(b){for(var c=Array.from(this.sources),e=0,f;f=b[e];e++)f instanceof a&&(c.remove(f)||this.addSource(f));c.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){a.prototype.destroy.call(this);this.sources=null}});c.UNION=c.prototype.rule;c.INTERSECTION=function(a,b){return a==b};c.DIFFERENCE=function(a){return a==1};c.MORE_THAN_ONE_INCLUDE=function(a,b){return b==1||a>1};c.AT_LEAST_ONE_EXCLUDE=
function(a,b){return b==1||a<b};var e=function(a){return!this.has(a)},f=v(a,{minuend:null,subtrahend:null,listen:{minuend:{datasetChanged:function(a,b){if(this.subtrahend){var c=p(b.inserted&&b.inserted.filter(e,this.subtrahend),b.deleted&&b.deleted.filter(this.has,this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(null,this.subtrahend)}},subtrahend:{datasetChanged:function(a,b){if(this.minuend){var c=p(b.deleted&&b.deleted.filter(e,this),b.inserted&&b.inserted.filter(this.has,
this));c&&this.event_datasetChanged(this,c)}},destroy:function(){this.setOperands(this.minuend,null)}}},init:function(b){a.prototype.init.call(this,b);var b=this.minuend,c=this.subtrahend;this.subtrahend=this.minuend=null;(b||c)&&this.setOperands(b,c)},setOperands:function(b,c){var e;b instanceof a==!1&&(b=null);c instanceof a==!1&&(c=null);var f=this.minuend,g=this.subtrahend;if(f!==b)f&&f.removeHandler(this.listen.minuend,this),(this.minuend=b)&&b.addHandler(this.listen.minuend,this);if(g!==c)g&&
g.removeHandler(this.listen.subtrahend,this),(this.subtrahend=c)&&c.addHandler(this.listen.subtrahend,this);if(!b||!c)this.itemCount&&this.event_datasetChanged(this,e={deleted:this.getItems()});else{var f=[],g=[],h;for(h in this.item_)(!b.item_[h]||c.item_[h])&&f.push(this.item_[h]);for(h in b.item_)!this.item_[h]&&!c.item_[h]&&g.push(b.item_[h]);(e=p(g,f))&&this.event_datasetChanged(this,e)}return e},clear:function(){this.setOperands()}}),g=v(a,{source:null,event_sourceChanged:n("sourceChanged",
"dataset","oldSource"),map:C,reduce:k,rule:k,addMemberRef:null,removeMemberRef:null,sourceMap_:null,listen:{sourceObject:{update:function(a){var b=this.map?this.map(a):a;if(b instanceof o==!1||this.reduce(b))b=null;var c=this.sourceMap_[a.eventObjectId],e=c.member;if(e!=b){var f=this.memberMap_,g,h,j;c.member=b;if(e)c=e.eventObjectId,this.removeMemberRef&&this.removeMemberRef(e,a),--f[c]==0&&(delete f[c],j=[e]);if(b)e=b.eventObjectId,this.addMemberRef&&this.addMemberRef(b,a),f[e]?f[e]++:(f[e]=1,h=
[b]);(g=p(h,j))&&this.event_datasetChanged(this,g)}}},source:{datasetChanged:function(a,c){var e=this.sourceMap_,f=this.memberMap_,g=[],h=[],j,k,n;b.setAccumulateState(!0);if(c.inserted)for(var q=0;j=c.inserted[q];q++){n=this.map?this.map(j):j;if(n instanceof o==!1||this.reduce(n))n=null;j.addHandler(this.listen.sourceObject,this);e[j.eventObjectId]={sourceObject:j,member:n};if(n)k=n.eventObjectId,f[k]?f[k]++:(f[k]=1,g.push(n)),this.addMemberRef&&this.addMemberRef(n,j)}if(c.deleted)for(q=0;j=c.deleted[q];q++)if(k=
j.eventObjectId,n=e[k].member,j.removeHandler(this.listen.sourceObject,this),delete e[k],n)k=n.eventObjectId,--f[k]==0&&(delete f[k],h.push(n)),this.removeMemberRef&&this.removeMemberRef(n,j);b.setAccumulateState(!1);(c=p(g,h))&&this.event_datasetChanged(this,c)},destroy:function(){this.setSource()}}},init:function(b){a.prototype.init.call(this,b);this.sourceMap_={};if(b=this.source)this.source=null,this.setSource(b)},setRule:function(a){typeof a!="function"&&(a=j);if(this.rule!==a)return this.rule=
a,this.applyRule()},setMap:function(a){typeof a!="function"&&(a=C);if(this.map!==a)return this.map=a,this.applyRule()},setSource:function(b){b instanceof a==!1&&(b=null);if(this.source!==b){var c=this.source;c&&(c.removeHandler(this.listen.source,this),this.listen.source.datasetChanged.call(this,c,{deleted:c.getItems()}));if(this.source=b)b.addHandler(this.listen.source,this),this.listen.source.datasetChanged.call(this,b,{inserted:b.getItems()});this.event_sourceChanged(this,c)}},applyRule:function(){var a=
this.sourceMap_,b=this.memberMap_,c,e,f,g,h,j=[],k=[],n,q;for(q in a){h=a[q];g=h.sourceObject;c=h.member;e=this.map?this.map(g):g;if(e instanceof o==!1||this.reduce(e))e=null;if(c!=e){h.member=e;if(c)f=c.eventObjectId,this.removeMemberRef&&this.removeMemberRef(c,g),b[f]--;if(e)c=e.eventObjectId,this.addMemberRef&&this.addMemberRef(e,g),c in b?b[c]++:(b[c]=1,j.push(e))}}for(f in this.item_)b[f]==0&&(delete b[f],k.push(this.item_[f]));(n=p(j,k))&&this.event_datasetChanged(this,n);return n},clear:function(){this.setSource()},
destroy:function(){a.prototype.destroy.call(this);this.sourceMap_=null}}),k=v(g,{reduce:function(a){return!this.rule(a)},rule:j}),v=v(g,{map:function(a){return this.keyMap.resolve(a)},rule:j,subsetClass:a,keyMap:null,addMemberRef:function(a,b){a.event_datasetChanged(a,{inserted:[b]})},removeMemberRef:function(a,b){a.event_datasetChanged(a,{deleted:[b]})},init:function(a){if(!this.keyMap||this.keyMap instanceof E==!1)this.keyMap=new E(Object.extend({keyGetter:this.rule,itemClass:this.subsetClass},
this.keyMap));g.prototype.init.call(this,a)},getSubset:function(a,b){return this.keyMap.get(a,b)},destroy:function(){g.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});Object.extend(b,{Merge:c,Subtract:f,MapReduce:g,Subset:k,Split:v});basis.namespace("basis.data",u).extend({STATE:{UNDEFINED:"undefined",READY:"ready",PROCESSING:"processing",ERROR:"error",DEPRECATED:"deprecated"},Subscription:s,Object:o,DataObject:o,KeyObjectMap:E,AbstractDataset:a,Dataset:b,AggregateDataset:c,
Collection:k,Grouping:v});basis.namespace("basis.data.dataset").extend({Merge:c,Subtract:f,MapReduce:g,Subset:k,Split:v})})();
(function(h){function p(a){return a.sortingValue||0}function u(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return+(a>b)||-(a<b)}function v(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return-(a>b)||+(a<b)}function t(a){return a.childNodes.sort(a.localSortingDesc?v:u)}function B(a,b){a.childNodes=b;a.firstChild=b[0]||null;a.lastChild=b[b.length-1]||null;for(var c=b.length-1;c>=0;c--)b[c].nextSibling=b[c+1]||null,b[c].previousSibling=b[c-1]||null,a.insertBefore(b[c],b[c].nextSibling)}function C(a,
b){var c=a.childFactory||a.document&&a.document.childFactory,e,b=Object.extend({document:a.document,contextSelection:a.selection||a.contextSelection},b);if(c&&(e=c.call(a,b),e instanceof a.childClass))return e;if(!e)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(a.childClass&&a.childClass.className)+" but "+(e&&e.constructor&&e.constructor.className)+")";}var j=h.Class,k=h.dom,n=h.data,r=h.html.Template,w=n.Subscription,q=n.DataObject,
z=n.AbstractDataset,y=n.Dataset,s=h.Cleaner,o=k.AXIS_DESCENDANT,E=k.AXIS_DESCENDANT_OR_SELF,a=Function.getter,b=Object.complete,c=h.cssom.classList,e=k.axis,f=h.EventObject.createEvent,g=h.EventObject.event;w.regType("DATASOURCE",{dataSourceChanged:function(a,b){this.remove(a,b);this.add(a,a.dataSource)}},function(a,b){a(b,b.dataSource)});var d=j.ExtensibleProperty(),i={ownerChanged:function(){},destroy:function(a){k.replace(a.element,this)}},l=function(){var a=this.key,b=this.config,c=this.owner,
e=typeof b.existsIf!="function"||b.existsIf(c),d=c.satellite[a];if(e){var e="delegate"in b,f="dataSource"in b,g=typeof b.delegate=="function"?b.delegate(c):null,h=typeof b.dataSource=="function"?b.dataSource(c):null;if(d)e&&d.setDelegate(g),f&&d.setDataSource(h);else{var A=c.tmpl[b.replace||a],d={owner:c};if(e)d.delegate=g;if(f)d.dataSource=h;b.config&&Object.complete(d,typeof b.config=="function"?b.config(c):b.config);d=new b.instanceOf(d);c.satellite[a]=d;A&&d instanceof K&&d.element&&(k.replace(A,
d.element),d.addHandler(i,A))}}else if(d)d.destroy(),d.owner=null,delete c.satellite[a]},m=j.CustomExtendProperty({update:!0},function(a,b){for(var c in b)a[c]=b[c]?l:null}),x=j(q,{event_update:function(a,b){q.prototype.event_update.call(this,a,b);var c=this.parentNode;c&&(c.matchFunction&&(this.match(),this.match(c.matchFunction)),c.insertBefore(this,this.nextSibling))},event_childNodesModified:f("childNodesModified","node","delta"),event_dataSourceChanged:f("dataSourceChanged","node","oldDataSource"),
event_localGroupingChanged:f("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:f("localSortingChanged","node"),event_ownerChanged:f("ownerChanged","node","oldOwner"),event_satellitesChanged:f("satellitesChanged","node","delta"),subscribeTo:q.prototype.subscribeTo+w.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegateParent:!1,nodeType:"DOMWrapperNode",canHaveChildren:!1,childNodes:null,dataSource:null,colMap_:null,destroyDataSourceMember:!0,document:null,
parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:!1,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:d,satellite:null,owner:null,init:function(a){var b=this.dataSource,c=this.childNodes,e=this.localGrouping;if(b)this.dataSource=null;q.prototype.init.call(this,a);if(e)this.localGrouping=null,this.setLocalGrouping(e);if(this.canHaveChildren)this.childNodes=[],b?(this.dataSource=null,this.setDataSource(b)):
c&&this.setChildNodes(c);else{if(c)this.childNodes=null;if(b)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==d)for(var f in this.satelliteConfig)if(a=this.satelliteConfig[f],j.isClass(a)&&(a={instanceOf:a}),typeof a=="object"){b={key:f,owner:this,config:a};a=a.hook?m.__extend__(a.hook):m;for(f in a)if(a[f]===l){this.addHandler(a,b);break}l.call(b)}if(f=this.owner)this.owner=null,this.setOwner(f)},appendChild:function(){},insertBefore:function(){},removeChild:function(){},
replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(a){if(!a||a instanceof x==!1)a=null;if(this.owner!==a){var b=this.owner;b&&b.removeHandler(this.listen.owner,this);(this.owner=a)&&a.addHandler(this.listen.owner,this);this.event_ownerChanged(this,b)}},destroy:function(){q.prototype.destroy.call(this);this.dataSource?
this.setDataSource():this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping)this.localGrouping.destroy(),this.localGrouping=null;this.owner&&this.setOwner();if(this.satellite){for(var a in this.satellite){var b=this.satellite[a];b.destroy();b.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=this.childNodes=this.document=null}}),H=j(x,{autoDestroyIfEmpty:!1,nodes:null,first:null,last:null,
init:function(a){this.nodes=[];x.prototype.init.call(this,a)},insert:function(a,b){var c=this.nodes,e=b?c.indexOf(b):c.length;if(e==-1)e=c.length;c.splice(e,0,a);this.first=c[0]||null;this.last=c[c.length-1]||null;a.groupNode=this;this.event_childNodesModified(this,{inserted:[a]})},remove:function(a){var b=this.nodes;if(b.remove(a))this.first=b[0]||null,this.last=b[b.length-1]||null,a.groupNode=null,this.event_childNodesModified(this,{deleted:[a]});!this.first&&this.autoDestroyIfEmpty&&this.destroy()},
clear:function(){if(this.first){for(var a=this.nodes,b=a.length;b-- >0;)a[b].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:a});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){x.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),F={canHaveChildren:!0,childClass:x,childFactory:null,listen:{dataSource:{datasetChanged:function(a,b){var c={},e=[];if(b.deleted)if(c.deleted=e,this.childNodes.length==b.deleted.length){e.push.apply(e,
this.childNodes);var d=this.dataSource;this.dataSource=null;this.clear(!0);this.dataSource=d;this.colMap_={}}else for(var d=0,f;f=b.deleted[d];d++){f=f.eventObjectId;var g=this.colMap_[f];delete this.colMap_[f];g.canHaveDelegate=!0;this.removeChild(g);e.push(g)}if(b.inserted){c.inserted=[];for(d=0;f=b.inserted[d];d++)g=C(this,{cascadeDestroy:!1,delegate:f}),g.canHaveDelegate=!1,this.colMap_[f.eventObjectId]=g,c.inserted.push(g),this.firstChild&&this.insertBefore(g)}this.firstChild?this.event_childNodesModified(this,
c):this.setChildNodes(c.inserted);if(this.destroyDataSourceMember&&e.length)for(d=0;f=e[d];d++)f.destroy()},destroy:function(a){this.dataSource===a&&this.setDataSource()}}},appendChild:function(a){return this.insertBefore(a)},insertBefore:function(a,b){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(a.firstChild){var c=this;do if(c==a)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";while(c=c.parentNode)}if(this.dataSource&&
!this.dataSource.has(a.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";a instanceof this.childClass==!1&&(a=C(this,a instanceof q?{delegate:a}:a));var d=a.parentNode===this,f=a.groupNode,g=this.localGrouping,c=this.localSorting,h=this.childNodes,i=null,A=-1;if(g){i=g.getGroupNode(a);g=i.nodes;if(d&&a.nextSibling===b&&f===i)return a;c?(c=c(a)||0,A=g.binarySearchPos(c,p,this.localSortingDesc),a.sortingValue=c):A=b&&b.groupNode===i?g.indexOf(b):g.length;
if(A<g.length)b=g[A];else if(i.last)b=i.last.nextSibling;else{c=i;for(b=null;c=c.nextSibling;)if(b=c.first)break}if(a===b||d&&a.nextSibling===b)return f!==i&&(f&&f.remove(a),i.insert(a)),a;A=-1}else if(c){var A=this.localSortingDesc,g=a.nextSibling,j=a.previousSibling,c=c(a)||0;if(d){if(c===a.localSorting)return a;if((!g||(A?g.sortingValue<=c:g.sortingValue>=c))&&(!j||(A?j.sortingValue>=c:j.sortingValue<=c)))return a.sortingValue=c,a}A=h.binarySearchPos(c,p,A);b=h[A];a.sortingValue=c;if(a===b||d&&
g===b)return a}else{if(b&&b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(d){if(a.nextSibling===b)return a;if(a===b)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}d?(a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling,a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:this.firstChild=a.nextSibling,a.previousSibling=null,a.nextSibling=null,A==-1?h.remove(a):(c=h.indexOf(a),h.splice(c,1),c<
A&&A--),f&&f.remove(a)):a.parentNode&&a.parentNode.removeChild(a);f!==i&&i.insert(a,b);if(b){A==-1&&(A=h.indexOf(b));if(A==-1)throw"basis.dom.wrapper: Node was not found";a.nextSibling=b;h.splice(A,0,a)}else A=h.length,h.push(a),b={previousSibling:this.lastChild},this.lastChild=a;a.parentNode=this;a.previousSibling=b.previousSibling;A==0?this.firstChild=a:b.previousSibling.nextSibling=a;b.previousSibling=a;var l=!1,k=!1,m=this.selection||this.contextSelection;if(!a.document&&a.document!==this.document)l=
this.document,a.document=this.document;if(!a.contextSelection&&a.contextSelection!==m)a.contextSelection=m,k=!a.selection,a.selected&&m.add([a]);a.firstChild&&(l||k)&&e(a,o).forEach(function(a){if(l&&!a.document)a.document=l;if(k&&!a.contextSelection)a.selected&&a.unselect(),a.contextSelection=m});d||(a.match&&a.match(this.matchFunction),a.autoDelegateParent&&a.setDelegate(this),this.dataSource||this.event_childNodesModified(this,{inserted:[a]}));return a},removeChild:function(a){if(a==null||a.parentNode!==
this)throw"basis.dom.wrapper: Node was not found";if(a instanceof this.childClass==!1)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(a))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(a),1);a.parentNode=null;a.nextSibling?a.nextSibling.previousSibling=a.previousSibling:this.lastChild=a.previousSibling;a.previousSibling?a.previousSibling.nextSibling=a.nextSibling:
this.firstChild=a.nextSibling;a.nextSibling=null;a.previousSibling=null;a.document===this.document&&e(a,E).forEach(function(a){if(a.document==this.document)a.document=null},this);if(a.contextSelection){for(var b=a.contextSelection,c=a,d=[];c;){if(c.contextSelection===b)c.selected&&d.push(c),c.contextSelection=null;if(!c.selection&&c.firstChild)c=c.firstChild;else if(c.nextSibling)c=c.nextSibling;else for(;c=c.parentNode;)if(c.nextSibling){c=c.nextSibling;break}}b.remove(d)}a.groupNode&&a.groupNode.remove(a);
this.dataSource||this.event_childNodesModified(this,{deleted:[a]});a.autoDelegateParent&&a.setDelegate();return a},replaceChild:function(a,b){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(b==null||b.parentNode!==this)throw"basis.dom.wrapper: Node was not found";this.insertBefore(a,b);return this.removeChild(b)},clear:function(a){if(this.dataSource)this.setDataSource();else if(this.firstChild){var b=this.childNodes;this.lastChild=
this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:b});for(var c=b.length;c-- >0;){var d=b[c];d.parentNode=null;d.groupNode=null;a?((d.selection||d.document)&&e(d,k.AXIS_DESCENDANT_OR_SELF).forEach(function(a){if(this.selection&&a.selection===this.selection)a.selected&&a.selection.remove([a]),a.selection=null;if(a.document===this.document)a.document=null},this),d.nextSibling=null,d.previousSibling=null,d.autoDelegateParent&&d.setDelegate()):d.destroy()}this.localGrouping&&
this.localGrouping.clear()}},setChildNodes:function(a,b){this.dataSource||this.clear(!!b);if(a&&("length"in a==!1&&(a=[a]),a.length)){var c=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var d=0,e=a.length;d<e;d++)this.insertBefore(a[d]);this.event_childNodesModified=c;this.event_childNodesModified(this,{inserted:this.childNodes})}},setDataSource:function(a){if(!a||!this.canHaveChildren||a instanceof z==!1)a=null;if(this.dataSource!==a){var b=this.dataSource;if(b)this.colMap_=
this.dataSource=null,b.removeHandler(this.listen.dataSource,this),b.itemCount&&this.clear();if(a)this.dataSource=a,this.colMap_={},a.addHandler(this.listen.dataSource,this),a.itemCount&&this.listen.dataSource.datasetChanged.call(this,a,{inserted:a.getItems()});this.event_dataSourceChanged(this,b)}},setLocalGrouping:function(b){if(typeof b=="function"||typeof b=="string")b={groupGetter:a(b)};b instanceof D==!1&&(b=b!=null&&typeof b=="object"?new this.localGroupingClass(Object.complete({},b)):null);
if(this.localGrouping!==b){var c=this.localGrouping,d;if(this.localGrouping){if(!b&&this.firstChild){this.localGrouping=null;d=this.localSorting?t(this):this.childNodes;for(var e=d.length;e-- >0;)d[e].groupNode=null;B(this,d)}c.setOwner()}if(b&&(this.localGrouping=b,b.setOwner(this),this.firstChild)){d=this.localSorting?t(this):this.childNodes;for(e=0;b=d[e];e++)b.groupNode=this.localGrouping.getGroupNode(b);for(e=0;b=d[e];e++)b.groupNode.nodes.push(b);d.length=0;for(e=this.localGrouping.nullGroup;e;e=
e.nextSibling)b=e.nodes,e.first=b[0]||null,e.last=b[b.length-1]||null,d.push.apply(d,b),e.event_childNodesModified(e,{inserted:b});B(this,d)}this.event_localGroupingChanged(this,c)}},setLocalSorting:function(b,c){b&&(b=a(b));if(this.localSorting!=b||this.localSortingDesc!=!!c){this.localSortingDesc=!!c;this.localSorting=b||null;if(b&&this.firstChild){var e=[],d;for(d=this.firstChild;d;d=d.nextSibling)d.sortingValue=b(d)||0;if(this.localGrouping)for(var f=this.localGrouping.nullGroup;f;f=f.nextSibling)d=
f.nodes=t({childNodes:f.nodes,localSortingDesc:this.localSortingDesc}),f.first=d[0]||null,f.last=d[d.length-1]||null,e.push.apply(e,d);else e=t(this);B(this,e)}this.event_localSortingChanged(this)}},setMatchFunction:function(a){if(this.matchFunction!=a){this.matchFunction=a;for(var b=this.lastChild;b;b=b.previousSibling)b.match(a)}}},w=j(x,{event_enable:f("enable","node"),event_disable:f("disable","node"),event_select:f("select","node"),event_unselect:f("unselect","node"),event_match:f("match","node"),
event_unmatch:f("unmatch","node"),selectable:!0,selected:!1,selection:null,contextSelection:null,matchFunction:null,matched:!0,disabled:!1,init:function(a){if(this.selection&&this.selection instanceof z==!1)this.selection=new M(this.selection);x.prototype.init.call(this,a);this.disabled&&this.event_disable(this);if(this.selected)this.selected=!1,this.select(!0)},setSelection:function(a){if(this.selection==a)return!1;var b=this.selection;e(this,o,function(c){if(c.contextSelection==b)c.selected&&b&&
b.remove([c]),c.contextSelection=a});this.selection=a;return!0},hasOwnSelection:function(){return!!this.selection},select:function(a){var b=this.selected,c=this.contextSelection;if(c)a?b?c.remove([this]):c.add([this]):this.selectable&&c.set([this]);else if(!b&&this.selectable&&!this.isDisabled())this.selected=!0,this.event_select(this);return this.selected!=b},unselect:function(){var a=this.selected;if(a){var b=this.contextSelection;b?b.remove([this]):(this.selected=!1,this.event_unselect(this))}return this.selected!=
a},enable:function(){if(this.disabled)this.disabled=!1,this.event_enable(this)},disable:function(){if(!this.disabled)this.disabled=!0,this.event_disable(this)},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!k.findAncestor(this,a("disabled"))},match:function(a){if(typeof a!="function")if(this.matched){if(this.underMatch_)this.underMatch_(this,!0),this.underMatch_=null}else this.matched=!0,this.event_match(this);else if(a(this)){if(this.underMatch_=a,!this.matched)this.matched=
!0,this.event_match(this)}else if(this.underMatch_=null,this.matched)this.matched=!1,this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){this.hasOwnSelection()&&(this.selection.destroy(),delete this.selection);this.unselect();x.prototype.destroy.call(this)}}),n=j(w,F,{}),D=j(x,F,{event_childNodesModified:function(a,b){g.childNodesModified.call(this,a,b);this.nullGroup.nextSibling=this.firstChild;if(b.inserted&&this.dataSource&&this.nullGroup.first)for(var c=this.owner,d=Array.from(this.nullGroup.nodes),
e=d.length;e-- >0;)c.insertBefore(d[e],d[e].nextSibling)},event_ownerChanged:function(a,b){b&&b.localGrouping===this&&b.setLocalGrouping(null,!0);this.owner&&this.owner.localGrouping!==this&&this.owner.setLocalGrouping(this);g.ownerChanged.call(this,a,b);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:!0,autoDestroyEmptyGroups:!0,titleGetter:a("data.title"),groupGetter:Function.$undef,childClass:H,childFactory:function(a){return new this.childClass(b(a,{titleGetter:this.titleGetter,
autoDestroyIfEmpty:this.dataSource?!1:this.autoDestroyEmptyGroups}))},init:function(a){this.map_={};this.nullGroup=new H({autoDestroyIfEmpty:!1});x.prototype.init.call(this,a)},getGroupNode:function(a){var a=this.groupGetter(a),b=a instanceof q,c=this.map_[b?a.eventObjectId:a];!c&&!this.dataSource&&(c=this.appendChild(b?{delegate:a}:{data:{id:a,title:a}}));return c||this.nullGroup},insertBefore:function(a,b){a=F.insertBefore.call(this,a,b);if("groupId_"in a==!1)a.groupId_=a.delegate?a.delegate.eventObjectId:
a.data.id,this.map_[a.groupId_]=a;if(a.first){var c=this.owner,d=c.childNodes,e=a.first,f=a.last,g,h,i;for(g=a;g=g.previousSibling;)if(i=g.last)break;if(!i)i=this.nullGroup.last;for(g=a;g=g.nextSibling;)if(h=g.first)break;if(e.previousSibling!==i||f.nextSibling!==h){if(e.previousSibling)e.previousSibling.nextSibling=f.nextSibling;if(f.nextSibling)f.nextSibling.previousSibling=e.previousSibling;g=d.splice(d.indexOf(e),a.nodes.length);var A=d.indexOf(h);g.unshift(A!=-1?A:d.length,0);d.splice.apply(d,
g);e.previousSibling=i;f.nextSibling=h;if(i)i.nextSibling=e;if(h)h.previousSibling=f;c.firstChild=d[0];c.lastChild=d[d.length-1]}}return a},removeChild:function(a){F.removeChild.call(this,a);delete this.map_[a.groupId_];return a},clear:function(){F.clear.call(this);this.map_={}},destroy:function(){this.setOwner();x.prototype.destroy.call(this);this.map_=null}});x.prototype.localGroupingClass=D;var N=j.ExtensibleProperty(),G=function(a){return{template:new r("<div/>"),action:N,cssClassName:null,event_update:function(b,
c){a.event_update.call(this,b,c);this.templateUpdate(this.tmpl,"update",c)},event_select:function(b){a.event_select.call(this,b);c(this.tmpl.selected||this.tmpl.content||this.element).add("selected")},event_unselect:function(b){a.event_unselect.call(this,b);c(this.tmpl.selected||this.tmpl.content||this.element).remove("selected")},event_disable:function(b){a.event_disable.call(this,b);c(this.tmpl.disabled||this.element).add("disabled")},event_enable:function(b){a.event_enable.call(this,b);c(this.tmpl.disabled||
this.element).remove("disabled")},event_match:function(b){a.event_match.call(this,b);k.display(this.element,!0)},event_unmatch:function(b){a.event_unmatch.call(this,b);k.display(this.element,!1)},init:function(b){this.tmpl={};if(this.template){this.template.createInstance(this.tmpl,this);this.element=this.tmpl.element;if(this.tmpl.childNodesHere)this.tmpl.childNodesElement=this.tmpl.childNodesHere.parentNode,this.tmpl.childNodesElement.insertPoint=this.tmpl.childNodesHere;this.content&&k.insert(this.tmpl.content||
this.element,this.content)}else this.element=this.tmpl.element=k.createElement();this.childNodesElement=this.tmpl.childNodesElement||this.element;a.init.call(this,b);if(this.id)this.element.id=this.id;if(b=this.cssClassName){typeof b=="string"&&(b={element:b});for(var d in b){var e=this.tmpl[d];if(e)for(var e=c(e),f=String(b[d]).qw(),g=0,i;i=f[g++];)e.add(i)}}this.tmpl&&this.templateUpdate(this.tmpl);this.container&&k.insert(this.container,this.element)},templateAction:function(a,b){this.action[a]&&
this.action[a].call(this,b)},templateUpdate:function(){},destroy:function(){var b=this.element;a.destroy.call(this);b&&b.parentNode&&b.parentNode.removeChild(b);this.template&&this.template.clearInstance(this.tmpl,this);this.childNodesElement=this.tmpl=this.element=null}}},K=j(n,G,{}),G=j(H,G,{titleGetter:a("data.title"),templateUpdate:function(a){if(a.titleText)a.titleText.nodeValue=String(this.titleGetter(this))}}),I=function(a){return{insertBefore:function(b,c){var b=a.insertBefore.call(this,b,
c),d=b.groupNode||this,e=b.nextSibling,d=d.childNodesElement||d.element||this.childNodesElement||this.element,f=b.element,e=(e&&e.element.parentNode==d?e.element:null)||d.insertPoint||null;(f.parentNode!==d||f.nextSibling!==e)&&d.insertBefore(f,e);return b},removeChild:function(b){a.removeChild.call(this,b);var c=b.element,d=c.parentNode;d&&d.removeChild(c);return b},clear:function(b){if(b)for(var c=this.firstChild;c;){var d=c.element;d.parentNode&&d.parentNode.removeChild(d);c=c.nextSibling}a.clear.call(this,
b)},setChildNodes:function(b,c){var d=k.createFragment(),e=this.localGrouping||this,f=e.childNodesElement||e.element;e.childNodesElement=d;a.setChildNodes.call(this,b,c);f.insertBefore(d,f.insertPoint||null);e.childNodesElement=f}}},L=j(D,I,{childClass:G,event_ownerChanged:function(a,b){var c=this,d=this.owner,e=null;d&&(e=d.tmpl&&d.tmpl.groupsElement||d.childNodesElement||d.element);do c.element=c.childNodesElement=e;while(c=c.localGrouping);D.prototype.event_ownerChanged.call(this,a,b)}});L.prototype.localGroupingClass=
L;var J=j(K,I,{childClass:K,childFactory:function(a){return new this.childClass(a)},localGroupingClass:L}),I=j(J,{selection:{},init:function(a){this.document=this;J.prototype.init.call(this,a);s.add(this)},destroy:function(){if(this.selection)this.selection.destroy(),this.selection=null;J.prototype.destroy.call(this);s.remove(this)}}),f=j(z,{autoDestroy:!0,sourceNode:null,listen:{sourceNode:{childNodesModified:function(a,b){var c=this.memberMap_,d={},e=0,f=0,g=b.inserted,i=b.deleted;if(g&&g.length)for(d.inserted=
g;a=g[e];)c[a.eventObjectId]=a,e++;if(i&&i.length)for(d.deleted=i;a=i[f];)delete c[a.eventObjectId],f++;(e||f)&&this.event_datasetChanged(this,d)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:f("sourceNodeChanged")&&function(a,b){g.sourceNodeChanged.call(this,a,b);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:!1,init:function(a,b){z.prototype.init.call(this,b);a&&this.setSourceNode(a)},setSourceNode:function(a){a instanceof
x==!1&&(a=null);if(a!==this.sourceNode){var b=this.sourceNode;b&&(b.removeHandler(this.listen.sourceNode,this),this.listen.sourceNode.childNodesModified.call(this,b,{deleted:b.childNodes}));a&&(a.addHandler(this.listen.sourceNode,this),this.listen.sourceNode.childNodesModified.call(this,a,{inserted:a.childNodes}));this.sourceNode=a;this.event_sourceNodeChanged(this,b)}},destroy:function(){this.setSourceNode();z.prototype.destroy.call(this)}}),M=j(y,{multiple:!1,event_datasetChanged:function(a,b){y.prototype.event_datasetChanged.call(this,
a,b);if(b.inserted)for(var c=0,d;d=b.inserted[c];c++)if(!d.selected)d.selected=!0,d.event_select();if(b.deleted)for(c=0;d=b.deleted[c];c++)if(d.selected)d.selected=!1,d.event_unselect()},add:function(a){if(!this.multiple)if(this.itemCount)return this.set(a);else a.splice(1);for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);return y.prototype.add.call(this,b)},set:function(a){for(var b=[],c=0,d;d=a[c];c++)d.contextSelection==this&&d.selectable&&b.push(d);this.multiple||
a.splice(1);return y.prototype.set.call(this,b)}}),A=function(a,b){for(var c=a.split(/\{(this_[^}]+)\}/),d=[],e=1;e<c.length;e+=2){var f=c[e].split("|")[0];d.push("this.tmpl."+f+".nodeValue = "+f.replace(/_/g,"."))}return Function("tmpl_","config_","return "+function(a){return Object.extend({template:tmpl_,templateUpdate:function(b,c,d){a.templateUpdate.call(this,b,c,d);_code_()}},config_)}.toString().replace("_code_()",d.join(";\n")))(new r(a),b)};h.namespace("basis.dom.wrapper",A).extend({AbstractNode:x,
InteractiveNode:w,Node:n,GroupingNode:D,PartitionNode:H,Control:I,TmplGroupingNode:L,TmplPartitionNode:G,TmplNode:K,TmplContainer:J,TmplControl:I,simpleTemplate:A,ChildNodesDataset:f,Selection:M})})(basis);
(function(h){function p(a){g[a]=g[a]||0;return a+g[a]++}function u(){var a=Array.from(arguments),b=a.pop();typeof b!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var c=[],d=[],e=0,f;e<a.length;e++)f=a[e].quote('"'),c.push(f+" in delta"),d.push("data["+f+"]");b=(new Function("calc","return function(delta, data, oldValue){"+(c.length?"if ("+c.join(" || ")+")":"")+"return calc("+d.join(", ")+");"+(c.length?"return oldValue;":"")+"}"))(b);b.args=a;b.isCalcField=
!0;return b}function v(){return u.apply(null,Array.from(arguments).concat(function(){for(var a=[],b=arguments.length;b-- >0;){if(arguments[b]==null)return null;a.push(arguments[b])}return a.join("-")}))}var t=h.Class,B=h.Cleaner,C=Object.extend,j=Function.$self,k=Function.getter,n=h.data,r=h.EventObject,w=n.Dataset,q=n.Collection,z=n.Grouping,y=n.DataObject,s=n.STATE,o={},E={string:1,number:1},a=[],b=function(a){return isNaN(a)?null:Number(a)},c=function(a){return isNaN(a)?null:Number(a)},e=function(a){return isNaN(a)?
null:parseInt(a)},f=function(a){return a==null?null:String(a)},g={},d=h.Class(null,{init:function(a){var b=this.index={};this.normalize=a;this.valueWrapper=function(c,d){var e=a(c,d);return e!==d&&b[e]?d:e};this.calcWrapper=function(c,d){var e=a(c,d);if(e!==d&&b[e])throw"Duplicate value for index "+d+" => "+c;return e};B.add(this)},get:function(a,b){var c=this.index[a];if(c&&(!b||c instanceof b))return c},add:function(a,b){var c=this.index[a];if(b&&(!c||c===b))return this.index[a]=b,!0},remove:function(a,
b){if(this.index[a]===b)return delete this.index[a],!0},destroy:function(){this.index=null}}),n=function(a,b){return function(c){return a.prototype[b].call(this,c&&c.map(this.wrapper))}},i=function(a,b){return function(c){if(!this.name)this.name=p(b);a.prototype.init.call(this,c)}},l=function(a){return function(b,c){w.setAccumulateState(!0);b=(b||[]).map(this.wrapper);w.setAccumulateState(!1);return a.prototype.sync.call(this,b,c)}},m=t(w,{wrapper:Function.$self,init:i(w,"EntitySet"),sync:l(w),set:n(w,
"set"),add:n(w,"add"),remove:n(w,"remove"),destroy:function(){w.prototype.destroy.call(this);delete this.wrapper}}),x=t(m,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),H=t(q,{init:i(q,"EntityCollection"),sync:l(q)});H.sourceHandler=q.sourceHandler;var F=t(z,{subsetClass:x,init:i(z,"EntityGrouping"),sync:l(z),getSubset:function(a,b){var c=z.prototype.getSubset.call(this,a,b);if(c)c.wrapper=this.wrapper;return c}}),D=function(a){if(this instanceof D){var b=
new N(a||j);return function(a,c){return a!=null?(c instanceof m||(c=b.createEntitySet()),c.set(a instanceof w?a.getItems():Array.from(a)),c):null}}};D.className="basis.entity.EntitySetWrapper";var N=t(null,{init:function(a){this.wrapper=a},createEntitySet:function(){return new m({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),G=function(a){if(this instanceof G){var b=function(a,b){if(a!=null){if(a===b||a.entityType===c)return a;var g,i=c.idField;
if(E[typeof a]){if(!i)return;g=a;a={};a[i]=g}else if(c.compositeKey)g=c.compositeKey(a,a);else if(i)g=a[i];else if(f&&(b=c.singleton,!b))return c.singleton=new e(a);g!=null&&d&&(b=d.get(g,c.entityClass));b&&b.entityType===c?b.update(a):b=new e(a);return b}else return c.singleton},c=new L(a||{},b),d=c.index__,e=c.entityClass,f=c.isSingleton;C(b,{toString:function(){return this.typeName+"()"},entityType:c,type:b,typeName:c.name,index:d,reader:function(a){return c.reader(a)},get:function(a){return c.get(a)},
addField:function(a,b){c.addField(a,b)},all:c.all,createCollection:function(a,d,e){var f=c.collection_[a];return!f&&d?c.collection_[a]=new H({wrapper:b,source:e||c.all,rule:d}):f},getCollection:function(a){return c.collection_[a]},createGrouping:function(a,d,e){var f=c.grouping_[a];return!f&&d?c.grouping_[a]=new F({wrapper:b,source:e||c.all,rule:d}):f},getGrouping:function(a){return c.grouping_[a]},getSlot:function(a,b){return c.getSlot(a,b)}});return b}};G.className="basis.entity.EntityTypeWrapper";
var K=k("singleton"),I={};t(y,{});var L=t(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:!1,index__:null,slot_:null,init:function(b,c){this.name=b.name||p(this.name);this.index__=b.index;this.idFields={};a.push(this);this.isSingleton=b.isSingleton;this.wrapper=c;this.all=new x(Object.extend(b.all||{},{wrapper:c}));this.slot_={};if(b.extensible)this.extensible=!0;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(b.fields,this.addField,this);b.constrains&&
b.constrains.forEach(function(a){this.addCalcField(null,a)},this);if(this.isSingleton)this.get=K;b.aliases&&Object.iterate(b.aliases,this.addAlias,this);this.collection_={};if(b.collections)for(var d in b.collections)this.collection_[d]=new H({name:d,wrapper:c,source:this.all,rule:b.collections[d]||Function.$true});this.grouping_={};if(b.groupings)for(d in b.groupings)this.grouping_[d]=new F({name:d,wrapper:c,source:this.all,rule:b.groupings[d]||Function.$true});this.entityClass=M(this,this.all,this.index__,
this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:c,typeName:this.name,getId:function(){return this.__id__}})},reader:function(a){var b={};if(E[typeof a])return this.idField?(b[this.idField]=a,b):null;if(!a||a==null)return null;for(var c in a){var d=c in this.aliases?this.aliases[c]:"";d&&d in this.fields&&(b[d]=this.fields[d].reader?this.fields[d].reader(a[c]):a[c])}return b},addAlias:function(a,b){b in this.fields&&a in this.aliases==!1&&(this.aliases[a]=b)},addField:function(a,
g){if(!this.all.itemCount){this.aliases[a]=a;typeof g=="function"&&(g={type:g});if("type"in g&&typeof g.type!="function")g.type=j;var i=g.type||j;if([b,c,e,f].has(i))g.id=!0;if(g.id){if(!this.index__)this.index__=new d(String);this.idFields[a]=!0;this.idField||this.compositeKey?(this.idField=null,this.compositeKey=v.apply(null,Object.keys(this.idFields))):this.idField=a}g.calc?this.addCalcField(a,g.calc,void 0):this.fields[a]=i;this.defaults[a]="defValue"in g?g.defValue:i();this.getters["get_"+a]=
function(){return this.data[a]};I[a]||(I[a]={destroy:function(){this.set(a,null)}})}},addCalcField:function(a,b,c){if(!a||!this.fields[a]){if(!this.calcs)this.calcs=[];for(var d={args:b.args,wrapper:!c?b:function(a,d,e){return c(b(a,d,e))}},e=this.calcs.length,f=0,g=0;g<this.calcs.length;g++)b.args.has(this.calcs[g].key)&&(f=g+1);if(a){d.key=a;for(g=0;g<this.calcs.length;g++)if(this.calcs[g].args.has(a)){e=g;break}if(f>e)return;if(this.idField&&a==this.idField)this.compositeKey=b;this.fields[a]=function(a,
b){typeof console!="undefined"&&console.log("Calculate fields are readonly");return b}}else e=f;this.calcs.splice(Math.min(e,f),0,d)}},get:function(a){a=this.getId(a);if(a!=null)return this.index__.get(a,this.entityClass)},getId:function(a){if((this.idField||this.compositeKey)&&a!=null){if(E[typeof a])return a;if(a&&a.entityType===this)return a.__id__;if(a instanceof y)a=a.data;return this.compositeKey?this.compositeKey(a,a):a[this.idField]}},getSlot:function(a){var b=this.getId(a);if(b!=null){var c=
this.slot_[b];c||(E[typeof a]&&(c={},this.idField&&!this.compositeKey&&(c[this.idField]=a),a=c),c=this.slot_[b]=new y({delegate:this.get(b),data:a}));return c}}}),J=t(y,{init:r.prototype.init,event_rollbackUpdate:r.createEvent("rollbackUpdate")}),M=function(a,b,c,d,e,f,g){function i(b,c,d){var e=!1,f=a.calcs,g=b.__id__,j=b.data;try{if(f)for(var k=0,m;m=f[k++];){var n=m.key;if(n){var o=j[n];j[n]=m.wrapper(c,j,j[n]);j[n]!==o&&(c[n]=o,e=!0)}else m.wrapper(c,j)}if(a.compositeKey)b.__id__=a.compositeKey(c,
j,b.__id__);else if(l&&l in c)b.__id__=j[l];b.__id__!==g&&a.index__.calcWrapper(b.__id__)}catch(p){b.__id__=g;for(var q in c)b.data[q]=c[q];if(d)for(q in d)if(!b.modified)b.modified=d;e=!1}b.__id__!==g&&h(b,g,b.__id__);return e}function h(a,b,e){b!=null&&(c.remove(b,a),d[b]&&d[b].setDelegate());e!=null&&(c.add(e,a),d[e]&&d[e].setDelegate(a))}var l=a.idField;return t(J,g,{canHaveDelegate:!1,modified:null,isTarget:!0,extendConstructor_:!1,init:function(a){J.prototype.init.call(this);this.fieldHandlers_=
{};this.data={};this.root=this;this.target=this;var c,d={},g;for(g in e)g in a?(d[g]=f[g],c=e[g](a[g])):c=f[g],c&&c!==this&&c instanceof r&&c.addHandler(I[g],this)&&(this.fieldHandlers_[g]=!0),this.data[g]=c;i(this,d);b.event_datasetChanged(b,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(a){return this.data[a]},set:function(b,c,d,f){var g=e[b];if(!g){if(!a.extensible)return;g=j}var h,k=this.modified,c=g(c,this.data[b]),
g=this.data[b];if(c!==g&&(!c||!g||c.constructor!==Date||g.constructor!==Date||+c!==+g))a:{h={};if(b!=l)if(d){if(!k)this.modified=k={};if(b in k===!1)h.rollback={key:b,value:void 0},k[b]=g;else if(k[b]===c&&(h.rollback={key:b,value:c},delete k[b],!Object.keys(k).length))this.modified=null}else if(k&&b in k)if(k[b]!==c){h.rollback={key:b,value:k[b]};k[b]=c;break a}else return!1;this.data[b]=c;this.fieldHandlers_[b]&&(g.removeHandler(I[b],this),this.fieldHandlers_[b]=!1);c&&c!==this&&c instanceof r&&
c.addHandler(I[b],this)&&(this.fieldHandlers_[b]=!0);h.key=b;h.value=g;h.delta={};h.delta[b]=g}else if(!d&&k&&b in k&&(h={rollback:{key:b,value:k[b]}},delete k[b],!Object.keys(k).length))this.modified=null;if(!f&&h){var d=h.key,b=h.delta||{},m;if(h.rollback)m={},m[h.rollback.key]=h.rollback.value;i(this,b,m)&&(d=!0);if(d)this.event_update(this,b),h.delta=b;m&&this.event_rollbackUpdate(this,m)}return h||!1},update:function(a,b){if(a){var c,d={},e,f={},g,h;for(h in a)if(g=this.set(h,a[h],b,!0)){if(g.key)c=
!0,d[g.key]=g.value;if(g.rollback)e=!0,f[g.rollback.key]=g.rollback.value}i(this,d,f)&&(c=!0);c&&this.event_update(this,d);e&&this.event_rollbackUpdate(this,f)}return c?d:!1},reset:function(){this.update(f)},clear:function(){var a={},b;for(b in this.data)a[b]=void 0;return this.update(a)},commit:function(a){if(this.modified){var b=this.modified;this.modified=null}this.update(a);b&&this.event_rollbackUpdate(this,b)},rollback:function(){if(this.state!=s.PROCESSING){if(this.modified){var a=this.modified;
this.modified=null;this.update(a);this.event_rollbackUpdate(this,a)}this.setState(s.READY)}},destroy:function(){for(var a in this.fieldHandlers_)this.data[a].removeHandler(I[a],this);this.fieldHandlers_=o;this.__id__&&h(this,this.__id__,null);y.prototype.destroy.call(this);b.event_datasetChanged(b,{deleted:[this]});this.data=o;this.modified=null}})};h.namespace("basis.entity").extend({isEntity:function(a){return a&&a instanceof M},NumericId:b,NumberId:c,IntId:e,StringId:f,Index:d,CalculateField:u,
EntityType:G,Entity:M,BaseEntity:J,EntitySetType:D,EntitySet:m,ReadOnlyEntitySet:x,Collection:H,Grouping:F})})(basis);
