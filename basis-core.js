/*!
 * Basis javasript library 
 * http://code.google.com/p/basis-js/
 *
 * @license
 * GNU General Public License v2.0 <http://www.gnu.org/licenses/gpl-2.0.html>
 */

(function(v){function I(a,d){for(var b in d)a[b]=d[b];return a}function G(a,d){for(var b in d)if(b in a==false)a[b]=d[b];return a}function T(a){return a==null||a==undefined}function O(a){return a}function V(a){var d={};a.names=function(b){return Object.slice(d,typeof b=="string"?b.qw():b)};a.extend=function(b){G(d,b);I(this,b);return this};return a}function Q(a,d){for(var b=a.split("."),c=v,h,i,l;b.length;){h=b.shift();i=(i?i+".":"")+h;if(!c[h]){c[h]=V((!b.length?d:null)||function(){},i);if(l)l.namespaces_[i]=
c[h]}c=c[h];if(!l){l=c;if(!l.namespaces_)l.namespaces_={}}}return y[a]=c}I(Object,{extend:I,complete:G,keys:function(a){var d=[];for(var b in a)d.push(b);return d},values:function(a){var d=[];for(var b in a)d.push(a[b]);return d},slice:function(a,d){var b={};if(!d)return I(b,a);for(var c=0,h;h=d[c++];)if(h in a)b[h]=a[h];return b},splice:function(a,d){var b={};if(!d)return I(b,a);for(var c=0,h;h=d[c++];)if(h in a){b[h]=a[h];delete a[h]}return b},iterate:function(a,d,b){var c=[];for(var h in a)c.push(d.call(b,
h,a[h]));return c},coalesce:function(){for(var a=arguments,d=0;d<a.length;d++)if(a[d]!=null)return a[d]}});var M=function(){},H=function(){var a=1,d={},b={},c=function(h){return h.modificator};c.getter=c;c.getterIdx_=a++;return function(h,i){var l,n;if(!i){if(h.getter)return h.getter;if(typeof h=="function")return h}if(typeof h!="function")if(b[h])l=b[h];else{l=new Function("object","return object != null ? object."+h+" : object");l.path=h;l.getterIdx_=a++;b[h]=l}else{l=h;if(!l.getterIdx_)l.getterIdx_=
a++}n=l.getterIdx_;var f=d[n];if(f)if(typeof i=="undefined"){if(f.nmg)return f.nmg}else for(n=0;n<f.length;n++){if(f[n].modificator===i)return f[n].getter}else f=d[n]=[];var k=true;switch(i&&typeof i){case "string":n=function(m){return i.format(l(m))};break;case "function":n=function(m){return i(l(m))};break;case "object":k=false;n=function(m){return i[l(m)]};break;default:n=l.path?l:function(m){return l(m)}}if(k){f.push({getter:n,modificator:i});if(typeof i=="undefined")f.nmg=n}return n.getter=n}}();
I(Function,{$undefined:function(a){return a==undefined},$defined:function(a){return a!=undefined},$isNull:T,$isNotNull:function(a){return a!=null&&a!=undefined},$isSame:function(a){return a===this},$isNotSame:function(a){return a!==this},$self:O,$const:function(a){return function(){return a}},$false:function(){return false},$true:function(){return true},$null:function(){return null},$undef:M,getter:H,def:function(a,d,b){b=b||T;return function(c){c=a(c);return b(c)?d:c}},wrapper:function(a){return function(d){var b=
{};b[a]=d;return b}},lazyInit:function(a,d){var b=0,c,h;return c=function(){if(!b++){c.inited=true;c.data=h=a.apply(d||this,arguments)}return h}},lazyInitAndRun:function(a,d,b){var c=0,h,i;return h=function(){if(!c++){h.inited=true;h.data=i=a.call(b||this)}d.apply(i,arguments);return i}},runOnce:function(a,d){var b=0;return function(){if(!b++)return a.apply(d||this,arguments)}}});G(Function.prototype,{bind:function(a){var d=this,b=Array.from(arguments,1);return b.length?function(){return d.apply(a,
b.concat.apply(b,arguments))}:function(){return d.apply(a,arguments)}}});G(Array,{isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"}});I(Array,{from:function(a,d){if(a!=null){var b=a.length;if(typeof b=="undefined")return[a];d||(d=0);if(b-d>0){for(var c=[],h=0,i=d;i<b;)c[h++]=a[i++];return c}}return[]},create:function(a,d,b){for(var c=[],h=0;h<a;h++)c[h]=typeof d=="function"?d.call(b,h,c):d;return c}});G(Array.prototype,{indexOf:function(a,d){d=parseInt(d)||0;if(d<0)return-1;
for(;d<this.length;d++)if(this[d]===a)return d;return-1},lastIndexOf:function(a,d){var b=this.length;d=parseInt(d);for(d=isNaN(d)||d>=b?b-1:(d+b)%b;d>=0;d--)if(this[d]===a)return d;return-1},forEach:function(a,d){for(var b=0,c=this.length;b<c;b++)b in this&&a.call(d,this[b],b,this)},every:function(a,d){for(var b=0,c=this.length;b<c;b++)if(b in this&&!a.call(d,this[b],b,this))return false;return true},some:function(a,d){for(var b=0,c=this.length;b<c;b++)if(b in this&&a.call(d,this[b],b,this))return true;
return false},filter:function(a,d){for(var b=[],c=0,h=this.length;c<h;c++)c in this&&a.call(d,this[c],c,this)&&b.push(this[c]);return b},map:function(a,d){for(var b=[],c=0,h=this.length;c<h;c++)if(c in this)b[c]=a.call(d,this[c],c,this);return b},reduce:function(a,d){var b=this.length,c=arguments.length;if(b==0&&c==1)throw new TypeError;var h,i=0;if(c>1){h=d;i=1}for(c=0;c<b;c++)if(c in this)h=i++?a.call(null,h,this[c],c,this):this[c];return h}});I(Array.prototype,{flatten:function(){return this.concat.apply([],
this)},repeat:function(a){return Array.create(parseInt(a)||0,this).flatten()},item:function(a){a=parseInt(a||0);return this[a>=0?a:this.length+a]},search:function(a,d,b){Array.lastSearchIndex=-1;d=Function.getter(d||O);b=parseInt(b)||0;for(var c=this.length;b<c;b++)if(d(this[b])===a)return this[Array.lastSearchIndex=b]},lastSearch:function(a,d,b){Array.lastSearchIndex=-1;d=Function.getter(d||O);var c=this.length;b=isNaN(b)||b==null?c:parseInt(b);for(c=b>c?c:b;c-- >0;)if(d(this[c])===a)return this[Array.lastSearchIndex=
c]},binarySearchPos:function(a,d,b,c,h,i){if(!this.length)return c?-1:0;d=Function.getter(d||O);b=!!b;var l;h=isNaN(h)?0:h;var n=isNaN(i)?this.length-1:i;do{i=h+n>>1;l=d(this[i]);if(b?a>l:a<l)n=i-1;else if(b?a<l:a>l)h=i+1;else return a==l?i:c?-1:0}while(h<=n);return c?-1:i+(l<a^b)},binarySearch:function(a,d){return this.binarySearchPos(a,d,false,true)},add:function(a){return this.indexOf(a)==-1&&!!this.push(a)},remove:function(a){a=this.indexOf(a);return a!=-1&&!!this.splice(a,1)},has:function(a){return this.indexOf(a)!=
-1},merge:function(a){return this.reduce(I,a||{})},sortAsObject:function(a,d,b){a=Function.getter(a);b=b?-1:1;return this.map(function(c,h){return{i:h,v:a(c)}}).sort(d||function(c,h){return b*(c.v>h.v||-(c.v<h.v)||(c.i>h.i?1:-1))}).map(function(c){return this[c.i]},this)},set:function(a){if(this!==a){this.length=0;this.push.apply(this,a)}return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var J=Array.prototype.splice;Array.prototype.splice=function(){var a=Array.from(arguments);
if(a.length<2)a[1]=this.length;return J.apply(this,a)}}var x={"<":">","[":"]","(":")","{":"}","\u00ab":"\u00bb"};String.Entity={laquo:"\u00ab",raquo:"\u00bb",nbsp:"\u00a0",quot:'"',quote:'"',copy:"\u00a9",shy:"\u00ad",para:"\u00b6",sect:"\u00a7",deg:"\u00b0",mdash:"\u2014",hellip:"\u2026"};G(String,{toLowerCase:function(a){return String(a).toLowerCase()},toUpperCase:function(a){return String(a).toUpperCase()},trim:function(a){return String(a).trim()},trimLeft:function(a){return String(a).trimLeft()},
trimRight:function(a){return String(a).trimRight()},isEmpty:function(a){return a==null||String(a)==""},isNotEmpty:function(a){return a!=null&&String(a)!=""}});G(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});I(String.prototype,{toObject:function(a){try{return Function("return 0,"+this)()}catch(d){if(a)throw d;}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:
function(){for(var a=[],d=this.length,b=0;b<d;b++)a[b]=this.charAt(b);return a},repeat:function(a){return(new Array(parseInt(a)+1||0)).join(this)},qw:function(){var a=this.trim();return a?a.split(/\s+/):[]},forRegExp:function(){return this.replace(/[\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$]/g,"\\$&")},format:function(a){for(var d={},b=0;b<arguments.length;b++)d[b]=arguments[b];typeof a=="object"&&I(d,a);return this.replace(/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi,function(c,h,i,l,n){c=h in d?d[h]:n?"":
c;if(i&&!isNaN(c)){c=Number(c);return i=="."?c.toFixed(l):c.lead(l)}return c})},quote:function(a,d){a=a||'"';d=d||x[a]||a;var b=(a.length==1?a:"")+(d.length==1?d:"");return a+(b?this.replace(new RegExp("["+b.forRegExp()+"]","g"),"\\$&"):this)+d},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(a,d){return d.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}});
String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=11)String.prototype.split=function(a){if(a==""||a&&a.source=="")return this.toArray();var d=[],b=0,c;if(a instanceof RegExp)for(a.global||(a=new RegExp(a.source,/\/([mi]*)$/.exec(a)[1]+"g"));c=a.exec(this);){c[0]=this.substring(b,c.index);d.push.apply(d,c);b=a.lastIndex}else for(;(c=this.indexOf(a,b))!=-1;){d.push(this.substring(b,c));b=c+a.length}d.push(this.substr(b));return d};if("12".substr(-1)!="2"){var E=
String.prototype.substr;String.prototype.substr=function(a,d){return E.call(this,a<0?Math.max(0,this.length+a):a,d)}}I(Number.prototype,{fit:function(a,d){if(!isNaN(a)&&this<a)return Number(a);if(!isNaN(d)&&this>d)return Number(d);return this},between:function(a,d){return!isNaN(this)&&this>=a&&this<=d},quote:function(a,d){return(this+"").quote(a,d)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(a){return!a||isNaN(a)?0:
Math.floor(this/a)*a},lead:function(a,d){return(this+"").replace(/\d+/,function(b){return(a-=b.length-1)>1?Array(a).join(d||0)+b:b})},group:function(a,d){return(this+"").replace(/\d+/,function(b){return b.replace(/\d/g,function(c,h){return!h+(b.length-h)%(a||3)?c:(d||" ")+c})})},format:function(a,d,b,c,h){a=this.toFixed(a);if(d||h)a=a.replace(/(\d+)(\.?)/,function(i,l,n){return(d?Number(l).group(3,d):l)+(n?h||n:"")});if(b)a=a.replace(/^-?/,"$&"+(b||""));return a+(c||"")}});G(Date,{now:function(){return+new Date}});
(new Date).getYear()<1900&&I(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(a){return this.setFullYear(!isNaN(a)&&a<100?Number(a)+1900:a)}});var y={},R=function(){function a(i,l){for(var n=y[i],f=l?l.split(/\./):[];n&&f.length;)n=n[f.shift()];return n}var d=v.document?v.document.getElementsByTagName("SCRIPT"):null,b=(d?d[d.length-1].src:module.filename).replace(/[^\/]+$/,""),c={},h;if(typeof require=="function")h=function(i){return require(requirePath+i.replace(/\./g,
"/"))};else{h=function(i,l){var n=i.match(/^([a-z][a-zA-Z0-9\_]*(\.[a-z][a-zA-Z0-9\_]*)*)?/)[0],f=i.substr(n.length?n.length+1:0),k=a(n,f),m=/^basis\./.test(n)?b:(location?location.href:"").replace(/[a-z0-9\-\_\.]+\.[a-z0-9]+$/,"");if(!y[n]||!k)if(/^https?:/.test(m))if(c[i])throw"Attempt to load namespace, probably cycle require";else{c[i]=1;m=m+(l||"")+i.replace(/\./g,"/")+".js";var q=new XMLHttpRequest;q.open("POST",m,false);q.send(null);if(q.status==200){try{(new Function(q.responseText)).call(v)}catch(t){throw t;
}h.sequence.push(i.replace(/\./g,"/")+".js")}else if(q.status==404&&f)R(n);else throw"unable to load module "+i+" by basis.require()";}else throw"Path `"+i+"` can't be resolved";return k||a(n,f)};h.sequence=[]}return h}(),K=function(){function a(n){return typeof n=="function"&&n.basisClass_}var d=Function(),b={id:1},c={},h=function(){for(var n in{toString:1})return;return true}();I(d,{className:"basis.Class",extendConstructor_:false,prototype:{constructor:null,init:Function(),toString:function(){return"[object "+
(this.constructor||this).className+"]"},destroy:function(){for(var n in this)this[n]=null;this.destroy=M}},create:function(n){if(typeof n!="function")n=d;var f=Function();f.prototype=n.prototype;f=new f;for(var k={className:n.className+"._SubClass_",basisClass_:true,superClass_:n,extendConstructor_:!!n.extendConstructor_,__extend__:function(g){return g&&(typeof g=="object"||typeof g=="function"&&!a(g))&&g!==c?d.create.call(null,z,g):g},extend:d.extend,subclass:function(){return d.create.apply(null,
[z].concat(Array.from(arguments)))},prototype:f},m=arguments,q=1;q<m.length;q++)k.extend(typeof m[q]=="function"&&!a(m[q])?m[q](n.prototype):m[q]);var t={},z=k.extendConstructor_?function(g,j){this.eventObjectId=b.id++;var o;for(var r in g){o=this[r];this[r]=o&&o.__extend__?o.__extend__(g[r]):g[r]}this.init(j||t)}:function(){this.eventObjectId=b.id++;this.init.apply(this,arguments)};f.constructor=z;for(var e in f)if(f[e]===c)f[e]=z;I(z,k);return z},extend:function(n){var f=this.prototype;if(n.prototype)n=
n.prototype;for(var k in n){var m=n[k],q=f[k];if(k=="className"||k=="extendConstructor_")this[k]=m;else f[k]=q&&q.__extend__?q.__extend__(m):m}if(h&&n[k="toString"]!==Object.prototype[k])f[k]=n[k];return this}});var i=function(n,f){return{__extend__:function(k){var m=Function();m.prototype=this;m=new m;f(m,k);return m}}.__extend__(n)},l=function(n){return i(n,I)};return Q("basis.Class",d.create).extend({SELF:c,BaseClass:d,create:d.create,isClass:a,CustomExtendProperty:i,ExtensibleProperty:l,NestedExtProperty:function(n){return i(n,
function(f,k){for(var m in k){var q=f[m];f[m]=q&&q.__extend__?q.__extend__(k[m]):l(k[m])}})}})}(),C=function(){function a(i){var l=b[i];l||(l=b[i]=function(){var n=this.handlers_,f,k;if(n&&n.length){n=d.call(n);for(var m=n.length;m-- >0;){f=n[m];k=f.handler[i];typeof k=="function"&&k.apply(f.thisObject,arguments)}}});return l}var d=Array.prototype.slice,b={},c,h=K(null,{handlers_:null,event_destroy:c=a("destroy","object"),listen:K.NestedExtProperty(),extendConstructor_:true,init:function(){if(this.handler)(this.handlers_||
(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})},addHandler:function(i,l){var n=this.handlers_;if(!n)n=this.handlers_=[];l||(l=this);for(var f=n.length,k;f-- >0;){k=n[f];if(k.handler===i&&k.thisObject===l)return false}return!!n.push({handler:i,thisObject:l||this})},removeHandler:function(i,l){var n=this.handlers_;if(n){l||(l=this);for(var f=n.length,k;f-- >0;){k=n[f];if(k.handler===i&&k.thisObject===l)return!!n.splice(f,1)}return false}},destroy:function(){if(this.handlers_){c.call(this,
this);this.handlers_=null}}});h.createEvent=a;h.event=b;return h}(),N=function(){var a=[];return{add:function(d){d!=null&&a.push(d)},remove:function(d){a.remove(d)}}}();(function(){function a(f){if(d){if(f.source!=v||f.data!=b)return;basis.dom.event.kill(f)}if(c.length){f=c.shift();delete h[f.key];f.fn()}}var d=typeof addEventListener=="function"&&typeof postMessage=="function",b="zeroTimeoutMessage",c=[],h={},i=1;d&&v.addEventListener("message",a,true);var l=setTimeout;v.setTimeout=function(f,k){var m;
if(k)m=l.call(v,f,k);else{m={key:"z"+i++,fn:typeof f=="function"?f:new Function(f)};h[m.key]=m;c.push(m);if(d)postMessage(b,"*");else m.timer=l.call(v,a,0);m=m.key}return m};var n=clearTimeout;v.clearTimeout=function(f){if(/z\d+/.test(f)){var k=h[f];if(k){clearTimeout(k.timer);c.remove(k);delete h[f]}}else return n.call(v,f)}})();var D=function(){function a(){if(!k)if(i.length){var m=Date.now(),q=Math.max(i[0].eventTime,m);if(q<n){clearTimeout(f);f=setTimeout(b,(n=q)-m)}}else{f=clearTimeout(f);n=
c}}function d(m,q){var t=m.eventObjectId,z=l[q]&&l[q][t];if(z){i.remove(z);delete l[q][t];a()}}function b(){var m=Date.now();m=i.binarySearchPos(m+15,h);k=true;i.splice(0,m).forEach(function(q){delete l[q.eventName][q.object.eventObjectId];q.callback.call(q.object)});k=false;n=c;a()}var c=2E12,h=H("eventTime"),i=[],l={},n=c,f=null,k=false;N.add({destroy:function(){k=true;clearTimeout(f);i.length=0;l=null}});return{add:function(m,q,t){var z=m.eventObjectId,e=l[q];e||(e=l[q]={});var g=e[z];if(g){if(isNaN(t))return d(m,
q);if(g.eventTime==t)return;i.remove(g);g.eventTime=t}else{if(isNaN(t))return;g=e[z]={eventName:q,object:m,eventTime:t,callback:m[q]}}i.splice(i.binarySearchPos(t,h),0,g);a()},remove:d}}();Q("basis").extend({namespace:Q,platformFeature:{},EventObject:C,TimeEventManager:D,Cleaner:N,require:R});v.basis.locale={}})(this);
(function(v,I){function G(N){var D=1E6;N=String(N).split(".");for(var a=0,d=0;a<4&&a<N.length;a++,D/=100)d+=N[a]*D;return d}function T(){for(var N=0;N<arguments.length;N++){var D=arguments[N].toLowerCase();if(D in V){if(V[D])return true}else{var a=D.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(a){V[D]=false;var d=a[1].toLowerCase(),b=G(a[3]);a=a[4]||"=";if(d=Q[d])return V[D]=!b||a=="="&&d==b||a=="+"&&d>=b||a=="-"&&d<b}}}return false}var O="basis.ua",V={},Q={},M=I.navigator&&I.navigator.userAgent,H=
"unknown",J="unknown",x={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]};for(var E in x)if(!(E=="MSIE"&&I.opera))if(!(E=="Safari"&&M.match(/chrome/i)))if(!(E=="AppleWebKit"&&M.match(/iphone/i)))if(M.match(new RegExp(E+
".(\\d+(\\.\\d+)*)","i"))){var y=x[E],R=I.opera&&typeof I.opera.version=="function"?I.opera.version():RegExp.$1,K=G(R);H=y[0]+K;J=y[0]+" "+R;for(H=0;H<y.length;H++)Q[y[H].toLowerCase()]=K}v.platformFeature.datauri=false;M=typeof Image!="undefined"?new Image:{};M.onload=function(){v.platformFeature.datauri=true};M.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";x={set:function(N,D,a,d){document.cookie=N+"="+(D==null?"":escape(D))+";path="+(d||(location.pathname.indexOf("/")==
0?"":"/")+location.pathname)+(a?";expires="+(new Date(Date.now()+a*1E3)).toGMTString():"")},get:function(N){return(N=document.cookie.match(new RegExp("(^|;)\\s*"+N+"\\s*=\\s*(.*?)\\s*(;|$)")))&&unescape(N[2])},remove:function(N,D){document.cookie=N+"=;expires="+(new Date(0)).toGMTString()+";path="+(D||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)}};if(T("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(C){}O=v.namespace(O);O.toString=function(){return J};return O.extend({testImage:M,
prettyName:J,test:T,is:function(N){return T(N)},Cookies:x})})(basis,this);
(function(v,I){function G(f,k,m){if(k!=null)return f.insertBefore(b(k)?k:Q(k),m||null)}function T(f){return H("",f.cloneNode(true)).innerHTML}function O(f){return b(f)||f&&f.nodeType?f:typeof f=="string"?y.getElementById(f):null}function V(f,k,m){var q,t=[];m=typeof m=="string"?getter(m):m||Function.$true;k&26&&m(f)&&t.push(f);switch(k){case 1:case 2:for(q=f;(q=q[C])&&q!==f.document;)m(q)&&t.push(q);break;case 64:for(q=f[N];q;){m(q)&&t.push(q);q=q[D]}break;case 4:case 8:if(f[N]){k=new c(f);k.nodes(m,
t)}break;case 128:k=new c(f,m);for(k.cursor_=f[D]||f[C];q=k.next();)t.push(q);break;case 256:for(q=f;q=q[D];)m(q)&&t.push(q);break;case 32:m(f[C])&&t.push(f[C]);break;case 512:k=new c(f,m,c.BACKWARD);for(k.cursor_=f[a]||f[C];q=k.next();)t.push(q);break;case 1024:for(q=f;q=q[a];)m(q)&&t.push(q);break}return t}function Q(f){return y.createTextNode(f!=null?f:"")}function M(){for(var f=y.createDocumentFragment(),k=arguments.length,m=M.array=[],q=0;q<k;q++)m.push(G(f,arguments[q]));return f}function H(f){var k=
f!=undefined&&typeof f!="string",m=(k?f.description:f)||"",q="div",t=m.match(/^([a-z0-9\_\-]+)(.*)$/i);if(t){q=t[1];m=t[2]}if(m!=""){for(var z=[],e={},g;t=n.exec(m);){if(t[8])throw new Error("Create element error in basis.dom.createElement()\n\nDescription:\n> "+m+"\n\nProblem place:\n> "+m.substr(0,t.index)+"--\>"+m.substr(t.index)+"<--");g=t[1]||t[2]||t[3];if(t[1])e.id=g;else if(t[2])z.push(g);else if(g!="class")e[g]=t[4]?E(t[5],t[6],t[7]):g}if(i&&e.name&&/^(input|textarea|select)$/i.test(q))q=
"<"+q+" name="+e.name+">"}m=y.createElement(q);if(e){if(e.style&&l)m.style.cssText=e.style;for(var j in e)m.setAttribute(j,e[j],0)}if(z&&z.length)m.className=z.join(" ");arguments.length>1&&G(m,M.apply(0,Array.from(arguments,1).flatten()));if(k){f.css&&v.cssom&&v.cssom.setStyle(m,f.css);if(v.dom.event)for(var o in f)if(typeof f[o]=="function")v.dom.event.addHandler(m,o,f[o],m);else f[o]instanceof v.dom.event.Handler&&v.dom.event.addHandler(m,o,f[o].handler,f[o].thisObject)}return m}function J(f,k){return f[C]?
f[C].replaceChild(k,f):f}function x(f){if(y.selection){var k=y.selection.createRange();k.compareEndPoints("StartToEnd",k)!=0&&k.collapse(f);return k.getBookmark().charCodeAt(2)-2}}var E=Object.coalesce,y=I.document,R=v.Class,K=y.createElement("div"),C="parentNode",N="firstChild",D="nextSibling",a="previousSibling",d;d=typeof K.compareDocumentPosition=="function"?function(f,k){return f.compareDocumentPosition(k)}:function(f,k){if(f==k)return 0;if(f.document!=k.document)return 33;return f.sourceIndex>
k.sourceIndex?2|8*k.contains(childA):4|16*f.contains(childB)};var b;if(typeof Node!="undefined"){b=function(f){return f instanceof Node};if(!Node.prototype.contains)Node.prototype.contains=function(f){return!!(this.compareDocumentPosition(f)&16)}}else b=function(f){return f&&f.ownerDocument===y};var c=R(null,{root_:null,cursor_:null,filter:Function.$true,init:function(f,k,m){this.setRoot(f);this.setDirection(m);if(typeof k=="function")this.filter=k},setDirection:function(f){Object.extend(this,f?{a:"lastChild",
b:a,c:D,d:N}:{a:N,b:D,c:a,d:"lastChild"})},setRoot:function(f){this.root_=f||y;this.reset()},reset:function(){this.cursor_=null},first:function(f){this.reset();return this.next(f)},last:function(f){this.reset();return this.prev(f)},nodes:function(f,k){var m;k||(k=[]);for(this.reset();m=this.next(f);)k.push(m);return k},next:function(f){f=f||this.filter;var k=this.cursor_||this.root_;do for(var m=k[this.a];!m;){if(k===this.root_)return this.cursor_=null;(m=k[this.b])||(k=k[C])}while(!f(k=m));return this.cursor_=
k},prev:function(f){f=f||this.filter;var k=this.cursor_,m=this.c,q=this.d;do{var t=k?k[m]:this.root_[q];if(t){for(;t[q];)t=t[q];k=t}else if(k)k=k[C];if(!k||k===this.root_){k=null;break}}while(!f(k));return this.cursor_=k},destroy:function(){this.cursor_=this.root_=null}});c.BACKWARD=true;var h="textContent innerText nodeValue".qw(),i=function(){var f=y.createElement("input");f.name="a";return!/name/.test(T(f))}(),l;K.setAttribute("style","color: red");l=K.style.color!=="red";var n=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;
return v.namespace("basis.dom").extend({ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_TYPE_NODE:10,DOCUMENT_NODE:9,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,AXIS_ANCESTOR:1,AXIS_ANCESTOR_OR_SELF:2,AXIS_DESCENDANT:4,AXIS_DESCENDANT_OR_SELF:8,AXIS_SELF:16,AXIS_PARENT:32,AXIS_CHILD:64,AXIS_FOLLOWING:128,AXIS_FOLLOWING_SIBLING:256,AXIS_PRESCENDING:512,AXIS_PRESCENDING_SIBLING:1024,INSERT_BEGIN:"begin",
INSERT_END:"end",INSERT_BEFORE:"before",INSERT_AFTER:"after",TreeWalker:c,outerHTML:T,textContent:function(f){for(var k=0,m;m=h[k++];)if(f[m]!=null)return f[m];return V(f,4,function(q){return q.nodeType==3}).map(getter("nodeValue")).join("")},get:O,tag:function(f,k){f=O(f)||y;return k=="*"&&f.all?Array.from(f.all):Array.from(f.getElementsByTagName(k||"*"))},axis:V,findAncestor:function(f,k,m){for(;f&&f!==m;){if(k(f))return f;f=f.parentNode}},createElement:H,createText:Q,createFragment:M,insert:function(f,
k,m,q){f=O(f);if(!f)throw new Error("basis.dom.insert: destination node can't be null");switch(m){case undefined:case "end":q=null;break;case "begin":q=f[N];break;case "before":break;case "after":q=q[D];break;default:q=Number(m).between(0,f.childNodes.length)?f.childNodes[m]:null}m=!b(f);if(!k||!Array.isArray(k))m=m?k&&f.insertBefore(k,q):G(f,k,q);else if(m){m=[];for(var t=0,z=k.length;t<z;t++)m[t]=f.insertBefore(k[t],q)}else{f.insertBefore(M.apply(0,k),q);m=M.array}return m},remove:function(f){return f[C]?
f[C].removeChild(f):f},replace:J,swap:function(f,k){if(f===k||d(f,k)&25)return false;J(f,K);J(k,f);J(K,k);return true},clone:function(f,k){var m=f.cloneNode(!k);m.attachEvent&&V(m,8).forEach(Event.clearHandlers);return m},clear:function(f){for(f=O(f);f.lastChild;)f.removeChild(f.lastChild);return f},wrap:function(f,k,m){var q=[];m=Function.getter(m||Function.$self);for(var t in k)for(var z=0;z<f.length;z++){var e=m(f[z]);q[z]=k[t](f[z],z,e)?H(t,e):f[z]}return q},setAttribute:function(f,k,m){m==null?
f.removeAttribute(k):f.setAttribute(k,m)},parentOf:function(f,k){return f.contains(k)},isInside:function(f,k){return f==k||k.contains(f)},focus:function(f,k){try{f=O(f);f.focus();k&&f.select&&f.select()}catch(m){}},setSelectionRange:function(f,k,m){if(arguments.length<3)m=k;if(f.setSelectionRange)f.setSelectionRange(k,m);else if(f.createTextRange){var q=f.createTextRange();q.collapse(true);q.moveStart("character",k);q.moveEnd("character",m-k);q.select()}},getSelectionStart:function(f){return typeof f.selectionStart!=
"undefined"?f.selectionStart:x(true)},getSelectionEnd:function(f){return typeof f.selectionEnd!="undefined"?f.selectionEnd:x(false)}})})(basis,this);
(function(v,I){function G(a){return a||I.event}function T(a){return typeof a=="string"?E.get(a):a}function O(a){a=G(a);if(a.stopPropagation)a.stopPropagation();else a.cancelBubble=true}function V(a){a=G(a);if(a.preventDefault)a.preventDefault();else a.returnValue=false}function Q(a){var d=Array.from(C[a.type]);if(d)for(var b=d.length;b-- >0;){var c=d[b];c.handler.call(c.thisObject,a)}}function M(a,d,b,c){a=T(a);if(!a)throw new Error("Event.addHandler: can't attach event listener to undefined");if(typeof b!=
"function")throw new Error("Event.addHandler: handler must be a function");a[R]||(a[R]={});var h={handler:b,thisObject:c},i=a[R],l=i[d];if(l){for(a=0;d=l[a];a++)if(d.handler===b&&d.thisObject===c)return;l.push(h)}else{l=i[d]=[h];l.fireEvent=function(n){n=G(n);if(N&&n)if(typeof n.returnValue=="undefined"){Q(n);if(n.cancelBubble===true)return;if(typeof n.returnValue=="undefined")n.returnValue=true}for(var f=0,k;k=l[f++];)k.handler.call(k.thisObject,n)};a.addEventListener?a.addEventListener(d,l.fireEvent,
false):a.attachEvent("on"+d,l.fireEvent)}}function H(a,d,b,c){a=T(a);var h=a[R];if(h)if(h=h[d])for(var i=0,l;l=h[i];i++)if(l.handler===b&&l.thisObject===c){h.splice(i,1);h.length||J(a,d);return}}function J(a,d){a=T(a);var b=a[R];if(b)if(typeof d!="string")for(d in b)J(a,d);else{var c=b[d];if(c){a.removeEventListener?a.removeEventListener(d,c.fireEvent,false):a.detachEvent("on"+d,c.fireEvent);delete b[d]}}}var x=I.document,E=v.dom,y=Function.$null,R="__basisEvents",K={mousewheel:["mousewheel","DOMMouseScroll"]},
C={},N=!x.addEventListener,D=function(){function a(){d++||setTimeout(function(){for(var h=0;h<b.length;h++)b[h].callback.call(b[h].thisObject)},10)}var d=false,b=[];if(v.ua.is("ie7-"))(function(){var h="_"+Date.now();x.write('<script id="'+h+'" defer src="//:"><\/script>');T(h).onreadystatechange=function(){if(this.readyState=="complete"){E.remove(this);a()}}})();else if(v.ua.is("safari525-"))var c=setInterval(function(){if(/loaded|complete/.test(x.readyState)){clearInterval(c);a()}},15);else M(x,
"DOMContentLoaded",a,false);M(x,"load",a,false);M(I,"load",a,false);return function(h,i){d||b.push({callback:h,thisObject:i})}}();return v.namespace("basis.dom.event",G).extend({KEY:{BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F5:116},MOUSE_LEFT:{VALUE:1,BIT:1},MOUSE_RIGHT:{VALUE:3,BIT:2},MOUSE_MIDDLE:{VALUE:2,BIT:4},browserEvents:function(a){return K[a]||[a]},Handler:function(a,
d){this.handler=a;this.thisObject=d},sender:function(a){a=G(a);return a.target||a.srcElement},cancelBubble:O,cancelDefault:V,kill:function(a,d){if(d=T(d))M(d,a,Event.kill);else{V(a);O(a)}},key:function(a){a=G(a);return a.keyCode||a.which||0},charCode:function(a){a=G(a);return a.charCode||a.keyCode||0},mouseButton:function(a,d){a=G(a);return typeof a.which=="number"?a.which==d.VALUE:a.button&d.BIT},mouseX:function(a){a=G(a);return a.changedTouches?a.changedTouches[0].pageX:"pageX"in a?a.pageX:a.clientX+
(x.documentElement.scrollLeft||x.body.scrollLeft)},mouseY:function(a){a=G(a);return a.changedTouches?a.changedTouches[0].pageY:"pageY"in a?a.pageY:a.clientY+(x.documentElement.scrollTop||x.body.scrollTop)},wheelDelta:function(a){a=G(a);return"wheelDelta"in a?a.wheelDelta/120:a.type=="DOMMouseScroll"?-a.detail/3:0},addGlobalHandler:function(a,d,b){var c=C[a];if(c)for(a=c.length;a-- >0;){var h=c[a];if(h.handler===d&&h.thisObject===b)return}else{x.addEventListener?x.addEventListener(a,Q,true):M(x,a,
y);c=C[a]=[]}c.push({handler:d,thisObject:b})},removeGlobalHandler:function(a,d,b){var c=C[a];if(c)for(var h=0,i;i=c[h];h++)if(i.handler===d&&i.thisObject===b){c.splice(h,1);if(!c.length){delete C[a];x.removeEventListener?x.removeEventListener(a,Q,true):H(x,a,y)}return}},addHandler:M,addHandlers:function(a,d,b){a=T(a);for(var c in d)M(a,c,d[c],b)},removeHandler:H,clearHandlers:J,fireEvent:function(a,d){a=T(a);var b=a[R];b&&b[d]&&b[d].fireEvent()},onLoad:D,onUnload:function(a,d){M(I,"unload",a,d)}})})(basis,
this);
(function(){function v(a,d,b){for(var c=1,h;d;){if(d&1){h=y[c];if(b&c){a.addHandler(h.handler,h.context);h.action(h.context.add,a)}else{a.removeHandler(h.handler,h.context);h.action(h.context.remove,a)}}d>>=1;c<<=1}}function I(a){return Array.isArray(a)?a.map(I):{data:a}}var G=basis.Class,T=basis.EventObject,O=Object.values,V=Function.$self,Q=T.createEvent,M=T.event,H={},J=[],x={},E={PRIORITY:[],values_:{},add:function(a,d){var b=a.toUpperCase(),c=a.toLowerCase();this[b]=c;x[c]=true;if(d){d=this.indexOf(d);
d==-1?this.PRIORITY.push(c):this.PRIORITY.splice(d,0,c)}}};E.add("READY");E.add("DEPRECATED");E.add("UNDEFINED");E.add("ERROR");E.add("PROCESSING");var y={},R=1,K={NONE:0,MASK:0,add:function(a,d,b){y[R]={handler:d,action:b,context:{add:function(c,h){if(h){var i=K[a]+"_"+c.eventObjectId;if(!h.subscribers_)h.subscribers_={};if(!h.subscribers_[i]){var l=h.subscriberCount;h.subscribers_[i]=c;h.subscriberCount+=1;h.event_subscribersChanged(h,l)}}},remove:function(c,h){if(h){var i=K[a]+"_"+c.eventObjectId;
if(h.subscribers_[i]){var l=h.subscriberCount;delete h.subscribers_[i];h.subscriberCount-=1;h.event_subscribersChanged(h,l)}}}}};K[a]=R;K.MASK|=R;R<<=1}};K.add("DELEGATE",{delegateChanged:function(a,d){this.remove(a,d);this.add(a,a.delegate)}},function(a,d){a(d,d.delegate)});K.add("TARGET",{targetChanged:function(a,d){this.remove(a,d);this.add(a,a.target)}},function(a,d){a(d,d.target)});var C=G(T,{state:E.READY,data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,
target:null,active:false,subscribeTo:K.DELEGATE+K.TARGET,subscriberCount:0,subscribers_:null,event_update:Q("update","object","delta"),event_stateChanged:Q("stateChanged","object","oldState"),event_delegateChanged:Q("delegateChanged","object","oldDelegate"),event_rootChanged:Q("rootChanged","object","oldRoot"),event_targetChanged:Q("targetChanged","object","oldTarget")&&function(a,d){var b=this.listen.target;if(b){d&&d.removeHandler(b,this);this.target&&this.target.addHandler(b,this)}M.targetChanged.call(this,
a,d)},event_subscribersChanged:Q("subscribersChanged","object"),event_activeChanged:Q("activeChanged","object"),listen:{delegate:{update:function(a,d){this.data=a.data;this.event_update(this,d)},stateChanged:function(a,d){this.state=a.state;this.event_stateChanged(this,d)},targetChanged:function(a,d){this.target=a.target;this.event_targetChanged(this,d)},rootChanged:function(a,d){this.data=a.data;this.event_rootChanged(this,d)},destroy:function(){this.cascadeDestroy?this.destroy():this.setDelegate()}}},
init:function(a){T.prototype.init.call(this,a);if(a=this.delegate){this.delegate=null;this.data=a.data;this.state=a.state;this.setDelegate(a)}else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}this.active&&v(this,this.subscribeTo,K.MASK)},isConnected:function(a){if(a instanceof C){for(;a&&a!==this&&a!==a.delegate;)a=a.delegate;return a===this}return false},getRootDelegate:function(){for(var a=this;a.delegate&&a.delegate!==a;)a=a.delegate;return a},setDelegate:function(a){if(this.canHaveDelegate&&
a&&a instanceof C){if(a.delegate&&this.isConnected(a))return false}else a=null;if(this.delegate!==a){var d=this.state,b=this.data,c=this.delegate,h=this.target,i=this.root,l={},n=this.listen.delegate;c&&n&&c.removeHandler(n,this);if(a){this.delegate=a;this.root=a.root;this.data=a.data;this.state=a.state;this.target=a.target;n&&a.addHandler(n,this);for(var f in a.data)if(f in b===false)l[f]=undefined;for(f in b)if(b[f]!==a.data[f])l[f]=b[f]}else{this.target=this.delegate=null;this.root=this;this.data=
{};for(f in b)this.data[f]=b[f]}this.event_delegateChanged(this,c);this.root!==i&&this.event_rootChanged(this,i);this.target!==h&&this.event_targetChanged(this,h);if(a){for(f in l){this.event_update(this,l);break}if(d!==this.state&&(String(d)!=this.state||d.data!==this.state.data))this.event_stateChanged(this,d)}return true}return false},setState:function(a,d){var b=this.target||this.getRootDelegate();if(b!==this)return b.setState(a,d);b=String(a);if(!x[b])throw new Error("Wrong state value");if(this.state!=
b||this.state.data!=d){var c=this.state;this.state=Object(b);this.state.data=d;this.event_stateChanged(this,c);return true}return false},deprecate:function(){this.state!=E.PROCESSING&&this.setState(E.DEPRECATED)},update:function(a){var d=this.target||this.getRootDelegate();if(d!==this)return d.update(a);if(a){d={};var b=0;for(var c in a)if(this.data[c]!==a[c]){b++;d[c]=this.data[c];this.data[c]=a[c]}if(b){this.event_update(this,d);return d}}return false},setActive:function(a){a=!!a;if(this.active!=
a){this.active=a;this.event_activeChanged(this);v(this,this.subscribeTo,K.MASK*a);return true}return false},setSubscription:function(a){a=a&K.MASK;var d=this.subscribeTo^a;if(d){this.subscribeTo=a;this.active&&v(this,d,a);return true}return false},destroy:function(){this.active&&v(this,this.subscribeTo,0);this.delegate&&this.setDelegate();T.prototype.destroy.call(this);this.data=H;this.state=E.UNDEFINED;this.target=this.root=null}});V=G(null,{itemClass:C,keyGetter:V,map_:null,extendConstructor_:true,
init:function(){this.map_={};basis.Cleaner.add(this)},resolve:function(a){return this.get(this.keyGetter(a),a)},create:function(a){var d={};if(a instanceof C)d.delegate=a;else d.data={id:a,title:a};return new this.itemClass(d)},get:function(a,d){var b=a instanceof C?a.eventObjectId:a,c=this.map_[b];if(!c&&d){c=this.map_[b]=this.create(a,d);c.addHandler({destroy:function(){delete this.map_[b]}},this)}return c},destroy:function(){basis.Cleaner.remove(this);for(var a=O(this.map_),d=0,b;b=a[d++];)b.destroy()}});
var N=G(C,{state:E.UNDEFINED,itemCount:0,item_:null,memberMap_:null,cache_:null,event_datasetChanged:Q("datasetChanged","dataset","delta")&&function(a,d){var b,c=0,h=0,i;if(b=d.inserted)for(;i=b[c];){this.item_[i.eventObjectId]=i;c++}if(b=d.deleted)for(;i=b[h];){delete this.item_[i.eventObjectId];h++}this.itemCount+=c-h;this.cache_=null;M.datasetChanged.call(this,a,d)},init:function(a){C.prototype.init.call(this,a);this.memberMap_={};this.item_={}},has:function(a){return!!(a&&this.item_[a.eventObjectId])},
getItems:function(){if(!this.cache_)this.cache_=O(this.item_);return this.cache_},pick:function(){for(var a in this.item_)return this.item_[a];return null},top:function(a){var d=[];if(a)for(var b in this.item_)if(d.push(this.item_[b])>=a)break;return d},add:function(){},remove:function(){},set:function(){},sync:function(){},clear:function(){},destroy:function(){this.clear();C.prototype.destroy.call(this);this.cache_=J;this.itemCount=0;this.item_=this.memberMap_=null}}),D=G(N,{listen:{item:{destroy:function(a){this.memberMap_[a.eventObjectId]&&
this.remove([a])}}},init:function(a){N.prototype.init.call(this,a);if(a=this.items){this.set(a);this.items=null}},add:function(a){for(var d,b=this.memberMap_,c=[],h=this.listen.item,i=0;i<a.length;i++){var l=a[i];if(l instanceof C){var n=l.eventObjectId;if(!b[n]){b[n]=l;h&&l.addHandler(h,this);c.push(l)}}}if(c.length)this.event_datasetChanged(this,d={inserted:c});return d},remove:function(a){for(var d,b=this.memberMap_,c=[],h=this.listen.item,i=0;i<a.length;i++){var l=a[i];if(l instanceof C){var n=
l.eventObjectId;if(b[n]){h&&l.removeHandler(h,this);delete b[n];c.push(l)}}}if(c.length)this.event_datasetChanged(this,d={deleted:c});return d},set:function(a){if(!this.itemCount)return this.add(a);if(!a.length)return this.clear();for(var d=this.memberMap_,b={},c=[],h=[],i,l,n=this.listen.item,f=0;f<a.length;f++){i=a[f];if(i instanceof C){l=i.eventObjectId;b[l]=i;if(!d[l]){d[l]=i;n&&i.addHandler(n,this);h.push(i)}}}for(l in d)if(!b[l]){i=d[l];n&&i.removeHandler(n,this);delete d[l];c.push(i)}var k;
a={};var m;if(h&&h.length)m=a.inserted=h;if(c&&c.length)m=a.deleted=c;if(m)k=a;if(c=k)this.event_datasetChanged(this,c);return c},sync:function(a,d){if(a){D.setAccumulateState(true);for(var b=this.memberMap_,c,h,i={},l=[],n,f=0;f<a.length;f++){c=a[f];if(c instanceof C){h=c.eventObjectId;i[h]=c;b[h]||l.push(c)}}for(h in this.item_)i[h]||this.item_[h].destroy();if(d&&l.length)n=this.add(l);D.setAccumulateState(false);return n}},clear:function(){var a,d=this.getItems(),b=this.listen.item;if(d.length){if(b)for(a=
d.length;a-- >0;)d[a].removeHandler(b,this);this.event_datasetChanged(this,a={deleted:d});this.memberMap_={}}return a}});D.setAccumulateState=function(){function a(f){var k=f.dataset;h.call(k,k,f)}function d(f,k){var m=f.eventObjectId,q=k.inserted,t=k.deleted,z=n[m];if(q&&t){if(z){delete n[m];a(z)}return h.call(f,f,k)}if(z){var e=z[q?"inserted":"deleted"];if(e)return e.push.apply(e,q||t);else a(z)}n[m]=k;k.dataset=f}function b(){i=1;setAccumulateState(false)}var c=N.prototype,h=c.event_datasetChanged,
i=0,l,n={};return function(f){if(f){if(i==0){c.event_datasetChanged=d;l=setTimeout(b,0)}i++}else{i-=i>0;if(i==0){clearTimeout(l);c.event_datasetChanged=h;f=n;n={};O(f).forEach(a)}}}}();basis.namespace("basis.data",I).extend({STATE:E,SUBSCRIPTION:K,Object:C,DataObject:C,KeyObjectMap:V,AbstractDataset:N,Dataset:D})})(basis,this);
(function(v,I){function G(d,b,c,h){b=b.split(/\{([a-z0-9\_]+(?:\|[^}]*)?)\}/i);for(var i=C(),l,n=0;n<b.length;n++){if(n%2){l=b[n].split(/\|/);d.getters[l[0]]=c+"childNodes["+h+"]";l=l.length>1?l[1]:l[0]}else l=b[n].length?b[n]:null;if(l!=null){if(K){i.lastChild&&i.appendChild(M.createComment(""));h++}i.appendChild(N(l));h++}}return i}function T(d){return function(b){if(!(b&&b.type=="click"&&b.which==3)){var c=v.dom.event.sender(b),h,i;do if(h=c.getAttributeNode&&c.getAttributeNode(d))break;while(c=
c.parentNode);if(c&&h){do if(i=c.basisObjectId)if((i=E[i])&&i.templateAction){c=h.nodeValue.qw();h=0;for(var l;l=c[h++];)i.templateAction(l,v.dom.event(b));break}while(c=c.parentNode)}}}}function O(d,b,c){b=b.trim();if(!b)return"";for(var h="",i;i=R.exec(b);){var l=i[2],n=i[4]||i[5]||l;if(i[3])d.getters[i[3]]=c+'.getAttributeNode("'+l+'")';if(i=l.match(/^event-([a-z]+)/i)){var f=i[1];if(!x[f]){x[f]=true;i=0;f=v.dom.event.browserEvents(f);for(var k;k=f[i++];)v.dom.event.addGlobalHandler(k,T(l))}if(!window.__basis_emitEvent)window.__basis_emitEvent=
function(m,q){m=v.dom.event(m);var t=this,z;do if(z=t.basisObjectId)if((z=E[z])&&z.templateAction){t=q.qw();for(var e=0,g;g=t[e++];)z.templateAction(g,v.dom.event(m));break}while(t=t.parentNode)}}h+=l=="class"?n.trim().replace(/^(.)|\s+/g,".$1"):"["+l+(n?"="+n.quote('"'):"")+"]"}return h}function V(d,b){if(!d.stack)d.stack=[];if(!d.source)d.source=d.str;b||(b=".");for(var c=C(),h,i=0,l,n=d.stack;l=y.exec(d.str);){h=RegExp.leftContext;d.str=d.str.substr(h.length+l[0].length);if(h.length){c.appendChild(G(d,
h,b,i));i=c.childNodes.length}if(l[5])if(l[5]==n[n.length-1]){n.pop();return c}else throw"Wrong end tag";if(l[6]){if(l[7])d.getters[l[7]]=b+"childNodes["+i+"]";c.appendChild(M.createComment(l[6]))}else{h=l[1];var f=l[2],k=!!l[4],m=b+"childNodes["+i+"]";l=H.createElement(h+O(d,l[3],m));if(f)d.getters[f]=m;if(!k){n.push(h);l.appendChild(V(d,m+"."))}c.appendChild(l)}i++}d.str.length&&c.appendChild(G(d,d.str,b,i));if(n.length)throw"No end tag for "+n.reverse();return c}function Q(d){if(!this.proto){d=
this.source;if(typeof d=="function")this.source=d=d();d=d.trim();d={str:d,getters:{element:".childNodes[0]"}};var b=V(d);d=Object.iterate(d.getters,function(n,f){for(var k=n.split(/\|/).map(String.format,"obj_.{0}"),m=f.split(/(\.?childNodes\[(\d+)\])/),q=b,t=0;t<m.length;t+=3){var z=m[t+2];if(!z)break;m[t+2]="";q=q.childNodes[z];if(q.previousSibling)q.nextSibling||(m[t+1]=".lastChild");else m[t+1]=".firstChild"}return{name:k[0],alias:k.join("="),path:"dom_"+m.join("")}}).sortAsObject("path");for(var c=
0;c<d.length;c++)for(var h=new RegExp("^"+d[c].path.forRegExp()),i=c+1,l;l=d[i++];)l.path=l.path.replace(h,d[c].name);this.createInstance=(new Function("proto_","map_","var obj_, dom_; return "+function(n,f){obj_=n||{};dom_=proto_.cloneNode(true);_code_();if(f&&obj_.element){var k=obj_.element.basisObjectId=map_.seed++;map_[k]=f}return obj_}.toString().replace("_code_()",d.map(String.format,"{alias}={path};\n").join(""))))(b,E);this.clearInstance=(new Function("map_","var obj_; return "+function(n){obj_=
n;(n=obj_.element&&obj_.element.basisObjectId)&&delete map_[n];_code_()}.toString().replace("_code_()",d.map(String.format,"{alias}=null;\n").join(""))))(E)}}var M=I.document,H=v.dom,J=v.Class,x={},E={seed:1},y=/<([a-z0-9\_]+)(?:\{([a-z0-9\_\|]+)\})?([^>]*?)(\/?)>|<\/([a-z0-9\_]+)>|<!--(\s*\{([a-z0-9\_\|]+)\}\s*|.*?)--\>/i,R=/(?:([a-z0-9\_\-]+):)?([a-z0-9\_\-]+)(?:\{([a-z0-9\_\|]+)\})?(?:="((?:\\.|[^"])*?)"|='((?:\\.|[^'])*?)')?\s*/gi;H.createFragment();var K=H.createElement("","a","b").cloneNode(true).childNodes.length==
1,C=H.createFragment,N=H.createText,D=J(null,{__extend__:function(d){return d instanceof D?d:new D(d)},init:function(d){this.source=d},createInstance:function(d,b){Q.call(this);return this.createInstance(d,b)},clearInstance:function(){Q.call(this)}}),a=M.createElement("DIV");return v.namespace("basis.html").extend({Template:D,escape:function(d){return H.createElement("DIV",H.createText(d)).innerHTML},unescape:function(d){a.innerHTML=d;return a.firstChild.nodeValue},string2Html:function(d){a.innerHTML=
d;return H.createFragment.apply(null,Array.from(a.childNodes))}})})(basis,this);
(function(v){function I(e){return e.sortingValue||0}function G(e,g){e=e.sortingValue||0;g=g.sortingValue||0;return+(e>g)||-(e<g)}function T(e,g){e=e.sortingValue||0;g=g.sortingValue||0;return-(e>g)||+(e<g)}function O(e){return e.childNodes.sort(e.localSortingDesc?T:G)}function V(e,g){var j=g.length-1;e.childNodes=g;e.firstChild=g[0]||null;e.lastChild=g[j]||null;for(var o=j;j=g[o];o--){j.nextSibling=g[o+1]||null;j.previousSibling=g[o-1]||null;e.insertBefore(j,j.nextSibling)}}function Q(e,g){var j=
e.childFactory||e.document&&e.document.childFactory,o;g=Object.extend({document:e.document,contextSelection:e.selection||e.contextSelection},g);if(j){o=j.call(e,g);if(o instanceof e.childClass)return o}if(!o)throw"basis.dom.wrapper: Child node is null";throw"basis.dom.wrapper: Child node has wrong class (expected "+(e.childClass&&e.childClass.className)+" but "+(o&&o.constructor&&o.constructor.className)+")";}function M(){return v.ui.apply(this,arguments)}var H=v.Class,J=v.dom,x=v.data,E=x.SUBSCRIPTION,
y=x.DataObject,R=x.AbstractDataset,K=x.Dataset,C=J.AXIS_DESCENDANT,N=J.AXIS_DESCENDANT_OR_SELF,D=Function.getter,a=Object.complete,d=J.axis;x=v.EventObject.createEvent;var b=v.EventObject.event,c={NONE:"none",PARENT:"parent",OWNER:"owner"};E.add("DATASOURCE",{dataSourceChanged:function(e,g){this.remove(e,g);this.add(e,e.dataSource)}},function(e,g){e(g,g.dataSource)});var h=H.ExtensibleProperty(),i={ownerChanged:function(){},destroy:function(e){J.replace(e.element,this)}},l=function(){var e=this.key,
g=this.config,j=this.owner,o=typeof g.existsIf!="function"||g.existsIf(j),r=j.satellite[e];if(o){o="delegate"in g;var A="dataSource"in g,B=typeof g.delegate=="function"?g.delegate(j):null,p=typeof g.dataSource=="function"?g.dataSource(j):null;if(r){o&&r.setDelegate(B);A&&r.setDataSource(p)}else{var s=j.tmpl[g.replace||e];r={owner:j};if(o)r.delegate=B;if(A)r.dataSource=p;if(g.config)Object.complete(r,typeof g.config=="function"?g.config(j):g.config);r=new g.instanceOf(r);j.satellite[e]=r;if(s&&r instanceof
v.ui.Node&&r.element){J.replace(s,r.element);r.addHandler(i,s)}}}else if(r){r.destroy();r.owner=null;delete j.satellite[e]}},n=H.CustomExtendProperty({update:true},function(e,g){for(var j in g)e[j]=g[j]?l:null}),f=H(y,{event_update:function(e,g){y.prototype.event_update.call(this,e,g);var j=this.parentNode;if(j){j.matchFunction&&this.match(j.matchFunction);j.insertBefore(this,this.nextSibling)}},event_childNodesModified:x("childNodesModified","node","delta"),event_dataSourceChanged:x("dataSourceChanged",
"node","oldDataSource"),event_localGroupingChanged:x("localGroupingChanged","node","oldGroupingNode"),event_localSortingChanged:x("localSortingChanged","node","oldLocalSorting","oldLocalSortingDesc"),event_ownerChanged:x("ownerChanged","node","oldOwner"),event_satellitesChanged:x("satellitesChanged","node","delta"),subscribeTo:y.prototype.subscribeTo+E.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegate:c.NONE,nodeType:"DOMWrapperNode",canHaveChildren:false,childNodes:null,
dataSource:null,colMap_:null,destroyDataSourceMember:true,document:null,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,localSorting:null,localSortingDesc:false,localGrouping:null,localGroupingClass:null,groupNode:null,satelliteConfig:h,satellite:null,owner:null,init:function(e){var g=this.dataSource,j=this.childNodes,o=this.localGrouping;if(g)this.dataSource=null;y.prototype.init.call(this,e);if(o){this.localGrouping=null;this.setLocalGrouping(o)}if(this.canHaveChildren){this.childNodes=
[];if(g){this.dataSource=null;this.setDataSource(g)}else j&&this.setChildNodes(j)}else{if(j)this.childNodes=null;if(g)this.dataSource=null}if(!this.satellite)this.satellite={};if(this.satelliteConfig!==h)for(var r in this.satelliteConfig){e=this.satelliteConfig[r];if(H.isClass(e))e={instanceOf:e};if(typeof e=="object"){g={key:r,owner:this,config:e};e=e.hook?n.__extend__(e.hook):n;for(r in e)if(e[r]===l){this.addHandler(e,g);break}l.call(g)}}if(r=this.owner){this.owner=null;this.setOwner(r)}},appendChild:function(){},
insertBefore:function(){},removeChild:function(){},replaceChild:function(){},clear:function(){},hasChildNodes:function(){return this.childNodes.length>0},setChildNodes:function(){},setLocalGrouping:function(){},setLocalSorting:function(){},setDataSource:function(){},setOwner:function(e){if(!e||e instanceof f==false)e=null;if(this.owner!==e){var g=this.owner,j=this.listen.owner;this.owner=e;if(j){g&&g.removeHandler(j,this);e&&e.addHandler(j,this)}this.event_ownerChanged(this,g);this.autoDelegate==
c.OWNER&&this.setDelagate(e)}},destroy:function(){y.prototype.destroy.call(this);if(this.dataSource)this.setDataSource();else this.firstChild&&this.clear();this.parentNode&&this.parentNode.removeChild(this);if(this.localGrouping){this.localGrouping.destroy();this.localGrouping=null}this.owner&&this.setOwner();if(this.satellite){for(var e in this.satellite){var g=this.satellite[e];g.destroy();g.owner=null}this.satellite=null}this.lastChild=this.firstChild=this.nextSibling=this.previousSibling=this.parentNode=
this.childNodes=this.document=null}}),k=H(f,{autoDestroyIfEmpty:false,nodes:null,first:null,last:null,init:function(e){this.nodes=[];f.prototype.init.call(this,e)},insert:function(e,g){var j=this.nodes,o=g?j.indexOf(g):-1;if(o==-1){j.push(e);this.last=e}else j.splice(o,0,e);this.first=j[0];e.groupNode=this;this.event_childNodesModified(this,{inserted:[e]})},remove:function(e){var g=this.nodes;if(g.remove(e)){this.first=g[0]||null;this.last=g[g.length-1]||null;e.groupNode=null;this.event_childNodesModified(this,
{deleted:[e]})}!this.first&&this.autoDestroyIfEmpty&&this.destroy()},clear:function(){if(this.first){for(var e=this.nodes,g=e.length;g-- >0;)e[g].groupNode=null;this.nodes=[];this.last=this.first=null;this.event_childNodesModified(this,{deleted:e});this.autoDestroyIfEmpty&&this.destroy()}},destroy:function(){f.prototype.destroy.call(this);this.last=this.first=this.nodes=null}}),m={canHaveChildren:true,childClass:f,childFactory:null,listen:{dataSource:{datasetChanged:function(e,g){var j={},o=[];if(g.deleted){j.deleted=
o;if(this.childNodes.length==g.deleted.length){o.push.apply(o,this.childNodes);var r=this.dataSource;this.dataSource=null;this.clear(true);this.dataSource=r;this.colMap_={}}else{r=0;for(var A;A=g.deleted[r];r++){A=A.eventObjectId;var B=this.colMap_[A];delete this.colMap_[A];B.canHaveDelegate=true;this.removeChild(B);o.push(B)}}}if(g.inserted){j.inserted=[];for(r=0;A=g.inserted[r];r++){B=Q(this,{cascadeDestroy:false,delegate:A});B.canHaveDelegate=false;this.colMap_[A.eventObjectId]=B;j.inserted.push(B);
this.firstChild&&this.insertBefore(B)}}this.firstChild?this.event_childNodesModified(this,j):this.setChildNodes(j.inserted);if(this.destroyDataSourceMember&&o.length)for(r=0;A=o[r];r++)A.destroy()},destroy:function(e){this.dataSource===e&&this.setDataSource()}}},appendChild:function(e){return this.insertBefore(e)},insertBefore:function(e,g){if(!this.canHaveChildren)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";if(e.firstChild){var j=this;do if(j==e)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";
while(j=j.parentNode)}if(this.dataSource&&!this.dataSource.has(e.delegate))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(e instanceof this.childClass==false)e=Q(this,e instanceof y?{delegate:e}:e);var o=e.parentNode===this,r=e.groupNode,A=this.localGrouping,B=this.localSorting,p,s=this.childNodes,u,L,S=null;j=-1;var aa=false,F;if(o){F=e.nextSibling;L=e.previousSibling}if(B){g=null;p=this.localSortingDesc;u=B(e)||0;if(o)if(u===e.sortingValue)aa=true;
else if((!F||(p?F.sortingValue<=u:F.sortingValue>=u))&&(!L||(p?L.sortingValue>=u:L.sortingValue<=u))){e.sortingValue=u;aa=true}}if(A){S=A.getGroupNode(e);L=S.nodes;if(r===S)if(aa||o&&F===g)return e;if(B)if(aa)j=F&&F.groupNode===S?L.indexOf(F):L.length;else{j=L.binarySearchPos(u,I,p);e.sortingValue=u}else j=g&&g.groupNode===S?L.indexOf(g):L.length;if(j<L.length)g=L[j];else if(S.last)g=S.last.nextSibling;else{j=S;for(g=null;j=j.nextSibling;)if(g=j.first)break}if(e===g||o&&e.nextSibling===g){if(r!==
S){r&&r.remove(e);S.insert(e)}return e}j=-1}else if(B){if(aa)return e;j=s.binarySearchPos(u,I,p);g=s[j];e.sortingValue=u;if(e===g||o&&F===g)return e}else{if(g&&g.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(o){if(F===g)return e;if(e===g)throw"basis.dom.wrapper: Node can't be inserted at specified point in hierarchy";}}if(o){if(e.nextSibling)e.nextSibling.previousSibling=e.previousSibling;else this.lastChild=e.previousSibling;if(e.previousSibling)e.previousSibling.nextSibling=
e.nextSibling;else this.firstChild=e.nextSibling;e.previousSibling=null;e.nextSibling=null;if(j==-1)s.remove(e);else{p=s.indexOf(e);s.splice(p,1);p<j&&j--}if(r){r.remove(e);r=null}}else e.parentNode&&e.parentNode.removeChild(e);r!=S&&S.insert(e,g);if(g){if(j==-1)j=s.indexOf(g);if(j==-1)throw"basis.dom.wrapper: Node was not found";e.nextSibling=g;s.splice(j,0,e)}else{j=s.length;s.push(e);g={previousSibling:this.lastChild};this.lastChild=e}e.parentNode=this;e.previousSibling=g.previousSibling;if(j==
0)this.firstChild=e;else g.previousSibling.nextSibling=e;g.previousSibling=e;var W=false,$=false,Y=this.selection||this.contextSelection;if(!e.document&&e.document!==this.document){W=this.document;e.document=this.document}if(!e.contextSelection&&e.contextSelection!==Y){e.contextSelection=Y;$=!e.selection;e.selected&&Y.add([e])}if(e.firstChild&&(W||$))d(e,C).forEach(function(w){if(W&&!w.document)w.document=W;if($&&!w.contextSelection){w.selected&&w.unselect();w.contextSelection=Y}});if(!o){e.match&&
e.match(this.matchFunction);e.autoDelegate==c.PARENT&&e.setDelegate(this);this.dataSource||this.event_childNodesModified(this,{inserted:[e]})}return e},removeChild:function(e){if(e==null||e.parentNode!==this)throw"basis.dom.wrapper: Node was not found";if(e instanceof this.childClass==false)throw"basis.dom.wrapper: Child node has wrong class";if(this.dataSource&&this.dataSource.has(e))throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";this.childNodes.splice(this.childNodes.indexOf(e),
1);e.parentNode=null;if(e.nextSibling)e.nextSibling.previousSibling=e.previousSibling;else this.lastChild=e.previousSibling;if(e.previousSibling)e.previousSibling.nextSibling=e.nextSibling;else this.firstChild=e.nextSibling;e.nextSibling=null;e.previousSibling=null;e.document===this.document&&d(e,N).forEach(function(r){if(r.document==this.document)r.document=null},this);if(e.contextSelection){for(var g=e.contextSelection,j=e,o=[];j;){if(j.contextSelection===g){j.selected&&o.push(j);j.contextSelection=
null}if(!j.selection&&j.firstChild)j=j.firstChild;else if(j.nextSibling)j=j.nextSibling;else for(;j=j.parentNode;)if(j.nextSibling){j=j.nextSibling;break}}g.remove(o)}e.groupNode&&e.groupNode.remove(e);this.dataSource||this.event_childNodesModified(this,{deleted:[e]});e.autoDelegate==c.PARENT&&e.setDelegate();return e},replaceChild:function(e,g){if(this.dataSource)throw"basis.dom.wrapper: Operation is not allowed because node is under dataSource control";if(g==null||g.parentNode!==this)throw"basis.dom.wrapper: Node was not found";
this.insertBefore(e,g);return this.removeChild(g)},clear:function(e){if(this.dataSource)this.setDataSource();else if(this.firstChild){var g=this.childNodes;this.lastChild=this.firstChild=null;this.childNodes=[];this.event_childNodesModified(this,{deleted:g});for(var j=g.length;j-- >0;){var o=g[j];o.parentNode=null;o.groupNode=null;if(e){if(o.selection||o.document)d(o,J.AXIS_DESCENDANT_OR_SELF).forEach(function(r){if(this.selection&&r.selection===this.selection){r.selected&&r.selection.remove([r]);
r.selection=null}if(r.document===this.document)r.document=null},this);o.nextSibling=null;o.previousSibling=null;o.autoDelegate==c.PARENT&&o.setDelegate()}else o.destroy()}if(this.localGrouping){e=this.localGrouping.childNodes;for(j=e.length-1;g=e[j];j--)g.clear()}}},setChildNodes:function(e,g){this.dataSource||this.clear(!!g);if(e){if("length"in e==false)e=[e];if(e.length){var j=this.event_childNodesModified;this.event_childNodesModified=Function.$undef;for(var o=0,r=e.length;o<r;o++)this.insertBefore(e[o]);
this.event_childNodesModified=j;this.event_childNodesModified(this,{inserted:this.childNodes})}}},setDataSource:function(e){if(!e||!this.canHaveChildren||e instanceof R==false)e=null;if(this.dataSource!==e){var g=this.dataSource,j=this.listen.dataSource;this.dataSource=e;if(g){this.colMap_=null;j&&g.removeHandler(j,this);g.itemCount&&this.clear()}if(e){this.colMap_={};if(j){e.addHandler(j,this);e.itemCount&&j.datasetChanged&&j.datasetChanged.call(this,e,{inserted:e.getItems()})}}this.event_dataSourceChanged(this,
g)}},setLocalGrouping:function(e){if(typeof e=="function"||typeof e=="string")e={groupGetter:D(e)};if(e instanceof t==false)e=e!=null&&typeof e=="object"?new this.localGroupingClass(Object.complete({},e)):null;if(this.localGrouping!==e){var g=this.localGrouping,j;if(this.localGrouping){if(!e){this.localGrouping=null;if(this.firstChild){j=this.localSorting?O(this):this.childNodes;for(var o=j.length;o-- >0;)j[o].groupNode=null;V(this,j)}}g.setOwner()}if(e){this.localGrouping=e;e.setOwner(this);if(this.firstChild){j=
this.localSorting?O(this):this.childNodes;for(o=0;e=j[o];o++)e.groupNode=this.localGrouping.getGroupNode(e);j=j;for(o=0;e=j[o];o++)e.groupNode.nodes.push(e);j.length=0;for(o=this.localGrouping.nullGroup;o;o=o.nextSibling){e=o.nodes;o.first=e[0]||null;o.last=e[e.length-1]||null;j.push.apply(j,e);o.event_childNodesModified(o,{inserted:e})}V(this,j)}}this.event_localGroupingChanged(this,g)}},setLocalSorting:function(e,g){if(e)e=D(e);if(this.localSorting!=e||this.localSortingDesc!=!!g){var j=this.localSorting,
o=this.localSortingDesc;this.localSortingDesc=!!g;this.localSorting=e||null;if(e&&this.firstChild){var r=[],A;for(A=this.firstChild;A;A=A.nextSibling)A.sortingValue=e(A)||0;if(this.localGrouping)for(var B=this.localGrouping.nullGroup;B;B=B.nextSibling){A=B.nodes=O({childNodes:B.nodes,localSortingDesc:this.localSortingDesc});B.first=A[0]||null;B.last=A[A.length-1]||null;r.push.apply(r,A)}else r=O(this);V(this,r)}this.event_localSortingChanged(this,j,o)}},setMatchFunction:function(e){if(this.matchFunction!=
e){var g=this.matchFunction;this.matchFunction=e;for(var j=this.lastChild;j;j=j.previousSibling)j.match(e);this.event_matchFunctionChanged(this,g)}}};E=H(f,{event_enable:x("enable","node"),event_disable:x("disable","node"),event_select:x("select","node"),event_unselect:x("unselect","node"),event_match:x("match","node"),event_unmatch:x("unmatch","node"),event_matchFunctionChanged:x("matchFunctionChanged","node","oldMatchFunction"),selectable:true,selected:false,selection:null,contextSelection:null,
matchFunction:null,matched:true,disabled:false,init:function(e){if(this.selection&&this.selection instanceof R==false)this.selection=new z(this.selection);f.prototype.init.call(this,e);this.disabled&&this.event_disable(this);if(this.selected){this.selected=false;this.select(true)}},setSelection:function(e){if(this.selection==e)return false;var g=this.selection;d(this,C,function(j){if(j.contextSelection==g){j.selected&&g&&g.remove([j]);j.contextSelection=e}});this.selection=e;return true},hasOwnSelection:function(){return!!this.selection},
select:function(e){var g=this.selected,j=this.contextSelection;if(j)if(e)g?j.remove([this]):j.add([this]);else this.selectable&&j.set([this]);else if(!g&&this.selectable&&!this.isDisabled()){this.selected=true;this.event_select(this)}return this.selected!=g},unselect:function(){var e=this.selected;if(e){var g=this.contextSelection;if(g)g.remove([this]);else{this.selected=false;this.event_unselect(this)}}return this.selected!=e},enable:function(){if(this.disabled){this.disabled=false;this.event_enable(this)}},
disable:function(){if(!this.disabled){this.disabled=true;this.event_disable(this)}},isDisabled:function(){return this.disabled||this.document&&this.document.disabled||!!J.findAncestor(this,D("disabled"))},match:function(e){if(typeof e!="function")e=null;this.underMatch_&&!e&&this.underMatch_(this,true);this.underMatch_=e;e=!e||e(this);if(this.matched!=e)(this.matched=e)?this.event_match(this):this.event_unmatch(this)},setMatchFunction:function(){},destroy:function(){if(this.hasOwnSelection()){this.selection.destroy();
delete this.selection}this.unselect();f.prototype.destroy.call(this)}});var q=H(E,m,{}),t=H(f,m,{event_childNodesModified:function(e,g){b.childNodesModified.call(this,e,g);this.nullGroup.nextSibling=this.firstChild;if(g.inserted&&this.dataSource&&this.nullGroup.first)for(var j=this.owner,o=Array.from(this.nullGroup.nodes),r=o.length;r-- >0;)j.insertBefore(o[r],o[r].nextSibling)},event_ownerChanged:function(e,g){g&&g.localGrouping===this&&g.setLocalGrouping(null,true);this.owner&&this.owner.localGrouping!==
this&&this.owner.setLocalGrouping(this);b.ownerChanged.call(this,e,g);!this.owner&&this.autoDestroyWithNoOwner&&this.destroy()},map_:null,autoDestroyWithNoOwner:true,autoDestroyEmptyGroups:true,titleGetter:D("data.title"),groupGetter:Function.$undef,childClass:k,childFactory:function(e){return new this.childClass(a(e,{titleGetter:this.titleGetter,autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups}))},init:function(e){this.map_={};this.nullGroup=new k({autoDestroyIfEmpty:false});
f.prototype.init.call(this,e)},getGroupNode:function(e){e=this.groupGetter(e);var g=e instanceof y,j=this.map_[g?e.eventObjectId:e];if(!j&&!this.dataSource)j=this.appendChild(g?{delegate:e}:{data:{id:e,title:e}});return j||this.nullGroup},insertBefore:function(e,g){e=m.insertBefore.call(this,e,g);if("groupId_"in e==false){e.groupId_=e.delegate?e.delegate.eventObjectId:e.data.id;this.map_[e.groupId_]=e}if(e.first){var j=this.owner,o=j.childNodes,r=e.first,A=e.last,B,p,s;for(B=e;B=B.previousSibling;)if(s=
B.last)break;if(!s)s=this.nullGroup.last;for(B=e;B=B.nextSibling;)if(p=B.first)break;if(r.previousSibling!==s||A.nextSibling!==p){if(r.previousSibling)r.previousSibling.nextSibling=A.nextSibling;if(A.nextSibling)A.nextSibling.previousSibling=r.previousSibling;B=o.splice(o.indexOf(r),e.nodes.length);var u=o.indexOf(p);B.unshift(u!=-1?u:o.length,0);o.splice.apply(o,B);r.previousSibling=s;A.nextSibling=p;if(s)s.nextSibling=r;if(p)p.previousSibling=A;j.firstChild=o[0];j.lastChild=o[o.length-1]}}return e},
removeChild:function(e){m.removeChild.call(this,e);delete this.map_[e.groupId_];return e},clear:function(){m.clear.call(this);this.map_={}},destroy:function(){this.setOwner();f.prototype.destroy.call(this);this.map_=null}});f.prototype.localGroupingClass=t;x=H(R,{autoDestroy:true,sourceNode:null,listen:{sourceNode:{childNodesModified:function(e,g){var j=this.memberMap_,o={},r=0,A=0,B=g.inserted,p=g.deleted;if(B&&B.length)for(o.inserted=B;e=B[r];){j[e.eventObjectId]=e;r++}if(p&&p.length)for(o.deleted=
p;e=p[A];){delete j[e.eventObjectId];A++}if(r||A)this.event_datasetChanged(this,o)},destroy:function(){this.autoDestroy?this.destroy():this.setSourceNode()}}},event_sourceNodeChanged:x("sourceNodeChanged")&&function(e,g){b.sourceNodeChanged.call(this,e,g);!this.sourceNode&&this.autoDestroy&&this.destroy()},extendConstructor_:false,init:function(e,g){R.prototype.init.call(this,g);e&&this.setSourceNode(e)},setSourceNode:function(e){if(e instanceof f==false)e=null;if(e!==this.sourceNode){var g=this.sourceNode,
j=this.listen.sourceNode;this.sourceNode=e;if(j){var o=j.childNodesModified;if(g){g.removeHandler(j,this);o&&o.call(this,g,{deleted:g.childNodes})}if(e){e.addHandler(j,this);o&&o.call(this,e,{inserted:e.childNodes})}}this.event_sourceNodeChanged(this,g)}},destroy:function(){this.setSourceNode();R.prototype.destroy.call(this)}});var z=H(K,{multiple:false,event_datasetChanged:function(e,g){K.prototype.event_datasetChanged.call(this,e,g);if(g.inserted)for(var j=0,o;o=g.inserted[j];j++)if(!o.selected){o.selected=
true;o.event_select()}if(g.deleted)for(j=0;o=g.deleted[j];j++)if(o.selected){o.selected=false;o.event_unselect()}},add:function(e){if(!this.multiple)if(this.itemCount)return this.set(e);else e.splice(1);for(var g=[],j=0,o;o=e[j];j++)o.contextSelection==this&&o.selectable&&g.push(o);return K.prototype.add.call(this,g)},set:function(e){for(var g=[],j=0,o;o=e[j];j++)o.contextSelection==this&&o.selectable&&g.push(o);this.multiple||e.splice(1);return K.prototype.set.call(this,g)}});v.namespace("basis.dom.wrapper",
M).extend({DELEGATE:c,AbstractNode:f,InteractiveNode:E,Node:q,GroupingNode:t,PartitionNode:k,simpleTemplate:M,ChildNodesDataset:x,Selection:z})})(basis);
(function(v,I){function G(g,j){return V(j,true).getRule(g,true)}function T(g,j){var o=g.match(/^([^{]+)\{(.*)\}\s*$/);if(o){for(var r=o[1].trim().split(/\s*,\s*/),A=0;A<r.length;A++)this.addRule(r[A],o[2]||null,j++);return j-1}}function O(g,j){var o=C.createElement(!g?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:j?"alternate ":"",url:g.quote('"')}));C.tag(null,"HEAD")[0].appendChild(o);o=o.sheet||o.styleSheet;try{if(!o.cssRules)o.cssRules=o.rules}catch(r){}if(!o.insertRule)o.insertRule=
T;if(!o.deleteRule)o.deleteRule=o.removeRule;return o}function V(g,j){g||(g="DefaultGenericStyleSheet");if(!c[g])if(j)c[g]=new l(O());return c[g]}function Q(g,j,o,r){r=r||{};j=j.qw();for(var A=0,B;B=j[A];A++)if(typeof i.style[B]!="undefined"){if(o)v.platformFeature["css-"+g]=B;h[g]={key:B,getter:r[B]};return}}function M(g,j){var o=h[g];if(g=o?o.key:g.replace(/^-ms-/,"ms-").camelize())return{key:g,value:o&&o.getter?o.getter(j):j}}function H(g,j,o){if(typeof g.setProperty=="function")return g.setProperty(j,
o);if(j=M(j,o))return g.style[j.key]=j.value}function J(g,j){for(var o in j)H(g,o,j[o]);return g}function x(g,j){return H(g,"display",typeof j=="string"?j:j?"":"none")}function E(g,j){return H(g,"visibility",j?"":"hidden")}function y(g){return q[g]||(q[g]=new RegExp("\\s*\\b"+g+"\\b"))}function R(g,j){var o=(j?"g":"s")+g;return z[o]||(z[o]=new RegExp((j?"":"\\s*")+"\\b"+g+"\\S*\\b"))}var K=I.document,C=v.dom,N=v.dom.event,D=v.Class,a=/\s*!important/i,d=String("important"),b=1,c={},h={},i=C.createElement("DIV");
Q("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(g){return"alpha(opacity:"+parseInt(g*100)+")"}});Q("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);Q("float","cssFloat styleFloat");var l=D(null,{styleSheet:null,rules:null,init:function(g){this.styleSheet=g;this.rules=[];this.map_={}},getRule:function(g,j){if(!this.map_[g])if(j){for(var o=this.styleSheet,r=this.rules.length,A=o.insertRule(g+"{}",r),B=r;B<=A;B++)this.rules.push(new n(o.cssRules[B]));
this.map_[g]=r!=A?new f(this.rules.splice(r)):this.rules[r]}return this.map_[g]},deleteRule:function(g){var j=this.map_[g];if(j){j=j.rules||[j];for(var o=0;o<j.length;o++){var r=this.rules.indexOf(j[o]);this.stylesheet.deleteRule(r);this.rules.splice(r,1)}delete this.map_[g]}},destroy:function(){delete this.rules}}),n=D(null,{rule:null,selector:"",init:function(g){if(g){this.rule=g;this.selector=g.selectorText}},setProperty:function(g,j){var o,r=!!a.test(j),A=this.rule.style;if(r||(A.getPropertyPriority?
A.getPropertyPriority(g)==d:false)){j=j.replace(a,"");if(o=M(g,j)){var B=o.key;if(A.setProperty){r||A.removeProperty(B);A.setProperty(B,o.value,r?d:"")}else{o=B+": "+o.value+(r?" !"+d:"")+";";A.cssText=A.cssText.replace(new RegExp(A[B]?B+"\\s*:\\s*"+A[B]+"(\\s*!"+d+")?\\s*;?":"^","i"),o)}}}else H(this.rule,g,j)},setStyle:function(g){Object.iterate(g,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){delete this.rule}}),f=D(null,{rules:null,init:function(g){this.rules=
g},destroy:function(){delete this.rules}});["setProperty","setStyle","clear"].forEach(function(g){f.prototype[g]=function(){for(var j,o=0;j=this.rules[o];o++)j[g].apply(j,arguments)}});var k={};["em","ex","px","%"].forEach(function(g){k[g=="%"?"percent":g]=function(j){return j==0||isNaN(j)?"0":j+g}});var m,q={},t=D(null,{init:function(g){this.element=g},toString:function(){return this.element.className},set:function(g){this.clear();g.qw().forEach(this.add,this)},replace:function(g,j,o){o=o||"";typeof g!=
"undefined"&&this.remove(o+g);typeof j!="undefined"&&this.add(o+j)},bool:function(g,j){j?this.add(g):this.remove(g)},clear:function(){this.element.className=""},contains:function(g){return!!this.element.className.match(y(g))},item:function(g){return this.element.className.qw()[g]},add:function(g){this.element.className.match(y(g))||(this.element.className+=" "+g)},remove:function(g){var j=this.element.className;g=j.replace(y(g),"");if(g!=j)this.element.className=g},toggle:function(g){var j=this.contains(g);
j?this.remove(g):this.add(g);return!j}}),z={},e=D(null,{delim:"-",init:function(g,j){this.classList=j;this.prefix=g+this.delim},add:function(g){this.classList.add(this.prefix+g)},remove:function(g){this.classList.remove(this.prefix+g)},items:function(){var g=this.classList.toString();if(g)return g.toString().match(R(this.prefix,true))},set:function(g){var j=this.items();g=typeof g!="undefined"?this.prefix+g:"";var o=this.classList;if(j)if(j.length==1){if(j[0]===g)return;o.remove(j[0])}else this.clear();
g&&o.add(g)},clear:function(){this.items().forEach(this.classList.remove,this.classList)}});if(I.DOMTokenList&&K.documentElement.classList){D=t.prototype;Object.extend(I.DOMTokenList.prototype,{set:D.set,replace:D.replace,bool:D.bool,clear:function(){for(var g=this.length;g-- >0;)this.remove(this[g])},setPrefixToken:D.setPrefixToken});m=function(g){return(typeof g=="string"?C.get(g):g).classList}}else m=function(g){return new t(typeof g=="string"?C.get(g):g)};N.onLoad(function(){m(K.body).bool("opacity-not-support",
!v.platformFeature["css-opacity"])});C.extend({setStyleProperty:H,setStyle:J,display:x,show:function(g){return x(g,1)},hide:function(g){return x(g)},visibility:E,visible:function(g){return E(g,1)},invisible:function(g){return E(g)}});return v.namespace("basis.cssom").extend({setStyleProperty:H,setStyle:J,classList:function(g,j){return j?new e(j,m(g)):m(g)},uniqueRule:function(g){var j="genericRule-"+b++;g&&m(g).add(j);g=G("."+j);g.token=j;return g},cssRule:G,getStyleSheet:V,addStyleSheet:O,CssStyleSheetWrapper:l,
CssRuleWrapper:n,CssRuleWrapperSet:f}).extend(k)})(basis,this);
(function(){function v(b,c){var h={},i;if(b&&b.length)i=h.inserted=b;if(c&&c.length)i=h.deleted=c;if(i)return h}function I(b,c){if(!b.length)return 0;var h,i,l,n=0,f=b.length-1;do{h=n+f>>1;l=b[h].value||0;if(l===i){l=b[h].object.eventObjectId;i=c.object.eventObjectId}else i=c.value||0;if(i<l)f=h-1;else if(i>l)n=h+1;else return i==l?h:0}while(n<=f);return h+(l<i)}var G=basis.Class,T=Object.extend,O=Object.values,V=Function.$self,Q=Function.$true,M=Function.$false,H=basis.EventObject.createEvent,J=
basis.data.SUBSCRIPTION,x=basis.data.DataObject,E=basis.data.KeyObjectMap,y=basis.data.AbstractDataset,R=basis.data.Dataset;J.add("SOURCE",{sourceChanged:function(b,c){this.remove(b,c);this.add(b,b.source)},sourcesChanged:function(b,c){var h;if(h=c.inserted)for(var i=h.length;i-- >0;)this.add(b,h[i]);if(h=c.deleted)for(i=h.length;i-- >0;)this.remove(b,h[i])}},function(b,c){for(var h=c.sources||[c.source],i=0,l;l=h[i++];)b(c,l)});J.add("MINUEND",{operandsChanged:function(b,c){if(this.minuend!==c){this.remove(b,
c);this.add(b,b.minuend)}}},function(b,c){b(c,c.minuend)});J.add("SUBTRAHEND",{operandsChanged:function(b,c,h){if(this.subtrahend!==h){this.remove(b,h);this.add(b,b.subtrahend)}}},function(b,c){b(c,c.subtrahend)});var K={datasetChanged:function(b,c){var h=this.memberMap_,i={},l,n;if(c.inserted)for(var f=0;l=c.inserted[f];f++){n=l.eventObjectId;if(h[n])h[n].count++;else h[n]={count:1,object:l};i[n]=h[n]}if(c.deleted)for(f=0;l=c.deleted[f];f++){n=l.eventObjectId;i[n]=h[n];h[n].count--}this.applyRule(i)},
destroy:function(b){this.removeSource(b)}},C=G(y,{subscribeTo:J.SOURCE,event_sourcesChanged:H("sourcesChanged","dataset","delta"),sources:null,rule:function(b){return b>0},listen:{source:K},init:function(b){y.prototype.init.call(this,b);b=this.sources;this.sources=[];b&&b.forEach(this.addSource,this)},setRule:function(b){if(typeof b!="function")b=C.UNION;if(this.rule!==b){this.rule=b;this.applyRule()}},applyRule:function(b){var c=this.memberMap_,h=this.rule,i=this.sources.length,l=[],n=[],f,k;b||
(b=c);for(var m in b){f=c[m];k=i&&f.count&&h(f.count,i);if(k!=!!this.item_[m])(k?l:n).push(f.object);f.count==0&&delete c[m]}if(b=v(l,n))this.event_datasetChanged(this,b)},addSource:function(b){if(b instanceof y)if(this.sources.add(b)){this.listen.source&&b.addHandler(this.listen.source,this);var c=this.memberMap_;for(var h in b.item_)if(c[h])c[h].count++;else c[h]={count:1,object:b.item_[h]};this.applyRule();this.event_sourcesChanged(this,{inserted:[b]});return true}},removeSource:function(b){if(this.sources.remove(b)){this.listen.source&&
b.removeHandler(this.listen.source,this);var c=this.memberMap_;for(var h in b.item_)c[h].count--;this.applyRule();this.event_sourcesChanged(this,{deleted:[b]});return true}},setSources:function(b){for(var c=Array.from(this.sources),h=0,i;i=b[h];h++)if(i instanceof y)c.remove(i)||this.addSource(i);c.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){y.prototype.destroy.call(this);this.sources=null}});C.UNION=C.prototype.rule;
C.INTERSECTION=function(b,c){return b==c};C.DIFFERENCE=function(b){return b==1};C.MORE_THAN_ONE_INCLUDE=function(b,c){return c==1||b>1};C.AT_LEAST_ONE_EXCLUDE=function(b,c){return c==1||b<c};var N=function(b){return!this.has(b)};K={datasetChanged:function(b,c){if(this.subtrahend){var h=v(c.inserted&&c.inserted.filter(N,this.subtrahend),c.deleted&&c.deleted.filter(this.has,this));h&&this.event_datasetChanged(this,h)}},destroy:function(){this.setOperands(null,this.subtrahend)}};var D={datasetChanged:function(b,
c){if(this.minuend){var h=v(c.deleted&&c.deleted.filter(N,this),c.inserted&&c.inserted.filter(this.has,this));h&&this.event_datasetChanged(this,h)}},destroy:function(){this.setOperands(this.minuend,null)}};K=G(y,{subscribeTo:J.MINUEND+J.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:H("operandsChanged","dataset","oldMinuend","oldSubtrahend"),listen:{minuend:K,subtrahend:D},init:function(b){y.prototype.init.call(this,b);b=this.minuend;var c=this.subtrahend;this.subtrahend=this.minuend=
null;if(b||c)this.setOperands(b,c)},setOperands:function(b,c){var h,i=false;if(b instanceof y==false)b=null;if(c instanceof y==false)c=null;var l=this.minuend,n=this.subtrahend;if(l!==b){i=true;this.minuend=b;var f=this.listen.minuend;if(f){l&&l.removeHandler(f,this);b&&b.addHandler(f,this)}}if(n!==c){i=true;this.subtrahend=c;if(f=this.listen.subtrahend){n&&n.removeHandler(f,this);c&&c.addHandler(f,this)}}if(!i)return false;this.event_operandsChanged(this,l,n);if(!b||!c){if(this.itemCount)this.event_datasetChanged(this,
h={deleted:this.getItems()})}else{h=[];i=[];for(var k in this.item_)if(!b.item_[k]||c.item_[k])h.push(this.item_[k]);for(k in b.item_)!this.item_[k]&&!c.item_[k]&&i.push(b.item_[k]);if(h=v(i,h))this.event_datasetChanged(this,h)}return h},clear:function(){this.setOperands()}});var a={subscribeTo:J.SOURCE,source:null,sourceMap_:null,event_sourceChanged:H("sourceChanged","dataset","oldSource"),init:function(b){this.sourceMap_={};y.prototype.init.call(this,b);if(b=this.source){this.source=null;this.setSource(b)}},
setSource:function(b){if(b instanceof y==false)b=null;if(this.source!==b){var c=this.source,h=this.listen.source;this.source=b;if(h){var i=h.datasetChanged;if(c){c.removeHandler(h,this);i&&i.call(this,c,{deleted:c.getItems()})}if(b){b.addHandler(h,this);i&&i.call(this,b,{inserted:b.getItems()})}}this.event_sourceChanged(this,c)}},clear:function(){this.setSource()}},d=G(y,a,{map:V,reduce:M,rule:Q,addMemberRef:null,removeMemberRef:null,listen:{sourceObject:{update:function(b){var c=this.map?this.map(b):
b;if(c instanceof x==false||this.reduce(c))c=null;var h=this.sourceMap_[b.eventObjectId],i=h.member;if(i!=c){var l=this.memberMap_,n,f;h.member=c;if(i){h=i.eventObjectId;this.removeMemberRef&&this.removeMemberRef(i,b);if(--l[h]==0){delete l[h];f=[i]}}if(c){i=c.eventObjectId;this.addMemberRef&&this.addMemberRef(c,b);if(l[i])l[i]++;else{l[i]=1;n=[c]}}if(b=v(n,f))this.event_datasetChanged(this,b)}}},source:{datasetChanged:function(b,c){var h=this.sourceMap_,i=this.memberMap_,l=[],n=[],f,k,m,q=this.listen.sourceObject;
R.setAccumulateState(true);if(c.inserted)for(var t=0;f=c.inserted[t];t++){m=this.map?this.map(f):f;if(m instanceof x==false||this.reduce(m))m=null;q&&f.addHandler(q,this);h[f.eventObjectId]={sourceObject:f,member:m};if(m){k=m.eventObjectId;if(i[k])i[k]++;else{i[k]=1;l.push(m)}this.addMemberRef&&this.addMemberRef(m,f)}}if(c.deleted)for(t=0;f=c.deleted[t];t++){k=f.eventObjectId;m=h[k].member;q&&f.removeHandler(q,this);delete h[k];if(m){k=m.eventObjectId;if(--i[k]==0){delete i[k];n.push(m)}this.removeMemberRef&&
this.removeMemberRef(m,f)}}R.setAccumulateState(false);if(c=v(l,n))this.event_datasetChanged(this,c)},destroy:function(){this.setSource()}}},init:function(b){a.init.call(this,b)},setRule:function(b){if(typeof b!="function")b=Q;if(this.rule!==b){this.rule=b;return this.applyRule()}},setMap:function(b){if(typeof b!="function")b=V;if(this.map!==b){this.map=b;return this.applyRule()}},setReduce:function(b){if(typeof b!="function")b=M;if(this.reduce!==b){this.reduce=b;return this.applyRule()}},applyRule:function(){var b=
this.sourceMap_,c=this.memberMap_,h,i,l,n,f,k=[],m=[];for(var q in b){f=b[q];n=f.sourceObject;h=f.member;i=this.map?this.map(n):n;if(i instanceof x==false||this.reduce(i))i=null;if(h!=i){f.member=i;if(h){l=h.eventObjectId;this.removeMemberRef&&this.removeMemberRef(h,n);c[l]--}if(i){h=i.eventObjectId;this.addMemberRef&&this.addMemberRef(i,n);if(h in c)c[h]++;else{c[h]=1;k.push(i)}}}}for(l in this.item_)if(c[l]==0){delete c[l];m.push(this.item_[l])}if(b=v(k,m))this.event_datasetChanged(this,b);return b},
destroy:function(){y.prototype.destroy.call(this);this.sourceMap_=null}});H=G(d,{reduce:function(b){return!this.rule(b)}});J=G(d,{map:function(b){return this.keyMap.resolve(b)},subsetClass:y,keyMap:null,addMemberRef:function(b,c){b.event_datasetChanged(b,{inserted:[c]})},removeMemberRef:function(b,c){b.event_datasetChanged(b,{deleted:[c]})},init:function(b){if(!this.keyMap||this.keyMap instanceof E==false)this.keyMap=new E(T({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));d.prototype.init.call(this,
b)},getSubset:function(b,c){return this.keyMap.get(b,c)},destroy:function(){d.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});D=G(y,a,{rule:Q,index_:null,offset:0,limit:10,listen:{sourceObject:{update:function(b){var c=this.sourceMap_[b.eventObjectId];b=this.rule(b);var h=this.index_;if(b!==c.value){h.splice(I(h,c),1);c.value=b;h.splice(I(h,c),0,c);this.applyRule()}}},source:{datasetChanged:function(b,c){var h=this.sourceMap_,i=this.index_,l=this.listen.sourceObject,n,f;if(f=
c.inserted)for(var k=0,m;m=f[k];k++){n={object:m,value:this.rule(m)};h[m.eventObjectId]=n;i.splice(I(i,n),0,n);l&&m.addHandler(l,this)}if(f=c.deleted)for(k=0;m=f[k];k++){n=h[m.eventObjectId];i.splice(I(i,n),1);l&&m.removeHandler(l,this)}this.applyRule()}}},init:function(b){this.index_=[];a.init.call(this,b)},setRange:function(b,c){this.offset=b;this.limit=c;this.applyRule()},applyRule:function(){for(var b=Object.slice(this.item_),c=this.index_.slice(this.offset,this.offset+this.limit),h=[],i=0,l;l=
c[i];i++){var n=l.object.eventObjectId;if(b[n])delete b[n];else h.push(l.object)}if(b=v(h,O(b)))this.event_datasetChanged(this,b)}});G=G(y,a,{rule:Q,map:V,subsetClass:y,listen:{sourceObject:{update:function(b,c){var h=this.sourceMap_,i=this.memberMap_,l=b.eventObjectId,n=h[l].list;h=h[l].list={};l=this.rule(b);var f=[],k=[],m;if(Array.isArray(l))for(var q=0;q<l.length;q++)if(m=this.keyMap.resolve(l[q])){t=m.eventObjectId;h[t]=m;if(!n[t]){m.event_datasetChanged(m,{inserted:[b]});if(i[t])i[t]++;else{f.push(m);
i[t]=1}}}for(var t in n)if(!h[t]){m=n[t];m.event_datasetChanged(m,{deleted:[b]});if(!--i[t]){delete i[t];k.push(m)}}if(c=v(f,k))this.event_datasetChanged(this,c)}},source:{datasetChanged:function(b,c){var h=this.sourceMap_,i=this.memberMap_,l=this.listen.sourceObject,n,f,k,m=[],q=[];if(n=c.inserted)for(var t=0,z;z=n[t];t++){var e=this.rule(z),g={object:z,list:{}};h[z.eventObjectId]=g;if(Array.isArray(e))for(var j=0;j<e.length;j++)if(f=this.keyMap.resolve(e[j])){f.event_datasetChanged(f,{inserted:[z]});
k=f.eventObjectId;g.list[k]=f;if(i[k])i[k]++;else{m.push(f);i[k]=1}}l&&z.addHandler(l,this)}if(n=c.deleted)for(t=0;z=n[t];t++){f=z.eventObjectId;e=h[f].list;delete h[f];for(k in e){f=e[k];f.event_datasetChanged(f,{deleted:[z]});if(!--i[k]){delete i[k];q.push(f)}}l&&z.removeHandler(l,this)}if(c=v(m,q))this.event_datasetChanged(this,c)}}},init:function(b){if(!this.keyMap||this.keyMap instanceof E==false)this.keyMap=new E(T({keyGetter:this.map,itemClass:this.subsetClass},this.keyMap));a.init.call(this,
b)}});basis.namespace("basis.data.dataset").extend({Merge:C,Subtract:K,MapReduce:d,Subset:H,Split:J,Slice:D,Cloud:G})})(basis,this);
(function(v){function I(p){i[p]=i[p]||0;return p+i[p]++}function G(){var p=Array.from(arguments),s=p.pop();typeof s!="function"&&console.warn("Last argument for calculate field constructor must be a function");for(var u=[],L=[],S=0,aa;S<p.length;S++){aa=p[S].quote('"');u.push(aa+" in delta");L.push("data["+aa+"]")}s=(new Function("calc","return function(delta, data, oldValue){"+(u.length?"if ("+u.join(" || ")+")":"")+"return calc("+L.join(", ")+");"+(u.length?"return oldValue;":"")+"}"))(s);s.args=
p;s.isCalcField=true;return s}function T(){return G.apply(null,Array.from(arguments).concat(function(){for(var p=[],s=arguments.length;s-- >0;){if(arguments[s]==null)return null;p.push(arguments[s])}return p.join("-")}))}var O=v.Class,V=v.Cleaner,Q=Object.extend,M=Function.$self,H=Function.getter,J=v.data,x=v.EventObject,E=J.Dataset,y=J.dataset.Subset,R=J.dataset.Split,K=J.DataObject,C=J.STATE,N={},D={string:1,number:1},a=[],d=function(p){return isNaN(p)?null:Number(p)},b=function(p){return isNaN(p)?
null:Number(p)},c=function(p){return isNaN(p)?null:parseInt(p)},h=function(p){return p==null?null:String(p)},i={},l=v.Class(null,{init:function(p){var s=this.index={};this.normalize=p;this.valueWrapper=function(u,L){var S=p(u,L);if(S!==L&&s[S])return L;return S};this.calcWrapper=function(u,L){var S=p(u,L);if(S!==L&&s[S])throw"Duplicate value for index "+L+" => "+u;return S};V.add(this)},get:function(p,s){var u=this.index[p];if(u&&(!s||u instanceof s))return u},add:function(p,s){var u=this.index[p];
if(s&&(!u||u===s)){this.index[p]=s;return true}},remove:function(p,s){if(this.index[p]===s){delete this.index[p];return true}},destroy:function(){this.index=null}});J=function(p,s){return function(u){return p.prototype[s].call(this,u&&u.map(this.wrapper))}};var n=function(p,s){return function(u){if(!this.name)this.name=I(s);p.prototype.init.call(this,u)}},f=function(p){return function(s,u){E.setAccumulateState(true);s=(s||[]).map(this.wrapper);E.setAccumulateState(false);return p.prototype.sync.call(this,
s,u)}},k=O(E,{wrapper:Function.$self,init:n(E,"EntitySet"),sync:f(E),set:J(E,"set"),add:J(E,"add"),remove:J(E,"remove"),destroy:function(){E.prototype.destroy.call(this);delete this.wrapper}}),m=O(k,{set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false}),q=O(y,{init:n(y,"EntityCollection"),sync:f(y)});q.sourceHandler=y.sourceHandler;var t=O(R,{subsetClass:m,init:n(R,"EntityGrouping"),sync:f(R),getSubset:function(p,s){var u=R.prototype.getSubset.call(this,p,s);if(u)u.wrapper=
this.wrapper;return u}}),z=function(p){if(this instanceof z){var s=new e(p||M);return function(u,L){if(u!=null){L instanceof k||(L=s.createEntitySet());L.set(u instanceof E?u.getItems():Array.from(u));return L}else return null}}};z.className="basis.entity.EntitySetWrapper";var e=O(null,{init:function(p){this.wrapper=p},createEntitySet:function(){return new k({wrapper:this.wrapper,name:"Set of "+((this.wrapper.entityType||this.wrapper).name||"").quote("{")})}}),g=function(p){if(this instanceof g){var s=
function(F,W){if(F!=null){if(F===W||F.entityType===u)return F;var $,Y=u.idField;if(D[typeof F]){if(!Y)return;$=F;F={};F[Y]=$}else if(u.compositeKey)$=u.compositeKey(F,F);else if(Y)$=F[Y];else if(aa){W=u.singleton;if(!W)return u.singleton=new S(F)}if($!=null&&L)W=L.get($,u.entityClass);if(W&&W.entityType===u)W.update(F);else W=new S(F);return W}else return u.singleton},u=new r(p||{},s),L=u.index__,S=u.entityClass,aa=u.isSingleton;Q(s,{toString:function(){return this.typeName+"()"},entityType:u,type:s,
typeName:u.name,index:L,reader:function(F){return u.reader(F)},get:function(F){return u.get(F)},addField:function(F,W){u.addField(F,W)},all:u.all,createCollection:function(F,W,$){var Y=u.collection_[F];if(!Y&&W)return u.collection_[F]=new q({wrapper:s,source:$||u.all,rule:W});return Y},getCollection:function(F){return u.collection_[F]},createGrouping:function(F,W,$){var Y=u.grouping_[F];if(!Y&&W)return u.grouping_[F]=new t({wrapper:s,source:$||u.all,rule:W});return Y},getGrouping:function(F){return u.grouping_[F]},
getSlot:function(F,W){return u.getSlot(F,W)}});return s}};g.className="basis.entity.EntityTypeWrapper";var j=H("singleton"),o={};O(K,{});var r=O(null,{name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(p,s){this.name=p.name||I(this.name);this.index__=p.index;this.idFields={};a.push(this);this.isSingleton=p.isSingleton;this.wrapper=s;this.all=new m(Object.extend(p.all||{},{wrapper:s}));this.slot_={};if(p.extensible)this.extensible=true;this.fields=
{};this.defaults={};this.aliases={};this.getters={};Object.iterate(p.fields,this.addField,this);p.constrains&&p.constrains.forEach(function(L){this.addCalcField(null,L)},this);if(this.isSingleton)this.get=j;p.aliases&&Object.iterate(p.aliases,this.addAlias,this);this.collection_={};if(p.collections)for(var u in p.collections)this.collection_[u]=new q({name:u,wrapper:s,source:this.all,rule:p.collections[u]||Function.$true});this.grouping_={};if(p.groupings)for(u in p.groupings)this.grouping_[u]=new t({name:u,
wrapper:s,source:this.all,rule:p.groupings[u]||Function.$true});this.entityClass=B(this,this.all,this.index__,this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:s,typeName:this.name,getId:function(){return this.__id__}})},reader:function(p){var s={};if(D[typeof p]){if(this.idField){s[this.idField]=p;return s}return null}if(!p||p==null)return null;for(var u in p){var L=u in this.aliases?this.aliases[u]:"";if(L&&L in this.fields)s[L]=this.fields[L].reader?this.fields[L].reader(p[u]):
p[u]}return s},addAlias:function(p,s){if(s in this.fields)if(p in this.aliases==false)this.aliases[p]=s},addField:function(p,s){if(!this.all.itemCount){this.aliases[p]=p;if(typeof s=="function")s={type:s};if("type"in s&&typeof s.type!="function")s.type=M;var u=s.type||M;if([d,b,c,h].has(u))s.id=true;if(s.id){if(!this.index__)this.index__=new l(String);this.idFields[p]=true;if(this.idField||this.compositeKey){this.idField=null;this.compositeKey=T.apply(null,Object.keys(this.idFields))}else this.idField=
p}if(s.calc)this.addCalcField(p,s.calc,void 0);else this.fields[p]=u;this.defaults[p]="defValue"in s?s.defValue:u();this.getters["get_"+p]=function(){return this.data[p]};o[p]||(o[p]={destroy:function(){this.set(p,null)}})}},addCalcField:function(p,s,u){if(!(p&&this.fields[p])){if(!this.calcs)this.calcs=[];for(var L={args:s.args,wrapper:!u?s:function(W,$,Y){return u(s(W,$,Y))}},S=this.calcs.length,aa=0,F=0;F<this.calcs.length;F++)if(s.args.has(this.calcs[F].key))aa=F+1;if(p){L.key=p;for(F=0;F<this.calcs.length;F++)if(this.calcs[F].args.has(p)){S=
F;break}if(aa>S)return;if(this.idField&&p==this.idField)this.compositeKey=s;this.fields[p]=function(W,$){typeof console!="undefined"&&console.log("Calculate fields are readonly");return $}}else S=aa;this.calcs.splice(Math.min(S,aa),0,L)}},get:function(p){p=this.getId(p);if(p!=null)return this.index__.get(p,this.entityClass)},getId:function(p){if((this.idField||this.compositeKey)&&p!=null){if(D[typeof p])return p;if(p&&p.entityType===this)return p.__id__;if(p instanceof K)p=p.data;return this.compositeKey?
this.compositeKey(p,p):p[this.idField]}},getSlot:function(p){var s=this.getId(p);if(s!=null){var u=this.slot_[s];if(!u){if(D[typeof p]){u={};if(this.idField&&!this.compositeKey)u[this.idField]=p;p=u}u=this.slot_[s]=new K({delegate:this.get(s),data:p})}return u}}}),A=O(K,{init:x.prototype.init,event_rollbackUpdate:x.createEvent("rollbackUpdate")}),B=function(p,s,u,L,S,aa,F){function W(w,P,Z){var ba=false,ca=p.calcs,X=w.__id__,U=w.data;try{if(ca)for(var da=0,fa;fa=ca[da++];){var ea=fa.key;if(ea){var ha=
U[ea];U[ea]=fa.wrapper(P,U,U[ea]);if(U[ea]!==ha){P[ea]=ha;ba=true}}else fa.wrapper(P,U)}if(p.compositeKey)w.__id__=p.compositeKey(P,U,w.__id__);else if(Y&&Y in P)w.__id__=U[Y];w.__id__!==X&&p.index__.calcWrapper(w.__id__)}catch(ia){w.__id__=X;for(var ga in P)w.data[ga]=P[ga];if(Z)for(ga in Z)if(!w.modified)w.modified=Z;ba=false}w.__id__!==X&&$(w,X,w.__id__);return ba}function $(w,P,Z){if(P!=null){u.remove(P,w);L[P]&&L[P].setDelegate()}if(Z!=null){u.add(Z,w);L[Z]&&L[Z].setDelegate(w)}}var Y=p.idField;
return O(A,F,{canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(w){A.prototype.init.call(this);this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var P,Z={};for(var ba in S){if(ba in w){Z[ba]=aa[ba];P=S[ba](w[ba])}else P=aa[ba];if(P&&P!==this&&P instanceof x)if(P.addHandler(o[ba],this))this.fieldHandlers_[ba]=true;this.data[ba]=P}W(this,Z);s.event_datasetChanged(s,{inserted:[this]})},toString:function(){return"[object "+this.constructor.className+
"("+this.entityType.name+")]"},get:function(w){return this.data[w]},set:function(w,P,Z,ba){var ca=S[w];if(!ca){if(!p.extensible)return;ca=M}var X,U=this.modified;P=ca(P,this.data[w]);ca=this.data[w];if(P!==ca&&(!P||!ca||P.constructor!==Date||ca.constructor!==Date||+P!==+ca))a:{X={};if(w!=Y)if(Z){if(!U)this.modified=U={};if(w in U===false){X.rollback={key:w,value:undefined};U[w]=ca}else if(U[w]===P){X.rollback={key:w,value:P};delete U[w];if(!Object.keys(U).length)this.modified=null}}else if(U&&w in
U)if(U[w]!==P){X.rollback={key:w,value:U[w]};U[w]=P;break a}else return false;this.data[w]=P;if(this.fieldHandlers_[w]){ca.removeHandler(o[w],this);this.fieldHandlers_[w]=false}if(P&&P!==this&&P instanceof x)if(P.addHandler(o[w],this))this.fieldHandlers_[w]=true;X.key=w;X.value=ca;X.delta={};X.delta[w]=ca}else if(!Z&&U&&w in U){X={rollback:{key:w,value:U[w]}};delete U[w];if(!Object.keys(U).length)this.modified=null}if(!ba&&X){Z=X.key;w=X.delta||{};var da;if(X.rollback){da={};da[X.rollback.key]=X.rollback.value}if(W(this,
w,da))Z=true;if(Z){this.event_update(this,w);X.delta=w}da&&this.event_rollbackUpdate(this,da)}return X||false},update:function(w,P){if(w){var Z,ba={},ca,X={},U;for(var da in w)if(U=this.set(da,w[da],P,true)){if(U.key){Z=true;ba[U.key]=U.value}if(U.rollback){ca=true;X[U.rollback.key]=U.rollback.value}}if(W(this,ba,X))Z=true;Z&&this.event_update(this,ba);ca&&this.event_rollbackUpdate(this,X)}return Z?ba:false},reset:function(){this.update(aa)},clear:function(){var w={};for(var P in this.data)w[P]=undefined;
return this.update(w)},commit:function(w){if(this.modified){var P=this.modified;this.modified=null}this.update(w);P&&this.event_rollbackUpdate(this,P)},rollback:function(){if(this.state!=C.PROCESSING){if(this.modified){var w=this.modified;this.modified=null;this.update(w);this.event_rollbackUpdate(this,w)}this.setState(C.READY)}},destroy:function(){for(var w in this.fieldHandlers_)this.data[w].removeHandler(o[w],this);this.fieldHandlers_=N;this.__id__&&$(this,this.__id__,null);K.prototype.destroy.call(this);
s.event_datasetChanged(s,{deleted:[this]});this.data=N;this.modified=null}})};v.namespace("basis.entity").extend({isEntity:function(p){return p&&p instanceof B},NumericId:d,NumberId:b,IntId:c,StringId:h,Index:l,CalculateField:G,EntityType:g,Entity:B,BaseEntity:A,EntitySetType:z,EntitySet:k,ReadOnlyEntitySet:m,Collection:q,Grouping:t})})(basis);
