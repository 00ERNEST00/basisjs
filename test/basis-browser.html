<?xml version="1.0" encoding="windows-1251"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html lang="ru" xml:lang="ru">

<head>
  <meta http-equiv="Content-type" content="text/html; charset=windows-1251" />
  <title>Basis Test Suite - Browser</title>

  <style type="text/css">
    @import "style/default/style.css";

    /* */
    BODY
    {
      font-family: Georgia;
      font-size: small;
      _font-size: x-small;
    }
  </style>
  
  <script type="text/javascript"  src="../basis.js"></script>
  <script type="text/javascript"  src="../dom_wraper.js"></script>
  <script type="text/javascript"  src="test.js"></script>
  <script type="text/javascript"  src="common.js"></script>
</head>

<body>

  <script type="text/javascript">
    loadTest((function(){

      var Event = Basis.Event;
      var CSS = Basis.CSS;
      var Tester = Basis.Test.Tester;
      var DOM = Basis.DOM;
      var Browser = Basis.Browser;

      var CookieName;

      return [
        {
          name: 'Cookie',
          testcase: [
            {
              name: 'set',
              test: function(){
                CookieName = 'test-cookie-' + Math.random().toFixed(8).substr(2);

                Browser.Cookies.set(CookieName, 1);
                this.is(true, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*1\\s*(;|$)')).test(document.cookie), true);

                Browser.Cookies.set(CookieName, 'basis-test');
                this.is(true, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*basis-test\\s*(;|$)')).test(document.cookie), true);

                Browser.Cookies.set(CookieName);
                this.is(true, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=?\\s*(;|$)')).test(document.cookie), true);
              }
            },
            {
              name: 'get',
              test: function(){
                Browser.Cookies.set(CookieName, 1);
                this.is('1', Browser.Cookies.get(CookieName));

                Browser.Cookies.set(CookieName, 'basis-test');
                this.is('basis-test', Browser.Cookies.get(CookieName));

                Browser.Cookies.set(CookieName);
                this.is('', Browser.Cookies.get(CookieName));

                Browser.Cookies.set(CookieName, 'Привет мир');
                this.is('Привет мир', Browser.Cookies.get(CookieName));
              }
            },
            {
              name: 'remove',
              test: function(){
                Browser.Cookies.set(CookieName, 1);
                this.is(true, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*1\\s*(;|$)')).test(document.cookie), true);

                Browser.Cookies.remove(CookieName);
                this.is(false, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*1\\s*(;|$)')).test(document.cookie), true);
                this.is(false, (new RegExp(CookieName)).test(document.cookie), true);
              }
            },
            {
              name: 'remove by path',
              test: function(){
                var path = location.pathname.replace(/\/[^\/]+$/, '/');

                // set with path
                Browser.Cookies.set(CookieName, 1, 0, path);
                //alert(CookieName + '\n' + document.cookie);
                this.is(true, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*1\\s*(;|$)')).test(document.cookie), true);

                // no effect for remove without path
                Browser.Cookies.remove(CookieName);
                this.is(true, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*1\\s*(;|$)')).test(document.cookie));
                this.is(true, (new RegExp(CookieName)).test(document.cookie));

                // remove
                Browser.Cookies.remove(CookieName, path);
                this.is(false, (new RegExp('(^|\;)\\s*' + CookieName + '\\s*=\\s*1\\s*(;|$)')).test(document.cookie));
                this.is(false, (new RegExp(CookieName)).test(document.cookie));
              }
            }
          ]
        },
        {
          name: 'clear test cookies',
          test: function(){
            document.cookie = CookieName + '=;expires=' + new Date(0);
          }
        }
      ];

    })());

//    if (top.nextTest)
//      top.nextTest();

  </script>
</body>

</html>